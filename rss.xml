<?xml version="1.0" encoding="utf-8"?>






<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>WSS.COOL</title>
        <link>https://wss.cool/</link>
        <description>现在是一名前端，希望转到后端，最后做架构师。这里记录了常用到的前端、后端、服务器和各种工具的常用api、知识点等。记录的api方便查找，记录的知识点作为一种输出可以增加理解。</description>
        <generator>Hugo 0.68.3 https://gohugo.io/</generator>
        
            <language>zh-CN</language>
        
        
            <managingEditor>wss.six@foxmail.com (王书硕)</managingEditor>
        
        
            <webMaster>wss.six@foxmail.com (王书硕)</webMaster>
        
        
            <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
        
        <lastBuildDate>Tue, 27 Apr 2021 02:54:58 +0000</lastBuildDate>
        
            <atom:link rel="self" type="application/rss+xml" href="https://wss.cool/rss.xml" />
        
        
            <item>
                <title>Goland</title>
                <link>https://wss.cool/goland.html</link>
                <guid isPermaLink="true">https://wss.cool/goland.html</guid>
                <pubDate>Mon, 19 Apr 2021 14:05:03 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="json转换为go的数据结构定义">json转换为go的数据结构定义</h2>
<ol>
<li>copy一段json结构的代码字符串。</li>
<li>ctrl+v 时会有一个dialog提示</li>
<li>结构体中还有嵌入结构体时，可以用 ctrl + shift + alt + T 然后选择 intorduce type...把嵌入的结构体提取出来为一个独立的结构体。</li>
<li>可以改变json的名字格式，alt + enter 选择change field name style in tags 选择fieldName</li>
<li>还可以批量的修改tag的内容，alt + enter 选择 update key value in tags ，输入 ,omitemypty</li>
</ol>
]]></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Head-First-设计模式</title>
                <link>https://wss.cool/head-first-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html</link>
                <guid isPermaLink="true">https://wss.cool/head-first-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html</guid>
                <pubDate>Mon, 12 Apr 2021 13:15:26 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="策略">策略</h2>
<h2 id="观察者">观察者</h2>
<h2 id="装饰器">装饰器</h2>
<h2 id="工厂模式">工厂模式</h2>
<h2 id="单例模式">单例模式</h2>
<h2 id="命令模式">命令模式</h2>
<h2 id="设计原则">设计原则</h2>
<h3 id="好莱坞原则">好莱坞原则</h3>
<p>模板方法模式，父类属于高层组件，子类属于底层组件。父类是冲向类，其中有若干具体抽象方法，他们是算法的某部分的具体实现，由子类提供。父类还可以定义钩子，用于控制算法流程。</p>
<p>好莱坞原则是说，高层组件会去调用底层组件的方法，不要反向调用。</p>
<p>这样做的好处是避免环形依赖。解耦，其他代码只依赖高级组件，可以减少整个系统的依赖。</p>
<p>框架中比较多。框架提供模板，实现算法的步骤，细节交给使用者实现。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%88%86%E7%B1%BB/">分类</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E6%98%BE%E7%A4%BA%E5%9C%A8%E5%BA%95%E9%83%A8/">显示在底部</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>PostgreSQL</title>
                <link>https://wss.cool/postgresql.html</link>
                <guid isPermaLink="true">https://wss.cool/postgresql.html</guid>
                <pubDate>Sun, 07 Feb 2021 14:08:07 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="允许被远程访问">允许被远程访问</h2>
<p>在目录 /etc/postgresql/9.x/main 下</p>
<ol>
<li>
<p>允许任意IP的连接请求
postgresql.conf 文件
去掉注释，并修改 <code>listen_addresses = '*'</code></p>
</li>
<li>
<p>允许密码认证
pg_hba.conf 文件</p>
</li>
</ol>
<pre><code># TYPE  DATABASE  USER  CIDR-ADDRESS  METHOD
host  all  all 0.0.0.0/0 md5
</code></pre><ol start="3">
<li>重启</li>
</ol>
<pre><code>sudo service postgresql restart
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Cli工具--Gg</title>
                <link>https://wss.cool/cli%E5%B7%A5%E5%85%B7-gg.html</link>
                <guid isPermaLink="true">https://wss.cool/cli%E5%B7%A5%E5%85%B7-gg.html</guid>
                <pubDate>Thu, 04 Feb 2021 18:49:54 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>使用了这几个库</p>
<ul>
<li>github.com/atotto/clipboard</li>
<li>github.com/urfave/cli/v2</li>
</ul>
<p><code>gg r</code>快速的往gitlab提一个 merge request 。</p>
<ul>
<li>bufio.NewReader 读取用户输入</li>
<li>go exec 执行命令</li>
<li>读取当前git分支名算法</li>
<li>剪贴板操作</li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Cli</title>
                <link>https://wss.cool/cli.html</link>
                <guid isPermaLink="true">https://wss.cool/cli.html</guid>
                <pubDate>Sun, 31 Jan 2021 22:26:41 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>cli: <a href="https://github.com/urfave/cli/blob/master/docs/v2/manual.md">https://github.com/urfave/cli/blob/master/docs/v2/manual.md</a></p>
<p>交互式: <a href="https://github.com/manifoldco/promptui">https://github.com/manifoldco/promptui</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">app</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">cli</span><span class="p">.</span><span class="nx">App</span><span class="p">{</span>
		<span class="nx">Flags</span><span class="p">:</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span> <span class="p">{</span>
			<span class="o">&amp;</span><span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
        <span class="nx">Name</span><span class="p">:</span>        <span class="s">&#34;lang&#34;</span><span class="p">,</span>
        <span class="nx">Aliases</span><span class="p">:</span>     <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;l&#34;</span><span class="p">},</span>
				<span class="nx">Value</span><span class="p">:</span>       <span class="s">&#34;english&#34;</span><span class="p">,</span>
				<span class="nx">Usage</span><span class="p">:</span>       <span class="s">&#34;language for the greeting&#34;</span><span class="p">,</span>
				<span class="nx">Destination</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">language</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="nx">Action</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
			<span class="nx">name</span> <span class="o">:=</span> <span class="s">&#34;someone&#34;</span>
			<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nf">NArg</span><span class="p">()</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
				<span class="nx">name</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="nx">language</span> <span class="o">==</span> <span class="s">&#34;spanish&#34;</span> <span class="p">{</span>
				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Hola&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="kc">nil</span>
		<span class="p">},</span>
	<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这段代码里既有 arguments 又有 flag 。在使用命令时，要先输入 flag 后输入 arg</p>
<pre><code>go run main.go -lang=spanish wangshushuo
</code></pre><p>flag 部分有多种用法可选：</p>
<ul>
<li>-lang=abc</li>
<li>--lang=abc</li>
<li>--lang abc</li>
</ul>
<p>如果定义里 Aliase 还可以</p>
<ul>
<li>-l abc</li>
</ul>
<h2 id="环境变量">环境变量</h2>
<p>定义 EnvVars 可以用来读取环境变量</p>
<pre><code>app := &amp;cli.App{
  Flags: []cli.Flag{
    &amp;cli.StringFlag{
      Name:    &quot;lang&quot;,
      Aliases: []string{&quot;l&quot;},
      Value:   &quot;english&quot;,
      Usage:   &quot;language for the greeting&quot;,
      EnvVars: []string{&quot;LEGACY_COMPAT_LANG&quot;, &quot;APP_LANG&quot;, &quot;LANG&quot;},
    },
  },
}
</code></pre><h2 id="从文件中取值">从文件中取值</h2>
<p>FilePath</p>
<pre><code>app.Flags = []cli.Flag {
  &amp;cli.StringFlag{
    Name: &quot;password&quot;,
    Aliases: []string{&quot;p&quot;},
    Usage: &quot;password for the mysql database&quot;,
    FilePath: &quot;/etc/mysql/password&quot;,
  },
}
</code></pre><p>文件比环境变量的优先级高。</p>
<h2 id="交互式的获取值">交互式的获取值</h2>
<pre><code>	var language string

	prompt := promptui.Select{
		Label: &quot;Select Day&quot;,
		Items: []string{&quot;spanish&quot;, &quot;english&quot;, &quot;chinese&quot;},
	}

	_, language, err := prompt.Run()

	app := &amp;cli.App{
		Action: func(c *cli.Context) error {
			name := &quot;someone&quot;
			if c.NArg() &gt; 0 {
				name = c.Args().Get(0)
			}
			if language == &quot;spanish&quot; {
				fmt.Println(&quot;Hola&quot;, name)
			} else {
				fmt.Println(&quot;Hello&quot;, name)
			}
			return nil
		},
	}
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Go Tips</title>
                <link>https://wss.cool/gotips.html</link>
                <guid isPermaLink="true">https://wss.cool/gotips.html</guid>
                <pubDate>Wed, 27 Jan 2021 15:03:39 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="去map的size">去map的size</h2>
<p>用 len</p>
<h2 id="遍历map">遍历map</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">m</span> <span class="p">{</span> 
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;key[%s] value[%s]\n&#34;</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><a href="https://stackoverflow.com/questions/1841443/iterating-over-all-the-keys-of-a-map">参考</a></p>
<h2 id="json转换">json转换</h2>
<p>使用<code>encoding/json</code>包的 Unmarshal 和 Marshal 方法，结构体要注明 json</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;encoding/json&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Data</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Votes</span> <span class="o">*</span><span class="nx">Votes</span> <span class="s">`json:&#34;votes&#34;`</span>
    <span class="nx">Count</span> <span class="kt">string</span> <span class="s">`json:&#34;count,omitempty&#34;`</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Votes</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">OptionA</span> <span class="kt">string</span> <span class="s">`json:&#34;option_A&#34;`</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="o">:=</span> <span class="s">`{ &#34;votes&#34;: { &#34;option_A&#34;: &#34;3&#34; } }`</span>
    <span class="nx">data</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Data</span><span class="p">{</span>
        <span class="nx">Votes</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">Votes</span><span class="p">{},</span>
    <span class="p">}</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span> <span class="nx">data</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Votes</span><span class="p">)</span>

    <span class="nx">s2</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">s2</span><span class="p">))</span>

    <span class="nx">data</span><span class="p">.</span><span class="nx">Count</span> <span class="p">=</span> <span class="s">&#34;2&#34;</span>
    <span class="nx">s3</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">s3</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><a href="https://stackoverflow.com/questions/40429296/decode-json-with-unknown-structure">参考</a></p>
<h2 id="指定interface">指定interface</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">a</span> <span class="kd">interface</span><span class="p">{}</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="kt">string</span>

<span class="nx">b</span> <span class="p">=</span> <span class="nx">a</span><span class="p">.(</span><span class="kt">string</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="go-run-失败">go run 失败</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">$ go run main.go
<span class="c1"># command-line-arguments</span>
.<span class="se">\m</span>ain.go:4:2: undefined: a
.<span class="se">\m</span>ain.go:5:2: undefined: average2
</code></pre></td></tr></table>
</div>
</div><p>main.go 文件引用了 package main 中的另外两个文件中的函数。所以 run 命令应该是这样的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">$ go run main.go demo.go average2.go 
</code></pre></td></tr></table>
</div>
</div><p>要把关联的文件都加载才行。</p>
<h2 id="-运算符">* 运算符</h2>
<ul>
<li>声明变量为指针类型
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">myIntPointer</span> <span class="o">*</span><span class="kt">int</span>
<span class="nx">myInt</span> <span class="o">:=</span> <span class="mi">4</span>
<span class="nx">myIntPointer</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">myInt</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>获取指针的值
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">myIntPointer</span><span class="p">)</span> <span class="c1">// 4
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>修改指针指向的变量的值
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">myIntPointer</span> <span class="o">*</span><span class="kt">int</span>
<span class="nx">myInt</span> <span class="o">:=</span> <span class="mi">4</span>
<span class="nx">myIntPointer</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">myInt</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">myIntPointer</span><span class="p">)</span> <span class="c1">//4
</span><span class="c1"></span><span class="o">*</span><span class="nx">myIntPointer</span> <span class="p">=</span> <span class="mi">8</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">myInt</span><span class="p">)</span> <span class="c1">//8
</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="单元测试">单元测试</h2>
<p>命令是 go test 文件名，它会寻找以 _test.go 结尾的文件</p>
<ul>
<li>-v 会打印出执行的用例的名字</li>
<li>-run 加关键字，只会执行相关的文件</li>
</ul>
<p>一个 _test.go 文件内可以有多个测试函数，函数的名字要以 Test 开头</p>
<h2 id="install">install</h2>
<p><code>go install</code> 命令会对当前目录的go程序进行编译并安装编译后的结果文件到指定目录。可以到 <code>cd $GOPATH/bin</code> 目录中查看。</p>
<p>安装后的程序是以目录名命名的。</p>
<pre><code>go install -v -work // 
go install -a -v -work // 强行重新安装指定代码包及其依赖包
</code></pre><p><a href="https://wiki.jikexueyuan.com/project/go-command-tutorial/0.2.html">参考</a></p>
<h2 id="go-get">go get</h2>
<p>go get 命令会下载并install一个go程序</p>
<p>刚开始本地创建了项目时，要进行 go mode init 会创建一个 go.mod 文件</p>
<pre><code>module gg

go 1.14

require (
	github.com/atotto/clipboard v0.1.2
	github.com/urfave/cli/v2 v2.3.0
)
</code></pre><p>其中的 module 是你当前文件夹的名字</p>
<p>当把它提交到 github 后，用 go get 命令安装时，命令应该是这样的</p>
<pre><code>go get github.com/wangshushuo/gg
</code></pre><p>然后会报一个错误</p>
<pre><code>$ go get github.com/wangshushuo/gg@v0.1.1
go get: github.com/wangshushuo/gg@v0.1.1: parsing go.mod:
module declares its path as: gg
but was required as: github.com/wangshushuo/gg
</code></pre><p>module 这个字段现在是 gg ，要求的是 github.com/wangshushuo/gg 。</p>
<p>所以需要在 go.mod 文件中将 gg 改为 github.com/wangshushuo/gg 。</p>
<h2 id="http-请求">http 请求</h2>
<p>form</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{}</span>
<span class="nx">form</span> <span class="o">:=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">Values</span><span class="p">{}</span>
<span class="nx">form</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">,</span> <span class="s">&#34;xxx&#34;</span><span class="p">)</span>
<span class="nx">form</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">&#34;password&#34;</span><span class="p">,</span> <span class="s">&#34;xxx&#34;</span><span class="p">)</span>

<span class="nx">req</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">NewRequest</span><span class="p">(</span><span class="s">&#34;POST&#34;</span><span class="p">,</span> <span class="s">&#34;http://xxx/api/loginapi&#34;</span><span class="p">,</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nf">Encode</span><span class="p">()))</span>

<span class="k">if</span> <span class="nx">req</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;application/x-www-form-urlencoded&#34;</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;err&#34;</span><span class="p">)</span>
    <span class="c1">// handle error
</span><span class="c1"></span><span class="p">}</span>
<span class="nx">res</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
<span class="k">defer</span> <span class="nx">res</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
<span class="nx">body</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">body</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>json</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">loginInfo</span> <span class="o">:=</span> <span class="nx">LoginInfo</span><span class="p">{</span>
    <span class="nx">Username</span><span class="p">:</span> <span class="s">&#34;王书硕&#34;</span><span class="p">,</span>
    <span class="nx">Password</span><span class="p">:</span> <span class="s">&#34;ISxUo7Ol&#34;</span><span class="p">,</span>
<span class="p">}</span>
<span class="nx">loginInfoJson</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">loginInfo</span><span class="p">)</span>

<span class="nx">req</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">NewRequest</span><span class="p">(</span><span class="s">&#34;POST&#34;</span><span class="p">,</span> <span class="s">&#34;http://xxx/api/loginapi&#34;</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">.</span><span class="nf">NewBuffer</span><span class="p">(</span><span class="nx">loginInfoJson</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="htmltemplate">html/template</h2>
<p>简单的方式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">temp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nf">ParseFiles</span><span class="p">(</span><span class="s">&#34;tech_keyword/category/view.html&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>这样的模板不能植入方法，需要用template.New方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">demo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">funcMap</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">FuncMap</span><span class="p">{</span><span class="s">&#34;add&#34;</span><span class="p">:</span> <span class="nx">add</span><span class="p">}</span>
    <span class="nx">temp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;view.html&#34;</span><span class="p">).</span><span class="nf">Funcs</span><span class="p">(</span><span class="nx">funcMap</span><span class="p">).</span><span class="nf">ParseFiles</span><span class="p">(</span><span class="s">&#34;tech_keyword/category/view.html&#34;</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>New的参数需要是ParseFiles中文件名一样，不然会报错</p>
<pre><code>error: template: “…” is an incomplete or empty template
</code></pre><h2 id="template-bing-data">template bing data</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">OAuth2</span><span class="p">)</span> <span class="nf">view</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">temp</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;view.html&#34;</span><span class="p">).</span><span class="nf">ParseFiles</span><span class="p">(</span><span class="s">&#34;oauth2/view.gohtml&#34;</span><span class="p">)</span>
	<span class="nx">res</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;https://api.github.com/user&#34;</span><span class="p">)</span>
	<span class="nx">robots</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
	<span class="nx">res</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;err: &#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="nx">http</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">(),</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">robots</span><span class="p">))</span>
	<span class="nx">userInfo</span> <span class="o">:=</span> <span class="nx">UserInfoData</span><span class="p">{}</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">robots</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">userInfo</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;err: &#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="nx">http</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">(),</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">_</span> <span class="p">=</span> <span class="nx">temp</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">userInfo</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>5.软件构建中的设计</title>
                <link>https://wss.cool/5.%E8%BD%AF%E4%BB%B6%E6%9E%84%E5%BB%BA%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1.html</link>
                <guid isPermaLink="true">https://wss.cool/5.%E8%BD%AF%E4%BB%B6%E6%9E%84%E5%BB%BA%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1.html</guid>
                <pubDate>Fri, 22 Jan 2021 23:00:34 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="53-设计构造块启发式方法">5.3 设计构造块：启发式方法</h2>
<ul>
<li>当继承能简化设计时就继承。定义对象之间的相同点和不同点就叫“继承”。</li>
</ul>
<h2 id="隐藏信息">隐藏信息</h2>
<ul>
<li>使用了隐藏信息的大型项目，比没使用的，容易修改4倍</li>
</ul>
<h3 id="秘密和隐私权">秘密和隐私权</h3>
<ul>
<li>
<p>隐藏起来的秘密可能是某个易变的区域，或某种数据类型的实现方式，或某个需要隔离的区域，在这个区域中发生的错误，不会给程序其余部分带来太大损失。类的职责就是把这部分信息隐藏起来，并保护自己的隐私权。</p>
</li>
<li>
<p>隐藏信息就是隐藏复杂度。</p>
</li>
<li>
<p>设计一个类的一项关键性决策就是确定类的哪些特性应该对外可见或隐藏。</p>
<blockquote>
<p>暴露过多的信息会增加人的智力负担，如果别的类引用了你的类的细节，这对双方都是bug隐患。</p>
</blockquote>
</li>
<li>
<p>设计类的接口与设计其他环节一样，都是一个迭代的过程。一次没得到合适的接口就多尝试几次，知道稳定下来。</p>
</li>
</ul>
<h3 id="两类秘密">两类秘密</h3>
<ul>
<li>隐藏复杂度，这样你就不用再去应付它</li>
<li>隐藏变化源，这样当变化发生时，其影响就限制在局部范围内。</li>
</ul>
<h3 id="隐藏信息的价值">隐藏信息的价值</h3>
<ul>
<li>
<p>信息隐藏有着独特的启发力，他能够激发出有效的设计方案。</p>
</li>
<li>
<p>问题“这个类需要隐藏些什么？”正切中了接口设计的核心。</p>
</li>
<li>
<p>请养成问“我该隐藏些什么？”的习惯，你会惊奇地发现，有很多很棘手的设计难题都会在你面前化解。</p>
</li>
</ul>
<h2 id="找出容易改变的区域">找出容易改变的区域</h2>
<ul>
<li>好的程序设计所面临的最重要挑战之一就是适应变化。</li>
<li>目标应该是把不稳定的区域隔离起来，让变化所带来的影响限制在一个子程序、类或者包的内部。
<ol>
<li><strong>找出看起来容易变化的项目</strong>。好的需求应该包含一份潜在变化清单。没有的话，请参考“在任何项目中都容易发生变化的区域”的讨论。</li>
<li><strong>把容易变化的项目分离出来</strong>。容易同时发生变化的组件划分到同一类中。</li>
<li><strong>把看起来容易变化的项目隔离开</strong>。类之间的接口可以使其对变化不敏感，要设计好接口。</li>
</ol>
</li>
<li>主动应对变更的最有力的技术之一，是表驱动技术。</li>
<li>容易发生变化的区域：
<ul>
<li>业务规则：基于业务规则的逻辑不应该遍布于整个程序，而是仅仅隐藏于系统的某个角落。</li>
<li>输入和输出：检查所有外部接口，看看有哪些可能的变化，通常是个不错的主意。（类的私有方法不检查，公开方法检查输入）</li>
<li>⭐️困难的设计区域和构建区域：把困难的设计区域和构建区域隐藏起来也是很好的想法，因为这些代码很可能因为设计得很差而需要重新做。</li>
<li>状态变量：与大多数其他类型的数据相比，这种东西更容易改变。在使用状态变量时增加至少两层的灵活性和可读性：
<ul>
<li>不要使用布尔值作为状态变量，请换用枚举类型。</li>
<li>使用访问器子程序取代对状态变量的直接检查。</li>
</ul>
</li>
<li>数据量的限制：使用具名常量 MAX_EMPLOYEES 来隐藏 100 这样的数字</li>
<li>预料不同程度的变化
<ul>
<li>如何找出容易变化的区域
<ul>
<li>首先找出对用户最有用的最小子集，它构成来系统的核心，不容易发生变化</li>
<li>然后逐步扩展这个系统</li>
<li>对于附加功能可以提取出来，并把它们的可能改进隐藏起来</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="保持松散耦合">保持松散耦合</h2>
<h3 id="耦合的标准">耦合的标准</h3>
<ul>
<li>规模，模块间的连接数量</li>
<li>可见行。通过参数表传递数据便是一种明显的连接，因为值得提倡。通过修改全局数据而使另一个模块能够使用该数据便是一种“鬼鬼祟祟”的做法，因此是很不好的设计。</li>
<li>灵活性。一个模块越容易被其他模块所调用，那么它们之间的耦合关系就越松散。</li>
</ul>
<h3 id="耦合的种类">耦合的种类</h3>
<ul>
<li>简单数据参数耦合。正常</li>
<li>简单对象耦合。也很不错</li>
<li>对象参数耦合。object1要求object2给它一个object3。有些紧密了，不大好。</li>
<li>语义上的耦合。一个模块使用了另一个模块的语法元素，而且还使用了有关那个模块内部工作细节的语义知识。
<ul>
<li>语义上的耦合是非常危险的，A模块调用了B模块，更改B模块中的代码可能会破坏A模块，破坏方式是编译器无法检查的。类似这样的代码崩溃时，其方式是非常微妙的，看起来与被使用的模块中的代码更改毫无关系，因此会使得调试工作变得无比困难。</li>
</ul>
</li>
</ul>
<p>松散耦合的关键之处在于，一个有效的模块提供的出了一层附加的抽象——一旦你写好了它，你就可以想当然的去用它。这样就降低了整体系统的复杂度，使得你可以在同一时间只关注一件事。如果对一个模块的使用要求同时关注好几件事——其内部工作的细节、对全局数据的修改、不确定的功能点等——那么就失去了抽象的能力。模块所具有的管理复杂度的能力也就削弱或完全丧失了。</p>
<p>类和子程序是用于降低复杂度的首选和最重要的智力工具。如果它们没有帮你简化工作，那么它们就失职了。</p>
<h2 id="查阅常见的设计模式">查阅常见的设计模式</h2>
<h2 id="54-设计实践">5.4 设计实践</h2>
<ul>
<li>迭代</li>
<li>分而治之</li>
<li>自上而下和自下而上的设计方法
<ul>
<li>自上而下的论据</li>
<li>自下而上的论据</li>
<li>其实并没有争论</li>
</ul>
</li>
<li>建立试验性原型</li>
<li>合作设计</li>
<li>要做多少设计才够</li>
<li>记录你的设计成果</li>
</ul>
<blockquote>
</blockquote>
<h2 id="要点">要点</h2>
<ul>
<li>软件的首要技术使命就是管理复杂度。以简单性作为努力目标的设计方案对此最有帮助。</li>
<li>简单性可以通过两种方式来获取：一是减少在同一时间所关注的本质性复杂度的量，二是避免生成不必要的偶然的复杂度。</li>
<li>设计是一种启发式的过程。固执于某一种单一方法会损害创新力，从而损害你的程序。</li>
<li>好的设计都是迭代的。你尝试设计的可能性越多，你的最终设计方案就会变得越好。</li>
<li>隐藏信息是个非常有价值的概念。通过询问“我应该隐藏什么？”能够解决很多困难的设计问题。</li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</category>
                                
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8/">代码大全</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>沟通</title>
                <link>https://wss.cool/%E6%B2%9F%E9%80%9A.html</link>
                <guid isPermaLink="true">https://wss.cool/%E6%B2%9F%E9%80%9A.html</guid>
                <pubDate>Fri, 15 Jan 2021 16:23:23 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>跟产品沟通，谈开发时间。</p>
<ul>
<li>
<p>开发：评估工作量，要A日期能提测。</p>
</li>
<li>
<p>产品：不行哦，客户等着用呢，要提前B天。</p>
</li>
<li>
<p>开发：不行哦，时间这么紧张，不能保证质量呀，可能会提测质量不好，后期bug多。</p>
</li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Changelist更新时间长</title>
                <link>https://wss.cool/changelist-git-ignore.html</link>
                <guid isPermaLink="true">https://wss.cool/changelist-git-ignore.html</guid>
                <pubDate>Fri, 15 Jan 2021 10:45:56 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="问题">问题</h2>
<p>当发生切换分支等操作时，webstorm的commit窗口中的changelist会进行updating，正常情况下它应该执行的很快，甚至察觉不到，但是不知道什么情况下updating会长时间不结束并占用大量cpu。</p>
<p>当发生了异常情况时，打开任务管理器，可以看到，这时webstorm是在运行一个git命令</p>
<pre><code>git -c credential.helper= -c core.quotepath=false -c log.showSignature=false status --ignored --porcelain -z --
</code></pre><p>可以理解为是在运行<code>git status --ignored</code>，它就会扫描 node_module 等已经设置为忽略的文件，而它们有层次很深，文件很多，就会导致git占用大量cpu进行计算。可能会让webstorm变卡、电脑变卡。</p>
<h2 id="解决方法">解决方法</h2>
<p>可以通过修改webstorm的注册表，让它不扫描忽略文件。</p>
<ol>
<li>
<p>打开注册表</p>
<ul>
<li>菜单中 Help | Find action..., 输入<code>Registry...</code></li>
</ul>
</li>
<li>
<p>找到<code>git.process.ignored</code></p>
<ul>
<li>在注册表界面可以直接输入<code>git.process.ignored</code>进行搜索</li>
<li>取消它的勾选就可以了
<img src="https://hugo-1256216240.cos.ap-chengdu.myqcloud.com/20210115110317_7eebc60a6f46b7076eddc44f64d02287.png" alt="20210115110317_7eebc60a6f46b7076eddc44f64d02287.png"></li>
</ul>
</li>
</ol>
<p>这样updating的时候，就不会扫描忽略文件了，就很快了。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%95%88%E7%8E%87/">效率</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>断言函数</title>
                <link>https://wss.cool/assertfunction.html</link>
                <guid isPermaLink="true">https://wss.cool/assertfunction.html</guid>
                <pubDate>Wed, 13 Jan 2021 15:52:47 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://jkchao.github.io/typescript-book-chinese/new/typescript-3.7.html#%E6%96%AD%E8%A8%80%E5%87%BD%E6%95%B0">https://jkchao.github.io/typescript-book-chinese/new/typescript-3.7.html#%E6%96%AD%E8%A8%80%E5%87%BD%E6%95%B0</a></p>
<p><a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#assertion-functions">https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#assertion-functions</a></p>
]]></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>架构整洁之道</title>
                <link>https://wss.cool/%E6%9E%B6%E6%9E%84%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93.html</link>
                <guid isPermaLink="true">https://wss.cool/%E6%9E%B6%E6%9E%84%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93.html</guid>
                <pubDate>Tue, 05 Jan 2021 22:55:39 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="第三部分-设计原则">第三部分 设计原则</h2>
<p>SOLID原则的主要作用就是告诉我们如何将数据和函数组织成为类，以及如何将这些类链接起来成为程序。</p>
<p>为软件构建中层结构的主要目标如下：使软件可容忍被改动。使软件更容易被理解。构建可在多个软件系统中复用的组件。</p>
<p>我们在这里之所以会使用“中层”这个词，是因为这些设计原则主要适用于那些进行模块级编程的程序员。</p>
<p>SOLID原则应该直接紧贴于具体的代码逻辑之上，这些原则是用来帮助我们定义软件架构中的组件和模块的。</p>
<blockquote>
<p>SOLID原则——如何设计好模块</p>
</blockquote>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>工作TIPS</title>
                <link>https://wss.cool/%E5%B7%A5%E4%BD%9Ctips.html</link>
                <guid isPermaLink="true">https://wss.cool/%E5%B7%A5%E4%BD%9Ctips.html</guid>
                <pubDate>Fri, 18 Dec 2020 13:46:12 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="go">go</h2>
<h3 id="为表单加一个字段">为表单加一个字段</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 自定义field中间件
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">NewCustomizedFieldMiddlewares</span><span class="p">()</span> <span class="nx">form_context</span><span class="p">.</span><span class="nx">FormMiddlewares</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">new</span><span class="p">(</span><span class="nx">customizedFieldMiddlewares</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">customizedFieldMiddlewares</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">customizedFieldMiddlewares</span><span class="p">)</span> <span class="nf">Register</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">form_context</span><span class="p">.</span><span class="nx">FormContext</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">ctx</span><span class="p">.</span><span class="nf">GetResponsePipeline</span><span class="p">().</span><span class="nf">Add</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">HandleResponse</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// ctx的metadataApi可以加一个field（主表子表）
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">customizedFieldMiddlewares</span><span class="p">)</span> <span class="nf">HandleResponse</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">form_context</span><span class="p">.</span><span class="nx">FormContext</span><span class="p">,</span> <span class="nx">res</span> <span class="o">*</span><span class="nx">context</span><span class="p">.</span><span class="nx">BizFormConfigResponse</span><span class="p">)</span> <span class="o">*</span><span class="nx">context</span><span class="p">.</span><span class="nx">BizFormConfigResponse</span> <span class="p">{</span>
	<span class="nx">isMobile</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">GetSolution</span><span class="p">().</span><span class="nx">FormTemplate</span><span class="p">.</span><span class="nx">IsMobile</span>
	<span class="k">if</span> <span class="nx">isMobile</span> <span class="o">==</span> <span class="kc">true</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">res</span>
	<span class="p">}</span>
	<span class="nf">addMasterFields</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
	<span class="k">return</span> <span class="nx">res</span>
<span class="p">}</span>

<span class="c1">// 定义field
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">addMasterFields</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">form_context</span><span class="p">.</span><span class="nx">FormContext</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">api</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">GetMetadataApi</span><span class="p">()</span>
	<span class="nx">item</span> <span class="o">:=</span> <span class="nx">form_context</span><span class="p">.</span><span class="nx">FormMasterFieldParams</span><span class="p">{</span>
		<span class="nx">MetadataField</span><span class="p">:</span> <span class="nx">metadata</span><span class="p">.</span><span class="nx">Field</span><span class="p">{</span>
			<span class="nx">Path</span><span class="p">:</span>           <span class="s">&#34;project&#34;</span><span class="p">,</span>
			<span class="nx">DisplayName</span><span class="p">:</span>    <span class="s">&#34;项目编码&#34;</span><span class="p">,</span>
			<span class="nx">IsContextField</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="nx">Required</span><span class="p">:</span>       <span class="kc">true</span><span class="p">,</span>
			<span class="nx">Readonly</span><span class="p">:</span>       <span class="kc">false</span><span class="p">,</span>
			<span class="nx">IsExtend</span><span class="p">:</span>       <span class="kc">true</span><span class="p">,</span>
			<span class="nx">IsExtendField</span><span class="p">:</span>  <span class="kc">true</span><span class="p">,</span>
			<span class="nx">ExtendInfo</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">ExtendInfo</span><span class="p">{</span>
				<span class="nx">Type</span><span class="p">:</span>      <span class="s">&#34;String&#34;</span><span class="p">,</span>
				<span class="nx">ReferType</span><span class="p">:</span> <span class="s">&#34;Project&#34;</span><span class="p">,</span>
				<span class="nx">EnumType</span><span class="p">:</span>  <span class="s">&#34;&#34;</span><span class="p">,</span>
				<span class="nx">IsMulti</span><span class="p">:</span>   <span class="kc">false</span><span class="p">,</span>
				<span class="nx">IsSubmit</span><span class="p">:</span>  <span class="kc">false</span><span class="p">,</span>
				<span class="nx">Precision</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="nx">TemplateField</span><span class="p">:</span> <span class="nx">template</span><span class="p">.</span><span class="nx">Field</span><span class="p">{</span>
			<span class="nx">FieldBase</span><span class="p">:</span> <span class="nx">template</span><span class="p">.</span><span class="nx">FieldBase</span><span class="p">{</span>
				<span class="nx">Extended</span><span class="p">:</span>    <span class="kc">true</span><span class="p">,</span>
				<span class="nx">Path</span><span class="p">:</span>        <span class="s">&#34;project&#34;</span><span class="p">,</span>
				<span class="nx">Required</span><span class="p">:</span>    <span class="kc">true</span><span class="p">,</span>
				<span class="nx">DisplayName</span><span class="p">:</span> <span class="s">&#34;项目编码&#34;</span><span class="p">,</span>
			<span class="p">},</span>
			<span class="nx">Colspan</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
			<span class="nx">Rowspan</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">SectionIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
		<span class="nx">InsertIndex</span><span class="p">:</span>  <span class="mi">6</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="nx">api</span><span class="p">.</span><span class="nf">AddMasterField</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%B7%A5%E4%BD%9C/">工作</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Iris</title>
                <link>https://wss.cool/iris.html</link>
                <guid isPermaLink="true">https://wss.cool/iris.html</guid>
                <pubDate>Wed, 16 Dec 2020 23:51:41 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<dl>
<dt>oauth2</dt>
<dd>可以用来快速实现github授权登陆功能。</dd>
<dt>热重启</dt>
<dd>开发的时候不用每次重新编译</dd>
<dt>Typescript集成 + Web IDE</dt>
<dd>这两个是啥？</dd>
</dl>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%88%86%E7%B1%BB/">分类</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E6%98%BE%E7%A4%BA%E5%9C%A8%E5%BA%95%E9%83%A8/">显示在底部</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Go语言核心36讲</title>
                <link>https://wss.cool/go%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%8336%E8%AE%B2.html</link>
                <guid isPermaLink="true">https://wss.cool/go%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%8336%E8%AE%B2.html</guid>
                <pubDate>Sun, 29 Nov 2020 23:08:01 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="方法返回类型为-string">方法返回类型为 *string</h2>
<p>类型 *string 代表的是字符串的指针类型，而不是字符串类型。因此，这里的类型name代表的是一个指向字符串的指针。</p>
<p>name的类型是 *string，用 *name 可以取到它的值。</p>
]]></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>榜单</title>
                <link>https://wss.cool/%E6%A6%9C%E5%8D%95.html</link>
                <guid isPermaLink="true">https://wss.cool/%E6%A6%9C%E5%8D%95.html</guid>
                <pubDate>Sun, 29 Nov 2020 22:41:53 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="go-module">Go Module</h2>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/59687626">开始使用 Go Module</a></li>
</ol>
<h3 id="关联问题">关联问题</h3>
<ul>
<li><code>go run xx.go</code> 报错 <code>package XXX is not in GOROOT</code></li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>精度</title>
                <link>https://wss.cool/%E7%B2%BE%E5%BA%A6.html</link>
                <guid isPermaLink="true">https://wss.cool/%E7%B2%BE%E5%BA%A6.html</guid>
                <pubDate>Thu, 12 Nov 2020 11:40:46 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="遇到的问题">遇到的问题</h2>
<p>在 JS 中计算数字经常会遇到精度的问题。使一些判断语句出现bug。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="mf">1.1</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">===</span> <span class="mi">110</span>
<span class="c1">// 110.00000000000001
</span><span class="c1"></span>
<span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">===</span> <span class="mf">0.3</span>
<span class="c1">// 0.30000000000000004
</span></code></pre></td></tr></table>
</div>
</div><h2 id="解决方法">解决方法</h2>
<p>不使用严格相等(==或===)来做判断，容忍两个数之间有一个很小的误差。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">eq</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">right</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.000001</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="原理">原理</h2>
<p>比如正常的比较，<code>0.1 + 0.2 === 0.3</code> 相当于 <code>0.1 + 0.2 - 0.3 === 0</code> 。bug就出现在不是等于零，而是一个很小很小的数。这个很小很小的数就使误差。如果误差在可接受范围内，我们就还可以认为它们使相等的。</p>
<p>这个误差，可以通过 <code>Number.EPSILON</code><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> 来设置。具体设置成多少我还不知道，可能要根据做的业务的情况来确定吧。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">eq</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">right</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">EPSILON</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>阮一峰.<a href="https://es6.ruanyifeng.com/#docs/number#Number-EPSILON">ECMAScript 6 入门</a>.[2020年11月12日] <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/javascript/">JavaScript</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>NVM阿里源</title>
                <link>https://wss.cool/nvm%E9%98%BF%E9%87%8C%E6%BA%90.html</link>
                <guid isPermaLink="true">https://wss.cool/nvm%E9%98%BF%E9%87%8C%E6%BA%90.html</guid>
                <pubDate>Sat, 07 Nov 2020 22:57:53 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>修改NVM下载nodejs的地址，设置环境变量。</p>
<p>命令行是<code>bash</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">echo</span> -e <span class="s2">&#34;\nexport NVM_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node&#34;</span> &gt;&gt; ~/.bashrc 
<span class="nb">source</span> ~/.bashrc
</code></pre></td></tr></table>
</div>
</div><p>命令行是<code>zsh</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">echo</span> -e <span class="s2">&#34;\nexport NVM_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node&#34;</span> &gt;&gt; ~/.zshrc 
<span class="nb">source</span> ~/.zshrc
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/nvm/">nvm</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Windows中的换行符</title>
                <link>https://wss.cool/windows%E4%B8%AD%E7%9A%84%E6%8D%A2%E8%A1%8C%E7%AC%A6.html</link>
                <guid isPermaLink="true">https://wss.cool/windows%E4%B8%AD%E7%9A%84%E6%8D%A2%E8%A1%8C%E7%AC%A6.html</guid>
                <pubDate>Mon, 12 Oct 2020 17:12:27 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="问题">问题</h2>
<p>如果项目中设置的eslint，要求换行符是\n(LF)，那么在windows中打开项目的文件，编辑器/IDE可能会标红报错（eslint错误）。</p>
<h2 id="解决方法">解决方法</h2>
<ol>
<li>告诉 Git 在提交时把回车和换行转(CRLF)换成换行(LF)，检出时不转换</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">git config --global core.autocrlf input
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>设置本地 Git 的换行符</li>
</ol>
<pre><code>git config --global core.eol lf
</code></pre><ol start="3">
<li>设置编辑器/IDE将 CRLF 改成 LF</li>
</ol>
<h2 id="原理">原理</h2>
<p>Git 默认的行为是，在藏库里只保存 LF 换行符，但是Windows系统的默认换行符是 CRLF 。在Windows系统中，Git 为了实现只保存 LF 换行符，在提交代码时，Git 会自动进行转化为 LF ，签出代码时自动转换回 CRLF 。</p>
<p>经过上面的三步操作，可以让 Git 不做这个自动转换，并且让新创建的换行符都时 LF 的。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/git/">git</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>高斯模糊</title>
                <link>https://wss.cool/%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A.html</link>
                <guid isPermaLink="true">https://wss.cool/%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A.html</guid>
                <pubDate>Wed, 19 Aug 2020 12:12:31 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>像iPhone一样的毛玻璃效果，让背景里的东西是模糊的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">backdrop-filter</span><span class="o">:</span> <span class="nt">saturate</span><span class="o">(</span><span class="nt">180</span><span class="o">%)</span> <span class="nt">blur</span><span class="o">(</span><span class="nt">2px</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>WebStorm的code-snippet</title>
                <link>https://wss.cool/webstorm%E7%9A%84code-snippet.html</link>
                <guid isPermaLink="true">https://wss.cool/webstorm%E7%9A%84code-snippet.html</guid>
                <pubDate>Wed, 19 Aug 2020 10:23:09 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://blog.jetbrains.com/webstorm/2018/01/using-and-creating-code-snippets/">官网文档</a></p>
<p>这个功能在 webstorm 中叫做 live template 。就是将一段代码变成模版，就像打出 <code>log</code> 就会出现下来菜单提示 <code>console.log</code> 一样。 live template 可以实现复杂一点的事情，比如在模版内部定义变量，可以在初始时快速编辑它们。</p>
<ol>
<li>首先准备好一段代码，下面是创建一个 React 组件，我们要把它变成一个模版，以后可以快速的创建组件。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Keyword</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>将代码全选后，打开 actions 面板<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>，输入 <code>save as live template</code> ，就可以打开一个操作面板了。
<img src="https://hugo-1256216240.cos.ap-chengdu.myqcloud.com/20201109221701_3ea50a1759e3609e284c85ec2bd99894.png" alt="20201109221701_3ea50a1759e3609e284c85ec2bd99894.png" title="save as live template"></li>
</ol>
<ul>
<li><span class="shortcodes_number">1</span>
 在 user 目录下出现了一个新的条目，它就是刚刚那段代码</li>
<li><span class="shortcodes_number">2</span>
 唤醒模板的关键词，比如 <code>log</code></li>
<li><span class="shortcodes_number">3</span>
 可以在模板中设置变量。在代码中定义变量，在按钮中给变量设置值，比如文件名、不带扩展名的文件名等等。</li>
<li><span class="shortcodes_number">4</span>
 多个变量之间可以用 <code>tab</code> 快速切换光标到下一个， <code>$END$</code> 代表最后一个</li>
</ul>
<ol start="3">
<li>点击 ok 保存设置</li>
<li>尝试一下吧，可以把刚才的代码删掉，输入 <code>imfc</code> 看看效果。</li>
</ol>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>有两种方法：a. mac 快捷键：<code>shift+cmd+a</code> （可能与系统的快捷键冲突，需要修改一下系统快捷键）；b. 可以通过连按（2次） <code>shift</code> 呼出搜索面板，在切换到 action 标签。 <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%95%88%E7%8E%87/">效率</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>React与Mobx的MVP和单元测试</title>
                <link>https://wss.cool/react%E4%B8%8Emobx%E7%9A%84mvp%E5%92%8C%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95.html</link>
                <guid isPermaLink="true">https://wss.cool/react%E4%B8%8Emobx%E7%9A%84mvp%E5%92%8C%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95.html</guid>
                <pubDate>Fri, 14 Aug 2020 09:35:25 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>我比较熟悉Redux，所以以Redux与Mobx作为类比我会比较容易理解。</p>
<p>redux会有一个store与react组件配合。</p>
<p>store中定义变量、状态，写修改变量的reducer及相应的action。</p>
<p>react组件中调用变量，使用dispatch调用action修改变量，完成单向数据流。</p>
<p>reducer有两种写法——是否包含业务逻辑，这里选择不包含业务逻辑，就只是修改数据。业务逻辑全部放在react中。</p>
<p>以上是一个普通的redux+react的用法。</p>
<p>把它改为MVP模式的话，其实只是把业务逻辑和组件状态都从react组件中抽离出来，放在一个Presenter中。让react组件只接受数据和调用方法。</p>
<p>redux可以换成mobx。</p>
<p>在mobx的store中，它可以作为MVP中的M。还是声明变量、定义action，作用与redux一样。</p>
<h2 id="声明变量">声明变量</h2>
<p>如果使用observable声明的话，</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>WebStorm</title>
                <link>https://wss.cool/webstorm.html</link>
                <guid isPermaLink="true">https://wss.cool/webstorm.html</guid>
                <pubDate>Thu, 13 Aug 2020 09:39:16 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="常用快捷操作">常用快捷操作</h2>
<p>光标回到之前的位置：菜单是navigate&gt;(back+forward)</p>
<ul>
<li>mac：<code>ctrl -</code> 和 <code>ctrl shift -</code></li>
<li>windows：<code>ctrl alt 左/右</code></li>
</ul>
<p>折叠代码：菜单是code&gt;folding</p>
<ul>
<li>折叠：<code>ctrl -</code>,<code>ctrl shift -</code></li>
<li>展开：<code>ctrl +</code>,<code>ctrl shift +</code></li>
</ul>
<h2 id="常用设置">常用设置</h2>
<ol>
<li>自动保存的开关</li>
<li>修改文件有*标记</li>
<li>修改的文件的目录和文件的颜色都提示</li>
<li>Windows系统中使用\n换行符</li>
<li>切换terminal</li>
</ol>
<p><strong>修改默认terminal</strong></p>
<p>Ctrl+Alt+S 打开设置，选择 tools 目录，选择 terminal</p>
<p><strong>取消自动保存</strong></p>
<p>关闭自动保存功能</p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Appearance &amp; Behavior，定位到 Synchronization 一栏，取消勾选以下三项：</p>
<ul>
<li>Save files on frame deactivation</li>
<li>Save files automatically if application is idle for [15] sec</li>
<li>Use &quot;safe write&quot; (save changes to a temporary file first)</li>
</ul>
<p><strong>打开修改文件后的星号提示</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Editor → General → Editor Tabs，定位到 Appearance 一栏，勾选 Mark modified (*)。</p>
<p><strong>修改编译器字体</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Editor → Font，Font 选择为 Fira Code，Size 设置为 12。</p>
<p><strong>设置文件换行符</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Editor → Code Style，定位到 General 标签，Line separator 选择为 Unix and OS X (\n)。</p>
<p><strong>版本控制文件发生改变时上级目录也会有相应提示</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Version Control，勾选 Show directories with changed descendants。</p>
<h2 id="常用快捷键">常用快捷键</h2>
<table>
<thead>
<tr>
<th align="left">操作</th>
<th align="left">WebStorm</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">重复选中的内容或当前行</td>
<td align="left">Ctrl+D</td>
</tr>
<tr>
<td align="left">删除行</td>
<td align="left">Ctrl+Y</td>
</tr>
<tr>
<td align="left">格式化代码</td>
<td align="left">Ctrl+Alt+L</td>
</tr>
<tr>
<td align="left">按prettier格式化</td>
<td align="left">Ctrl+Shift+Alt+P</td>
</tr>
<tr>
<td align="left">重命名</td>
<td align="left">Shift+F6</td>
</tr>
<tr>
<td align="left">撤销或反撤销修改</td>
<td align="left">Ctrl+Z 或 Ctr+Shift+Z</td>
</tr>
<tr>
<td align="left">回到之前的位置</td>
<td align="left">Ctrl+Alt+左\右</td>
</tr>
<tr>
<td align="left">光标移到内容的开始或结束标签处</td>
<td align="left">ctrl+[ 或 ctrl+]</td>
</tr>
<tr>
<td align="left">打开最近操作过的文件</td>
<td align="left">Ctrl+E</td>
</tr>
<tr>
<td align="left">搜索文件</td>
<td align="left">Ctrl+Shift+N</td>
</tr>
<tr>
<td align="left">在所有文件中列出代码使用情况</td>
<td align="left">Alt+F7</td>
</tr>
<tr>
<td align="left">在当前文件中高亮代码使用情况</td>
<td align="left">Ctrl+Shift+F7</td>
</tr>
</tbody>
</table>
<h2 id="配置">配置</h2>
<p><strong>恢复默认配置</strong></p>
<p>只要删除 C:\Users\wxj.WebStorm2018.3\config 目录，即可恢复默认配置。</p>
<p><strong>修改默认terminal</strong></p>
<p>Ctrl+Alt+S 打开设置，选择 tools 目录，选择 terminal</p>
<p><strong>显示内存指示器</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Appearance &amp; Behavior → Appearance，定位到 Window Options 一栏，勾选 Show memory indicator。</p>
<p><strong>取消自动打开项目</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Appearance &amp; Behavior → System Settings，定位到 Startup/Shutdown 一栏，取消勾选 Reopen last project on startup。</p>
<p><strong>取消自动保存</strong></p>
<p>关闭自动保存功能</p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Appearance &amp; Behavior，定位到 Synchronization 一栏，取消勾选以下三项：</p>
<ul>
<li>Save files on frame deactivation</li>
<li>Save files automatically if application is idle for [15] sec</li>
<li>Use &quot;safe write&quot; (save changes to a temporary file first)</li>
</ul>
<p><strong>打开修改文件后的星号提示</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Editor → General → Editor Tabs，定位到 Appearance 一栏，勾选 Mark modified (*)。</p>
<p><strong>关闭自动更新检查</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ System Settings → Updates，取消勾选 Automatically check updates for [Stable Releases]。</p>
<p><strong>启用软换行</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Editor → General，定位到 Soft Wraps 一栏，勾选 Use soft wraps in editor。</p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Editor → General → Console，勾选 Use soft wraps in console。</p>
<p><strong>修改编译器字体</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Editor → Font，Font 选择为 Fira Code，Size 设置为 12。</p>
<p><strong>设置文件换行符</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Editor → Code Style，定位到 General 标签，Line separator 选择为 Unix and OS X (\n)。</p>
<p><strong>设置工程和文件 UTF-8 编码</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Editor → File Encodings，Global Encoding 选择为 UTF-8，Project Encoding 为 UTF-8。</p>
<p>定位到 Properties Files (*.properties) 一栏，Default encoding for properties files 选择为 UTF-8，但不要勾选 Transparent native-to-ascii conversion。</p>
<p>定位到 BOM for new UTF-8 files 一栏，Create UTF-8 files 选择为 with NO BOM。</p>
<p><strong>设置控制台 UTF-8 编码</strong></p>
<p>在 D:\Program Files\JetBrains\WebStorm 2018.3.5\bin[webstorm|webstorm64].exe.vmoptions 文件末尾添加 -Dfile.encoding=UTF-8。</p>
<p><strong>版本控制文件发生改变时上级目录也会有相应提示</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Version Control，勾选 Show directories with changed descendants。</p>
<p><strong>配置 GitHub 账户</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Version Control → GitHub，点击 Add account (Alt+Insert)，在弹出的 Login In to Github 中分别填写 GitHub 账户名和密码，然后点击 Log In。最后勾选 Clone git repositories using ssh。</p>
<p><strong>配置 Git</strong></p>
<p>Settings for New Projects（Ctrl+Alt+S）→ Version Control → Git，Path to Git executable 选择 D:\Program Files\Git\bin\git.exe。</p>
<h2 id="快捷键">快捷键</h2>
<p>以下所展示的快捷键是默认时的选择，即 Settings for New Projects（Ctrl+Alt+S）→ Keymap 中，选择的是 Default。</p>
<h3 id="编辑代码">编辑代码</h3>
<ul>
<li>同步磁盘文件：Ctrl+Alt+Y</li>
<li>快速生成通用方法：Alt+Insert</li>
<li>注释和取消注释：Ctrl+/ 和 Ctrl+Shift+/</li>
<li>快速修复问题：Alt+Enter</li>
</ul>
<h3 id="阅读代码">阅读代码</h3>
<ul>
<li>隐藏所有工具窗口：Ctrl+Shift+F12</li>
<li>显示/隐藏工程目录窗口：Alt+1</li>
<li>移动窗口分割线：Ctrl+Shift+左箭头 或 Ctrl+Shift+左箭头</li>
<li>在工程目录中定位当前文件的位置：Alt+F1</li>
<li>显示说明文档：Ctrl+Q</li>
<li>折叠代码块：Ctrl+Shift+.</li>
<li>显示折叠后的代码块：Ctrl++</li>
<li>查看代码的定义：Ctrl+Shift+I</li>
<li>退出：Esc</li>
<li>导航至下一高亮处：F3</li>
<li>导航至上一高亮处：Shift+F3</li>
<li>取消高亮：Esc</li>
<li>跳至代码声明处：Ctrl+B 或 Ctrl+鼠标左键</li>
<li>跳至代码实现处：Ctrl+Alt+B 或 Ctrl+Alt+鼠标左键</li>
<li>跳至父类代码：Ctrl+U</li>
<li>导航文件中的各成员：Ctrl+F12</li>
<li>打开 UML 类图：Ctrl+Alt+U 或 Ctrl+Alt+Shift+U</li>
</ul>
<h3 id="打开文件">打开文件</h3>
<ul>
<li>根据 Classes 打开文件：Ctrl+N</li>
<li>根据文件名打开所有文件或定位目录：Ctrl+Shift+N</li>
<li>根据 Symbols 打开所有文件：Ctrl+Shift+Alt+N</li>
</ul>
<h3 id="打开配置">打开配置</h3>
<ul>
<li>打开配置：Ctrl+Alt+S</li>
<li>搜索所有可用的操作（Actions）：Ctrl+Shift+A</li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%95%88%E7%8E%87/">效率</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>笔记</title>
                <link>https://wss.cool/posts/%E7%AC%94%E8%AE%B0/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E7%AC%94%E8%AE%B0/</guid>
                <pubDate>Wed, 12 Aug 2020 10:59:42 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="mobx的observable变成非observ的变量">mobx的observable变成非observ的变量</h2>
<p>以@observable声明的变量，可以会变成普通的对象，而失去响应能力，可能是应为直接复制的操作导致的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="kd">@observable</span>
<span class="kr">private</span> <span class="nx">rowData</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// 这样rowData是不是observable的？
</span><span class="c1"></span>
<span class="kd">@observable</span>
<span class="kr">private</span> <span class="nx">rowData</span> <span class="o">=</span> <span class="nx">observable</span><span class="p">([]);</span> <span class="c1">// 需要这样赋值才行吗？
</span></code></pre></td></tr></table>
</div>
</div><p>indicatorMap需要使用observable.ref声明才能监听到。用observable声明并用replace替换的话就不能监听到了.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">reaction</span><span class="p">(</span>
  <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">indicatorMap</span><span class="p">,</span> 
  <span class="p">(</span><span class="nx">indicatorMap</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">),</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="8月13日review">8月13日review</h2>
<ol>
<li>cellRendererFramework改成cellRender</li>
</ol>
<p>改了cellRender以后不显示了。</p>
<ol start="2">
<li>没有AgSelect这个组件</li>
</ol>
<p>MetadataHelper.resolveFullTitle()</p>
<h2 id="列表中实现编码列跳转到编辑">列表中实现编码列跳转到编辑</h2>
<h2 id="实现新建页面保存后刷新列表">实现新建页面保存后刷新列表</h2>
<ol>
<li>在定义路由时，将props传给presenter
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">..</span><span class="nx">renderBizForm</span><span class="p">({</span>
  <span class="nx">entityName</span><span class="o">:</span> <span class="nx">EN_Customer</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;客户&#39;</span><span class="p">,</span>
  <span class="c1">// hashPrefix: &#39;/customer/form&#39;,
</span><span class="c1"></span>  <span class="nx">createPresenter</span><span class="o">:</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">queryParams</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">CustomerFormPresenter</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">importCustomerForm</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">CustomerFormPresenter</span><span class="p">({</span>
      <span class="p">...</span><span class="nx">props</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">},</span>
<span class="p">}),</span>
</code></pre></td></tr></table>
</div>
</div><p>easyBizForm在constructor中将props赋值给_options，其中包含 passParams ，跳转到create界面时，会存一个onSuccess在路由中，通过passParams姐可以拿到这个onSuccess了。</p>
</li>
</ol>
<h2 id="错误提示信息">错误提示信息</h2>
<p>什么情况会出现唯一性错误？</p>
<p>哪些错误需要解析？</p>
<p>哪些错误是没有具体error信息，只有message的？</p>
<h2 id="单元测试覆盖率">单元测试覆盖率</h2>
<p>jest apps/link/src/main/screens/projects/budget --coverage</p>
<p>jest src/main/screens/projects/budget --coverage</p>
<h2 id="refer是怎么渲染出来的怎么才能变成多选">refer是怎么渲染出来的，怎么才能变成多选？</h2>
<p>在编制方案中，使用了MSTFormLayout和MSTFormElement来实现project的refer。MSTFormLayout中有DataField，它根据field.type确定project是refer，然后使用了ReferField组件又Refer组件。</p>
<p>这个组件里根据metadata取到entity对应的参照方案。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">referConfig</span> <span class="o">=</span> <span class="nx">metadata</span><span class="p">.</span><span class="nx">getReferConfig</span><span class="p">(</span><span class="nx">entityName</span><span class="p">,</span> <span class="nx">referName</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>参照方案内包含了是否为多选的配置 <code>referConfig.multi</code> 。</p>
<p>还可以通过参数，透传到Refer组件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-tsx" data-lang="tsx"><span class="o">&lt;</span><span class="nx">MSTFormElement</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&#34;project&#34;</span> <span class="nx">isMulti</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>遇到问题：需要将project的初始值改为数组</strong>
在formCreated生命周期中，进行赋值操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;project&#39;</span><span class="p">).</span><span class="nx">value</span><span class="o">=</span><span class="p">[];</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="最佳实践1">最佳实践1</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">projectEligibles</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">)=&gt;{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">presenterApi</span><span class="p">.</span><span class="nx">getEntityCRUD</span><span class="p">().</span><span class="nx">deleteRowByRealIndex</span><span class="p">(</span><span class="s1">&#39;projectEligibles&#39;</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
<span class="p">})</span>
<span class="nx">newProjectItems</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">presenterApi</span><span class="p">.</span><span class="nx">getEntityCRUD</span><span class="p">().</span><span class="nx">appendRow</span><span class="p">(</span><span class="s1">&#39;projectEligibles&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getProjectAttr</span><span class="p">(</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span> <span class="s1">&#39;项目&#39;</span><span class="p">,</span> <span class="nx">item</span><span class="p">))</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Go基础三：方法和接口</title>
                <link>https://wss.cool/learn-go-3.html</link>
                <guid isPermaLink="true">https://wss.cool/learn-go-3.html</guid>
                <pubDate>Mon, 06 Jul 2020 12:27:59 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="方法">方法</h2>
<ol>
<li>定义</li>
</ol>
<p>Go中没有类，不过可以为结构体类型定义方法。方法就是一类带有特殊「接收者」参数的函数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Vertex</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">X</span><span class="p">,</span> <span class="nx">Y</span> <span class="kt">float64</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">Vertex</span><span class="p">)</span> <span class="nf">Abs</span><span class="p">()</span> <span class="kt">float64</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">X</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">X</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">Y</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">v</span> <span class="o">:=</span> <span class="nx">Vertex</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nf">Abs</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>方法接收者，在func与方法名之间。这里是<code>(v Vertex)</code>。相当于为<code>Vertex</code>类型定义了方法<code>Abs</code></p>
<ol start="2">
<li>非结构体类型的方法</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">MyFloat</span> <span class="kt">float64</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">MyFloat</span><span class="p">)</span> <span class="nf">Abs</span><span class="p">()</span> <span class="kt">float64</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">f</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nb">float64</span><span class="p">(</span><span class="o">-</span><span class="nx">f</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">f</span> <span class="o">:=</span> <span class="nf">MyFloat</span><span class="p">(</span><span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">Sqrt2</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nf">Abs</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>接收者的类型定义和方法声明必须在同一包内；不能为内建类型声明方法。</p>
<ol start="3">
<li>指针接收者</li>
</ol>
<p>前面定义的方法，是「值接收者」</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">Vertex</span><span class="p">)</span> <span class="nf">Abs</span><span class="p">()</span> <span class="kt">float64</span> <span class="p">{}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">MyFloat</span><span class="p">)</span> <span class="nf">Abs</span><span class="p">()</span> <span class="kt">float64</span> <span class="p">{}</span>
</code></pre></td></tr></table>
</div>
</div><p>还有一种「指针接收者」，多了一个「*」星号</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">Vertex</span><span class="p">)</span> <span class="nf">Scale</span><span class="p">(</span><span class="nx">f</span> <span class="kt">float64</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">v</span><span class="p">.</span><span class="nx">X</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">X</span> <span class="o">*</span> <span class="nx">f</span>
	<span class="nx">v</span><span class="p">.</span><span class="nx">Y</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Y</span> <span class="o">*</span> <span class="nx">f</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>「指针接收者」可以修改指针，「值接收者」则不能修改。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Vertex</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">X</span><span class="p">,</span> <span class="nx">Y</span> <span class="kt">float64</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">Vertex</span><span class="p">)</span> <span class="nf">Abs</span><span class="p">()</span> <span class="kt">float64</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">v</span><span class="p">.</span><span class="nx">X</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Y</span>
<span class="p">}</span>

<span class="c1">// 可以对v进行修改。如果去掉「*」则不会修改。
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">Vertex</span><span class="p">)</span> <span class="nf">Scale</span><span class="p">(</span><span class="nx">f</span> <span class="kt">float64</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">v</span><span class="p">.</span><span class="nx">X</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">X</span> <span class="o">*</span> <span class="nx">f</span>
	<span class="nx">v</span><span class="p">.</span><span class="nx">Y</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Y</span> <span class="o">*</span> <span class="nx">f</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">v</span> <span class="o">:=</span> <span class="nx">Vertex</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">}</span>
	<span class="nx">v</span><span class="p">.</span><span class="nf">Scale</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nf">Abs</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>指针与函数
函数定义的参数如果是指针，那么传的参数就要求是指针，如果传值就会报错。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">ScaleFunc</span><span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">Vertex</span><span class="p">,</span> <span class="nx">f</span> <span class="kt">float64</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">v</span><span class="p">.</span><span class="nx">X</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">X</span> <span class="o">*</span> <span class="nx">f</span>
	<span class="nx">v</span><span class="p">.</span><span class="nx">Y</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Y</span> <span class="o">*</span> <span class="nx">f</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">v</span> <span class="o">:=</span> <span class="nx">Vertex</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">}</span>
	<span class="nf">ScaleFunc</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1">// 编译错误！
</span><span class="c1"></span>	<span class="nf">ScaleFunc</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">v</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">// OK
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>方法与指针重定向
以指针为接收者的方法被调用时，接收者既能为值又能为指针：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">v</span> <span class="nx">Vertex</span>
<span class="nx">v</span><span class="p">.</span><span class="nf">Scale</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1">// OK
</span><span class="c1"></span><span class="nx">p</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">v</span>
<span class="nx">p</span><span class="p">.</span><span class="nf">Scale</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">// OK
</span></code></pre></td></tr></table>
</div>
</div><p>反过来，接受一个值作为参数的函数必须接受一个指定类型的值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">v</span> <span class="nx">Vertex</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">AbsFunc</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span>  <span class="c1">// OK
</span><span class="c1"></span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">AbsFunc</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">v</span><span class="p">))</span> <span class="c1">// 编译错误！
</span></code></pre></td></tr></table>
</div>
</div><p>而以值为接收者的方法被调用时，接收者既能为值又能为指针。</p>
<p>使用指针接收者能避免在调用时复制值，尤其是大型构造体，会更加高效。</p>
<p>一般不混用两者。</p>
<h2 id="接口">接口</h2>
<ol>
<li>接口类型是由一组方法签名定义的结合。</li>
</ol>
<p>接口类型的变量可以保存任意实现了这些方法的值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 定义接口
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Abser</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nf">Abs</span><span class="p">()</span> <span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// 定义结构体，并实现接口
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">MyFloat</span> <span class="kt">float64</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">MyFloat</span><span class="p">)</span> <span class="nf">Abs</span><span class="p">()</span> <span class="kt">float64</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">f</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nb">float64</span><span class="p">(</span><span class="o">-</span><span class="nx">f</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 定义结构体，并实现结构
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Vertex</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">X</span><span class="p">,</span> <span class="nx">Y</span> <span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// 指针的方法
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">Vertex</span><span class="p">)</span> <span class="nf">Abs</span><span class="p">()</span> <span class="kt">float64</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">X</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">X</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">Y</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">a</span> <span class="nx">Abser</span>
	<span class="nx">f</span> <span class="o">:=</span> <span class="nf">MyFloat</span><span class="p">(</span><span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">Sqrt2</span><span class="p">)</span>
	<span class="nx">v</span> <span class="o">:=</span> <span class="nx">Vertex</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">}</span>

	<span class="nx">a</span> <span class="p">=</span> <span class="nx">f</span>  <span class="c1">// a MyFloat 实现了 Abser
</span><span class="c1"></span>	<span class="nx">a</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">v</span> <span class="c1">// a *Vertex 实现了 Abser
</span><span class="c1"></span>
	<span class="c1">// 下面一行，v 是一个 Vertex（而不是 *Vertex）
</span><span class="c1"></span>	<span class="c1">// 所以没有实现 Abser。
</span><span class="c1"></span>	<span class="nx">a</span> <span class="p">=</span> <span class="nx">v</span>
	<span class="o">&gt;=</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nf">Abs</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>接口与隐式实现</li>
</ol>
<p>类型通过实现接口的所有方法实现接口，无需专门的声明。</p>
<p>隐式接口从接口的实现中解藕了定义，这样接口的实现可以出现在任何包中，无需提前准备。</p>
<ol start="3">
<li>接口值</li>
</ol>
<p>接口也是值。它们可以像其它值一样传递。接口值可以用作函数的参数或返回值。凡是这个接口的类型都可以使用这个方法或作为返回值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">I</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nf">M</span><span class="p">()</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">describe</span><span class="p">(</span><span class="nx">i</span> <span class="nx">I</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;(%v, %T)\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">i</span> <span class="nx">I</span>

	<span class="nx">i</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">T</span><span class="p">{</span><span class="s">&#34;Hello&#34;</span><span class="p">}</span>
	<span class="nf">describe</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
	<span class="nx">i</span><span class="p">.</span><span class="nf">M</span><span class="p">()</span>

	<span class="nx">i</span> <span class="p">=</span> <span class="nf">F</span><span class="p">(</span><span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span><span class="p">)</span>
	<span class="nf">describe</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
	<span class="nx">i</span><span class="p">.</span><span class="nf">M</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Go基础二：流程控制语句</title>
                <link>https://wss.cool/learn-go-2.html</link>
                <guid isPermaLink="true">https://wss.cool/learn-go-2.html</guid>
                <pubDate>Mon, 06 Jul 2020 12:27:59 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="循环">循环</h2>
<p>Go只有一种循环语句：for</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">sum</span> <span class="o">:=</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nx">sum</span> <span class="o">+=</span> <span class="nx">i</span>
	<span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">sum</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>链表</title>
                <link>https://wss.cool/%E9%93%BE%E8%A1%A8.html</link>
                <guid isPermaLink="true">https://wss.cool/%E9%93%BE%E8%A1%A8.html</guid>
                <pubDate>Tue, 30 Jun 2020 09:27:18 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="数组">数组</h2>
<p>数组的缺点：数组中添加或删除元素需要将其他元素向前或向后移动，</p>
<p>除了对数据的随机访问，链表几乎可以用在任何可以使用一维数组的情况中。</p>
<h2 id="链表">链表</h2>
<p>链表是由一组“节点”组成的集合。每个节点都使用一个对象的引用指向它的后继。指向另一个节点的引用叫做“链”。数组元素靠它们的位置进行引用，链表元素则是靠互相之间的关系进行引用。</p>
<h2 id="链表对象">链表对象</h2>
<p>节点类：元素内容和后继的引用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">Node</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>链表类：表投和一些操作方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">LinkedList</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">head</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Node</span><span class="p">(</span><span class="s2">&#34;head&#34;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">find</span> <span class="o">=</span> <span class="nx">find</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">insert</span> <span class="o">=</span> <span class="nx">insert</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="nx">remove</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="nx">display</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="插入元素">插入元素</h2>
<p>向一个已知</p>
<h2 id="参考">参考</h2>
<ol>
<li>数据结构与算法JavaScript描述.[美]麦克米伦.[译者]王群锋，杜欢.人民邮电出版社.2014-08</li>
</ol>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%88%86%E7%B1%BB/">分类</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E6%98%BE%E7%A4%BA%E5%9C%A8%E5%BA%95%E9%83%A8/">显示在底部</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Go基础一：包、变量和函数</title>
                <link>https://wss.cool/learn-go-1.html</link>
                <guid isPermaLink="true">https://wss.cool/learn-go-1.html</guid>
                <pubDate>Mon, 29 Jun 2020 10:06:01 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="包">包</h2>
<p>每个Go程序都由包构成，程序从main方法开始执行。</p>
<p>通过下面这段代码来学习「包」相关的几个知识点。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span><span class="err">#</span><span class="mi">1</span><span class="err">#</span>
  <span class="s">&#34;fmt&#34;</span>
  <span class="s">&#34;math/rand&#34;</span>
  <span class="s">&#34;math&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;My favorite number is&#34;</span><span class="p">,</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="err">#</span><span class="mi">2</span><span class="err">#</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="p">)</span><span class="err">#</span><span class="mi">3</span><span class="err">#</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div></p>
<ul>
<li><span class="shortcodes_number">1</span>
程序导入了<code>fmt</code> <code>math/rand</code>两个包。</li>
<li><span class="shortcodes_number">1</span>
可以用圆括号进行“分组”导入，也可以分别导入。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>
<span class="kn">import</span> <span class="s">&#34;math&#34;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li><span class="shortcodes_number">2</span>
程序中以路径中的最后一段为包名。</li>
<li><span class="shortcodes_number">3</span>
以大写字母开头的变量是导出的，此处用小写的<code>math.pi</code>就不会导出，会报错，需要改完大写的<code>math.Pi</code>才能正常运行。</li>
</ul>
<h2 id="函数">函数</h2>
<ol>
<li>函数可以没有参数或接收多个参数</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="nx">x</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">y</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>多个相同的类型可用省略写法</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>可返回任意数量的返回值</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">swap</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">x</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>返回值可以被命名，它们被视为定义在函数的顶部</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">split</span><span class="p">(</span><span class="nx">sum</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">x</span> <span class="p">=</span> <span class="nx">sum</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">9</span>
	<span class="nx">y</span> <span class="p">=</span> <span class="nx">sum</span> <span class="o">-</span> <span class="nx">x</span>
	<span class="k">return</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>无参数的 return 返回已命名的返回值</li>
<li>无参数的 return 应该仅在这样短小的函数中使用，否则会影响可读性</li>
</ul>
<h2 id="变量">变量</h2>
<ol>
<li>var 用于声明变量列表，类型在最后。可出现在包和函数级别</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="kd">var</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">python</span><span class="p">,</span> <span class="nx">java</span> <span class="kt">bool</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">i</span> <span class="kt">int</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">python</span><span class="p">,</span> <span class="nx">java</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>声明可以包含初始值，每个变量对应一个。有初始值的话，可以省略类型。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="kt">int</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="kd">var</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">java</span><span class="p">,</span> <span class="nx">python</span> <span class="p">=</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&#34;no!&#34;</span>
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>在..函数中..，且..类型明确..，则可以使用..简洁赋值..语句<code>:=</code>代替<code>var</code>。在函数外，每个语句都必须以关键字开始（var，func等），因此<code>:=</code>不能在函数外使用。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="kt">int</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="nx">k</span> <span class="o">:=</span> <span class="mi">3</span>
<span class="nx">c</span><span class="p">,</span> <span class="nx">python</span><span class="p">,</span> <span class="nx">java</span> <span class="o">:=</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&#34;no!&#34;</span>
</code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>基本类型</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kt">bool</span>

<span class="kt">string</span>

<span class="kt">int</span>  <span class="kt">int8</span>  <span class="kt">int16</span>  <span class="kt">int32</span>  <span class="kt">int64</span>
<span class="kt">uint</span> <span class="kt">uint8</span> <span class="kt">uint16</span> <span class="kt">uint32</span> <span class="kt">uint64</span> <span class="kt">uintptr</span>

<span class="kt">byte</span> <span class="c1">// uint8 的别名
</span><span class="c1"></span>
<span class="kt">rune</span> <span class="c1">// int32 的别名
</span><span class="c1"></span>    <span class="c1">// 表示一个 Unicode 码点
</span><span class="c1"></span>
<span class="kt">float32</span> <span class="kt">float64</span>

<span class="kt">complex64</span> <span class="kt">complex128</span>
</code></pre></td></tr></table>
</div>
</div><p><code>int</code>, <code>uint</code> 和 <code>uintptr</code> 在 32 位系统上通常为 32 位宽，在 64 位系统上则为 64 位宽。 当你需要一个整数值时应使用 <code>int</code> 类型，除非你有特殊的理由使用固定大小或无符号的整数类型。</p>
<ol start="5">
<li>没有明确初始值的变量声明会被赋值为它们的「零值」。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">i</span> <span class="kt">int</span>		<span class="c1">// 数值类型为 0
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">f</span> <span class="kt">float64</span>	<span class="c1">// 数值类型为 0
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">b</span> <span class="kt">bool</span>		<span class="c1">// 布尔类型为 false
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">s</span> <span class="kt">string</span>	<span class="c1">// 字符串为 &#34;&#34;（空字符串）
</span></code></pre></td></tr></table>
</div>
</div><ol start="6">
<li>类型转换：表达式 T(v) 将值 v 转换为类型 T</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">i</span> <span class="kt">int</span>		<span class="p">=</span> <span class="mi">42</span>
<span class="kd">var</span> <span class="nx">f</span> <span class="kt">float64</span>	<span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="nx">u</span> <span class="o">:=</span> <span class="nb">uint</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ol start="7">
<li>类型推断：声明变量但未指定类型时，类型由右值推导得出。
<ul>
<li>当右值声明了类型时，新变量的类型与其相同</li>
<li>当右值包含未指定类型的数值常量时，由其精度决定类型</li>
</ul>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">i</span> <span class="o">:=</span> <span class="mi">42</span>				<span class="c1">// int
</span><span class="c1"></span><span class="nx">f</span> <span class="o">:=</span> <span class="mf">3.142</span>			<span class="c1">// float64
</span><span class="c1"></span><span class="nx">g</span> <span class="o">:=</span> <span class="mf">0.867</span> <span class="o">+</span> <span class="m">0.5i</span>	<span class="c1">// complex128
</span><span class="c1"></span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;g is of type %T\n&#34;</span><span class="p">,</span> <span class="nx">g</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ol start="8">
<li>常量使用 const 声明，语法与声明变量类似。常量不能用 := 语法声明</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="nx">World</span> <span class="p">=</span> <span class="s">&#34;世界&#34;</span>
</code></pre></td></tr></table>
</div>
</div><ol start="9">
<li>数值常量：高精度的<strong>值</strong>，未指定类型的常量由上下文决定其类型</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
	<span class="c1">// 将 1 左移 100 位来创建一个非常大的数字
</span><span class="c1"></span>	<span class="c1">// 即这个数的二进制是 1 后面跟着 100 个 0
</span><span class="c1"></span>	<span class="nx">Big</span> <span class="p">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">100</span>
	<span class="c1">// 再往右移 99 位，即 Small = 1 &lt;&lt; 1，或者说 Small = 2
</span><span class="c1"></span>	<span class="nx">Small</span> <span class="p">=</span> <span class="nx">Big</span> <span class="o">&gt;&gt;</span> <span class="mi">99</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">needInt</span><span class="p">(</span><span class="nx">x</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
<span class="kd">func</span> <span class="nf">needFloat</span><span class="p">(</span><span class="nx">x</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">float64</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">needInt</span><span class="p">(</span><span class="nx">Small</span><span class="p">))</span>		<span class="c1">// Small可以作为int
</span><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">needFloat</span><span class="p">(</span><span class="nx">Small</span><span class="p">))</span>		<span class="c1">// Small可以作为float64
</span><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">needFloat</span><span class="p">(</span><span class="nx">Big</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>React-生命周期</title>
                <link>https://wss.cool/react-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html</link>
                <guid isPermaLink="true">https://wss.cool/react-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html</guid>
                <pubDate>Fri, 19 Jun 2020 09:41:43 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="挂载">挂载</h2>
<ul>
<li>constructor</li>
<li>getDerviedStateFromProps</li>
<li>render</li>
<li>didMount</li>
</ul>
<p>willMount已过时</p>
<h2 id="更新">更新</h2>
<ul>
<li>getDerviedStateFromProps</li>
<li>shouldComponentUpdate(nextProps, nextState)</li>
<li>render</li>
<li>getSnapshotBeforeUpdate(prevProps, prevState)</li>
<li>componentDidUpdate(prevProps, prevState, snapshot)</li>
</ul>
<p>willUpdate和willReceiveProps已过时</p>
<p>getSnapshotBeforeUpdate可以在更新前，从DOM中获取一些信息，比如滚动位置。</p>
<h2 id="卸载">卸载</h2>
<ul>
<li>willUnmount</li>
</ul>
<h2 id="异常">异常</h2>
<ul>
<li>getDerviedStateFromError</li>
<li>didCatch</li>
</ul>
<h2 id="setstate">setState</h2>
<p>setState在合成事件或者生命周期中调用时，会将修改放入队列，在协调和更新之后进行更新state</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>TLS握手过程</title>
                <link>https://wss.cool/%E5%AD%A6%E4%B9%A0tls.html</link>
                <guid isPermaLink="true">https://wss.cool/%E5%AD%A6%E4%B9%A0tls.html</guid>
                <pubDate>Tue, 16 Jun 2020 14:41:03 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="什么是tls">什么是TLS</h2>
<p>TLS是IETF对SSL进行标准化时，将其改名为Transport Layer Security(传输层安全)。严格说，SSL与TLS指代的协议的版本号不同，TLS1.0是SSL3.0的升级版。</p>
<h2 id="握手">握手</h2>
<p>TLS的通信是通过对称加密进行的，也就是client与server使用同一个密钥进行加密和解密，那么这个密钥怎么从加密方传给解密方呢？如果直接从网络上传输，它就可能会被攻击者获取到，这样加密也就失去了意义。也就是说，发送密钥有被窃听的危险，但是不发送的话，接收方又不能解密。</p>
<p>所以为了安全的将密钥发送给接收方</p>
<p>首先会进行TCP的握手，即一次往返。然后开始TLS的握手。</p>
<p>四个阶段：</p>
<ol>
<li>client hello</li>
<li>server hello</li>
<li>client finish</li>
<li>server finish</li>
</ol>
<p>主要做了两件事：确定协议版本和加密套件、生成加密密钥。TLS的握手主要由3个阶段来完成这两件事。</p>
<p>第一件事比较简单，只需要client告诉server自己支持的协议的版本和支持的加密套件，然后server选择并通知client。就可以啦。这两个操作分别在握手的第一第二阶段完成。</p>
<p>第二件事就没那么简单来。协议规定，生成一个加密密钥需要三个随机数，其中前两个随机数分别在第一阶段和第二阶段，由client和server分别生成并告诉对方。第三个随机数的交换要稍微复杂一点。</p>
<ul>
<li>首先client在第二阶段得到来server的证书，证书中包含来server的公钥。</li>
<li>然后client会使用这个公钥对第三个随机数进行加密，然后将随机数的密文传给server。</li>
<li>最后，server将密文解密，得到了第三个随机数。</li>
</ul>
<p>这样，client和server两端就都有了这三个随机数，然后它们使用相同的算法生成一个密钥，用这个密钥来对数据进行对称加密，在将密文在网络中传输。</p>
<p>为什么第三个随机数要这么麻烦呢？</p>
<p>首先，client和server都会发送和接收数据，所以两边都要进行加密和解密。加密算法主要就两类：对称和非对称。非对称的性能差，所以就选择性能好的对称算法。而对称算法的密钥需要两端都知道才可以，因此使用非对称加密将密钥从一边发送给另一边。又为了保证随机性，就用三个随机数来生成密钥。</p>
<p><strong>下面具体说一下这四个阶段都做了什么。</strong></p>
<p>第一步，client需要告诉server自己支持的版本号和加密套件，还要生成随机数2，用于计算加密密钥。client把这三个信息告诉来server。</p>
<p>第二步，server在拿到这些信息后，它会选择一个版本号和一个加密套件。然后跟第一步一样，生成随机数2，也是用于计算加密密钥。在加上自己的证书，将这四项数据发回给client。</p>
<p>第三步，client首先验证证书的有效性，若有效从中取出server的公钥。生成随机数3，使用公钥对其进行加密，并发送给server密文，并告诉server之后的消息开始加密了。还会将前面的握手信息的摘要进行加密后传给server，server收到后将其解密，用于验证协商的密钥的一致性。</p>
<p>第四步，</p>
<h3 id="client-hello">client hello</h3>
<p>client告诉server：</p>
<ol>
<li>协议版本号</li>
<li>随机数1</li>
<li>支持的加密套件</li>
</ol>
<h3 id="server-hello">server hello</h3>
<p>server根据收到的信息</p>
<ol>
<li>确认版本号</li>
<li>随机数2</li>
<li>选择加密套件</li>
<li>server证书</li>
</ol>
<h3 id="client回应">client回应</h3>
<p>首先验证证书，如果验证通过：</p>
<ol>
<li>从证书内取出server公钥</li>
<li>随机数3，使用公钥加密</li>
<li>client握手结束</li>
</ol>
<h3 id="server回应">server回应</h3>
<ol>
<li>server握手结束</li>
</ol>
<h2 id="完成握手">完成握手</h2>
<p>两边都有了三个随机数，使用相同的加密算法，生成一个对称密钥。此后两边的应用数据都通过这个密钥进行加密。</p>
<h2 id="对称加密于非对称加密">对称加密于非对称加密</h2>
<p>非对称加密算法最常用的是RSA算法，使用公钥和私钥进行加密和解密。缺点是速度慢，优点是安全性高。</p>
<p>对称加密算法，加密和解密使用同一个密钥。优点是速度快。</p>
<p><img src="https://hugo-1256216240.cos.ap-chengdu.myqcloud.com/20200617170240_3ad7348e955aff44fda2574262f18834.png" alt="发送对称加密的密钥.png" title="发送对称加密的密钥"><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<h2 id="参考">参考</h2>
<p><a href="https://www.jianshu.com/p/7158568e4867">https://www.jianshu.com/p/7158568e4867</a></p>
<p>图解HTTP</p>
<p>Web性能权威指南</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>上野宣.<a href="https://m.douban.com/book/subject/25863515/">图解HTTP</a>.于均良.北京:人民邮电出版社,2014.5 <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E7%BD%91%E7%BB%9C/">网络</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>计算贝塞尔曲线</title>
                <link>https://wss.cool/%E8%AE%A1%E7%AE%97%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF.html</link>
                <guid isPermaLink="true">https://wss.cool/%E8%AE%A1%E7%AE%97%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF.html</guid>
                <pubDate>Fri, 12 Jun 2020 12:18:44 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="为什么做这个事">为什么做这个事</h2>
<p>今天去面试，工作是开发一个3D内容的编辑器，面试官问了我一个问题</p>
<blockquote>
<p>做一个动画使一个元素从一个位置移动到另一个位置，移动的过程的速度是可配置的。怎么实现这种配置</p>
</blockquote>
<p>我的回答是用一个曲线模拟速度，曲线有JS代码计算。曲线上有拐点，可以控制各个段落的斜率。</p>
<p>回到家后，我想到chrome在调试css的transition时，chrome会提供跟我们一个界面来调贝塞尔曲线，它就跟面试官问的问题中的那个东西。所以我就想着做一个这东西出来，进行开源。也是作为练习。而且我还打算做一个开源编辑器，没准以后也会用到。</p>
<h2 id="开始做">开始做</h2>
<p>贝塞尔曲线应该有一个计算公式，我将公式转换成JS代码就可以了。于是查了<a href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E8%8C%B2%E6%9B%B2%E7%B7%9A#%E7%A8%8B%E5%BC%8F%E7%AF%84%E4%BE%8B">维基百科</a>。</p>
<p>知道了多项式公式：
<img src="/images/bezier/%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF.png" alt="多项式公式" title="贝塞尔曲线多项式公式"></p>
<p>其中有个括号n,i，不知道是什么，查了一下，它是「组合」：
<img src="/images/bezier/%E7%BB%84%E5%90%88.png" alt="组合" title="组合"></p>
<p>有了这两个公式，代码就不困难了。</p>
<p>写好代码后把计算这部分做成了一个npm包，发布到了npm仓库，代码放在了github<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<pre><code>npm install @wangshushuo/bezierjs
</code></pre><h2 id="绘制canvas">绘制canvas</h2>
<p>canvas的api我不熟，多亏了MDN的<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes">canvas文档</a>，需要用到画圆、写字、画线条、填充颜色等API。</p>
<p>下面是做出来的效果，代码在Github<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<iframe src="https://wss.cool/react-bezier/" style="height:400px;width:400px;"></iframe>
<h2 id="总结">总结</h2>
<p>做出来以后决定很有成就感，收获了这些：</p>
<ul>
<li>了解到了如何计算贝塞尔曲线和组合</li>
<li>熟悉了一波canvas的api</li>
<li>第一次发布了npm包</li>
<li>第一次在代码中使用了TypeScript的枚举</li>
</ul>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>地址：<a href="https://github.com/wangshushuo/bezierjs">https://github.com/wangshushuo/bezierjs</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>绘制canvas的仓库地址：<a href="https://github.com/wangshushuo/react-bezier">https://github.com/wangshushuo/react-bezier</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>枚举的应用</title>
                <link>https://wss.cool/%E6%9E%9A%E4%B8%BE%E7%9A%84%E5%BA%94%E7%94%A8.html</link>
                <guid isPermaLink="true">https://wss.cool/%E6%9E%9A%E4%B8%BE%E7%9A%84%E5%BA%94%E7%94%A8.html</guid>
                <pubDate>Thu, 11 Jun 2020 23:41:48 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>展示TypeScript中的枚举(enum)的一种实际用例。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">class</span> <span class="nx">P</span> <span class="p">{</span>
  <span class="nx">x</span>: <span class="kt">number</span><span class="p">;</span>
  <span class="nx">y</span>: <span class="kt">number</span><span class="p">;</span>
  <span class="kr">constructor</span><span class="p">(</span><span class="nx">x</span>: <span class="kt">number</span><span class="p">,</span> <span class="nx">y</span>: <span class="kt">number</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">enum</span> <span class="nx">key</span> <span class="p">{</span>
  <span class="nx">x</span> <span class="o">=</span> <span class="s2">&#34;x&#34;</span><span class="p">,</span>
  <span class="nx">y</span> <span class="o">=</span> <span class="s2">&#34;y&#34;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">p0</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">P</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">dosomething</span><span class="p">(</span><span class="nx">key</span>: <span class="kt">key</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p0</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
<span class="p">}</span>

<span class="nx">dosomething</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>
<span class="nx">dosomething</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>设置jar包使用内存</title>
                <link>https://wss.cool/%E8%AE%BE%E7%BD%AEjar%E5%8C%85%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98.html</link>
                <guid isPermaLink="true">https://wss.cool/%E8%AE%BE%E7%BD%AEjar%E5%8C%85%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98.html</guid>
                <pubDate>Thu, 28 May 2020 07:56:46 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>下面的命令中包含了几个 <code>jvm option</code> 限制运行jar包使用的内存在72M。</p>
<pre><code>java -XX:+UseSerialGC -Xss512k -XX:MaxRAM=72m -jar image-0.0.4-SNAPSHOT.jar
</code></pre><p>如果不加这3个option的话，会使用大概300-400M内存。</p>
<p>根据这个答案<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>进行的设置：</p>
<p>With <code>-XX:+UseSerialGC</code> 这将与分配堆内存的线程而不是专用GC线程内联地执行垃圾回收。</p>
<p>With <code>-Xss512k</code> 这会将每个线程的堆栈内存限制为512KB，而不是默认的1MB。</p>
<p>With <code>-XX:MaxRAM=72m</code> 这会将JVM对堆和非堆托管内存的计算限制在此值的范围内。</p>
<p>除了上述JVM选项之外，您还可以在 <code>application.properties</code> 文件中使用以下属性：</p>
<p><code>server.tomcat.max-threads = 1</code> 这会将HTTP请求处理程序线程数限制为1（默认值为200）</p>
<p>这是一个使用上述限制并使用 <code>docker -m 72m</code> 参数运行非常简单的 <code>Spring Boot</code> 应用程序的 <code>docker stats</code> 示例。如果我降低的值低于此值，我将无法启动应用程序。</p>
<pre><code>83ccc9b2156d: Mem Usage: 70.36MiB / 72MiB | Mem Percentage: 97.72%
</code></pre><section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>CCob.<a href="https://stackoverflow.com/a/52993285/6021280">stackoverflow Answers</a>.2018年10月25日 <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>学习TCP</title>
                <link>https://wss.cool/%E5%AD%A6%E4%B9%A0tcp.html</link>
                <guid isPermaLink="true">https://wss.cool/%E5%AD%A6%E4%B9%A0tcp.html</guid>
                <pubDate>Wed, 27 May 2020 13:30:38 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="三次握手">三次握手</h2>
<ol>
<li>SYN：client 随机生成起始分组序列号 x ，并发送SYN分组，还有其他TCP表示和选项</li>
<li>SYN ACK：server 将 x+1 ，生成随机序列号 y</li>
<li>ACK：client 将 x + 1，y + 1，发送ACK分组，完成握手。此时可以发起请求，比如 Http Get 。</li>
</ol>
<h2 id="慢启动">慢启动</h2>
<p>完成了三次握手，client发送了http/get请求，server处理完请求开始发送响应数据，新TCP链接传输的最大值取rwnd和cwnd的最小值，也就是4个TCP段。client收到4个TCP段后分别发送ACK确认，也就是4个ACK确认。server收到4个ACK，每收到一个ACK，慢启动算法会让服务器cwnd递增一个TCP段，此时cwnd就增加到8个TCP段。这就是慢启动和指数增长。</p>
<dl>
<dt>rwnd</dt>
<dd>缩放窗口</dd>
<dt>cwnd</dt>
<dd>拥塞窗口</dd>
<dt>TCP段</dt>
<dd>一个TCP数据包。负载1460字节 + TCP头信息20字节 + IP头信息20字节 + 以太网头信息22字节 = 以太网数据包1522字节</dd>
<dt>4个TCP段</dt>
<dd>协议规定的服务器默认cwnd值，新版协议是10个。</dd>
</dl>
<h2 id="参考">参考</h2>
<ol>
<li>阮一峰.<a href="http://www.ruanyifeng.com/blog/2017/06/tcp-protocol.html">TCP 协议简介</a>.[2017年6月8日]</li>
<li>Ilya Grigorik.Web性能权威指南.李松峰译.北京:人民邮电出版社，2014</li>
</ol>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E7%BD%91%E7%BB%9C/">网络</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>组件化</title>
                <link>https://wss.cool/%E7%BB%84%E4%BB%B6%E5%8C%96.html</link>
                <guid isPermaLink="true">https://wss.cool/%E7%BB%84%E4%BB%B6%E5%8C%96.html</guid>
                <pubDate>Tue, 26 May 2020 18:27:38 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<dl>
<dt>减少重复代码</dt>
<dd>即便没有复杂的逻辑，只是重复的UI元素，也可以封装成组件，以便重复使用，减少重复代码。</dd>
<dt>封装逻辑</dt>
<dd>相关的函数、变量和DOM元素封装成一个组件，降低复杂度。需要的话，暴露出参数用于复用。</dd>
<dt>复用</dt>
<dd>功能逻辑可以是通用的，比如背景图、颜色、文字等可能变化，也可以重复使用一个组件在不同的地方传不同的参数。</dd>
</dl>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>深浅拷贝</title>
                <link>https://wss.cool/%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D.html</link>
                <guid isPermaLink="true">https://wss.cool/%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D.html</guid>
                <pubDate>Mon, 25 May 2020 18:34:27 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="什么是拷贝什么是深浅拷贝">什么是拷贝，什么是深浅拷贝</h2>
<p>在 JavaScript 中，变量中保存的是对象的引用。比如像下面这样的操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">对象1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>a和b都在引用对象1，如果对对象1进行修改，则a和b两个变量都会受到影响，有时我们不希望出现这种情况，就要对对象进行拷贝操作来切换引用。比如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">对象1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">拷贝</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>那么如何实现拷贝呢？</p>
<p>我们知道对象是由多个key和value组成的，所以拷贝就是创建一个新的对象，将旧对象的key和value拷贝到新对象中，让新旧对象的key和value完全一样。比如像下面这样</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">对象1</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">新对象</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">对象1</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p>这样的操作需要注意value的类型，分为基本类型和引用类型<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>，如果所有的value都是基本类型，但是如果value是引用类型就会出现新旧对象中都引用了一个对象的情况，也就是上文提到的a和b变量的问题。..如果想完全切断引用，就要对引用类型的value在进行一次拷贝..。对于是否需要完全切断引用就有了两种拷贝方式，需要完全切断引用的就是「深拷贝」，不需要的就是「浅拷贝」。</p>
<p>简单概括一下。</p>
<p>「浅拷贝」是只对对象的key和value进行一次遍历拷贝，不管内部的引用。</p>
<p>「深拷贝」要将对象内部的引用完全切断，对对象进行递归地拷贝。</p>
<h2 id="如何实现深拷贝">如何实现深拷贝</h2>
<p>先看一种实现方式</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="ln"> 1</span><span class="kd">function</span> <span class="nx">clone</span><span class="p">(</span><span class="nx">旧对象</span><span class="p">)</span> <span class="p">{</span>
<span class="ln"> 2</span>  <span class="kd">var</span> <span class="nx">新对象</span> <span class="o">=</span> <span class="p">{};</span>
<span class="ln"> 3</span>  <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">旧对象</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="ln"> 4</span>    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">旧对象</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="ln"> 5</span>    <span class="k">if</span><span class="p">(</span><span class="nx">is基本类型</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
<span class="ln"> 6</span>      <span class="nx">新对象</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">旧对象</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="ln"> 7</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="hl"><span class="ln"> 8</span>      <span class="nx">新对象</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">clone</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// 递归
</span></span><span class="ln"> 9</span><span class="c1"></span>    <span class="p">}</span>
<span class="ln">10</span>  <span class="p">})</span>
<span class="ln">11</span>  <span class="k">return</span> <span class="nx">新对象</span><span class="p">;</span>
<span class="ln">12</span><span class="p">}</span>
</code></pre></div>
<p>这种方法用的是递归，即当value不是基本类型时就对它进行拷贝。该方法有一个明显的问题，当出现循环引用时，就进入了一个死循环。</p>
<p>我们知道，函数的调用会形成一个「执行栈」，函数执行过程中如果又调用了函数就像该函数压入栈顶并执行，前一个函数就暂停了等待新函数执行完。</p>
<p>递归就是当前对象还没有拷贝完，就开始了下一次拷贝，就是在「执行栈」又压入了一次函数调用，而循环引用会导致不停滴往执行栈顶添加，对后执行栈超过限制大小，而中断。</p>
<p>为了避免爆栈问题，可以让一次拷贝进行完之后再开始下一次拷贝。就是把遇到的对象放在一个地方（数组1），当遇到对象时把它保存起来，完成一次拷贝后去检查看还有没有需要拷贝的对象。</p>
<p>这样虽然解决了爆栈，但是仍是一个死循环，因为会不停地向那个地方添加对象。所以需要一种方法来判断已经拷贝过的对象。</p>
<p>我们再创建一个数组2，用来保存拷贝过的对象，当遇到新的对象时，先去数组内查找，就不向数组1添加了，也就阻止了死循环。</p>
<p>下面的代码是对上面分析的过程的实现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// value 参数为原对象
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">cloneLoop</span><span class="p">(</span><span class="nx">oldObject</span><span class="p">)</span> <span class="p">{</span>

  <span class="kr">const</span> <span class="nx">uniqueList</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// 用来去重
</span><span class="c1"></span>  <span class="c1">// 新的空对象
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">root</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="c1">// 存储子对象的数组
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">children</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nx">parent</span><span class="o">:</span> <span class="nx">root</span><span class="p">,</span>
      <span class="nx">key</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">oldObject</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">];</span>

  <span class="c1">// 如果children内有子对象，则将其copy
</span><span class="c1"></span>  <span class="k">while</span><span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 深度优先，如果使用shift()则是广度有限。
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
    <span class="kr">const</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">childObject</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">childObject</span><span class="p">;</span>

    <span class="c1">// 当key是undefined时，parent是{}，也就是刚开始
</span><span class="c1"></span>    <span class="c1">// 当key不是undefined时，就是已经复制到子对象了，这时key肯定时有值的，
</span><span class="c1"></span>    <span class="c1">// 需要把key对应的value初始化为空对象，后面的循环把子对象的 key 和 value 复制到空对象上。
</span><span class="c1"></span>    <span class="kd">let</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">key</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>

    <span class="c1">// 当循环引用时，childObject会与拷贝过的对象相等，就可以把它直接赋值到新对象上。完成一次拷贝。
</span><span class="c1"></span>    <span class="kd">let</span> <span class="nx">uniqueData</span> <span class="o">=</span> <span class="nx">find</span><span class="p">(</span><span class="nx">uniqueList</span><span class="p">,</span> <span class="nx">childObject</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">uniqueData</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">parent</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">uniqueData</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span> <span class="c1">// 中断本次循环
</span><span class="c1"></span>    <span class="p">}</span>

    <span class="c1">// 数据不存在
</span><span class="c1"></span>    <span class="c1">// 保存源数据，在拷贝数据中对应的引用
</span><span class="c1"></span>    <span class="nx">uniqueList</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="nx">source</span><span class="o">:</span> <span class="nx">childObject</span><span class="p">,</span>
      <span class="nx">target</span><span class="o">:</span> <span class="nx">res</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="c1">// 遍历子对象
</span><span class="c1"></span>    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">childObject</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// 如果value时对象，将子对象放入「子对象数组」中，待下一次while读取遍历
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">childObject</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// 下一次循环
</span><span class="c1"></span>          <span class="nx">children</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="nx">parent</span><span class="o">:</span> <span class="nx">res</span><span class="p">,</span>
            <span class="nx">key</span><span class="o">:</span> <span class="nx">k</span><span class="p">,</span>
            <span class="nx">childObject</span><span class="o">:</span> <span class="nx">childObject</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span>
          <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">res</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">childObject</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">root</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">find</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">source</span> <span class="o">===</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>总结一下要点：</p>
<ol>
<li>使用一个数组存储copy过程中遇到的对象，以破解爆栈的问题。</li>
<li>使用另一个数组存储copy过的对象，以破解循环引用的问题。</li>
</ol>
<p>对于拷贝一个对象的过程lodash使用的是「结构化克隆算法」<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>，普通对象直接复制key和value，数组等其他对象使用相应的复制方法。</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Nicholas C.Zakas；JavaScript高级程序设计(第3版)；4.1 基本类型与引用类型的值 <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>MDN web docs；<a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/API/DOM/The_structured_clone_algorithm">结构化克隆算法</a>。<br>
HTML Living Standard；<a href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializeinternal">结构化克隆算法</a>，<a href="https://whatwg-cn.github.io/html/#structuredserializeinternal">中文翻译</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E7%AE%97%E6%B3%95/">算法</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>JavaScript变量类型</title>
                <link>https://wss.cool/javascript%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B.html</link>
                <guid isPermaLink="true">https://wss.cool/javascript%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B.html</guid>
                <pubDate>Mon, 25 May 2020 18:23:09 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>变量类型的值分为基本类型和引用类型。</p>
<p>基本类型有五种：String、Number、Boolean、Undefined和Null。</p>
<p>引用类型是对象。对象中又有宿主对象和原生对象的区别。</p>
<p>宿主对象是环境提供的对象。比如DOM对象：window、document；BOM对象：history、location、navigator等。</p>
<p>原生对象是JavaScript语言提供的，比如Math、Array、Date、RegExp等，还有ES6的Set、Map等。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/javascript%E5%9F%BA%E7%A1%80/">JavaScript基础</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Mysql增删改查</title>
                <link>https://wss.cool/mysql%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5.html</link>
                <guid isPermaLink="true">https://wss.cool/mysql%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5.html</guid>
                <pubDate>Mon, 25 May 2020 17:47:39 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="create">create</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tasks</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="p">,</span><span class="n">description</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;Learn MySQL INSERT&#39;</span><span class="p">,</span><span class="s1">&#39;2017-07-21&#39;</span><span class="p">,</span><span class="s1">&#39;2017-07-22&#39;</span><span class="p">,</span><span class="s1">&#39;Start learning..&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="read-左右链接">read 左右链接</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
    <span class="n">plugin_of_user</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">plugin_of_user</span><span class="p">.</span><span class="n">user_plugin_name</span><span class="p">,</span>
    <span class="n">plugin_info</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">plugin_info</span><span class="p">.</span><span class="n">avatar</span><span class="p">,</span> <span class="n">plugin_info</span><span class="p">.</span><span class="n">link</span><span class="p">,</span> <span class="n">plugin_info</span><span class="p">.</span><span class="k">type</span>
<span class="k">FROM</span> <span class="n">plugin_of_user</span>
<span class="k">RIGHT</span> <span class="k">JOIN</span> <span class="n">plugin_info</span>
<span class="k">ON</span> <span class="n">plugin_of_user</span><span class="p">.</span><span class="n">plugin_id</span><span class="o">=</span><span class="n">plugin_info</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span> <span class="n">plugin_of_user</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="update">update</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="p">[</span><span class="n">LOW_PRIORITY</span><span class="p">]</span> <span class="p">[</span><span class="k">IGNORE</span><span class="p">]</span> <span class="k">table_name</span> 
<span class="k">SET</span> 
    <span class="n">column_name1</span> <span class="o">=</span> <span class="n">expr1</span><span class="p">,</span>
    <span class="n">column_name2</span> <span class="o">=</span> <span class="n">expr2</span><span class="p">,</span>
    <span class="p">...</span>
<span class="k">WHERE</span>
    <span class="n">condition</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="无则添加有则修改">无则添加，有则修改</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">insert</span> <span class="k">into</span> <span class="n">student</span>
  <span class="p">(</span><span class="nb">number</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> 
<span class="k">values</span>
  <span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="err">‘张三’</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">DUPLICATE</span> <span class="k">KEY</span> <span class="k">UPDATE</span> 
<span class="nb">number</span> <span class="o">=</span> <span class="mi">46</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="err">‘李四’</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="delete">delete</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Mysql表结构</title>
                <link>https://wss.cool/mysql%E8%A1%A8%E7%BB%93%E6%9E%84.html</link>
                <guid isPermaLink="true">https://wss.cool/mysql%E8%A1%A8%E7%BB%93%E6%9E%84.html</guid>
                <pubDate>Mon, 25 May 2020 17:46:51 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h3 id="修改表结构">修改表结构</h3>
<ol>
<li>查看列：<code>desc 表名;</code></li>
<li>修改表名：<code>alter table t_book rename to bbb;</code></li>
<li>添加列：<code>alter table 表名 add column 列名 varchar(30);</code></li>
<li>删除列：<code>alter table 表名 drop column 列名;</code></li>
<li>修改列名MySQL： <code>alter table bbb change nnnnn hh int;</code></li>
<li>修改列名SQLServer：<code>exec sp_rename't_student.name','nn','column';</code></li>
<li>修改列名Oracle：<code>lter table bbb rename column nnnnn to hh int;</code></li>
<li>修改列属性：<code>alter table t_book modify name varchar(22);</code></li>
</ol>
<h3 id="唯一性约束">唯一性约束</h3>
<h4 id="建表时加上唯一性约束">建表时加上唯一性约束：</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">t_user</span><span class="o">`</span> <span class="p">(</span>
    <span class="o">`</span><span class="n">Id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span> 
    <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">unique</span><span class="p">,</span> 
    <span class="o">`</span><span class="n">password</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> 
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">Id</span><span class="o">`</span><span class="p">)</span> 
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1018</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">gbk</span><span class="p">;</span> 
</code></pre></td></tr></table>
</div>
</div><h4 id="给已经建好的表加上唯一性约束">给已经建好的表加上唯一性约束：</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">t_user</span><span class="o">`</span> <span class="k">ADD</span> <span class="k">unique</span><span class="p">(</span><span class="o">`</span><span class="n">username</span><span class="o">`</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>或者：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">unique</span> <span class="k">index</span> <span class="n">UserNameIndex</span> <span class="k">on</span> <span class="s1">&#39;t_user&#39;</span> <span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="索引">索引</h3>
<h4 id="mysql索引类型">mysql索引类型</h4>
<ul>
<li>primary：唯一索引，不允许为null。</li>
<li>key：普通非唯一索引。</li>
<li>unique：表示唯一的，不允许重复的索引，可以为null。</li>
<li>fulltext: 表示全文搜索的索引。 FULLTEXT用于搜索很长一篇文章的时候，效果最好。用在比较短的文本，如果就一两行字的，普通的INDEX 也可以。</li>
<li>spatial：空间索引。</li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Mysql数据类型</title>
                <link>https://wss.cool/mysql%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html</link>
                <guid isPermaLink="true">https://wss.cool/mysql%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html</guid>
                <pubDate>Mon, 25 May 2020 17:46:03 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h3 id="varchar">varchar</h3>
<p><code>varchar(666)</code>，其中参数<code>666</code>为字节数。</p>
<p><code>varchar</code>是可变长度的字符串，大小为<code>0-65535</code>字节。对应的字符串长度会受到字符集影响，若使用<code>utf-8</code>存储汉字，一个汉字字符对应<code>3</code>个字节。</p>
<p><code>varchar</code>还需要存储数据长度，当小于等于<code>255</code>个字节时，使用<code>1</code>个字节存储长度。大于<code>255</code>长度时，使用<code>2</code>个字节存储长度。</p>
<p>比如<code>varchar(666)</code>，使用<code>2</code>个字节存储长度，剩下的<code>664</code>个字节存储实际内容，</p>
<h3 id="text">text</h3>
<p>TEXT数据不存储在数据库服务器的内存中，因此，每当查询TEXT数据时，MySQL都必须从磁盘读取它，这与CHAR和VARCHAR相比要慢得多。
![mysql文档][image1]</p>
<blockquote>
<p>mysql的性能只有在上千万条纪律的时候才需要考虑。
——潘老师</p>
</blockquote>
<h3 id="datetime">DATETIME</h3>
<p>将js的Date对象传进去，会直接保存，查出来返回到前端页面时，可以这样使用<code>new Date(props.time)</code>转换成Date对象。</p>
<h3 id="没有布尔值使用tinyint">没有布尔值，使用tinyint</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">ed_class_price_user</span><span class="o">`</span><span class="p">(</span>
   <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">INT</span> <span class="n">UNSIGNED</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="o">`</span><span class="n">user_name</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">unique</span><span class="p">,</span>
   <span class="o">`</span><span class="n">password</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">disable</span><span class="o">`</span> <span class="n">TINYINT</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="p">)</span>
<span class="p">)</span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Git记住密码</title>
                <link>https://wss.cool/git%E8%AE%B0%E4%BD%8F%E5%AF%86%E7%A0%81.html</link>
                <guid isPermaLink="true">https://wss.cool/git%E8%AE%B0%E4%BD%8F%E5%AF%86%E7%A0%81.html</guid>
                <pubDate>Mon, 25 May 2020 17:34:13 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>一、配置本地仓库</p>
<pre><code>git config user.name &quot;your_name&quot;
git config user.email XXXX@gmail.com
</code></pre><p>二、记住密码</p>
<pre><code>// 当前仓库
git config  credential.helper store
// 全局仓库
git config --global credential.helper store
</code></pre><p>push 代码 这一步输入的用户名密码会被记住,
下次再push代码时就不用输入用户名密码, 这一步会在用户目录下生成文件.git-credential记录用户名密码的信息。</p>
<blockquote>
<p>创建 <code>.git-credential</code> 文件 并写入用户信息：用户名和密码</p>
</blockquote>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/git/">git</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Git设置代理</title>
                <link>https://wss.cool/git%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86.html</link>
                <guid isPermaLink="true">https://wss.cool/git%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86.html</guid>
                <pubDate>Mon, 25 May 2020 17:32:50 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>全局设置</p>
<pre><code>git config --global http.proxy 'socks5://127.0.0.1:1080'
git config --global https.proxy 'socks5://127.0.0.1:1080'
</code></pre><p>全局取消</p>
<pre><code>git config --global --unset http.proxy
git config --global --unset https.proxy
</code></pre><p>只对github.com</p>
<pre><code>git config --global http.https://github.com.proxy socks5://127.0.0.1:1080
</code></pre><p>取消代理</p>
<pre><code>git config --global --unset http.https://github.com.proxy
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/git/">git</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Git分支操作</title>
                <link>https://wss.cool/git%E5%88%86%E6%94%AF%E6%93%8D%E4%BD%9C.html</link>
                <guid isPermaLink="true">https://wss.cool/git%E5%88%86%E6%94%AF%E6%93%8D%E4%BD%9C.html</guid>
                <pubDate>Mon, 25 May 2020 17:30:46 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="分支操作">分支操作</h2>
<h3 id="删除本地的所有分支除了master">删除本地的所有分支，除了master</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git branch <span class="p">|</span> grep -v <span class="s2">&#34;master&#34;</span> <span class="p">|</span> xargs git branch -d
</code></pre></td></tr></table>
</div>
</div><h3 id="刷新本地的远程分支列表">刷新本地的远程分支列表</h3>
<p>远程已经被删除的分支，在本地使用<code>git branch -a</code>命令是依然可以看到。所以需要刷新一下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git remote prune origin
</code></pre></td></tr></table>
</div>
</div><p>这条命令是删除与<name>关联的陈旧引用</p>
<p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git fetch -p
</code></pre></td></tr></table>
</div>
</div><p>这条命令是在获取之前，删除远程不再存在的任何远程跟踪引用。</p>
<h3 id="切换分支branch">切换分支(branch)</h3>
<p>分支分为本地和远程两种，使用 <code>git branch</code> 查看分支，发现只有 <code>master</code> 也就是本地分支。<br>
查看远程分支可以使用 <code>git branch -a</code> 可以看到所有分支，包括远端的分支，使用远程分支名字 <code>remotes/origin/15-stable</code> 进行切换。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 远程分支列表</span>
git branch -r
<span class="c1"># 所有分支列表（包括远程）</span>
git branch -a 
<span class="c1"># 分支列表</span>
git branch
<span class="c1"># 创建并切换到dev分支,</span>
git checkout -b dev
<span class="c1"># 上面的命令，等于下面的两条命令</span>
<span class="c1"># 创建分支</span>
git branch dev 
<span class="c1"># 切换分支</span>
git checkout dev
</code></pre></td></tr></table>
</div>
</div><h3 id="删除远程分支">删除远程分支</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git push origin -d <span class="o">[</span>远程分支名<span class="o">]</span>
git push origin :<span class="o">[</span>远程分支名<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>git push origin :experimental<br>
Find a ref that matches experimental in the origin repository (e.g.  refs/heads/experimental), and delete it.</p>
</blockquote>
<h3 id="获取当前分支名">获取当前分支名</h3>
<pre><code>git symbolic-ref --short -q HEAD 
</code></pre><h3 id="获取当前分支从哪个分支签出">获取当前分支从哪个分支签出</h3>
<blockquote>
<p>基于哪个分支拉的分支</p>
</blockquote>
<p>下面的两个命令都可以获取到“父分支”，来自——<a href="https://stackoverflow.com/questions/3161204/how-to-find-the-nearest-parent-of-a-git-branch">How to find the nearest parent of a Git branch?</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git show-branch <span class="se">\
</span><span class="se"></span><span class="p">|</span> sed <span class="s2">&#34;s/].*//&#34;</span> <span class="se">\
</span><span class="se"></span><span class="p">|</span> grep <span class="s2">&#34;\*&#34;</span> <span class="se">\
</span><span class="se"></span><span class="p">|</span> grep -v <span class="s2">&#34;</span><span class="k">$(</span>git rev-parse --abbrev-ref HEAD<span class="k">)</span><span class="s2">&#34;</span> <span class="se">\
</span><span class="se"></span><span class="p">|</span> head -n1 <span class="se">\
</span><span class="se"></span><span class="p">|</span> sed <span class="s2">&#34;s/^.*\[//&#34;</span> 
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git show-branch <span class="p">|</span> grep <span class="s1">&#39;*&#39;</span> <span class="p">|</span> grep -v <span class="s2">&#34;</span><span class="k">$(</span>git rev-parse --abbrev-ref HEAD<span class="k">)</span><span class="s2">&#34;</span> <span class="p">|</span> head -n1 <span class="p">|</span> sed <span class="s1">&#39;s/.*\[\(.*\)\].*/\1/&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/[\^~].*//&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="推送当前分支到远端">推送当前分支到远端</h3>
<p>如果你还没有推到原点，那么<code>git push -u origin HEAD</code>可以在本地分支中设置上游跟踪信息。</p>
<h3 id="推送当前分支到远端会在远端新建当前分支名的新分支">推送当前分支到远端，会在远端新建当前分支名的新分支</h3>
<pre><code>git push -u origin HEAD  
</code></pre><h3 id="分支合并">分支合并</h3>
<p>建议合并时保留目标分支的commit信息。即使用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git merge --no-ff <span class="o">[</span>branch name<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>当合并错了以后怎么撤销合并呢，使用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git reset --hard <span class="o">[</span>merge的版本号<span class="o">]</span> <span class="c1">#版本号使用 git log 查，这种方法只针对合并以后对当前分支没有过其他操作，有的话比较复杂</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>合并远程分支：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 如果本地没有远程分支：</span>
git checkout -b develop origin/develop <span class="c1"># 本地新建develop分支并拉取</span>
<span class="c1"># 如果本地已有远程分支：</span>
git checkout develop 
git pull origin develop <span class="c1">#拉取远程代码</span>

<span class="c1"># 方法二：</span>
git fetch origin dev:temp <span class="c1">#拉取远程dev分支，创建本地temp分支</span>
git diff temp
git merge temp <span class="c1"># 合并</span>
git branch -d temp <span class="c1">#删除</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/git/">git</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Cors</title>
                <link>https://wss.cool/cors.html</link>
                <guid isPermaLink="true">https://wss.cool/cors.html</guid>
                <pubDate>Thu, 07 May 2020 12:38:38 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>使用 fetch 进行请求时，可在参数中加 <code>mode : 'no-cors'</code>，使浏览器不发送 option 请求，直接发起网络请求。但是请求的 header 只能是 CORS-safelisted 列表中的。其他 header 浏览器不会发送。比如 <code>Authorization</code>
<code>no-cors</code> 对 header 有影响，</p>
<p><a href="https://fetch.spec.whatwg.org/#cors-safelisted-response-header-name">https://fetch.spec.whatwg.org/#cors-safelisted-response-header-name</a>
<a href="https://stackoverflow.com/questions/44606244/using-fetch-api-with-mode-no-cors-can-t-set-request-headers">https://stackoverflow.com/questions/44606244/using-fetch-api-with-mode-no-cors-can-t-set-request-headers</a></p>
<p><a href="https://fetch.spec.whatwg.org/#http-access-control-allow-headers">https://fetch.spec.whatwg.org/#http-access-control-allow-headers</a>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Expose-Headers">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Expose-Headers</a>
<a href="https://stackoverflow.com/questions/43871637/no-access-control-allow-origin-header-is-present-on-the-requested-resource-whe">https://stackoverflow.com/questions/43871637/no-access-control-allow-origin-header-is-present-on-the-requested-resource-whe</a>
<a href="https://fetch.spec.whatwg.org/#headers-class">https://fetch.spec.whatwg.org/#headers-class</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Simple_requests">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Simple_requests</a>
<a href="https://fetch.spec.whatwg.org/#cors-protocol">https://fetch.spec.whatwg.org/#cors-protocol</a>
<a href="https://www.ruanyifeng.com/blog/2016/04/cors.html">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%88%86%E7%B1%BB/">分类</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E6%98%BE%E7%A4%BA%E5%9C%A8%E5%BA%95%E9%83%A8/">显示在底部</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>如何准备面试</title>
                <link>https://wss.cool/%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87%E9%9D%A2%E8%AF%95.html</link>
                <guid isPermaLink="true">https://wss.cool/%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87%E9%9D%A2%E8%AF%95.html</guid>
                <pubDate>Mon, 04 May 2020 00:29:30 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>我现在想换个工作，所以要准备面试，但是如何准备还没有完全想好。这里记录一下我想到的面试可能包含的内容。</p>
<p>面试应该分几个部分。首先是「基础知识点」的考察，这一步是必须的，来验验这个人是能否完成基本的编码工作，这步表现的可以的话应该能拿最低薪水。然后会「聊项目」，这步需要了解在项目中承担了哪些工作，在团队协作中扮演什么角色<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>，如果发现你的能力比较工资会多一些。最后是些人事相关的「非技术问题」，比如期望薪资、福利待遇、为什么离职等等。这几部分又该如何准备呢？</p>
<h2 id="基础知识">基础知识</h2>
<p>基础知识可以分为几个部分：语言、框架/库、算法。这些网上都有很多资料，需要筛选出高质量的内容。</p>
<p>我打算现在 Github 上找到那个<a href="https://github.com/h5bp/Front-end-Developer-Interview-Questions">最著名的前端面试题库</a>，写一个博客记录我的回答。基础搞定以后要复习 React/Vue 原理，主要是「虚拟DOM」「Diff算法」「异步渲染」「Hook原理」，还有一些常用的 API 。另外有些浏览器相关的，比如重绘、缓存、CORS等。准备算法我要继续看《算法》这本书，掌握几个常用常考的算法。</p>
<p>这个过程中遇到的所有知识，把不会的记录到博客中，会的也要重新整理博客。这些博客像「错题本」一样用来巩固知识。</p>
<h2 id="聊项目">聊项目</h2>
<p>这里需要仔细回想你在团队协作中扮演的角色。只是现实功能的话，就要对相关的技术熟一些。如果做了些代码设计工作，可能需要聊一下思路，遇到的问题等等。如果除了完成功能开发外还有其他贡献。比如发现A问题，你开发了B工具解决它，提高了工作效率/代码质量。发现了C问题，重新设计了D代码，将C问题重构/优化。或者为团队/公司解决了什么难题、帮助同事解决了什么问题。</p>
<p>这些工作都能体现你能力的高低，要「仔细」地想出来，并组织语言准备讲给面试官听。</p>
<p>拿我来说。我开发过工具提高工作效率，规范 Git 的使用方式。为项目补充文档，优化旧代码降低复杂度，设计组件优化代码，设计新的架构替换旧架构降低复杂度。帮助同事设计组件。为团队解决若干技术难题。制定并代码规范提高代码可读性，降低复杂度。</p>
<h2 id="非技术问题">非技术问题</h2>
<p>最重要的是薪资，如果前面聊的顺利，这里可以多说一点，因为公司一般都会还价。其他福利也很重要，有没有年终奖/项目奖金，会写在合同里吗，公积金交多少。</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>角色大概可以分为「初中高级」。承担的工作如果都是「实现xx功能」之类的，大概是初级的水平；如果功能、模块、组件这些能自己设计，大概能算中级水平；再高级点的工作，指导别人工作，搞一些工具、组件、方法提高工作效率，解决难题，这就算是高级了。<br>
<a href="https://twitter.com/haoel/status/1253910100668022784?s=20">https://twitter.com/haoel/status/1253910100668022784?s=20</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>初级：在给出指导和具体实施细节后，能独立按时按量（数量和质量）完成工作。<br>
中级：不用指导和具体实施细节，能独立的按时按量（数量和质量）完成工作。<br>
高级：解难题（能解决业务或技术难题），传帮带（能指导培养初中级人员），标准化（能沉淀出可复制或可复用的方法论或工作方式，提高生产效率） <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E8%A1%8C%E4%B8%9A%E6%88%90%E9%95%BF/">行业成长</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>做正确的事</title>
                <link>https://wss.cool/%E5%81%9A%E6%AD%A3%E7%A1%AE%E7%9A%84%E4%BA%8B.html</link>
                <guid isPermaLink="true">https://wss.cool/%E5%81%9A%E6%AD%A3%E7%A1%AE%E7%9A%84%E4%BA%8B.html</guid>
                <pubDate>Mon, 27 Apr 2020 08:41:25 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>作为程序员，在工作和业余时间都会有很多新的技术和不知道的知识点。在它们中找到有价值的、值得投入时间的事很重要。它们是能让自己在行业内成长的事，这里就简称为「正确的事」，这会影响到自己的成长速度。影响到自己在未来一年、三年、五年的能力和价值。</p>
<p>想要筛选出「正确的事」就要有一个判断标准，这个标准就是自己的目标。比如我想多赚钱，这就意味着去更好的公司，或者更高的职位。这些都要依托于好的技术和能力，那么我的目标就是拥有好的技术和能力，而我作为一个前端且喜欢 React ，市场上也有很多这样的工作机会，我只需要专注与 React 和其他通用技能的锻炼，其他技术对我来说就不重要。所以对于我来说，「正确的事」就是能为我提高「前端基础」「React技术栈」「软件行业通用技能」的事。</p>
<p>有了目标和判断标准和自己正在做的事的了解以后，就可以对要做的事进行判断了。在工作中选哪些「正确的事」，业余时间也投入到「正确的事」，其他事尽量不做，如果工作中非做不可，可以考虑换个公司。因为把有限的时间投入到「不正确的事」会影响自己的成长速度。</p>
<hr>
<p>再具体一点我认为能让自己在行业内成长的事有哪些。</p>
<ul>
<li>React原理、Redux原理，常用的JavaScript、CSS。这些属于专业基础知识。</li>
<li>前端组件化的设计，代码的组织和管理复杂度、代码规范、git的使用和规范。这些是为了让代码长期可维护，易于扩展和管理，少出bug，不给公司拖后腿。</li>
<li>nginx、linux的简单使用，可以简单的发布项目。</li>
<li>还有前后端通用的重要基础知识：代码大全（构建代码的技术）、算法，tcp/ip、fetch规范、oauth2规范之类。</li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E8%A1%8C%E4%B8%9A%E6%88%90%E9%95%BF/">行业成长</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>AccessToken认证</title>
                <link>https://wss.cool/access-token-for-get.html</link>
                <guid isPermaLink="true">https://wss.cool/access-token-for-get.html</guid>
                <pubDate>Wed, 22 Apr 2020 23:11:20 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="用途">用途</h2>
<p>当我们操作远程 Git 仓库时，需要进行身份认证，一般有三种方式：</p>
<dl>
<dt>1.账号密码</dt>
<dd>每次输入账号密码，或由工具记住并帮忙自动填写</dd>
<dt>2.<code>ssh</code></dt>
<dd>将本机的一个公钥设置到 <code>gitlab</code> 账户内</dd>
<dt>3.<code>access token</code></dt>
<dd>在链接中加入 <code>token</code></dd>
</dl>
<p>认证后进行 pull 或 push 等操作。下面说一下怎么在 gitlab 中使用 <code>access token</code> 进行认证。</p>
<h2 id="使用方法">使用方法📝</h2>
<ol>
<li>点击「头像」，找到 「Setting」，再找到 ..AccessTokens..</li>
<li>填写 &quot;name&quot; ，选择 <code>read_repository</code> <code>write_repository</code></li>
<li>点按钮「Create」 ，在页面上方 <em>Your New Personal Access Token</em> 处生成了一个一次性的字符串，将它复制保存起来，刷新页面后它就消失，如果搞丢了只能再生成。</li>
<li>这是一个使用 <code>access token</code> 的一般形势的链接：<code>http://oauth2:access-token@host.com/user/repo.git</code> ，将其中的 <code>access-token</code> 换成刚刚生成的那个。</li>
<li>使用这个上面的链接去 <code>clone</code> 项目：<code>git clone http://oauth2:access-token@host.com/user/repo.git</code> 或者替换原来的 <code>remote url</code> ：
<pre><code>git remote origin set-url http://oauth2:access-token@host.com/user/repo.git
</code></pre></li>
<li>完成后 <code>push</code> <code>pull</code> <code>fetch</code> 操作都会使用这个链接</li>
</ol>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/git/">git</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>可编辑元素</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/dom/%E5%8F%AF%E7%BC%96%E8%BE%91%E5%85%83%E7%B4%A0/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/dom/%E5%8F%AF%E7%BC%96%E8%BE%91%E5%85%83%E7%B4%A0/</guid>
                <pubDate>Wed, 22 Apr 2020 22:48:25 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="可编辑元素">可编辑元素</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- vue --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content&#34;</span> <span class="na">v-text</span><span class="o">=</span><span class="s">&#34;item.title&#34;</span> <span class="err">@</span><span class="na">keydown</span><span class="o">=</span><span class="s">&#34;onEnter&#34;</span>  <span class="err">@</span><span class="na">dblclick</span><span class="o">=</span><span class="s">&#34;turnOnEditable&#34;</span> <span class="err">@</span><span class="na">blur</span><span class="o">=</span><span class="s">&#34;(e)=&gt;{titleBlur(e, index)}&#34;</span><span class="p">&gt;</span>
  {{item.title}}
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// js
</span><span class="c1"></span><span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
    <span class="c1">// 修改标题，回车时失去焦点
</span><span class="c1"></span>    <span class="nx">onEnter</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span><span class="o">===</span><span class="mi">13</span><span class="p">){</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">blur</span><span class="p">();</span>
        <span class="p">}</span> 
    <span class="p">},</span>
    <span class="c1">// 失去焦点时，保存内容，并将元素修改为不可编辑
</span><span class="c1"></span>    <span class="nx">titleBlur</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">index</span><span class="p">){</span>
        <span class="kr">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">innerText</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onTitleChange</span><span class="p">({</span><span class="nx">title</span><span class="o">:</span><span class="nx">title</span><span class="p">,</span><span class="nx">index</span><span class="o">:</span><span class="nx">index</span><span class="p">});</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;contenteditable&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="c1">// 双击元素时，将其变为可编辑状态，并获取焦点。
</span><span class="c1"></span>    <span class="nx">turnOnEditable</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;contenteditable&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">range</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">();</span><span class="c1">//创建range
</span><span class="c1"></span>        <span class="nx">range</span><span class="p">.</span><span class="nx">selectAllChildren</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span><span class="c1">//range 选择obj下所有子内容
</span><span class="c1"></span>        <span class="nx">range</span><span class="p">.</span><span class="nx">collapseToEnd</span><span class="p">();</span> <span class="c1">// 光标放到最后
</span><span class="c1"></span>    <span class="p">},</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>html部分是基于vue的，不过也很容易用其他方式实现。这里实现的是双击元素后，将其变为可编辑模式，就是设置contenteditable属性，这个属性直接写在标签中也是可以的。
失去焦点时，将contenteditable属性置为false。
回车时，失去焦点，会触发blur事件。其中还有个操作光标的事件，因为可能出现focus后，光标在开始位置的问题。</p>
<p>MDN介绍<a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/HTML/Content_Editable">Content_Editable</a></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/dom/">DOM</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>常用DOM操作</title>
                <link>https://wss.cool/%E5%B8%B8%E7%94%A8dom%E6%93%8D%E4%BD%9C.html</link>
                <guid isPermaLink="true">https://wss.cool/%E5%B8%B8%E7%94%A8dom%E6%93%8D%E4%BD%9C.html</guid>
                <pubDate>Wed, 22 Apr 2020 19:20:48 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="上传图片时怎么拿到图片的src地址">上传图片时，怎么拿到图片的src地址？</h2>
<p>input选中图片以后，只是得到了file对象，如果想在img中显示该图片的话，并不知道src，所以想得到src还需要额外的操作。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">getObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">createObjectURL</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// basic
</span><span class="c1"></span>    <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">URL</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// mozilla(firefox)
</span><span class="c1"></span>    <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">webkitURL</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// webkit or chrome
</span><span class="c1"></span>    <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitURL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="js操作样式class">JS操作样式class</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;c&#34;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&#34;c&#34;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s2">&#34;c&#34;</span><span class="p">);</span>    <span class="c1">// false 因为&#34;c&#34;上面remove掉了
</span><span class="c1"></span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">className</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="原生获取真是宽高">原生获取真是宽高</h2>
<p>不知道为什么用#${divID}会报错，只能用div[]选择器了，id=后面要用单引号。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">textElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="sb">`div[id=&#39;</span><span class="si">${</span><span class="nx">divID</span><span class="si">}</span><span class="sb">&#39;] .ckeditor`</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">textElement</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">textElement</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="promise-asyncawait-获取图片原始尺寸">promise async/await 获取图片原始尺寸</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="nx">async</span> <span class="nx">funciton</span> <span class="nx">getImageInfo</span><span class="p">(</span><span class="nx">image_res_url</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="p">{</span><span class="nx">width</span>: <span class="kt">number</span><span class="p">,</span> <span class="nx">height</span>: <span class="kt">number</span><span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">image</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
    <span class="nx">image</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">image_res_url</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="p">{</span><span class="nx">width</span>: <span class="kt">number</span><span class="p">,</span> <span class="nx">height</span>: <span class="kt">number</span><span class="p">}</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">image</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">resolve</span><span class="p">({</span><span class="nx">width</span>: <span class="kt">image.naturalWidth</span><span class="p">,</span> <span class="nx">height</span>: <span class="kt">image.naturalHeight</span><span class="p">});</span>
        <span class="p">};</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">promise</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="js复制到剪切板chrome-66-支持">JS复制到剪切板(chrome 66+ 支持)</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">navigator</span><span class="p">.</span><span class="nx">clipboard</span><span class="p">.</span><span class="nx">writeText</span><span class="p">(</span><span class="s1">&#39;888&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Async: Copying to clipboard was successful!&#39;</span><span class="p">);</span>
    <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Async: Could not copy text: &#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">});</span>  
</code></pre></td></tr></table>
</div>
</div><h2 id="处理粘贴事件paste">处理粘贴事件(paste)</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">xxxElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;paste&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clipboardData</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">getData</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">text</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s2">&#34;text/plain&#34;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">getData</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">text</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s2">&#34;Text&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">execCommand</span><span class="p">(</span><span class="s2">&#34;insertHTML&#34;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
<span class="p">});</span>  

</code></pre></td></tr></table>
</div>
</div><h2 id="获取dataset">获取dataset</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">+</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="mouseevent">mouseEvent</h2>
<p>click事件实际上也是一个mouseEvent事件。mouseEvent中有一个属性<code>path</code>，它可以看到触发事件的路径，从触发了事件的元素开始，以及他的所有父元素，一直到document然后是window。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/dom/">DOM</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>熵与代码</title>
                <link>https://wss.cool/posts/%E5%BF%83%E5%BE%97/%E7%86%B5%E4%B8%8E%E4%BB%A3%E7%A0%81/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%BF%83%E5%BE%97/%E7%86%B5%E4%B8%8E%E4%BB%A3%E7%A0%81/</guid>
                <pubDate>Wed, 22 Apr 2020 10:29:53 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>看了阮一峰的博客<a href="http://www.ruanyifeng.com/blog/2017/04/entropy.html">《熵：宇宙的终极规则》</a>，略做记录📝。</p>
<h2 id="熵是什么">熵是什么？</h2>
<p>科学家们发现，能量转换总是伴随这损耗，且无法避免。损耗掉的这部分能量就叫做熵。后来总结成来热力学第二定律：能量转换总是产生熵。</p>
<blockquote>
<p>比如电能转化机械能不能完全转化，比如设计的代码转化为实际的代码总会产生bug。</p>
</blockquote>
<p>这里说的损耗是说能量转换成来预期外的状态，而不是凭空消失来。转化越多，新的状态就越多，状态多就是可能性多，表示混乱。换一种说法：能量转换就会让系统的混乱度增加，熵就是系统的混乱度。</p>
<p>可以总结出一个道理。如果不施加外力影响，事物永远向着更混乱的状态发展。</p>
<h2 id="熵与代码">熵与代码</h2>
<p>如果把熵引入到软件开发中。从需求转换为程序设计，再从程序设计转换成代码，这都想到与能量转换，就会产生熵，这里的熵就是bug，或者复杂度，或者阅读难度。</p>
<p>软件行业中已经有了一些手段来治理这些熵。写代码要有规范，要有review执行规范。要有测试流程，发现并治理bug。如果放松来对熵的警惕，熵会在系统中越来越多，系统越来越混乱，最后会破坏系统。也就是代码越来越混乱，变得难以维护和扩展，最后系统无法使用。</p>
<p>所以，由于热力学第二定律，写代码有bug是一件很正常的事。为了治理熵来让系统长治久安，采取“规范、review和测试”等治理熵的外力也是很必要的。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>获取滚动高度</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/javascript/%E8%8E%B7%E5%8F%96%E6%BB%9A%E5%8A%A8%E9%AB%98%E5%BA%A6/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/javascript/%E8%8E%B7%E5%8F%96%E6%BB%9A%E5%8A%A8%E9%AB%98%E5%BA%A6/</guid>
                <pubDate>Sat, 18 Apr 2020 01:45:53 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="获取滚动高度">获取滚动高度</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">getPageScrollY</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">yScroll</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">pageYOffset</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">yScroll</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">pageYOffset</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Explorer 6 Strict
</span><span class="c1"></span>        <span class="nx">yScroll</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span> <span class="p">{</span><span class="c1">// all other Explorers
</span><span class="c1"></span>        <span class="nx">yScroll</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">yScroll</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>也可以window.scrollY</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/javascript/">JavaScript</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Git报错</title>
                <link>https://wss.cool/posts/%E5%B7%A5%E5%85%B7/git/git%E6%8A%A5%E9%94%99/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%B7%A5%E5%85%B7/git/git%E6%8A%A5%E9%94%99/</guid>
                <pubDate>Sat, 18 Apr 2020 01:43:23 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="perission-denied">Perission denied</h2>
<p>在切换分支时，不能切换，报了这个错。</p>
<p>可能是因为 vuecli 的进程在控制着某个文件。将 vuecli 的命令行关了就可以解决问题了。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/git/">git</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Npm与yarn</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/npm%E4%B8%8Eyarn/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/npm%E4%B8%8Eyarn/</guid>
                <pubDate>Sat, 18 Apr 2020 01:31:26 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="yarn">yarn</h2>
<h3 id="淘宝的镜像">淘宝的镜像</h3>
<pre><code>yarn config set registry https://registry.npm.taobao.org --global
yarn config set disturl https://npm.taobao.org/dist --global

// 额外设置一些常用的库
yarn config set electron_mirror https://npm.taobao.org/mirrors/electron/ -g
yarn config set sass_binary_site https://npm.taobao.org/mirrors/node-sass/ -g
yarn config set phantomjs_cdnurl https://npm.taobao.org/mirrors/phantomjs/ -g
yarn config set chromedriver_cdnurl https://cdn.npm.taobao.org/dist/chromedriver -g
yarn config set operadriver_cdnurl https://cdn.npm.taobao.org/dist/operadriver -g
yarn config set fse_binary_host_mirror https://npm.taobao.org/mirrors/fsevents -g
</code></pre><h2 id="npm">npm</h2>
<pre><code>npm config set registry https://registry.npm.taobao.org
npm config set disturl https://npm.taobao.org/dist

npm config set electron_mirror https://npm.taobao.org/mirrors/electron/
npm config set sass_binary_site https://npm.taobao.org/mirrors/node-sass/
npm config set phantomjs_cdnurl https://npm.taobao.org/mirrors/phantomjs/
</code></pre><h3 id="npm设置代理">npm设置代理</h3>
<pre><code>npm config set proxy http://127.0.0.1:1080
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>应该知道的</title>
                <link>https://wss.cool/posts/%E5%BF%83%E5%BE%97/%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%BF%83%E5%BE%97/%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84/</guid>
                <pubDate>Sat, 18 Apr 2020 01:28:32 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<ul>
<li>Bad architecture causes more problems than bad code.</li>
<li>You will spend more time thinking than coding.</li>
<li>The best programmers are always building things.</li>
<li>There’s always a better way.</li>
<li>Code reviews by your peers will make all of you better.</li>
<li>Fewer features for better code is always the right answer in the end.</li>
<li>Don’t reinvent the wheel, library code is there to help.</li>
<li>If it’s not tested, it doesn’t work.</li>
<li>Code that’s hard to understand is hard to maintain.</li>
<li>Code that’s hard to maintain is next to useless.</li>
<li>Always know how your business makes money, that determines who gets paid what.</li>
<li>If you want to feel important as a software developer, work at a tech company.</li>
</ul>
<ol>
<li>你将花费更多的时间思考而不是编码。</li>
<li>不良的体系结构比不良的代码引起更多的问题。</li>
<li>最好的程序员总是在构建东西。</li>
<li>总会有更好的方法。</li>
<li>同行的代码审查将使所有人变得更好。</li>
<li>最终，正确的答案就是更少的功能来获得更好的代码。</li>
<li>如果未测试，它将无法正常工作。</li>
<li>不要重新发明轮子，库代码可以为您提供帮助。</li>
<li>难以理解的代码难以维护。</li>
<li>难以维护的代码几乎是无用的。</li>
<li>始终知道您的企业是如何赚钱的，这决定了谁能得到酬劳。</li>
<li>如果您想以软件开发人员的身份感到重要，请在技术公司工作。</li>
</ol>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E8%A1%8C%E4%B8%9A%E6%88%90%E9%95%BF/">行业成长</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Nginx导致的bug</title>
                <link>https://wss.cool/posts/%E5%90%8E%E7%AB%AF/spring/nginx%E5%AF%BC%E8%87%B4%E7%9A%84bug/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%90%8E%E7%AB%AF/spring/nginx%E5%AF%BC%E8%87%B4%E7%9A%84bug/</guid>
                <pubDate>Sat, 18 Apr 2020 01:24:25 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="什么情况下出现了bug">什么情况下出现了bug？</h2>
<p>后端代码使用 spring boot 实现了一个 github oauth2 认证登录的 client 。将代码附属到服务器以后，请求经过 nginx 反向代理，java程序报错。</p>
<h2 id="表现">表现</h2>
<p>报错</p>
<pre><code>Authentication request failed: org.springframework.security.oauth2.core.OAuth2AuthenticationException: [invalid_redirect_uri_parameter]
</code></pre><h2 id="原因">原因</h2>
<p>是nginx的导致的，可能是 nginx 转发请求的时候不会带着3个自定义header</p>
<h2 id="解决方法">解决方法</h2>
<p>修改 nginx 配置和 spring boot 的 tomcat 配置，处理3个 header 。</p>
<p>nginx配置</p>
<pre><code>proxy_set_header HOST $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
</code></pre><p>application.yml</p>
<pre><code>server:
  tomcat:
    remote-ip-header: &quot;X-Forwarded-For&quot;
    protocol-header: &quot;X-Forwarded-Proto&quot;
    protocol-header-https-value: &quot;https&quot;
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/spring/">spring</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/bug/">bug</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>JavaScript</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/javascript/javascript/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/javascript/javascript/</guid>
                <pubDate>Sat, 04 Apr 2020 02:13:49 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="避免高频率调用">避免高频率调用</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">throttle</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">method</span><span class="p">.</span><span class="nx">tId</span><span class="p">)</span> <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">method</span><span class="p">.</span><span class="nx">tId</span><span class="p">);</span>
  <span class="nx">method</span><span class="p">.</span><span class="nx">tId</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">method</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">200</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="es6新语法--扩展运算符三个点">ES6新语法--扩展运算符（三个点）</h2>
<h3 id="第二个参数以及之后的任意多个参数都会被放到values数组中">第二个参数以及之后的任意多个参数都会被放到values数组中</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">a</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="p">...</span><span class="nx">values</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span><span class="nx">values</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">a</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>

<span class="c1">// [&#34;a&#34;, &#34;b&#34;]
</span><span class="c1">// [1, 2, 3]
</span></code></pre></td></tr></table>
</div>
</div><h3 id="合并数组">合并数组</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// ES5 的合并数组
</span><span class="c1"></span><span class="nx">arr1</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">arr2</span><span class="p">,</span> <span class="nx">arr3</span><span class="p">);</span>

<span class="c1">// ES6 的合并数组
</span><span class="c1"></span><span class="p">[...</span><span class="nx">arr1</span><span class="p">,</span> <span class="p">...</span><span class="nx">arr2</span><span class="p">,</span> <span class="p">...</span><span class="nx">arr3</span><span class="p">]</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="与解构赋值结合">与解构赋值结合</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">111</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">333</span><span class="p">,</span><span class="mi">444</span><span class="p">]</span>

<span class="c1">// ES5
</span><span class="c1"></span><span class="nx">a</span> <span class="o">=</span> <span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">rest</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">//a 111
</span><span class="c1">//b [111,222,333,444]
</span><span class="c1"></span>
<span class="c1">// ES6
</span><span class="c1"></span><span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span><span class="p">]</span> <span class="o">=</span> <span class="nx">list</span>
<span class="c1">//a 111
</span><span class="c1">//b [111,222,333,444]
</span></code></pre></td></tr></table>
</div>
</div><h2 id="js正则">js正则</h2>
<p>制表符tab  \t<br>
换行符  \r<br>
汉字  \S<br>
任意 .<br>
小写字母 [a-z]</p>
<h2 id="数组排序">数组排序</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="nx">numbers</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="数组的every方法">数组的every方法</h2>
<p>every方法可以中断循环</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">contentList</span><span class="p">.</span><span class="nx">every</span><span class="p">((</span><span class="nx">content</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">content</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">contentList</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="事件">事件</h2>
<pre><code>// 取消默认行为：
e.preventDefault()
// 停止冒泡：
e.stopPropagation();  
</code></pre><h2 id="将promise改装成await">将promise改装成await</h2>
<p>将一个element UI库的confirm改装成await：这个confirm方法原来返回的是promise，resolve在try中return，reject在catch中return。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">public</span> <span class="nx">async</span> <span class="nx">confirm_async</span><span class="p">(</span><span class="nx">message</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">title</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">vue</span><span class="p">.</span><span class="nx">$confirm</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">title</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>调用confirm_async方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">const</span> <span class="nx">isConfirm</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">ed_showConfirm_async</span><span class="p">(</span><span class="s1">&#39;xx&#39;</span><span class="p">,</span><span class="s1">&#39;xx&#39;</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nx">isConfirm</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>这两个语句所在方法或函数，必须是一个async的函数或方法。这样就不需要把后续的操作都写在一个then方法中了。</p>
<h2 id="array-reduce数组的reduce方法">Array reduce，数组的reduce方法</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">memo</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">memo</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">memo</span><span class="p">;</span>
  <span class="p">},</span> <span class="p">{});</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="严格模式">严格模式</h2>
<pre><code>&quot;use strict&quot;;
</code></pre><ol>
<li>禁止this关键字指向全局对象</li>
</ol>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/javascript/">JavaScript</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>开平方</title>
                <link>https://wss.cool/square-root-dichotomy-and-newton-iteration.html</link>
                <guid isPermaLink="true">https://wss.cool/square-root-dichotomy-and-newton-iteration.html</guid>
                <pubDate>Fri, 03 Apr 2020 11:36:01 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>计算开平方可以用二分查找来计算。
如：求根号10</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 用二分查找，精度0.0001
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">二分开根号</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">x</span><span class="p">,</span><span class="nx">count</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mid</span> <span class="o">=</span> <span class="nx">start</span> <span class="o">+</span> <span class="p">(</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">sq</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">*</span> <span class="nx">mid</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">sq</span> <span class="o">-</span> <span class="nx">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="nx">e</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">mid</span><span class="p">,</span><span class="nx">count</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sq</span> <span class="o">&lt;</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">start</span> <span class="o">=</span> <span class="nx">mid</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sq</span> <span class="o">&gt;</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">end</span> <span class="o">=</span> <span class="nx">mid</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">mid</span><span class="p">,</span><span class="nx">count</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">二分开根号</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="c1">// 3.1622695922851562  18次循环
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 用牛顿迭代，精度0.0001
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">牛顿开根号</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// n_ = (n+a/n)/2;
</span><span class="c1"></span>  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">n_</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">/</span> <span class="nx">n</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="nx">n_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="nx">e</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">n</span> <span class="o">=</span> <span class="nx">n_</span><span class="p">;</span>
    <span class="nx">n_</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">/</span> <span class="nx">n</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">n_</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">牛顿开根号</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="c1">// 3.162277660168379   6次循环
</span></code></pre></td></tr></table>
</div>
</div><h1 id="牛顿迭代法适用条件">牛顿迭代法适用条件</h1>
<p>求函数f(x)=0的解α。<br>
必须满足如下条件才能用牛顿迭代法求方程的近似解。<br>
函数的导数不为0；x属于区间[α−r, α+r]；x0为α的近似值，即r&gt;=|a-x0|;<br>
函数在[α−r, α+r]内二阶导数连续；<br>
x0足够接近根 α。</p>
<p><a href="https://zh.wikipedia.org/wiki/%E7%89%9B%E9%A1%BF%E6%B3%95">牛顿法的维基百科</a></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E7%AE%97%E6%B3%95/">算法</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>MySQL</title>
                <link>https://wss.cool/mysql.html</link>
                <guid isPermaLink="true">https://wss.cool/mysql.html</guid>
                <pubDate>Thu, 02 Apr 2020 22:24:03 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="安装mysql">安装MySQL</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo apt-get –y install mysql-server mysql-client
sudo apt-get install mysql-server mysql-client
</code></pre></td></tr></table>
</div>
</div><p>服务器环境为腾讯云Ubuntu 16.04.1 LTS，使用上面的命令安装mysql服务端与客户端。安装完成后会出现一个设置密码的界面，输入两次密码即完成了安装，然后使用 <code>netstat -anp</code> 命令，会发现 <code>3306</code> 端口正在被监听，即说明安装成功且已运行。</p>
<h2 id="检查mysql是否启动">检查MySQL是否启动</h2>
<p><code>ps -ef | grep mysqld</code>
会看到类似结果说明正在运行：</p>
<pre><code>mysql      519     1  0 17:44 ?        00:00:00 /usr/sbin/mysqld
</code></pre><h2 id="开关mysql">开关MySQL</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 开启</span>
sudo /etc/init.d/mysql start
<span class="c1"># 关闭命令:</span>
sudo /etc/init.d/mysql stop
<span class="c1"># 重启</span>
sudo /etc/init.d/mysql restart
</code></pre></td></tr></table>
</div>
</div><h2 id="命令行中连接数据库">命令行中连接数据库：</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">-</span><span class="n">p</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="退出数据库">退出数据库：</h2>
<pre><code>exit
</code></pre><h2 id="建库删库">建库/删库</h2>
<p>CREATE DATABASE <code>yys</code> DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
DROP DATABASE <code>yys</code>;</p>
<h2 id="建表">建表</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">yuhun</span><span class="o">`</span><span class="p">(</span>
<span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">INT</span><span class="p">,</span>
<span class="o">`</span><span class="k">position</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span>
<span class="o">`</span><span class="k">type</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span>
<span class="o">`</span><span class="n">v</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="k">COMMENT</span> <span class="s1">&#39;表注释&#39;</span><span class="p">,</span>
<span class="o">`</span><span class="n">bs</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="k">COMMENT</span> <span class="s1">&#39;爆伤&#39;</span><span class="p">,</span>
<span class="o">`</span><span class="n">bj</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="k">COMMENT</span> <span class="s1">&#39;表注释&#39;</span><span class="p">,</span>
 <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="p">)</span>
<span class="p">)</span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="增删改查">增删改查</h2>
<h3 id="where">where</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">WHERE</span> <span class="n">CustomerID</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>Operator</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>=</td>
<td>Equal</td>
</tr>
<tr>
<td>&lt;&gt;</td>
<td>Not equal. Note: In some versions of SQL this operator may be written as !=</td>
</tr>
<tr>
<td>&gt;</td>
<td>Greater than</td>
</tr>
<tr>
<td>&lt;</td>
<td>Less than</td>
</tr>
<tr>
<td>&gt;=</td>
<td>Greater than or equal</td>
</tr>
<tr>
<td>&lt;=</td>
<td>Less than or equal</td>
</tr>
<tr>
<td>BETWEEN</td>
<td>Between an inclusive range</td>
</tr>
<tr>
<td>LIKE</td>
<td>Search for a pattern</td>
</tr>
<tr>
<td>IN</td>
<td>To specify multiple possible values for a column</td>
</tr>
</tbody>
</table>
<h3 id="update">update</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="k">table_name</span>
<span class="k">SET</span> <span class="n">column1</span> <span class="o">=</span> <span class="n">value1</span><span class="p">,</span> <span class="n">column2</span> <span class="o">=</span> <span class="n">value2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="delete">delete</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="insert">insert</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">table_name</span> <span class="p">(</span><span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span><span class="p">,</span> <span class="p">...)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="n">value3</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></td></tr></table>
</div>
</div><p>use demo
select zhuanye from runoob_tbl where id=1;
insert into pe (id,name) values (1,'前');</p>
<h2 id="导入">导入</h2>
<p>先将数据处理成一定格式，比如将excel中的数据复制到文档中，这些数据每一行的字段间是被制表符\t分隔，行与行指间被换行符\r\n分隔。<br>
如果excel中的数据不是很复杂，没有复杂的文本，没有换行之类的字符，就可以直接保存，然后将保存的文件导入数据库。如果文本比较复杂，比如招公务员的岗位的excel的文本中就有很多换行符，这时需要自己处理一下，是整个文本以特定的字符代替\t\r\n来分隔文本，因为导入数据的时候，mysql会考\t\n之类的字符来划分数据。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">load</span> <span class="k">data</span> <span class="k">local</span> <span class="n">infile</span> <span class="s2">&#34;~/yuhun.txt&#34;</span> <span class="k">into</span> <span class="k">table</span> <span class="n">yuhun</span>  <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">UTF8</span> <span class="n">fields</span> <span class="n">terminated</span> <span class="k">by</span> <span class="s2">&#34;\t&#34;</span> <span class="n">lines</span> <span class="n">terminated</span> <span class="k">by</span> <span class="s2">&#34;\n&#34;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>我将真正换行的地方替换成了&amp;符号。<br>
向服务器上传文件
scp /Users/wangshushuo/Desktop/yuhun.txt <a href="mailto:ubuntu@58.87.109.73">ubuntu@58.87.109.73</a>:~/yuhun.txt</p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/load-data.html">导入官方语法如下</a>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">LOAD</span> <span class="k">DATA</span> <span class="p">[</span><span class="n">LOW_PRIORITY</span> <span class="o">|</span> <span class="n">CONCURRENT</span><span class="p">]</span> <span class="p">[</span><span class="k">LOCAL</span><span class="p">]</span> <span class="n">INFILE</span> <span class="s1">&#39;file_name&#39;</span>
    <span class="p">[</span><span class="k">REPLACE</span> <span class="o">|</span> <span class="k">IGNORE</span><span class="p">]</span>
    <span class="k">INTO</span> <span class="k">TABLE</span> <span class="n">tbl_name</span>
    <span class="p">[</span><span class="n">PARTITION</span> <span class="p">(</span><span class="n">partition_name</span> <span class="p">[,</span> <span class="n">partition_name</span><span class="p">]</span> <span class="p">...)]</span>
    <span class="p">[</span><span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">charset_name</span><span class="p">]</span>
    <span class="p">[</span><span class="err">{</span><span class="n">FIELDS</span> <span class="o">|</span> <span class="n">COLUMNS</span><span class="err">}</span>
        <span class="p">[</span><span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;string&#39;</span><span class="p">]</span>
        <span class="p">[[</span><span class="n">OPTIONALLY</span><span class="p">]</span> <span class="n">ENCLOSED</span> <span class="k">BY</span> <span class="s1">&#39;char&#39;</span><span class="p">]</span>
        <span class="p">[</span><span class="n">ESCAPED</span> <span class="k">BY</span> <span class="s1">&#39;char&#39;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="p">[</span><span class="n">LINES</span>
        <span class="p">[</span><span class="n">STARTING</span> <span class="k">BY</span> <span class="s1">&#39;string&#39;</span><span class="p">]</span>
        <span class="p">[</span><span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;string&#39;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="p">[</span><span class="k">IGNORE</span> <span class="nb">number</span> <span class="err">{</span><span class="n">LINES</span> <span class="o">|</span> <span class="k">ROWS</span><span class="err">}</span><span class="p">]</span>
    <span class="p">[(</span><span class="n">col_name_or_user_var</span>
        <span class="p">[,</span> <span class="n">col_name_or_user_var</span><span class="p">]</span> <span class="p">...)]</span>
    <span class="p">[</span><span class="k">SET</span> <span class="n">col_name</span><span class="o">=</span><span class="err">{</span><span class="n">expr</span> <span class="o">|</span> <span class="k">DEFAULT</span><span class="err">}</span><span class="p">,</span>
        <span class="p">[,</span> <span class="n">col_name</span><span class="o">=</span><span class="err">{</span><span class="n">expr</span> <span class="o">|</span> <span class="k">DEFAULT</span><span class="err">}</span><span class="p">]</span> <span class="p">...]</span>
</code></pre></td></tr></table>
</div>
</div><p>一个例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">LOAD</span> <span class="k">DATA</span> <span class="n">INFILE</span> <span class="s1">&#39;file&#39;</span>
<span class="k">IGNORE</span> <span class="k">INTO</span> <span class="k">TABLE</span> <span class="k">table</span>
<span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">UTF8</span>
<span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;;&#39;</span>
<span class="n">OPTIONALLY</span> <span class="n">ENCLOSED</span> <span class="k">BY</span> <span class="s1">&#39;&#34;&#39;</span>
<span class="n">LINES</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;\n&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="远程连接新建一个帐号帐号名不能为root">远程连接新建一个帐号（帐号名不能为root）</h2>
<p>如：添加一个用户名为db_user，密码为db_pass，授权为% （%表示所有外围IP能连接）对db_name数据库所有权限，命令如下</p>
<pre><code>/# mysql -uroot -p
MySQL [(none)]&gt; grant all privileges on db_name.* to db_user@’%’ identified by ‘db_pass’; #授权语句，特别注意有分号
MySQL [(none)]&gt; flush privileges;
MySQL [(none)]&gt; exit; #退出数据库控制台，特别注意有分号
</code></pre><h2 id="表结构">表结构</h2>
<h2 id="表连接">表连接</h2>
<p>使用了连接语句以后，这两张表就被拼成了一张表。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">A</span>  
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">B</span> <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">book_id</span><span class="o">=</span><span class="n">B</span><span class="p">.</span><span class="n">book_id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>四种连接会像下图一样拼装2个表，空白的地方会被填充null</p>
<p><img src="/images/mysql-1.jpg" alt="表连接1"></p>
<p>然后where等语句就可以像操作一张表一样了。</p>
<h2 id="实践">实践</h2>
<p>评论回帖表</p>
<p>轮子哥 vczh
专业造轮子，拉黑抢前排。gaclib.net
75 人赞同了该回答
CommentID: GUID (primary key)
UnderWhichAnswer: GUID (index + foreign key)
ReplyWhichComment: GUID (nullable + foreign key)
Author: GUID (foreign key)
Time: datetime (ascend)
Content: string</p>
<h2 id="性能测试">性能测试</h2>
<p>mysqlslap是mysql自带的测试工具</p>
<p>下面为测试一条sql的效率</p>
<pre><code>mysqlslap --create-schema mind -q &quot;select * from test1&quot; --number-of-queries=100 -uroot -p123456
</code></pre><p>其中<code>--create-schema</code>后为数据库名，<code>-q</code>后为sql语句，<code>--number-of-queries</code>为重复次数。</p>
<h2 id="工具">工具</h2>
<h3 id="phpmyadmin">phpmyadmin</h3>
<p>通过docker使用：拉镜像，然后运行，然后访问本地的<a href="http://localhost:8080">localhost:8080</a></p>
<pre><code>docker pull phpmyadmin/phpmyadmin
docker run --name myphpadmin -d -e PMA_ARBITRARY=1 -p 8080:80 phpmyadmin/phpmyadmin
</code></pre><h4 id="连本地的mysqlubuntu">连本地的mysql(ubuntu)</h4>
<p>将<code>/etc/mysql/mysql.conf.d/mysql.cnf</code>中的<code>bind-address=127.0.0.1</code>改成<code>bind-address=0.0.0.0</code>，使可以远程访问。</p>
<p>然后使用本机ip访问(192.168.<em>.</em>)，登录的主机地址也是前面那个ip</p>
<h2 id="资料">资料</h2>
<p><a href="https://www.yiibai.com/mysql/update-data.html">易百教程MySQL</a>
<a href="https://www.kancloud.cn/thinkphp/mysql-design-optimalize/39325">Mysql设计与优化专题</a></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>重构旧项目-1</title>
                <link>https://wss.cool/%E9%87%8D%E6%9E%84%E6%97%A7%E9%A1%B9%E7%9B%AE-1.html</link>
                <guid isPermaLink="true">https://wss.cool/%E9%87%8D%E6%9E%84%E6%97%A7%E9%A1%B9%E7%9B%AE-1.html</guid>
                <pubDate>Thu, 02 Apr 2020 15:17:52 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="背景">背景</h2>
<p>这个项目有点老旧</p>
<pre><code>&quot;dva&quot;: &quot;2.1.0&quot;,
&quot;react&quot;: &quot;^16.2.0&quot;,
</code></pre><p>我打算用最新的 react 和 @reduxjs/toolkit 开始重构，旧的依赖只能使用 connect 方式来获取 store ，使用 useSelector 和 useDispatch 很方便也很易读。<code>@reduxjs/toolkit</code>提供的immer和actionCreater也很好用。</p>
<p>新版本的 react-redux 才提供了 useSelector 和 useDispatch ，但是新版本会导致 dva 出错。无奈放弃了新版本，还是用旧版本的 connect 。还好这不影响对代码进行组件化。</p>
<p>首先重构的是一个643行的组件，它的render方法有580行。</p>
<h2 id="重复代码">重复代码</h2>
<p>很容易的发现了一大段重复代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">numbers_wrapper</span><span class="p">}&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">member_count</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span><span class="nx">班级总人数</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">male_count</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span><span class="nx">男生人数</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">female_count</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span><span class="nx">女生人数</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">group_count</span> <span class="o">&amp;&amp;</span><span class="p">(</span> <span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">group_count</span><span class="p">[</span><span class="nx">userDetail</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span><span class="nx">分组数</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{(</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">user_lecture_count</span> <span class="o">?</span> <span class="p">(</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">user_lecture_count</span><span class="p">[</span><span class="nx">userDetail</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span><span class="nx">授课次数</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>可以将他们组织成2个组件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">NumberWithLabel</span><span class="p">({</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">count</span> <span class="p">})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;{</span><span class="nx">label</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">numbers_wrapper</span><span class="p">}&gt;</span>
    <span class="p">&lt;</span><span class="nt">NumberWithLabel</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;班级总人数&#34;</span> <span class="na">count</span><span class="o">=</span><span class="p">{</span><span class="nx">member_count</span><span class="p">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">NumberWithLabel</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;男生人数&#34;</span> <span class="na">count</span><span class="o">=</span><span class="p">{</span><span class="nx">male_count</span><span class="p">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">NumberWithLabel</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;女生人数&#34;</span> <span class="na">count</span><span class="o">=</span><span class="p">{</span><span class="nx">female_count</span><span class="p">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">NumberWithLabel</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;分组数&#34;</span> <span class="na">count</span><span class="o">=</span><span class="p">{</span><span class="nx">group_count</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">group_count</span><span class="p">[</span><span class="nx">userId</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">NumberWithLabel</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;授课次数&#34;</span> <span class="na">count</span><span class="o">=</span><span class="p">{(</span><span class="nx">user_lecture_count</span> <span class="o">?</span> <span class="p">(</span><span class="nx">user_lecture_count</span><span class="p">[</span><span class="nx">userId</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)}</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>数据使用 connect 获取，这样代码看起来简单读了。</p>
<h2 id="封装组件">封装组件</h2>
<p>然后发现了一大段代码可以封装成一个独立的组件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">card_body</span><span class="p">}&gt;</span>
<span class="p">{</span>
    <span class="nx">groupList</span> <span class="o">&amp;&amp;</span> <span class="nx">groupList</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">group</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_item</span><span class="p">}</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span> <span class="na">onDrop</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">handleStudentDrop</span><span class="p">(</span><span class="nx">group</span><span class="p">)}</span> <span class="na">onDragOver</span><span class="o">=</span><span class="p">{</span><span class="nx">handleStudentDragOver</span><span class="p">}</span>                                                <span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_item_header</span><span class="p">}&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_item_info</span><span class="p">}&gt;</span>
                    <span class="p">{</span><span class="nx">group</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
                    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">trophy_icon</span><span class="p">}</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_item_btns</span><span class="p">}&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">Radio</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_student_list_radio</span><span class="p">}</span> <span class="na">checked</span><span class="o">=</span><span class="p">{</span><span class="nx">group</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">curGroup</span><span class="p">}</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">selectCurGroup</span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">id</span><span class="p">)}</span> <span class="p">/&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_student_list</span><span class="p">}&gt;</span>
                <span class="p">{</span>
                    <span class="nx">group</span><span class="p">.</span><span class="nx">members</span> <span class="o">&amp;&amp;</span> <span class="nx">group</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="p">(</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="p">{{</span>
                            <span class="nx">textAlign</span><span class="o">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="nx">fontSize</span><span class="o">:</span><span class="mi">14</span><span class="p">,</span>
                            <span class="nx">color</span><span class="o">:</span><span class="s1">&#39;#666&#39;</span><span class="p">,</span>
                        <span class="p">}}&gt;</span><span class="nx">该小组没有学生</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;)</span> <span class="o">:</span> <span class="p">(</span>
                        <span class="nx">group</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">stu</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(&lt;</span><span class="nt">StudentItem</span>
                            <span class="na">isDrage</span>
                            <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span>
                            <span class="na">stu</span><span class="o">=</span><span class="p">{</span><span class="nx">stu</span><span class="p">}</span>
                            <span class="na">group</span><span class="o">=</span><span class="p">{</span><span class="nx">group</span><span class="p">}</span>
                            <span class="na">gender</span><span class="o">=</span><span class="p">{</span><span class="nx">stu</span><span class="p">.</span><span class="nx">gender</span><span class="p">}</span>
                            <span class="na">headimg_res_url</span><span class="o">=</span><span class="p">{</span><span class="nx">stu</span><span class="p">.</span><span class="nx">headimg_res_url</span><span class="p">}</span>
                            <span class="na">name</span><span class="o">=</span><span class="p">{</span><span class="nx">stu</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
                            <span class="na">groupStuStyle</span>
                            <span class="na">onDragStart</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">handleDragStart</span><span class="p">(</span><span class="nx">stu</span><span class="p">,</span> <span class="nx">group</span><span class="p">.</span><span class="nx">id</span><span class="p">)}</span>
                            <span class="na">onSetLeader</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">handleSetLeader</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">stu</span><span class="p">,</span><span class="nx">group</span><span class="p">)}</span>
                            <span class="na">onSetHeader</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">handleSetHeader</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">stu</span><span class="p">)}</span>
                        <span class="p">/&gt;))</span>
                    <span class="p">)</span>
                <span class="p">}</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">))</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>还有它相关的方法都是像下面👇这样的 dispatch ，大概有五六个。它们都写在 render 函数内，占用了很大的篇幅，对阅读代码有很大的影响。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">handleDragStart</span> <span class="o">=</span> <span class="p">(</span><span class="nx">stu</span><span class="p">,</span> <span class="nx">org_id</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;classDetail/updateState&#39;</span><span class="p">,</span>
        <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">onDragStudent</span><span class="o">:</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">stu</span><span class="p">,</span>
                <span class="nx">org_id</span><span class="p">,</span>
                <span class="nx">type</span><span class="o">:!!</span><span class="nx">org_id</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>我将这个 <code>dispatch</code> 中的 <code>action</code> 放到一个 <code>action_creater.js</code> 文件中，将组建放在 <code>GroupItem.jsx</code> 文件中。这可以让次要的信息不占用篇幅，主要的信息就会一目了然了。
这段代码就变成了2个组件和1个 <code>action creater</code> 文件。相关的代码封装在一起，再也不用为了看一个函数而滚动300行代码或者要用搜索才能找到了。</p>
<blockquote>
<p>这3个文件目前都只有40-50行。</p>
</blockquote>
<p>原来643行的文件，现在是490行，优化掉了150行（23%）的代码。使代码有了更好的封装，改善了阅读/维护难度。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%8A%98%E8%85%BE/">折腾</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>vim</title>
                <link>https://wss.cool/vim.html</link>
                <guid isPermaLink="true">https://wss.cool/vim.html</guid>
                <pubDate>Wed, 01 Apr 2020 21:27:14 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="替换">替换</h2>
<div class="shortcodes_withTitle" title="buiiuiuiu">abbnbnbn</div>
<pre><code>:[range]s/search/replace/optioins <span class="shortcodes_number">1</span>

:%s/aa/bb/g <span class="shortcodes_number">2</span>

:%s/aa/bb/gc <span class="shortcodes_number">3</span>

</code></pre><ul>
<li><span class="shortcodes_number">1</span>
 range表示搜索的范围， <code>:8,10 s/</code> 表示第8-10行，<code>:%s/</code> 表示全文。</li>
<li><span class="shortcodes_number">2</span>
 <code>g</code> 是一个option(global)，表示要替换所有匹配项，不加它的话只会替换第一个匹配项。</li>
<li><span class="shortcodes_number">3</span>
 <code>c</code> 是一个option(confirm)，表示替换前需要确认。</li>
</ul>
<h3 id="confirm">confirm</h3>
<p>加了confirm选项后，替换时会出现这样的提示，需要你回复。</p>
<pre><code>replace with foo (y/n/a/q/l/^E/^Y)?
</code></pre><table>
<thead>
<tr>
<th align="center">回复</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">y</td>
<td align="left">yes</td>
</tr>
<tr>
<td align="center">n</td>
<td align="left">no</td>
</tr>
<tr>
<td align="center">a</td>
<td align="left">go ahead，替换所有</td>
</tr>
<tr>
<td align="center">q</td>
<td align="left">quit 取消、退出操作</td>
</tr>
<tr>
<td align="center">l</td>
<td align="left">替换当前这个，然后退出操作</td>
</tr>
<tr>
<td align="center">^E/^Y</td>
<td align="left">scroll the text using Ctrl-e and Ctrl-y</td>
</tr>
</tbody>
</table>
<h2 id="配置">配置</h2>
<pre><code>set nocompatible 
set number
set relativenumber
set cursorline
set wrap
set laststatus=2
set ruler

syntax on
set showmode
set showcmd

set shiftwidth=4
set tabstop=2
set expandtab
set softtabstop=2
</code></pre><p>依次：不兼容vi，显示行号，行号是相对当前行的，光标所在的当前行高亮，换行，显示状态栏，状态栏中显示光标的位置，语法高亮开启，模式，指令，<code>&gt;&gt;&lt;&lt;==</code> 操作的空格数，tab键的空格数，缩紧使用空格，tab等于几个空格</p>
<h2 id="缩紧">缩紧</h2>
<p>在文本上按下&gt;&gt;（增加一级缩进）、&lt;&lt;（取消一级缩进）或者==（取消全部缩进）时，每一级的字符数。</p>
<h2 id="reference">reference</h2>
<ul>
<li>搜索与替换：<a href="https://www.linux.com/training-tutorials/vim-tips-basics-search-and-replace/">https://www.linux.com/training-tutorials/vim-tips-basics-search-and-replace/</a></li>
<li>配置：<a href="http://vim.spf13.com/">http://vim.spf13.com/</a></li>
<li>攻略1：<a href="https://github.com/vim-china/hello-vim">https://github.com/vim-china/hello-vim</a></li>
<li>攻略2：<a href="https://github.com/oldratlee/vim-practice">https://github.com/oldratlee/vim-practice</a></li>
<li>攻略3：<a href="https://github.com/wsdjeg/vim-galore-zh_cn">https://github.com/wsdjeg/vim-galore-zh_cn</a></li>
<li>阮一峰：<a href="https://www.ruanyifeng.com/blog/2018/09/vimrc.html">https://www.ruanyifeng.com/blog/2018/09/vimrc.html</a></li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/">工具</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>ReactRouter的哲学</title>
                <link>https://wss.cool/reactrouter-philosophy.html</link>
                <guid isPermaLink="true">https://wss.cool/reactrouter-philosophy.html</guid>
                <pubDate>Tue, 31 Mar 2020 13:11:28 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="哲学">哲学</h2>
<p>本指南的目的是解释使用React Router时的心智模型。 我们将其称为“动态路由”，这与您可能更熟悉的“静态路由”完全不同。</p>
<h3 id="静态路由">静态路由</h3>
<p>如果您使用过Rails，Express，Ember，Angular等，那么您已经使用了静态路由。 在这些框架中，您可以在进行任何渲染之前将路由声明为应用程序初始化的一部分。 React Router pre-v4也是静态的（大多数情况下）。<br>
请注意在应用侦听之前如何声明路由。 我们使用的客户端路由器是类似的。 在Angular中，您可以预先声明您的路由，然后在渲染之前将它们导入顶级AppModule.<br>
Ember有一个传统的routes.js文件，构建会读取并导入到应用程序中。 同样，这会在您的应用呈现之前发生。<br>
尽管API不同，但它们都共享“静态路由”模型。 React Router也使用“静态路由”直到v4。要成功使用React Router，您需要忘记这一切！：o</p>
<h3 id="背景故事">背景故事</h3>
<p>坦率地说，我们对我们在React Router的v2版本中方向感到非常沮丧。 我们（Michael和Ryan）觉得受到API的限制，认识到我们重新实现了React（生命周期等）的部分，而且它与React给我们创作UI的心理模型不符。我们走过走廊在研讨会讨论如何应对之前的酒店。我们互相问道：“如果我们使用我们在工作室教授的模式构建路由器会是什么样子？”开发只需要几个小时，我们就有了一个概念验证，我们知道它是未来 我们想要路由。 我们最终得到的API并不是React的“外部”，这是一个由React的其余部分组成或自然落实到位的API。 我们认为你会喜欢它。</p>
<h3 id="动态路由">动态路由</h3>
<p>当我们说动态路由时，我们指的是在您的应用呈现时发生的路由，而不是在正在运行的应用之外的配置或约定中。 这意味着几乎所有东西都是React Router中的一个组件。 以下是对API的60秒回顾，了解它的工作原理：首先，为自己定位的环境抓住自己的路由器组件，并将其呈现在应用的顶部。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">BrowserRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router-dom&#39;</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">((</span>
  <span class="o">&lt;</span><span class="nx">BrowserRouter</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">App</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="err">/BrowserRouter&gt;</span>
<span class="p">),</span> <span class="nx">el</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>接下来，抓取链接组件以链接到新位置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">nav</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&#34;/dashboard&#34;</span><span class="o">&gt;</span><span class="nx">Dashboard</span><span class="o">&lt;</span><span class="err">/Link&gt;</span>
    <span class="o">&lt;</span><span class="err">/nav&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>最后，当用户访问/仪表板时渲染Route来显示一些UI。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">nav</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&#34;/dashboard&#34;</span><span class="o">&gt;</span><span class="nx">Dashboard</span><span class="o">&lt;</span><span class="err">/Link&gt;</span>
    <span class="o">&lt;</span><span class="err">/nav&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&#34;/dashboard&#34;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Dashboard</span><span class="p">}</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Route将呈现<code>&lt;Dashboard {... props} /&gt;</code>，其中<code>props</code>是一些特定于路由器的东西，看起来像<code>{match，location，history}</code>。 如果用户不在<code>/dashboard</code>，则Route将呈现为null。 这就是它的全部内容。</p>
<h3 id="嵌套路由">嵌套路由</h3>
<p>很多路由器都有一些“嵌套路由”的概念。如果您在v4之前使用过React Router的版本，那么您也会知道它也是如此！当您从静态路由配置移动到动态渲染路由时，如何“嵌套路由”？那么，你如何潜逃一个div？</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">BrowserRouter</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="cm">/* here&#39;s a div */</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="cm">/* here&#39;s a Route */</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&#34;/tacos&#34;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Tacos</span><span class="p">}</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="o">&lt;</span><span class="err">/BrowserRouter&gt;</span>
<span class="p">)</span>

<span class="c1">// when the url matches `/tacos` this component renders
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">Tacos</span>  <span class="o">=</span> <span class="p">({</span> <span class="nx">match</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="c1">// here&#39;s a nested div
</span><span class="c1"></span>  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="cm">/* here&#39;s a nested Route,
</span><span class="cm">        match.url helps us make a relative path */</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="nx">Route</span>
      <span class="nx">path</span><span class="o">=</span><span class="p">{</span><span class="nx">match</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;/carnitas&#39;</span><span class="p">}</span>
      <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Carnitas</span><span class="p">}</span>
    <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>看看路由器没有“嵌套”API？ 路由只是一个组件，就像div一样。 因此，为了筑巢路线或div，你只需......做它。让我变得更加棘手。</p>
<h3 id="响应路线">响应路线</h3>
<p>考虑用户导航到<code>/invoices</code>。 您的应用适用于不同的屏幕尺寸，它们具有较窄的视口，因此您只需向其显示发票列表和发票仪表板的链接。他们可以从那里更深入地导航。<br>
在大屏幕上，<code>/invoices</code>不是有效的路线，但在小屏幕上它是！ 为了让事情变得更有趣，请考虑一个拥有巨型手机的人。 他们可以纵向查看/发票，然后将手机旋转到横向。 突然间，我们有足够的空间来显示主 - 细节用户界面，所以你应该立即重定向！</p>
<pre><code>
</code></pre><p>当用户将手机从纵向旋转到横向时，此代码会自动将其重定向到仪表板。 该组有效路由根据用户手中的移动设备的动态特性而改变。
这只是一个例子。 还有很多其他我们可以讨论的内容，但我们总结一下这个建议：为了让你的直觉与React Router的一致，考虑组件，而不是静态路由。 考虑如何使用React的声明可组合性来解决问题，因为几乎每个“React Router问题”都可能是“React问题”。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react/">React</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/knowledge/">knowledge</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>渐变色</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/css/linear-gradient/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/css/linear-gradient/</guid>
                <pubDate>Tue, 31 Mar 2020 08:41:24 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="先说草图布局">先说草图布局</h2>
<p>现在工作的公司设计的页面似乎从来不考虑体验。比如说加载数据的loading界面，目前我发现B站、知乎等很多的APP、网页都在用下面图片这种效果。就是在没有拿到数据前，页面用条条框框的图形来代表内容和数据。</p>
<p><img src="/images/linear-gradient-1.jpg" alt="草图布局" title="草图布局"></p>
<p>这个效果其实好像还没有一个正式的名字，“草图布局”这个名字是从<a href="http://weibo.ws/lJAtrc">阮一峰的微博</a>看来的，我认为挺恰当的就这么叫吧。下图来自他的微博，微博里还有demo可以参考。</p>
<p>这个demo的实现原始是，在<code>background-image</code>中使用各种<code>gradient</code>来画圆形、矩形，使用<code>background-size</code>控制各个图形的尺寸，主要是宽度。再使用<code>background-position</code>控制各个图形的位置来布局。这里就用到的渐变色，只不过用来画了非渐变的图形。</p>
<p>demo中有一个高亮的动画效果，是使用一个有旋转了100度的<code>linear-gradient</code>加一个位置动画的效果实现的。
<img src="/images/linear-gradient-3.gif" alt="草图布局" title="渐变色1"></p>
<p>我在我的项目中实现这个效果时遇到了问题——怎么确定这个渐变色的起始位置。比如下图这一条红线。
<img src="/images/linear-gradient-4.gif" alt="草图布局" title="渐变色2"></p>
<p>它的效果由这段代码实现的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">background-image</span><span class="o">:</span> <span class="nt">linear-gradient</span><span class="o">(</span>
	<span class="nt">120deg</span><span class="o">,</span> 
	<span class="nt">transparent</span> <span class="nt">308px</span><span class="o">,</span> 
	<span class="nt">red</span> <span class="nt">323px</span> <span class="o">,</span>
	<span class="nt">transparent</span> <span class="nt">338px</span>
<span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>linear-gradient的第一个参数是角度，其他3个参数表示某个位置及颜色，位置之间就是渐变色。想要一个图中这样从右上角开始的斜线，其中的<code>308</code>、<code>323</code>、<code>338</code>是怎么算的呢？下面研究一下计算方式。</p>
<h2 id="渐变色的方向与位置">渐变色的方向与位置</h2>
<p>计算方法是不大直观的，而且需要先了解几个概念：渐变线、起始点和终点。</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/linear-gradient">摘抄MDZ文档</a></p>
<p><img src="/images/linear-gradient-2.png" alt="渐变色" title="渐变线、起始点和终点"></p>
<dl>
<dt>渐变线</dt>
<dd>由包含渐变图形的容器的中心点和一个角度来定义的。渐变线上的颜色值是由不同的点来定义，包括起始点，终点，以及两者之间的可选的中间点（中间点可以有多个）</dd>
<dt>起始点</dt>
<dd>是渐变线上代表起始颜色值的点。起始点由渐变线和过容器顶点的垂直线之间的交叉点来定义。（垂直线跟渐变线在同一象限内）</dd>
<dt>终点</dt>
<dd>是渐变线上代表最终颜色值的点。终点也是由渐变线和从最近的顶点发出的垂直线之间的交叉点定义的，然而从起始点的对称点来定义终点是更容易理解的一种方式，因为终点是起点关于容器的中心点的反射点。</dd>
</dl>
<p>由这些概念可以知道渐变色是从起始点开始沿着渐变线的方向绘制，渐变色的交界会垂直与渐变线。也就是说我们想做的红线是垂直于渐变线的。那么我们看下图
<img src="/images/linear-gradient-5.gif" alt="渐变色"> <br>
已知红线与上边成60度角（自己定义的），所以渐变线应该是120deg，过点B做120deg渐变线的垂直线，相交于点C，点A点C的线段A的长度就是红色的起始位置，如果上边长度为375，由勾股定理可知线段A长度为309，所以红线的起始位置就是309px，（我的代码里取了308px没什么区别）<br>
由此可以写出上面的代码来实现红线。（其实就是顶点到红线的距离）<br>
所以当我们想实现一个有角度的渐变色的时候，就可以用类似的方法来计算颜色的起始位置。</p>
<p>如果渐变方向是平行与上下边或者左右边，可以这样写：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">background-image</span><span class="o">:</span> <span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">to</span> <span class="nt">bottom</span><span class="o">,</span><span class="nt">red</span> <span class="nt">25px</span> <span class="o">,</span><span class="nt">blue</span> <span class="nt">0</span><span class="o">);</span>
<span class="nt">background-image</span><span class="o">:</span> <span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">to</span> <span class="nt">right</span><span class="o">,</span> <span class="nt">red</span> <span class="nt">25px</span> <span class="o">,</span><span class="nt">blue</span> <span class="nt">0</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>另外下面代码的效果是一样的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">background-image</span><span class="o">:</span> <span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">red</span> <span class="nt">25px</span> <span class="o">,</span><span class="nt">blue</span> <span class="nt">0</span><span class="o">);</span>
<span class="nt">background-image</span><span class="o">:</span> <span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">180deg</span><span class="o">,</span> <span class="nt">red</span> <span class="nt">25px</span> <span class="o">,</span><span class="nt">blue</span> <span class="nt">0</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>另外，第二个颜色后面的数值便是渐变结束的位置，如果小雨前面颜色的位置就不会有渐变效果，利用这点可以用来实现草图布局。</p>
<p>例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">body</span><span class="o">,</span><span class="nt">html</span><span class="p">{</span>
	<span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">empty</span><span class="p">:</span><span class="nd">empty</span> <span class="p">{</span>
	<span class="k">margin</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
	<span class="k">width</span><span class="p">:</span> <span class="mi">702</span><span class="kt">px</span><span class="p">;</span>
	<span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
	
	<span class="k">background-image</span><span class="p">:</span>
		<span class="nb">linear-gradient</span><span class="p">(</span><span class="mi">100</span><span class="kt">deg</span><span class="p">,</span> 
			<span class="kc">transparent</span> <span class="mi">600</span><span class="kt">px</span><span class="p">,</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="mi">630</span><span class="kt">px</span> <span class="p">,</span><span class="kc">transparent</span> <span class="mi">660</span><span class="kt">px</span><span class="p">),</span>
		<span class="nb">linear-gradient</span><span class="p">(</span> <span class="kc">lightgray</span> <span class="mi">150</span><span class="kt">px</span><span class="p">,</span> <span class="kc">transparent</span> <span class="mi">0</span> <span class="p">),</span>
		<span class="nb">linear-gradient</span><span class="p">(</span> <span class="kc">lightgray</span> <span class="mi">150</span><span class="kt">px</span><span class="p">,</span> <span class="kc">transparent</span> <span class="mi">0</span> <span class="p">),</span>
		<span class="nb">linear-gradient</span><span class="p">(</span> <span class="kc">lightgray</span> <span class="mi">30</span><span class="kt">px</span><span class="p">,</span> <span class="kc">transparent</span> <span class="mi">0</span> <span class="p">),</span>
		<span class="nb">linear-gradient</span><span class="p">(</span> <span class="kc">lightgray</span> <span class="mi">88</span><span class="kt">px</span><span class="p">,</span> <span class="kc">transparent</span> <span class="mi">0</span> <span class="p">);</span>

	<span class="k">background-size</span><span class="p">:</span>
		<span class="mi">100</span><span class="kt">%</span> <span class="mi">100</span><span class="kt">%</span><span class="p">,</span> <span class="c">/* highlight */</span>
		<span class="mi">336</span><span class="kt">px</span> <span class="mi">150</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">336</span><span class="kt">px</span> <span class="mi">150</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">570</span><span class="kt">px</span> <span class="mi">30</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">720</span><span class="kt">px</span> <span class="mi">88</span><span class="kt">px</span><span class="p">;</span>

	<span class="k">background-position</span><span class="p">:</span>
		<span class="mi">-700</span><span class="kt">px</span> <span class="mi">0</span><span class="p">,</span>
		<span class="mi">0</span> <span class="mi">24</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">387</span><span class="kt">px</span> <span class="mi">24</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">0</span> <span class="mi">230</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">0</span> <span class="mi">284</span><span class="kt">px</span><span class="p">;</span>
	
	<span class="k">background-repeat</span><span class="p">:</span> <span class="kc">no-repeat</span><span class="p">;</span>

	<span class="k">animation</span><span class="p">:</span> <span class="n">shine</span> <span class="mi">2</span><span class="kt">s</span> <span class="kc">infinite</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">@</span><span class="k">keyframes</span> <span class="nt">shine</span> <span class="p">{</span>
	<span class="nt">to</span> <span class="p">{</span>
		<span class="k">background-position</span><span class="p">:</span>
			<span class="mi">160</span><span class="kt">px</span> <span class="mi">0</span><span class="p">,</span>
			<span class="mi">0</span> <span class="mi">24</span><span class="kt">px</span><span class="p">,</span>
			<span class="mi">387</span><span class="kt">px</span> <span class="mi">24</span><span class="kt">px</span><span class="p">,</span>
			<span class="mi">0</span> <span class="mi">230</span><span class="kt">px</span><span class="p">,</span>
			<span class="mi">0</span> <span class="mi">284</span><span class="kt">px</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/css/">CSS</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>SSH</title>
                <link>https://wss.cool/ssh.html</link>
                <guid isPermaLink="true">https://wss.cool/ssh.html</guid>
                <pubDate>Tue, 31 Mar 2020 08:37:31 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>在自己的电脑上生成公钥、密钥。公钥放在远程服务器上，密钥在自己电脑里不用管。连接远程服务器时就不用输入密码了。</p>
<h2 id="安装">安装</h2>
<p>新装的系统可能没有ssh服务，需要自己安装</p>
<pre><code>sudo apt-get install openssh-server
</code></pre><h2 id="配置">配置</h2>
<p>新安装的 <code>ssh server</code> 需要一点配置：开启密码登录，开启公钥登录。</p>
<ol>
<li>编辑配置文件
<pre><code>sudo vim /etc/ssh/sshd_config
</code></pre></li>
<li>开启密码登录、公钥登录
<pre><code>PasswordAuthentication yes
PubkeyAuthentication yes
</code></pre></li>
<li>重启 <code>ssh server</code>
<pre><code>service ssh reload <span class="shortcodes_tag">退出vim重启ssh</span>
</code></pre></li>
</ol>
<h2 id="生成key">生成key</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">ssh-keygen -t rsa
</code></pre></td></tr></table>
</div>
</div><h2 id="复制公钥">复制公钥</h2>
<p>将本机的公钥copy到远程机器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">ssh-copy-id username@remote_host_B
</code></pre></td></tr></table>
</div>
</div><p>然后输入密码。</p>
<blockquote>
<p>该命令会把本机的公钥复制到远程机器的 .ssh/authorized_keys 文件中。</p>
</blockquote>
<h2 id="登陆服务器">登陆服务器</h2>
<p>配置好公钥以后就可以使用如下命令登录了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">ssh username@hostname
</code></pre></td></tr></table>
</div>
</div><h2 id="配置别名">配置别名</h2>
<p>每次都使用 <code>ssh username@hostname</code> 登录会有点麻烦，可以通过配置将命令简化。比如下面的配置，可以将登录的命令简化为 <code>ssh azu</code> 。配置文件为 <code>~/.ssh/config</code> 。</p>
<pre><code>Host azu
   HostName 192.168.1.5
   User azu
   IdentityFile /homt/xx/.ssh/id_rsa
</code></pre><h2 id="alias命令">alias命令</h2>
<p>在终端中定义缩写的命令，比如：</p>
<pre><code>alias totx='ssh username@hostname'
</code></pre><p>这样就可以使用<code>totx</code>命令直接登陆远程服务器了，但是alias命令会在重启终端时</p>
<h2 id="永久保留alias命令">永久保留alias命令</h2>
<p>每次登陆时.bash_profile文件是会自动执行，此过程会调用.bashrc，将alias命令写入.bashrc文件就可以将alias命令永久生效了。（如果没有此文件就创建一个）</p>
<h2 id="报错">报错</h2>
<pre><code>WARNING: UNPROTECTED PRIVATE KEY FILE!
Permissions 0644 '' are too open.
...
</code></pre><p>我装了window是10和ubuntu双系统，将windows的一个公钥文件复制到ubuntu后，使用ssh的config配置了它。在使用ssh登录时，就报了这个错。</p>
<p>是文件权限的问题，改成只读的权限即可解决。</p>
<pre><code>chmod 400 ～/.ssh/id_rsa
</code></pre><h2 id="指定私钥证书登录">指定私钥(证书)登录</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">ssh name@6.6.6.6 -i ./identity_file.pem

scp -i ./identity_file.pem file_a name@1.1.1.1:~/
</code></pre></td></tr></table>
</div>
</div><h2 id="配置密钥文件">配置密钥文件</h2>
<p>通常使用ssh生成的秘钥文件名是“id_rsa”，通常这一对公钥私钥也是够用的。如果有第二份秘钥的话（腾讯云生成的），需要一个&quot;config&quot;文件。
该文件存放在&quot;.ssh&quot;目录下（不需要后缀扩展名），内容为：</p>
<pre><code>Host 128.128.666.666
   IdentityFile C:\Users\anrui\.ssh\pc_pc  
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>跨域CORS</title>
                <link>https://wss.cool/%E8%B7%A8%E5%9F%9Fcors.html</link>
                <guid isPermaLink="true">https://wss.cool/%E8%B7%A8%E5%9F%9Fcors.html</guid>
                <pubDate>Tue, 31 Mar 2020 08:33:05 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="什么是跨域问题">什么是跨域问题</h2>
<p>在网页中使用AJAX时，AJAX请求的URL与网页的URL相比较，如果是属于同一个域名才可以正常访问，如果不属于一个域名就会出现跨域问题。所以，怎么判断两个URL是不是属于同一个域名呢？</p>
<p>比如一个网页的URL是&quot;https://segmentfault.com/a/1190000011145364?aaa=666&quot;，可以把它拆分开：<br>
origin: &quot;https://segmentfault.com&quot;<br>
pathname: &quot;/a/1190000011145364&quot;<br>
search: &quot;?aaa=666&quot;</p>
<p>只有当两个URL的origin完全相同时，才不会出现跨域问题。所以以下origin都会出现跨域问题：<br>
子域名：https://abc.segmentfault.com<br>
不同协议：http://segmentfault.com<br>
不同端口：https://segmentfault.com:8080<br>
IP地址：https://192.168.4.12</p>
<p>当出现跨域问题时，AJAX请求返回后浏览器控制台会报错，AJAX的回调拿不到返回值。</p>
<h2 id="两种常用的解决方法jsonp和cors">两种常用的解决方法：JSONP和CORS</h2>
<h3 id="jsonp">JSONP</h3>
<p>原理是利用浏览器允许跨域引用JavaScript资源。<br>
发送请求时，通过URL告诉服务器函数名，如：<code>http://some.com?callback=handle</code>.<br>
服务器的通常是函数调用的形式，如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">handle</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>页面中需要先准备好函数<code>handle</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="cors">CORS</h3>
<p>这个方案好像不需要在JS代码中的额外操作。另外，默认情况下，Cookie不包括在CORS请求之中，如果需要请求中带着cookie，设置withCredentials参数即可。<br>
<a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">阮一峰——跨域资源共享 CORS 详解</a></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>AJAX</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/javascript/ajax/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/javascript/ajax/</guid>
                <pubDate>Tue, 31 Mar 2020 08:20:17 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>AJAX——异步的JavaScript和XML，就是使用<code>XMLHttpRequest</code>对象与服务器通信。</p>
<h2 id="发送http请求">发送http请求</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">httpRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.example.org/some.file&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>创建XMLHttpRequest对象</li>
<li>告诉它</li>
<li>与哪个服务器交互</li>
<li>以哪种方法交互</li>
<li>给服务器的数据</li>
</ol>
<h2 id="open方法">open()方法</h2>
<p>这个方法是选择互动的目标，比如玩游戏时，你要告诉服务器我要用这个账号玩，用微信要先选择一个人才能发消息。</p>
<p>由于<a href="/2018/06/22/cors.html">跨域问题</a>，<code>open()</code> 方法的 <code>URL</code> 参数默认*..不能..*使用第三方域名。<br>
第一个参数如果不大写某些浏览器可能无法处理（比如FireFox，不知道哪些版本会有这个问题？）</p>
<h2 id="send方法">send()方法</h2>
<p>选择了目标后，就可以发消息了。发微信是说人类的语言，这个send方法就是说机器能听懂的语言。</p>
<h3 id="指定发送给服务器的数据">指定发送给服务器的数据</h3>
<p><code>send()</code> 方法的参数就是要发送的数据，将会发送到服务器。像查询语句：<code>&quot;name=wss&amp;age=66&quot;</code>，<br>
或者其他格式, 例如multipart/form-data，JSON，XML等。</p>
<h3 id="指定返回数据的格式">指定返回数据的格式</h3>
<p>服务区收到了我们的请求后，会给我们一个响应。我们要事先告诉服务器我们想要的数据的格式。</p>
<p>当以POST方式获取数据时，需要设置请求的<em>MIME类型</em>。</p>
<blockquote>
<p>用于定义网络文件的类型和网页的编码，决定浏览器将以什么形式、什么编码读取这个文件）</p>
</blockquote>
<p>比如表单数据：<code>httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');</code></p>
<h2 id="处理服务器响应">处理服务器响应</h2>
<p><code>httpRequest.onreadystatechange</code>函数负责处理响应，函数内应该怎么处理呢？</p>
<p>第一步：检查请求的状态。</p>
<p>请求的状态会经历如下变化：（每当状态变化是都会调用onreadystatechange方法？）</p>
<ul>
<li>0 (未初始化) or (请求还未初始化) UNSENT</li>
<li>1 (正在加载) or (已建立服务器链接) OPENED</li>
<li>2 (加载成功) or (请求已接受) HEADERS_RECEIVED</li>
<li>3 (交互) or (正在处理请求) LOADING</li>
<li>4 (完成) or (请求已完成并且响应已准备好) DONE</li>
</ul>
<p>第二步：请求完成时，检查http状态码。</p>
<p>当请求完成，意味着完成了与服务器的交互。接下来就可以检查 <a href="http://www.runoob.com/http/http-status-codes.html">HTTP状态码</a> 了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">DONE</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Everything is good, the response was received.
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Perfect!
</span><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// There was a problem with the request.
</span><span class="c1"></span>        <span class="c1">// For example, the response may have a 404 (Not Found)
</span><span class="c1"></span>        <span class="c1">// or 500 (Internal Server Error) response code.
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Not ready yet.
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在检查完HTTP响应码后，就可以使用服务器返回的数据了，有两个方法去访问这些数据：</p>
<ul>
<li><code>httpRequest.responseText</code> – 服务器以文本字符的形式返回</li>
<li><code>httpRequest.responseXML</code> – 以 XMLDocument 对象方式返回，之后就可以使用JavaScript来处理
（返回JSON怎么处理？）</li>
</ul>
<h2 id="responsetype属性">responseType属性</h2>
<p>可以通过设置一个 XMLHttpRequest 对象的 responseType 属性来改变一个从服务器上返回的响应的<em>数据类型</em><br>
比如二进制数据:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="s2">&#34;arraybuffer&#34;</span><span class="p">;</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="监测进度">监测进度</h2>
<p>XMLHttpRequest 提供了各种在请求被处理期间发生的事件以供监听。包括定期进度通知、错误通知，等等。(这些事件与上面说的“请求状态readyState”有什么关系？)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;progress&#34;</span><span class="p">,</span> <span class="nx">updateProgress</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span> <span class="nx">transferComplete</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">,</span> <span class="nx">transferFailed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;abort&#34;</span><span class="p">,</span> <span class="nx">transferCanceled</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>

<span class="c1">// 如果 lengthComputable 属性的值是 false，那么意味着总字节数是未知并且 total 的值为零。
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">updateProgress</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">percentComplete</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span>
  <span class="p">}</span> 
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>progress 事件同时存在于下载和上传的传输。上传相关事件在 XMLHttpRequest.upload 对象上被触发，像下面这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">req</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;progress&#34;</span><span class="p">,</span> <span class="nx">updateProgress</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span> <span class="nx">transferComplete</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">,</span> <span class="nx">transferFailed</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;abort&#34;</span><span class="p">,</span> <span class="nx">transferCanceled</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>使用 loadend 事件可以侦测到所有的三种加载结束条件（abort、load、error）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;loadend&#34;</span><span class="p">,</span> <span class="nx">loadEnd</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="参考">参考</h1>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/AJAX/Getting_Started">MDN AJAX Getting Started</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/Sending_and_Receiving_Binary_Data">使用JavaScript类型数组接受二进制数据</a></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/javascript/">JavaScript</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>React</title>
                <link>https://wss.cool/react.html</link>
                <guid isPermaLink="true">https://wss.cool/react.html</guid>
                <pubDate>Mon, 30 Mar 2020 23:19:26 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="生命周期">生命周期</h2>
<p>用于初始化 state  constructor() {}</p>
<p>用于替换 <code>componentWillReceiveProps</code> ，该函数会在初始化和 <code>update</code> 时被调用，</p>
<p>如果需要对比 <code>prevProps</code> 需要单独在 <code>state</code> 中维护  <code>static getDerivedStateFromProps(nextProps, prevState) {}</code> ，因为该函数是静态函数，所以取不到 <code>this</code> 。</p>
<p>判断是否需要更新组件，多用于组件性能优化  <code>shouldComponentUpdate(nextProps, nextState) {}</code></p>
<p>用于获得最新的 <code>DOM</code> 数据  <code>getSnapshotBeforeUpdate() {}</code></p>
<p>以下函数不建议使用  <code>UNSAFE_componentWillMount() {}</code>，<code>UNSAFE_componentWillUpdate(nextProps, nextState) {}</code>，<code>UNSAFE_componentWillReceiveProps(nextProps) {}</code></p>
<h2 id="props中没有historylocationmatchwithrouter可以解决">props中没有history,location,match？withRouter可以解决</h2>
<p>如果A组件的父组件是Route（react-router-dom）,A的props参数会含有history,location,match，但是A组件的子组件B的props参数就不包含history,location,match。<br>
如果想在B组件中使用history的API，但是没有history对象该怎么办呢。这时就用到withRouter了<a href="https://reacttraining.com/react-router/web/api/withRouter">文档</a>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">withRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router&#39;</span><span class="p">;</span>
<span class="kr">class</span> <span class="nx">ShowTheLocation</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// this.props中会包含history,location,match
</span><span class="c1"></span><span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">withRouter</span><span class="p">(</span><span class="nx">ShowTheLocation</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react/">React</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>博客文章分类</title>
                <link>https://wss.cool/posts/%E5%8D%9A%E5%AE%A2%E5%88%86%E7%B1%BB/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%8D%9A%E5%AE%A2%E5%88%86%E7%B1%BB/</guid>
                <pubDate>Mon, 30 Mar 2020 22:49:40 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="介绍">介绍</h2>
<p>分类以树状展开，能体现出难易程度和关系，体现出自己的知识结构。</p>
<p>最简单和基础的是“api”分类，它是一些简单的语法，或者简单的API的用法的汇总，以前后端、服务器等划分子类，下面再展开具体的语言、类库、框架的API。使用这些API可以完成一些简单的日常工作。</p>
<p>进阶一点的是“知识点”分类，它是在API的背后的工作原理。掌握原理可以让工作中少踩坑。工作原理也可以在框架之间，在语言之间迁移。</p>
<p>第三个分类是“折腾”，它是由一些列的API、知识点经过一些步骤组合而成，一般是为了解决问题。</p>
<blockquote>
<p>折腾这个名字不大好，叫“实践”？</p>
</blockquote>
<p>再然后就是“心得与经验”分类，折腾实践多了，肯定会有好的经验和坏的教训，就需要思考总结，把它们沉淀为经验和套路。</p>
<h2 id="分类">分类</h2>
<ul>
<li>api （简单的API操作的记录）
<ul>
<li>前端
<ul>
<li>css</li>
<li>react</li>
<li>axios</li>
</ul>
</li>
<li>后端
<ul>
<li>java hashmap 使用</li>
<li>spring security</li>
<li>Spring mvc</li>
<li>Spring oauth2</li>
</ul>
</li>
<li>服务器
<ul>
<li>nginx
<ul>
<li>静态网站</li>
<li>反向代理</li>
</ul>
</li>
<li>linux
<ul>
<li>使用源码安装软件</li>
<li>ssh 登录，指定私钥文件（证书）</li>
</ul>
</li>
</ul>
</li>
<li>工具
<ul>
<li>git</li>
</ul>
</li>
</ul>
</li>
<li>知识点 （技术原理）
<ul>
<li>react
<ul>
<li>diff</li>
<li>元素</li>
<li>virtual dom</li>
<li>hooks</li>
<li>生命周期</li>
</ul>
</li>
<li>nginx
<ul>
<li>负载均衡</li>
</ul>
</li>
<li>java
<ul>
<li>hashmap原理</li>
</ul>
</li>
</ul>
</li>
<li>折腾（需要若干步骤、若干知识点、若干API操作组合而解决问题）
<ul>
<li>博客支持服务</li>
<li>gitlab的ci</li>
</ul>
</li>
<li>心得与经验（经历了一些事情后的想法，总结规律，思考结果。思想活动）
<ul>
<li>如何改bug</li>
<li>老板评价员工的逻辑</li>
<li>如何应付需求变动</li>
<li>如何写出好的代码</li>
<li>如何少加班</li>
<li>面试时总是没什么聊的怎么办？</li>
</ul>
</li>
<li>其他</li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>css</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/css/css/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/css/css/</guid>
                <pubDate>Sun, 29 Mar 2020 22:10:30 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="居中">居中</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css">  <span class="nt">top</span><span class="p">:</span><span class="nd">50</span><span class="o">%;</span>
  <span class="nt">left</span><span class="p">:</span><span class="nd">50</span><span class="o">%;</span>
  <span class="nt">transform</span><span class="o">:</span> <span class="nt">translate</span><span class="o">(</span><span class="nt">-50</span><span class="o">%,</span> <span class="nt">-50</span><span class="o">%);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="flex">Flex</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">class</span><span class="p">{</span>
  <span class="k">display</span><span class="p">:</span><span class="kc">flex</span><span class="p">;</span>
  <span class="k">justify-content</span><span class="p">:</span><span class="kc">flex</span><span class="o">-</span><span class="kc">start</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span><span class="kc">center</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="简易镂空效果">简易镂空效果</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">outline</span><span class="o">:</span>  <span class="nt">9999px</span> <span class="nt">solid</span> <span class="nt">rgba</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span><span class="nt">0</span><span class="o">,</span><span class="nt">0</span><span class="o">,</span><span class="p">.</span><span class="nc">76</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="多行文字英文数字换行限制行数">多行文字（英文、数字换行、限制行数）</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css">  <span class="nt">overflow</span><span class="o">:</span> <span class="nt">hidden</span><span class="o">;</span>
  <span class="nt">text-overflow</span><span class="p">:</span><span class="nd">ellipsis</span><span class="o">;</span>
  <span class="nt">white-space</span><span class="o">:</span> <span class="nt">nowrap</span><span class="o">;</span>
  <span class="nt">word-wrap</span><span class="p">:</span><span class="nd">break-word</span><span class="o">;</span>
  <span class="nt">word-break</span><span class="p">:</span><span class="nd">break-all</span><span class="o">;</span>

  <span class="nt">display</span><span class="p">:</span><span class="nd">-webkit-box</span><span class="o">;</span>
  <span class="nt">-webkit-box-orient</span><span class="p">:</span><span class="nd">vertical</span><span class="o">;</span>
  <span class="nt">-webkit-line-clamp</span><span class="p">:</span><span class="nd">2</span><span class="o">;</span>
  <span class="nt">overflow</span><span class="p">:</span><span class="nd">hidden</span><span class="o">;</span>
  <span class="nt">word-wrap</span><span class="p">:</span><span class="nd">break-word</span><span class="o">;</span>
  <span class="nt">word-break</span><span class="p">:</span><span class="nd">break-all</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="flex布局时使子元素不被缩放">flex布局时使子元素不被缩放</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css">  <span class="nt">flex-grow</span><span class="o">:</span> <span class="nt">0</span><span class="o">;</span>
  <span class="nt">flex-shrink</span><span class="p">:</span><span class="nd">0</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="ios滚动不流畅">ios滚动不流畅</h2>
<pre><code>-webkit-overflow-scrolling : touch; 
</code></pre><h2 id="placeholder的样式">placeholder的样式</h2>
<pre><code>.className::-webkit-input-placeholder {
  color: #B7B7B7;
}
</code></pre><h2 id="渐变色">渐变色</h2>
<p>各个参数的含义：<code>linear-gradient(方向, 开始颜色 大小, 结束颜色 大小);</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">node</span> <span class="p">{</span>
    <span class="k">background-image</span><span class="p">:</span> <span class="nb">linear-gradient</span><span class="p">(</span><span class="kc">to</span> <span class="kc">right</span><span class="p">,</span> <span class="mh">#000</span> <span class="mi">1</span><span class="kt">px</span><span class="p">,</span> <span class="kc">transparent</span> <span class="mi">0</span><span class="kt">px</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="使用css画不规则边框">使用css画不规则边框</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">node</span> <span class="p">{</span>
    <span class="k">background-image</span><span class="p">:</span> <span class="nb">linear-gradient</span><span class="p">(</span><span class="kc">to</span> <span class="kc">right</span><span class="p">,</span> <span class="mh">#000</span> <span class="mi">1</span><span class="kt">px</span><span class="p">,</span> <span class="kc">transparent</span> <span class="mi">0</span><span class="kt">px</span><span class="p">);</span>
    <span class="k">background-size</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
    <span class="n">background-position-y</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">background-repeat</span><span class="p">:</span> <span class="kc">no-repeat</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这段样式可以画半个左边框。其中用到了渐变色属性。</p>
<h2 id="渐变色文字">渐变色文字</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">text</span><span class="p">{</span>
  <span class="k">background-image</span><span class="p">:</span> <span class="kp">-webkit-</span><span class="nf">gradient</span><span class="p">(</span><span class="kc">linear</span><span class="p">,</span><span class="mi">0</span><span class="kt">%</span> <span class="mi">0</span><span class="kt">%</span><span class="p">,</span><span class="mi">25</span><span class="kt">%</span> <span class="mi">100</span><span class="kt">%</span><span class="p">,</span><span class="nf">from</span><span class="p">(</span><span class="mh">#ff2c2c</span><span class="p">),</span><span class="nf">to</span><span class="p">(</span><span class="mh">#7a5e91</span><span class="p">));</span>
  <span class="kp">-webkit-</span><span class="k">background-clip</span><span class="p">:</span> <span class="kc">text</span><span class="p">;</span>
  <span class="kp">-webkit-</span><span class="n">text-fill-color</span><span class="p">:</span> <span class="kc">transparent</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">span</span> <span class="p">{</span>
  <span class="k">background</span><span class="p">:</span> <span class="nb">linear-gradient</span><span class="p">(</span><span class="kc">to</span> <span class="kc">right</span><span class="p">,</span> <span class="kc">red</span><span class="p">,</span> <span class="kc">blue</span><span class="p">);</span>
  <span class="kp">-webkit-</span><span class="k">background-clip</span><span class="p">:</span> <span class="kc">text</span><span class="p">;</span>
  <span class="k">color</span><span class="p">:</span> <span class="kc">transparent</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="ios-阴影-input-textarea">IOS 阴影 input textarea</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">input</span><span class="o">,</span><span class="nt">textarea</span><span class="p">{</span>
	<span class="kp">-webkit-</span><span class="k">appearance</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="margin塌陷">margin塌陷</h2>
<p>在标准文档流中，竖直方向的margin会出现叠加现象，即较大的margin会覆盖掉较小的margin，竖直方向的两个盒子中间只有一个较大的margin，这就是margin的塌陷现象。<br>
margin的塌陷现象分两种情况：
1.兄弟关系的盒子：
比如ul的li，相邻的li之间的margin会重叠取较大的一个;
2.父子关系的盒子。
子盒子的margin-top大于父盒子时，子的margin-top会覆盖父的。</p>
<p>解决方法：<br>
当给父盒子设置边框或padding时，不会出现父子盒子的塌陷现象。<br>
当父盒子设置display:flex;时，不会出现这2种坍塌现象。</p>
<h2 id="盒子模型">盒子模型</h2>
<h2 id="清除浮动">清除浮动</h2>
<h2 id="css优先级">css优先级</h2>
<p>!important最高
行内style属性 &gt; 内联style标签 &gt; 外联css文件
id &gt; class &gt; tag
计算：
行内style属性 = 1000
ID选择器 = 100
类选择器、属性选择器、伪类 = 10
元素/伪元素 = 1
*通配选择器 = 0</p>
<h2 id="伪类伪元素">伪类&amp;伪元素</h2>
<p>伪元素：
::before
::after
::placeholder
::first-line
伪类：
:first-child
:nth-child
:empty</p>
<h2 id="inline-block元素有间隙">inline-block元素有间隙</h2>
<p>解决方法：在这些inline-block元素的父元素设置样式——fontsize：0；</p>
<h2 id="居中-1">居中</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">#</span><span class="nn">wrapper</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">table</span><span class="p">;</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">#</span><span class="nn">centred</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">table</span><span class="o">-</span><span class="kc">cell</span><span class="p">;</span>
  <span class="k">vertical-align</span><span class="p">:</span> <span class="kc">middle</span><span class="p">;</span>
  <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
<span class="p">}</span>  
</code></pre></td></tr></table>
</div>
</div><h2 id="左右对齐文字">左右对齐文字：</h2>
<pre><code>.a{
    width:596px;
    text-align:justify;
    text-align-last:justify;  
}
</code></pre><h2 id="固定位置显示背景图片">固定位置显示背景图片</h2>
<p>background-attachment: fixed;</p>
<h2 id="css滤镜">css滤镜</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">filter</span><span class="o">:</span> <span class="nt">grayscale</span><span class="o">(</span><span class="nt">100</span><span class="o">%);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="sass继承">sass继承</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scss" data-lang="scss"><span class="nc">.error</span> <span class="p">{</span>
  <span class="nt">border</span><span class="nd">:</span> <span class="nt">1px</span> <span class="nn">#f00</span><span class="p">;</span>
  <span class="nt">background-color</span><span class="nd">:</span> <span class="nn">#fdd</span><span class="p">;</span>

  <span class="k">&amp;</span><span class="nt">--serious</span> <span class="p">{</span>
    <span class="k">@extend</span> <span class="nc">.error</span><span class="p">;</span>
    <span class="nt">border-width</span><span class="nd">:</span> <span class="nt">3px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="css-module-的-composes-在-vscode-中有警告">css module 的 composes 在 vscode 中有警告</h2>
<p>在vscode的配置文件中加这个：</p>
<pre><code>&quot;css.lint.unknownProperties&quot;: &quot;ignore&quot;
</code></pre><h2 id="剪裁元素内容">剪裁元素内容</h2>
<pre><code>clip-path: inset(0 10px 0 10px);
</code></pre><p>这个可以剪裁元素内容，依次为上右下左，以边缘为起点，剪裁掉这么多宽度。
参考：https://www.zhangxinxu.com/wordpress/2014/12/css3-svg-clip-path/
和：https://developer.mozilla.org/zh-CN/docs/Web/CSS/clip-path</p>
<h2 id="隐藏滚动条">隐藏滚动条：</h2>
<pre><code>body::-webkit-scrollbar {
    display: none;
}  
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/css/">CSS</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>vscode</title>
                <link>https://wss.cool/vscode.html</link>
                <guid isPermaLink="true">https://wss.cool/vscode.html</guid>
                <pubDate>Sat, 28 Mar 2020 05:02:40 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="git自动刷新">Git自动刷新</h2>
<p>git 插件会不停的刷新文件的状态，间隔大概5秒。可以在设置中关掉它。</p>
<pre><code>Autorefresh
是否启用自动刷新。
</code></pre><h2 id="debugger-for-chrome">debugger for chrome</h2>
<p>当使用parcel时，实际引用js文件会带有hash，而编辑器中的文件没有hash，导致插件认为js文件没有被挂载，断点也就无效了。<br>
按照如下调整launch.json，可解决此问题。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="s2">&#34;sourceMapPathOverrides&#34;</span><span class="err">:</span> <span class="p">{</span>
	<span class="nt">&#34;../*&#34;</span><span class="p">:</span> <span class="s2">&#34;${webRoot}/*&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/">工具</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>hugo常用格式</title>
                <link>https://wss.cool/hugo%E5%B8%B8%E7%94%A8%E6%A0%BC%E5%BC%8F.html</link>
                <guid isPermaLink="true">https://wss.cool/hugo%E5%B8%B8%E7%94%A8%E6%A0%BC%E5%BC%8F.html</guid>
                <pubDate>Sat, 28 Mar 2020 02:52:52 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="自定义shortcodes">自定义shortcodes</h2>
<pre><code><span>{</span>{< tag nihao >}}</code></pre>
<p><strong>效果</strong>⬇️</p>
<span class="shortcodes_tag">nihao</span>
<div class="shortcodes_withTitle" title="ttt">title</div>
<p><span class="shortcodes_number">1</span>
 与 #1# 在highlight</p>
<h2 id="代码块内的高亮">代码块内的高亮</h2>
<p>Options:</p>
<dl>
<dt><code>linenos</code></dt>
<dd>configure line numbers. Valid values are <code>true</code>, <code>false</code>, <code>table</code>, or <code>inline</code>. <code>false</code> will turn off line numbers if it’s configured to be on in site config. New in v0.60.0 <code>table</code> will give copy-and-paste friendly code blocks.</dd>
<dt><code>hl_lines</code></dt>
<dd>lists a set of line numbers or line number ranges to be highlighted.</dd>
<dt><code>linenostart=199</code></dt>
<dd>starts the line number count from 199.</dd>
</dl>
<pre><code><span>{</span>{< highlight go "linenos=table,hl_lines=8 15-17,linenostart=199" >}}
// ... code
<span>{</span>{< / highlight >}}
</code></pre>
<p><strong>效果</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="hl"><span class="lnt"> 8
</span></span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">clone</span><span class="p">(</span><span class="nx">旧对象</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">新对象</span> <span class="o">=</span> <span class="p">{};</span> <span class="err">#</span><span class="mi">1</span><span class="err">#</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">旧对象</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">旧对象</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">is基本类型</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">新对象</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">旧对象</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="hl">      <span class="nx">clone</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
</span>    <span class="p">}</span>
  <span class="p">})</span>
  <span class="k">return</span> <span class="nx">新对象</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="定义">定义</h2>
<dl>
<dt>定义一</dt>
<dd>说明文字</dd>
</dl>
<h2 id="图片">图片</h2>
<p>下面引号内的文字是可以不加的，加了的话，会显示在图片下方，作为说明文字。</p>
<pre><code>![alt](/images/xx.png &quot;说明文字&quot;)
</code></pre><p><strong>效果</strong>⬇️
<img src="/images/hugo01.jpg" alt="52区" title="外域52区"><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>
<img src="/images/linear-gradient-2.png" alt="52区" title="外域52区"><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<h2 id="脚注">脚注</h2>
<p>维基百科的说明<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>，脚注或称注脚（英语：footnote），用于：</p>
<ul>
<li>为条目正文补充注解（解释性加注）</li>
<li>标明被引用于正文或注解的数据源</li>
</ul>
<p>例子：</p>
<p><strong>作者.书名.译者.出版地:出版者,出版时间</strong></p>
<p>Ilya Grigorik.Web性能权威指南.李松峰译.北京:人民邮电出版社，2014</p>
<p><strong>作者或网站名.文章名.[创作或更新时间]</strong></p>
<p>阮一峰.TCP 协议简介.[2017年6月8日]</p>
<p><a href="https://zh.wikipedia.org/wiki/Wikipedia:%E5%88%97%E6%98%8E%E6%9D%A5%E6%BA%90">维基百科的列明来源</a>介绍了脚注等说明性内容的用法。</p>
<blockquote>
<p>凡是引用前人（包括作者自己过去）已发表的文献中的观点、数据和材料等，我们建议都要对它们在文中出现的地方予以标明，并在文末列出参考文献表。<br>
书籍：序号 主要责任者．题名: 其他题名信息[文献类型标志]．其他责任者．版本．出版地: 出版者, 出版年: 引文页码[引用日期]．国际标准书号（ISBN）．获取和访问路径。<br>
网页：作者，文章标题，网页地址，发表或更新日期。（网页语言）</p>
</blockquote>
<p><a href="https://zh.wikipedia.org/wiki/%E6%96%87%E5%90%8E%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E8%91%97%E5%BD%95%E8%A7%84%E5%88%99#GB/T_7714-2005">中文参考文献规则</a></p>
<p>在词/句后或图片前加一个标记<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>，其实是一个冒点，点击可追溯到页面地步的注脚定义。</p>
<pre><code>某文章[^1]说到某技术非常厉害

[^1]: &lt;https://github.com/wangshushuo/abc.html&gt;
</code></pre><p><strong>效果</strong>⬇️</p>
<p>某文章<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>说到某技术非常厉害</p>
<h2 id="链接">链接</h2>
<p><strong>第一种：行内</strong></p>
<p><strong>效果</strong>⬇️</p>
<pre><code>[链接的文字](https://www.wss.cool)
</code></pre><p><a href="https://wss.cool">链接的文字</a></p>
<p><strong>第二种：简写</strong></p>
<pre><code>[链接的文字][a1]

[a1]: https://wss.cool
</code></pre><p><strong>效果</strong>⬇️</p>
<p><a href="https://wss.cool">链接的文字</a></p>
<h2 id="表格">表格</h2>
<pre><code>操作 | 代码 
:---:|:---:
暂存 | git stash
列表 | git stash list
取出 | git stash pop 1
</code></pre><pre><code>:---: 表示文字居中
:---  居左
---:  局右，
</code></pre><p><strong>效果</strong>⬇️</p>
<table>
<thead>
<tr>
<th align="center">操作</th>
<th align="center">代码</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">暂存</td>
<td align="center">git stash</td>
</tr>
<tr>
<td align="center">列表</td>
<td align="center">git stash list</td>
</tr>
<tr>
<td align="center">取出</td>
<td align="center">git stash pop 1</td>
</tr>
</tbody>
</table>
<h2 id="行内代码">行内代码</h2>
<p>这是一段代码 <code>a = b + c</code> 它是这样的。</p>
<hr>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://github.com/wangshushuo/abc.html">https://github.com/wangshushuo/abc.html</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p><a href="https://zh.wikipedia.org/wiki/Help:%E8%84%9A%E6%B3%A8">https://zh.wikipedia.org/wiki/Help:%E8%84%9A%E6%B3%A8</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>代码大全</title>
                <link>https://wss.cool/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8.html</link>
                <guid isPermaLink="true">https://wss.cool/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8.html</guid>
                <pubDate>Thu, 26 Mar 2020 10:37:50 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>这本书的原名是《Code Complete》，指的是软件项目中的“构建”这个阶段。内容的主要是如何把代码写好。</p>
<blockquote>
<p>需求设计，架构设计，构建（写代码），测试，发布。</p>
</blockquote>
<h2 id="从目录看书的结构">从目录看书的结构</h2>
<p>目录上把书分成了7个部分，每个部分包含多个章节。</p>
<ol>
<li>打好构建的基础</li>
<li>高质量的代码</li>
<li>变量</li>
<li>语句</li>
<li>改善代码</li>
<li>系统考虑</li>
<li>软件工艺</li>
</ol>
<h2 id="摘录">摘录</h2>
<h3 id="60">6.0</h3>
<ul>
<li>
<p>成为高效程序员的一个关键就在于，当你开发程序任一部分的代码时，都能安全地忽视程序中尽可能多的其余部分。而类就是实现这一目标的首要工具。</p>
</li>
<li>
<p>如果你的程序被设计为使用了很多体积庞大，包含众多子程序的类的话，那么类数据和全局数据之间的区别就变得模糊起来，类内数据也将开始受困于全局数据所面临的那些问题了。</p>
</li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</category>
                                
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8/">代码大全</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>React 组件打包为 library</title>
                <link>https://wss.cool/react-component-be-libiary.html</link>
                <guid isPermaLink="true">https://wss.cool/react-component-be-libiary.html</guid>
                <pubDate>Thu, 27 Feb 2020 12:10:28 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>在开发多个项目时，为了提到代码的复用，将一个 <code>React</code> 组件发不成一个独立的 <code>npm</code> 包是一个不错的方式。</p>
<p>这里参考 <code>reactjs-popup</code> 这个库。它的编译没有使用webpack等打包工具，它是使用 <code>bili</code> 和 <code>babel</code> 这两个库和自己写的脚本 <code>build.js</code> 文件进行的编译和打包。下面是 <code>build.js</code> 文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">del</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;del&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Bili</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bili&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">pkg</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./package.json&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">input</span><span class="o">:</span> <span class="s1">&#39;./src/index.js&#39;</span><span class="p">,</span>
  <span class="nx">outDir</span><span class="o">:</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;reactjs-popup&#39;</span><span class="p">,</span>
  <span class="nx">format</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;es&#39;</span><span class="p">,</span> <span class="s1">&#39;cjs&#39;</span><span class="p">,</span> <span class="s1">&#39;umd&#39;</span><span class="p">,</span> <span class="s1">&#39;umd-min&#39;</span><span class="p">],</span>
  <span class="nx">banner</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;browser&#39;</span><span class="p">,</span>
  <span class="nx">external</span><span class="o">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">pkg</span><span class="p">.</span><span class="nx">peerDependencies</span><span class="p">),</span>
<span class="p">};</span>

<span class="c1">// some confuse between babel config for parcel that use v6 and Bili that&#39;s use V7
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">babelBiliConfig</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">presets</span><span class="o">:</span> <span class="p">[[</span><span class="s1">&#39;@babel/preset-env&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">modules</span><span class="o">:</span> <span class="kc">false</span><span class="p">}],</span> <span class="s1">&#39;@babel/preset-react&#39;</span><span class="p">],</span>
  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;@babel/plugin-proposal-class-properties&#39;</span><span class="p">],</span>
<span class="p">};</span>
<span class="kr">const</span> <span class="nx">babelParcelConfig</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">[</span>
      <span class="s1">&#39;@babel/preset-env&#39;</span><span class="p">,</span>
      <span class="p">{</span>
        <span class="nx">targets</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">node</span><span class="o">:</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">],</span>
    <span class="s1">&#39;@babel/preset-react&#39;</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;@babel/plugin-proposal-class-properties&#39;</span><span class="p">],</span>
<span class="p">};</span>

<span class="c1">// Copy package.json, LICENSE,README and npmignore files
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">writePackageFiles</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">delete</span> <span class="nx">pkg</span><span class="p">.</span><span class="nx">devDependencies</span><span class="p">;</span>
  <span class="k">delete</span> <span class="nx">pkg</span><span class="p">.</span><span class="nx">scripts</span><span class="p">;</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
    <span class="s1">&#39;./lib/package.json&#39;</span><span class="p">,</span>
    <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">pkg</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span><span class="p">),</span>
    <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
  <span class="p">);</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
    <span class="s1">&#39;./lib/LICENSE&#39;</span><span class="p">,</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;LICENSE&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
    <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
  <span class="p">);</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
    <span class="s1">&#39;./lib/README.md&#39;</span><span class="p">,</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;README.md&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
    <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
  <span class="p">);</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
    <span class="s1">&#39;lib/.npmignore&#39;</span><span class="p">,</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;.npmignore&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
    <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
  <span class="p">);</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
    <span class="s1">&#39;./lib/index.d.ts&#39;</span><span class="p">,</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/index.d.ts&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
    <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="c1">// and use babel config V7
</span><span class="c1">// Clean up the output directory
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">Build</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Delete old build Folder ....&#39;</span><span class="p">);</span>
  <span class="nx">del</span><span class="p">([</span><span class="s1">&#39;lib/*&#39;</span><span class="p">]).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
      <span class="s1">&#39;./.babelrc&#39;</span><span class="p">,</span>
      <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">babelBiliConfig</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span><span class="p">),</span>
      <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="p">);</span>
    <span class="nx">Bili</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">options</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
        <span class="s1">&#39;./.babelrc&#39;</span><span class="p">,</span>
        <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">babelParcelConfig</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span><span class="p">),</span>
        <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">writePackageFiles</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
<span class="nx">promise</span> <span class="o">=</span> <span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">Build</span><span class="p">);</span>

<span class="c1">// catch errors
</span><span class="c1"></span><span class="nx">promise</span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">));</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="打包和使用">打包和使用</h2>
<ol>
<li>复制了一份这个项目</li>
<li>修改 <code>package.json</code> 、 <code>build.js</code> 和组件的代码</li>
<li>我的组件叫做 <code>Test</code> 包叫做 <code>react-test-comp</code></li>
<li>用它的方式打包</li>
<li>上传项目到 git 仓库</li>
<li>在项目中安装依赖
<pre><code>yarn add git+https://xxx.xxx/react-test-comp.git
</code></pre></li>
<li>在代码中使用
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Test</span> <span class="nx">from</span> <span class="s1">&#39;react-test-comp/lib&#39;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;App&#34;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Test</span> <span class="nx">text</span><span class="o">=</span><span class="s2">&#34;wangshushuo&#34;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>有一个点需要注意。从 <code>git</code> 和 <code>npm</code> 安装依赖是有区别的. <code>git</code> 仓库的打包后的文件是在 <code>react-test-comp/lib</code> 目录下，而 <code>npm</code> 则是将 <code>lib</code> 目录上传到仓库，引用的时候就不需要 <code>/lib</code> 目录</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react/">React</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/handbook/">handbook</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>创建 React 项目</title>
                <link>https://wss.cool/create-react-app.html</link>
                <guid isPermaLink="true">https://wss.cool/create-react-app.html</guid>
                <pubDate>Thu, 27 Feb 2020 11:10:50 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="创建项目">创建项目</h2>
<pre><code>yarn create react-app my-app
</code></pre><pre><code>npx create-react-app my-app
</code></pre><pre><code>npm init react-app my-app
</code></pre><h2 id="创建typescript项目">创建typescript项目</h2>
<p>在上面的命令的基础上，加<code>--template typescript</code></p>
<h2 id="环境变量">环境变量</h2>
<p>在 create-react-app 项目中，变量名必须以 <code>REACT_APP_</code> 开始。</p>
<p>在 <code>.env</code> 文件中定义变量 <code>REACT_APP_NOT_SECRET_CODE=123</code>。</p>
<p><strong>在 <code>js</code> 中使用</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">small</span><span class="o">&gt;</span><span class="nx">You</span> <span class="nx">are</span> <span class="nx">running</span> <span class="k">this</span> <span class="nx">application</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">b</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/b&gt; mode.&lt;/small&gt;</span>
      <span class="o">&lt;</span><span class="nx">form</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;hidden&#34;</span> <span class="nx">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_NOT_SECRET_CODE</span><span class="p">}</span> <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="err">/form&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>在 <code>html</code> 中使用</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>%REACT_APP_WEBSITE_NAME%<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>判断当前环境 <code>process.env.NODE_ENV !== 'production'</code>。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react/">React</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/handbook/">handbook</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>多快好省</title>
                <link>https://wss.cool/%E5%A4%9A%E5%BF%AB%E5%A5%BD%E7%9C%81.html</link>
                <guid isPermaLink="true">https://wss.cool/%E5%A4%9A%E5%BF%AB%E5%A5%BD%E7%9C%81.html</guid>
                <pubDate>Wed, 26 Feb 2020 13:45:16 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>经常会有一些不懂软件开发的领导，幻想着可以“多快好省”地开发出软件。但通常是不现实的。</p>
<table>
<thead>
<tr>
<th align="left">幻想</th>
<th align="left">幻想</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">多</td>
<td align="left">开发的功能多</td>
</tr>
<tr>
<td align="left">快</td>
<td align="left">开发的时间短</td>
</tr>
<tr>
<td align="left">好</td>
<td align="left">软件bug少</td>
</tr>
<tr>
<td align="left">省</td>
<td align="left">又少又便宜的人力</td>
</tr>
</tbody>
</table>
<h2 id="快和省">快和省</h2>
<p>快和省是最诱人的，因为这意味着成本低，它们的对立面就是“多、好”。少人力、少时间开发出来的东西如果想“好”，那么功能就要少，如果要功能多，那就好不了，会有很多bug。</p>
<h2 id="好与多">好与多</h2>
<p>要想开发多个功能，质量又好的软件。要么多花钱，请牛人设计开发，越想快就多招人，就不能省钱。想省钱就快不起来。</p>
<p>非要多快好省的话，最后的结果肯定是“多快省”的做出来了，然后软件很多问题，很不好用，体验差。生意就会很难做，软件也维护不下去，最后钱赔光了。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/">心得与经验</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Spring MVC与模版 thymeleaf 开发网站</title>
                <link>https://wss.cool/posts/%E5%90%8E%E7%AB%AF/spring/spring-mvc%E4%B8%8E%E6%A8%A1%E7%89%88thymeleaf%E5%BC%80%E5%8F%91%E7%BD%91%E7%AB%99/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%90%8E%E7%AB%AF/spring/spring-mvc%E4%B8%8E%E6%A8%A1%E7%89%88thymeleaf%E5%BC%80%E5%8F%91%E7%BD%91%E7%AB%99/</guid>
                <pubDate>Tue, 25 Feb 2020 23:39:38 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="一个简单的-controller-指向一个模版">一个简单的 controller 指向一个模版</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/greeting&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">greeting</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;World&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;greeting&#34;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>return &quot;greeting&quot;</code> 对应 <code>src/main/resources/templates/greeting.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;&#39;hello &#39;+${name}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="home-page不需要配置">Home Page，不需要配置</h2>
<p><code>src/main/resources/static/index.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Getting Started: Serving Web Content<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Type&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;text/html; charset=UTF-8&#34;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Get your greeting <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;/greeting&#34;</span><span class="p">&gt;</span>here<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="配置-spring-mvc">配置 Spring MVC</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.securingweb</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ViewControllerRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MvcConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="n">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&#34;/home&#34;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&#34;home&#34;</span><span class="o">);</span>
		<span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&#34;home&#34;</span><span class="o">);</span>
		<span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&#34;hello&#34;</span><span class="o">);</span>
		<span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&#34;login&#34;</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/spring/">spring</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Java后端开发常用工具</title>
                <link>https://wss.cool/java%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7.html</link>
                <guid isPermaLink="true">https://wss.cool/java%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7.html</guid>
                <pubDate>Thu, 30 Jan 2020 01:19:02 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="spring-web-mvc-reference">Spring Web MVC Reference</h2>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">Spring Web MVC Reference</a></p>
<h2 id="spring-security-reference">Spring Security Reference</h2>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.2.2.BUILD-SNAPSHOT/reference/htmlsingle/">Spring Security Reference</a>，内容很多。OAuth2相关的内容，不包含授权服务器。</p>
<h2 id="spring-security-oauth2-boot">Spring Security OAuth2 Boot</h2>
<p><a href="https://docs.spring.io/spring-security-oauth2-boot/docs/current-SNAPSHOT/reference/htmlsingle/">Spring Security OAuth2 Boot</a>，这里介绍了：授权服务器、资源服务器、客户端、单点登录等</p>
<h2 id="spring-boot-reference">Spring Boot Reference</h2>
<p><a href="https://docs.spring.io/spring-boot/docs/2.2.4.RELEASE/reference/html/spring-boot-features.html">Spring Boot Reference</a>，内容很多。</p>
<h2 id="apachecommonslogging">apache.commons.logging</h2>
<p><a href="https://commons.apache.org/proper/commons-logging/guide.html">https://commons.apache.org/proper/commons-logging/guide.html</a></p>
<h2 id="maven仓库">Maven仓库</h2>
<p><a href="https://mvnrepository.com/">Maven仓库</a>，根据名字搜索依赖包，可以得到版本pom等信息。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>我的博客支持服务</title>
                <link>https://wss.cool/%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%94%AF%E6%8C%81%E6%9C%8D%E5%8A%A1.html</link>
                <guid isPermaLink="true">https://wss.cool/%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%94%AF%E6%8C%81%E6%9C%8D%E5%8A%A1.html</guid>
                <pubDate>Wed, 29 Jan 2020 17:20:32 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h1 id="背景需求">背景需求</h1>
<p>我的博客是使用Hugo开发的，代码存放在Gitee上，每次写来新的东西后<code>git push</code>上去，然后到服务器上<code>git pull &amp;&amp; hugo</code>来更新。</p>
<p>这里会有一个需求——通过程序来执行这个更新代码并编译的操作。Gitee有WebHook功能，我需要开发一个接口绑定到WebHook，接口内执行更新操作即可。</p>
<h1 id="设计思路">设计思路</h1>
<h2 id="需求1过滤非法请求">需求1.过滤非法请求</h2>
<p>WebHook会发起一个Post请求，在Request Header中通过<code>X-Gitee-Token</code>携带令牌。所以需要一个Interceptor过滤掉没有带有这个Header的请求。</p>
<h2 id="需求2通过java执行shell命令">需求2.通过Java执行Shell命令</h2>
<p>原来是手动在命令行执行<code>git pull &amp;&amp; hugo</code>。现在需要在Java程序中执行Shell命令，所以需要一个工具来做这个事，<code>Apache Commons Exec</code>是一个这样的库。<a href="https://wowfriday.cn/java%E6%89%A7%E8%A1%8Cshell%E5%91%BD%E4%BB%A4.html">这里有一个简单的例子</a>。</p>
<h1 id="技术方案">技术方案</h1>
<ul>
<li><code>Spring Boot</code>创建项目</li>
<li><code>Spring Web</code>提供Web接口</li>
<li><code>Apache Commons Exec</code>提供执行shell命令的能力。<a href="https://commons.apache.org/proper/commons-exec/">exec官网</a>，<a href="https://commons.apache.org/proper/commons-exec/apidocs/index.html">API文档</a></li>
</ul>
<h1 id="流程图">流程图</h1>
<p><img src="/images/blogServer.svg" alt="流程图"></p>
<p>这其中有两个点是我没有做过的，一个是拦截器（检查是否带有X-Gitee-Token的），一个是执行shell命令。</p>
<h1 id="代码实现">代码实现</h1>
<h2 id="拦截器">拦截器</h2>
<p>找到了<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-handlermapping-interceptor">Spring Web MVC的文档</a>，分两步，一是实现<code>org.springframework.web.servlet</code>的<code>HandlerInterceptor</code>拦截器接口，二是配置拦截器。</p>
<h3 id="实现拦截器">实现拦截器</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GiteeInterceptorAdapter</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">){</span>
        <span class="c1">// ...
</span><span class="c1"></span>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="配置拦截器">配置拦截器</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MvcConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="n">GiteeInterceptorAdapter</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="执行shell命令">执行shell命令</h2>
<p>我把这部分单独写了一篇博客——<a href="https://wowfriday.cn/java%E6%89%A7%E8%A1%8Cshell%E5%91%BD%E4%BB%A4.html">《Java执行Shell命令》</a>。</p>
<h1 id="部署">部署</h1>
<ol>
<li>打包——使用maven的package打包</li>
<li>上传到服务器——maven的deploy用不好，需要花些时间学习一下。暂时使用scp命令上传。</li>
<li>运行Jar包——使用systemd运行，参考这篇博客<a href="https://wowfriday.cn/posts/linux-base/#%E4%BD%BF%E7%94%A8systemd%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%ADjava%E7%A8%8B%E5%BA%8F">《使用systemd启动关闭Java程序》</a>。</li>
</ol>
<h1 id="收获">收获</h1>
<ol>
<li>把一个手动工作实现了自动化。</li>
<li>通过查看<code>Spring Web MVC</code>的文档，找到并实现了拦截器的代码。</li>
<li>发现了一个工具库，通过查看它的文档，将它运用了起来。</li>
<li>第一次接触<code>OutputStream</code>和<code>ByteArrayOutputStream</code>。</li>
<li>Jar包的部署❗️</li>
</ol>
<h1 id="总结">总结</h1>
<p>从这个服务的实现可以提炼出一种解决问题的方法吗？</p>
<ul>
<li>首先是确定目标，也就是需求——自动化。</li>
<li>然后思考如何实现它——WebHook + 自己实现服务端功能——确定一个方案。</li>
<li>设计流程。</li>
<li>功能点和技术难题。</li>
<li>解决技术难题——查文档/google/stackoverflow等。</li>
<li>整个过程需要大量思考，需要多写，落实到纸上，以免遗忘和疏漏。</li>
<li>尤其是对流程的思考。</li>
<li>尤其是对难题的记录。</li>
<li>完成后</li>
<li>要总结学习到的知识点，计作“收获”</li>
<li>要总结提炼方法，使其能沉淀为经验，计作“总结”</li>
<li>更新技能树</li>
</ul>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%8A%98%E8%85%BE/">折腾</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Spring Security JWT</title>
                <link>https://wss.cool/spring-security-jwt.html</link>
                <guid isPermaLink="true">https://wss.cool/spring-security-jwt.html</guid>
                <pubDate>Sun, 19 Jan 2020 13:51:29 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h1 id="spring-security-architecture">Spring Security Architecture</h1>
<p>Spring Security 架构，入门介绍：<a href="https://spring.io/guides/topicals/spring-security-architecture/">网址</a></p>
<h2 id="authentication-and-access-control">Authentication and Access Control</h2>
<p>应用程序安全性归结为或多或少的两个独立问题：身份验证（您是谁？）和授权（您可以做什么？）。有时人们会说“访问控制”而不是“授权”，这可能会造成混淆，但是以这种方式思考可能会有所帮助，因为“授权”在其他地方超载。 Spring Security的体系结构旨在将身份验证与授权分开，并具有策略和扩展点。</p>
<h3 id="authentication">Authentication</h3>
<p>身份验证的主要策略接口是AuthenticationManager，它只有一种方法：</p>
<hr>
<h1 id="oauth-20-resource-server"> OAuth 2.0 Resource Server</h1>
<p>Spring Security supports protecting endpoints using two forms of OAuth 2.0 <a href="https://tools.ietf.org/html/rfc6750.html">Bearer Tokens</a>:</p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc7519">JWT</a></li>
<li>Opaque Tokens</li>
</ul>
<p>This is handy in circumstances where an application has delegated its authority management to an <a href="https://tools.ietf.org/html/rfc6749">authorization server</a> (for example, Okta or Ping Identity). This authorization server can be consulted by resource servers to authorize requests.</p>
<blockquote>
<p>Working samples for both <a href="https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2resourceserver">JWTs</a> and <a href="https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2resourceserver-opaque">Opaque Tokens</a> are available in the <a href="https://github.com/spring-projects/spring-security/tree/master/samples">Spring Security repository</a>.</p>
</blockquote>
<h2 id="1dependencies">1 Dependencies</h2>
<p>Most Resource Server support is collected into <code>spring-security-oauth2-resource-server</code>. However, the support for decoding and verifying JWTs is in <code>spring-security-oauth2-jose</code>, meaning that both are necessary in order to have a working resource server that supports JWT-encoded Bearer Tokens.</p>
<h2 id="2minimal-configuration-for-jwts">2 Minimal Configuration for JWTs</h2>
<p>When using <a href="https://spring.io/projects/spring-boot">Spring Boot</a>, configuring an application as a resource server consists of two basic steps. First, include the needed dependencies and second, indicate the location of the authorization server.</p>
<h3 id="specifying-the-authorization-server">Specifying the Authorization Server</h3>
<p>In a Spring Boot application, to specify which authorization server to use, simply do:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">resourceserver</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">jwt</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">issuer-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.com/issuer<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Where <a href="https://idp.example.com/issuer"><code>https://idp.example.com/issuer</code></a> is the value contained in the <code>iss</code> claim for JWT tokens that the authorization server will issue. Resource Server will use this property to further self-configure, discover the authorization server’s public keys, and subsequently validate incoming JWTs.</p>
<blockquote>
<p>To use the <code>issuer-uri</code> property, it must also be true that one of <code>https://idp.example.com/issuer/.well-known/openid-configuration</code>, <code>https://idp.example.com/.well-known/openid-configuration/issuer</code>, or <code>https://idp.example.com/.well-known/oauth-authorization-server/issuer</code> is a supported endpoint for the authorization server. This endpoint is referred to as a <a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfig">Provider Configuration</a> endpoint or a <a href="https://tools.ietf.org/html/rfc8414#section-3">Authorization Server Metadata</a> endpoint.</p>
</blockquote>
<p>And that’s it!</p>
<h3 id="startup-expectations">Startup Expectations</h3>
<p>When this property and these dependencies are used, Resource Server will automatically configure itself to validate JWT-encoded Bearer Tokens. It achieves this through a deterministic startup process:</p>
<ol>
<li>Hit the Provider Configuration or Authorization Server Metadata endpoint, processing the response for the <code>jwks_url</code> property</li>
<li>Configure the validation strategy to query <code>jwks_url</code> for valid public keys</li>
<li>Configure the validation strategy to validate each JWTs <code>iss</code> claim against <a href="https://idp.example.com"><code>https://idp.example.com</code></a>.</li>
</ol>
<p>A consequence of this process is that the authorization server must be up and receiving requests in order for Resource Server to successfully start up.</p>
<blockquote>
<p>If the authorization server is down when Resource Server queries it (given appropriate timeouts), then startup will fail.</p>
</blockquote>
<h3 id="runtime-expectations">Runtime Expectations</h3>
<p>Once the application is started up, Resource Server will attempt to process any request containing an <code>Authorization: Bearer</code> header:</p>
<pre><code>GET / HTTP/1.1
Authorization: Bearer some-token-value # Resource Server will process this
</code></pre><p>So long as this scheme is indicated, Resource Server will attempt to process the request according to the Bearer Token specification. Given a well-formed JWT, Resource Server will:</p>
<ol>
<li>Validate its signature against a public key obtained from the <code>jwks_url</code> endpoint during startup and matched against the JWTs header</li>
<li>Validate the JWTs <code>exp</code> and <code>nbf</code> timestamps and the JWTs <code>iss</code> claim, and</li>
<li>Map each scope to an authority with the prefix <code>SCOPE_</code>.</li>
</ol>
<blockquote>
<p>As the authorization server makes available new keys, Spring Security will automatically rotate the keys used to validate the JWT tokens.</p>
</blockquote>
<p>The resulting <code>Authentication#getPrincipal</code>, by default, is a Spring Security <code>Jwt</code> object, and <code>Authentication#getName</code> maps to the JWT’s <code>sub</code> property, if one is present. From here, consider jumping to:</p>
<ul>
<li><a href="#oauth2resourceserver-jwt-jwkseturi" title="12.3.3 Specifying the Authorization Server JWK Set Uri Directly">How to Configure without Tying Resource Server startup to an authorization server’s availability</a></li>
<li><a href="#oauth2resourceserver-jwt-sansboot" title="12.3.4 Overriding or Replacing Boot Auto Configuration">How to Configure without Spring Boot</a></li>
</ul>
<h2 id="3specifying-the-authorization-server-jwk-set-uri-directly">3 Specifying the Authorization Server JWK Set Uri Directly</h2>
<p>If the authorization server doesn’t support any configuration endpoints, or if Resource Server must be able to start up independently from the authorization server, then the <code>jwk-set-uri</code> can be supplied as well:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">resourceserver</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">jwt</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">issuer-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.com<span class="w">
</span><span class="w"> </span><span class="k">jwk-set-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.com/.well-known/jwks.json<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>The JWK Set uri is not standardized, but can typically be found in the authorization server’s documentation</p>
</blockquote>
<p>Consequently, Resource Server will not ping the authorization server at startup. We still specify the <code>issuer-uri</code> so that Resource Server still validates the <code>iss</code> claim on incoming JWTs.</p>
<blockquote>
<p>This property can also be supplied directly on the <a href="#oauth2resourceserver-jwt-jwkseturi-dsl" title="Using jwkSetUri()">DSL</a>.</p>
</blockquote>
<h2 id="4overriding-or-replacing-boot-auto-configuration">4 Overriding or Replacing Boot Auto Configuration</h2>
<p>There are two <code>@Bean</code> s that Spring Boot generates on Resource Server’s behalf. The first is a <code>WebSecurityConfigurerAdapter</code> that configures the app as a resource server. When including <code>spring-security-oauth2-jose</code>, this <code>WebSecurityConfigurerAdapter</code> looks like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">http</span>
        <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
            <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
            <span class="o">.</span><span class="na">and</span><span class="o">()</span>
        <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">(</span><span class="n">OAuth2ResourceServerConfigurer</span><span class="o">::</span><span class="n">jwt</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If the application doesn’t expose a <code>WebSecurityConfigurerAdapter</code> bean, then Spring Boot will expose the above default one. Replacing this is as simple as exposing the bean within the application:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCustomSecurityConfiguration</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/messages/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_message:read&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">jwt</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">jwtAuthenticationConverter</span><span class="o">(</span><span class="n">myConverter</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above requires the scope of <code>message:read</code> for any URL that starts with <code>/messages/</code>. Methods on the <code>oauth2ResourceServer</code> DSL will also override or replace auto configuration. For example, the second <code>@Bean</code> Spring Boot creates is a <code>JwtDecoder</code>, which decodes <code>String</code> tokens into validated instances of <code>Jwt</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">JwtDecoders</span><span class="o">.</span><span class="na">fromIssuerLocation</span><span class="o">(</span><span class="n">issuerUri</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Calling <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/oauth2/jwt/JwtDecoders.html#fromIssuerLocation-java.lang.String-"><code>JwtDecoders#fromIssuerLocation</code></a> is what invokes the Provider Configuration or Authorization Server Metadata endpoint in order to derive the JWK Set Uri.</p>
</blockquote>
<p>If the application doesn’t expose a <code>JwtDecoder</code> bean, then Spring Boot will expose the above default one. And its configuration can be overridden using <code>jwkSetUri()</code> or replaced using <code>decoder()</code>.</p>
<h3 id="using-jwkseturi">Using <code>jwkSetUri()</code></h3>
<p>An authorization server’s JWK Set Uri can be configured <a href="#oauth2resourceserver-jwt-jwkseturi" title="12.3.3 Specifying the Authorization Server JWK Set Uri Directly">as a configuration property</a> or it can be supplied in the DSL:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredJwkSetUri</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">jwt</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">jwkSetUri</span><span class="o">(</span><span class="s">&#34;https://idp.example.com/.well-known/jwks.json&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Using <code>jwkSetUri()</code> takes precedence over any configuration property.</p>
<h3 id="using-decoder">Using <code>decoder()</code></h3>
<p>More powerful than <code>jwkSetUri()</code> is <code>decoder()</code>, which will completely replace any Boot auto configuration of <code>JwtDecoder</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredJwtDecoder</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">jwt</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">decoder</span><span class="o">(</span><span class="n">myCustomDecoder</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This is handy when deeper configuration, like <a href="#oauth2resourceserver-jwt-validation" title="12.3.9 Configuring Validation">validation</a>, <a href="#oauth2resourceserver-jwt-claimsetmapping" title="12.3.10 Configuring Claim Set Mapping">mapping</a>, or <a href="#oauth2resourceserver-jwt-timeouts" title="12.3.11 Configuring Timeouts">request timeouts</a>, is necessary.</p>
<h3 id="exposing-a-jwtdecoder-bean">Exposing a <code>JwtDecoder</code> <code>@Bean</code></h3>
<p>Or, exposing a <code>JwtDecoder</code> <code>@Bean</code> has the same effect as <code>decoder()</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withJwkSetUri</span><span class="o">(</span><span class="n">jwkSetUri</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="5configuring-trusted-algorithms">5 Configuring Trusted Algorithms</h2>
<p>By default, <code>NimbusJwtDecoder</code>, and hence Resource Server, will only trust and verify tokens using <code>RS256</code>. You can customize this via <a href="#oauth2resourceserver-jwt-boot-algorithm" title="Via Spring Boot">Spring Boot</a>, <a href="#oauth2resourceserver-jwt-decoder-builder" title="Using a Builder">the NimbusJwtDecoder builder</a>, or from the <a href="#oauth2resourceserver-jwt-decoder-jwk-response" title="From JWK Set response">JWK Set response</a>.</p>
<h3 id="via-spring-boot">Via Spring Boot</h3>
<p>The simplest way to set the algorithm is as a property:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">resourceserver</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">jwt</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">jws-algorithm</span><span class="p">:</span><span class="w"> </span>RS512<span class="w">
</span><span class="w">          </span><span class="k">jwk-set-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.org/.well-known/jwks.json<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="using-a-builder">Using a Builder</h3>
<p>For greater power, though, we can use a builder that ships with <code>NimbusJwtDecoder</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">fromJwkSetUri</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">jwkSetUri</span><span class="o">)</span>
            <span class="o">.</span><span class="na">jwsAlgorithm</span><span class="o">(</span><span class="n">RS512</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Calling <code>jwsAlgorithm</code> more than once will configure <code>NimbusJwtDecoder</code> to trust more than one algorithm, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">fromJwkSetUri</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">jwkSetUri</span><span class="o">)</span>
            <span class="o">.</span><span class="na">jwsAlgorithm</span><span class="o">(</span><span class="n">RS512</span><span class="o">).</span><span class="na">jwsAlgorithm</span><span class="o">(</span><span class="n">EC512</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Or, you can call <code>jwsAlgorithms</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">fromJwkSetUri</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">jwkSetUri</span><span class="o">)</span>
            <span class="o">.</span><span class="na">jwsAlgorithms</span><span class="o">(</span><span class="n">algorithms</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="n">algorithms</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">RS512</span><span class="o">);</span>
                    <span class="n">algorithms</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">EC512</span><span class="o">);</span>
            <span class="o">}).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="from-jwk-set-response">From JWK Set response</h3>
<p>Since Spring Security’s JWT support is based off of Nimbus, you can use all it’s great features as well. For example, Nimbus has a <code>JWSKeySelector</code> implementation that will select the set of algorithms based on the JWK Set URI response. You can use it to generate a <code>NimbusJwtDecoder</code> like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// makes a request to the JWK Set endpoint
</span><span class="c1"></span>    <span class="n">JWSKeySelector</span> <span class="o">&lt;</span><span class="n">securitycontext</span><span class="o">&gt;</span><span class="n">jwsKeySelector</span> <span class="o">=</span>
            <span class="n">JWSAlgorithmFamilyJWSKeySelector</span><span class="o">.</span><span class="na">fromJWKSetURL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">jwkSetUrl</span><span class="o">);</span>

    <span class="n">DefaultJWTProcessor</span> <span class="o">&lt;</span><span class="n">securitycontext</span><span class="o">&gt;</span><span class="n">jwtProcessor</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">DefaultJWTProcessor</span><span class="o">&lt;&gt;();</span>
    <span class="n">jwtProcessor</span><span class="o">.</span><span class="na">setJWSKeySelector</span><span class="o">(</span><span class="n">jwsKeySelector</span><span class="o">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">NimbusJwtDecoder</span><span class="o">(</span><span class="n">jwtProcessor</span><span class="o">);</span>
<span class="o">}&lt;/</span><span class="n">securitycontext</span><span class="o">&gt;&lt;/</span><span class="n">securitycontext</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="6trusting-a-single-asymmetric-key">6 Trusting a Single Asymmetric Key</h2>
<p>Simpler than backing a Resource Server with a JWK Set endpoint is to hard-code an RSA public key. The public key can be provided via <a href="#oauth2resourceserver-jwt-decoder-public-key-boot" title="Via Spring Boot">Spring Boot</a> or by <a href="#oauth2resourceserver-jwt-decoder-public-key-builder" title="Using a Builder">Using a Builder</a>.</p>
<h3 id="via-spring-boot-1">Via Spring Boot</h3>
<p>Specifying a key via Spring Boot is quite simple. The key’s location can be specified like so:</p>
<pre><code>spring:
 security:
 oauth2:
 resourceserver:
 jwt:
 public-key-location: classpath:my-key.pub
</code></pre><p>Or, to allow for a more sophisticated lookup, you can post-process the <code>RsaKeyConversionServicePostProcessor</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">BeanFactoryPostProcessor</span> <span class="nf">conversionServiceCustomizer</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">beanFactory</span> <span class="o">-&gt;</span>
        <span class="n">beanFactory</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">RsaKeyConversionServicePostProcessor</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setResourceLoader</span><span class="o">(</span><span class="k">new</span> <span class="n">CustomResourceLoader</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Specify your key’s location:</p>
<pre><code>key.location: hfds://my-key.pub
</code></pre><p>And then autowire the value:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${key.location}&#34;</span><span class="o">)</span>
<span class="n">RSAPublicKey</span> <span class="n">key</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="using-a-builder-1">Using a Builder</h3>
<p>To wire an <code>RSAPublicKey</code> directly, you can simply use the appropriate <code>NimbusJwtDecoder</code> builder, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withPublicKey</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">key</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="7trusting-a-single-symmetric-key">7 Trusting a Single Symmetric Key</h2>
<p>Using a single symmetric key is also simple. You can simply load in your <code>SecretKey</code> and use the appropriate <code>NimbusJwtDecoder</code> builder, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withSecretKey</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">key</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="8configuring-authorization">8 Configuring Authorization</h2>
<p>A JWT that is issued from an OAuth 2.0 Authorization Server will typically either have a <code>scope</code> or <code>scp</code> attribute, indicating the scopes (or authorities) it’s been granted, for example: <code>{ …​, &quot;scope&quot; : &quot;messages contacts&quot;}</code> When this is the case, Resource Server will attempt to coerce these scopes into a list of granted authorities, prefixing each scope with the string &quot;SCOPE_&quot;. This means that to protect an endpoint or method with a scope derived from a JWT, the corresponding expressions should include this prefix:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredJwkSetUri</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">(</span><span class="n">authorizeRequests</span> <span class="o">-&gt;</span> <span class="n">authorizeRequests</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/contacts/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_contacts&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/messages/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_messages&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
            <span class="o">)</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">(</span><span class="n">OAuth2ResourceServerConfigurer</span><span class="o">::</span><span class="n">jwt</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Or similarly with method security:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&#34;hasAuthority(&#39;SCOPE_messages&#39;)&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">List</span> <span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span><span class="n">getMessages</span><span class="o">(...)</span> <span class="o">{}&lt;/</span><span class="n">message</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="extracting-authorities-manually">Extracting Authorities Manually</h3>
<p>However, there are a number of circumstances where this default is insufficient. For example, some authorization servers don’t use the <code>scope</code> attribute, but instead have their own custom attribute. Or, at other times, the resource server may need to adapt the attribute or a composition of attributes into internalized authorities. To this end, the DSL exposes <code>jwtAuthenticationConverter()</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredJwkSetUri</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">jwt</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">jwtAuthenticationConverter</span><span class="o">(</span><span class="n">grantedAuthoritiesExtractor</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">Converter</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">,</span> <span class="n">AbstractAuthenticationToken</span><span class="o">&gt;</span> <span class="nf">grantedAuthoritiesExtractor</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">JwtAuthenticationConverter</span> <span class="n">jwtAuthenticationConverter</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">JwtAuthenticationConverter</span><span class="o">();</span>
    <span class="n">jwtAuthenticationConverter</span><span class="o">.</span><span class="na">setJwtGrantedAuthoritiesConverter</span>
            <span class="o">(</span><span class="k">new</span> <span class="n">GrantedAuthoritiesExtractor</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">jwtAuthenticationConveter</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>which is responsible for converting a <code>Jwt</code> into an <code>Authentication</code>. As part of its configuration, we can supply a subsidiary converter to go from <code>Jwt</code> to a <code>Collection</code> of granted authorities. That final converter might be something like <code>GrantedAuthoritiesExtractor</code> below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="kd">class</span> <span class="nc">GrantedAuthoritiesExtractor</span>
        <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">convert</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">jwt</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span>
                <span class="n">jwt</span><span class="o">.</span><span class="na">getClaims</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;mycustomclaim&#34;</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">authorities</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">SimpleGrantedAuthority</span><span class="o">::</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>For more flexibility, the DSL supports entirely replacing the converter with any class that implements <code>Converter&lt;jwt, abstractauthenticationtoken=&quot;&quot;&gt;</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomAuthenticationConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">,</span> <span class="n">AbstractAuthenticationToken</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">AbstractAuthenticationToken</span> <span class="nf">convert</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">jwt</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">CustomAuthenticationToken</span><span class="o">(</span><span class="n">jwt</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="9configuring-validation">9 Configuring Validation</h2>
<p>Using <a href="#oauth2resourceserver-jwt-minimalconfiguration" title="12.3.2 Minimal Configuration for JWTs">minimal Spring Boot configuration</a>, indicating the authorization server’s issuer uri, Resource Server will default to verifying the <code>iss</code> claim as well as the <code>exp</code> and <code>nbf</code> timestamp claims. In circumstances where validation needs to be customized, Resource Server ships with two standard validators and also accepts custom <code>OAuth2TokenValidator</code> instances.</p>
<h3 id="customizing-timestamp-validation">Customizing Timestamp Validation</h3>
<p>JWT’s typically have a window of validity, with the start of the window indicated in the <code>nbf</code> claim and the end indicated in the <code>exp</code> claim. However, every server can experience clock drift, which can cause tokens to appear expired to one server, but not to another. This can cause some implementation heartburn as the number of collaborating servers increases in a distributed system. Resource Server uses <code>JwtTimestampValidator</code> to verify a token’s validity window, and it can be configured with a <code>clockSkew</code> to alleviate the above problem:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
     <span class="n">NimbusJwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="o">(</span><span class="n">NimbusJwtDecoder</span><span class="o">)</span>
             <span class="n">JwtDecoders</span><span class="o">.</span><span class="na">fromIssuerLocation</span><span class="o">(</span><span class="n">issuerUri</span><span class="o">);</span>

     <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">withClockSkew</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DelegatingOAuth2TokenValidator</span><span class="o">&lt;&gt;(</span>
            <span class="k">new</span> <span class="n">JwtTimestampValidator</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="n">60</span><span class="o">)),</span>
            <span class="k">new</span> <span class="n">IssuerValidator</span><span class="o">(</span><span class="n">issuerUri</span><span class="o">));</span>

     <span class="n">jwtDecoder</span><span class="o">.</span><span class="na">setJwtValidator</span><span class="o">(</span><span class="n">withClockSkew</span><span class="o">);</span>

     <span class="k">return</span> <span class="n">jwtDecoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>By default, Resource Server configures a clock skew of 30 seconds.</p>
</blockquote>
<h3 id="configuring-a-custom-validator">Configuring a Custom Validator</h3>
<p>Adding a check for the <code>aud</code> claim is simple with the <code>OAuth2TokenValidator</code> API:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AudienceValidator</span> <span class="kd">implements</span> <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">OAuth2Error</span> <span class="n">error</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OAuth2Error</span><span class="o">(</span><span class="s">&#34;invalid_token&#34;</span><span class="o">,</span> <span class="s">&#34;The required audience is missing&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">OAuth2TokenValidatorResult</span> <span class="nf">validate</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">jwt</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">jwt</span><span class="o">.</span><span class="na">getAudience</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;messaging&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">OAuth2TokenValidatorResult</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">OAuth2TokenValidatorResult</span><span class="o">.</span><span class="na">failure</span><span class="o">(</span><span class="n">error</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then, to add into a resource server, it’s a matter of specifying the <code>JwtDecoder</code> instance:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">NimbusJwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="o">(</span><span class="n">NimbusJwtDecoder</span><span class="o">)</span>
        <span class="n">JwtDecoders</span><span class="o">.</span><span class="na">fromIssuerLocation</span><span class="o">(</span><span class="n">issuerUri</span><span class="o">);</span>

    <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">audienceValidator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AudienceValidator</span><span class="o">();</span>
    <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">withIssuer</span> <span class="o">=</span> <span class="n">JwtValidators</span><span class="o">.</span><span class="na">createDefaultWithIssuer</span><span class="o">(</span><span class="n">issuerUri</span><span class="o">);</span>
    <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">withAudience</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DelegatingOAuth2TokenValidator</span><span class="o">&lt;&gt;(</span><span class="n">withIssuer</span><span class="o">,</span> <span class="n">audienceValidator</span><span class="o">);</span>

    <span class="n">jwtDecoder</span><span class="o">.</span><span class="na">setJwtValidator</span><span class="o">(</span><span class="n">withAudience</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">jwtDecoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="10configuring-claim-set-mapping">10 Configuring Claim Set Mapping</h2>
<p>Spring Security uses the <a href="https://bitbucket.org/connect2id/nimbus-jose-jwt/wiki/Home">Nimbus</a> library for parsing JWTs and validating their signatures. Consequently, Spring Security is subject to Nimbus’s interpretation of each field value and how to coerce each into a Java type. For example, because Nimbus remains Java 7 compatible, it doesn’t use <code>Instant</code> to represent timestamp fields. And it’s entirely possible to use a different library or for JWT processing, which may make its own coercion decisions that need adjustment. Or, quite simply, a resource server may want to add or remove claims from a JWT for domain-specific reasons. For these purposes, Resource Server supports mapping the JWT claim set with <code>MappedJwtClaimSetConverter</code>.</p>
<h3 id="customizing-the-conversion-of-a-single-claim">Customizing the Conversion of a Single Claim</h3>
<p>By default, <code>MappedJwtClaimSetConverter</code> will attempt to coerce claims into the following types:</p>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Java Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aud</code></td>
<td><code>Collection</code></td>
</tr>
<tr>
<td><code>exp</code></td>
<td><code>Instant</code></td>
</tr>
<tr>
<td><code>iat</code></td>
<td><code>Instant</code></td>
</tr>
<tr>
<td><code>iss</code></td>
<td><code>String</code></td>
</tr>
<tr>
<td><code>jti</code></td>
<td><code>String</code></td>
</tr>
<tr>
<td><code>nbf</code></td>
<td><code>Instant</code></td>
</tr>
<tr>
<td><code>sub</code></td>
<td><code>String</code></td>
</tr>
</tbody>
</table>
<p>An individual claim’s conversion strategy can be configured using <code>MappedJwtClaimSetConverter.withDefaults</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">NimbusJwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withJwkSetUri</span><span class="o">(</span><span class="n">jwkSetUri</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MappedJwtClaimSetConverter</span> <span class="n">converter</span> <span class="o">=</span> <span class="n">MappedJwtClaimSetConverter</span>
            <span class="o">.</span><span class="na">withDefaults</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">&#34;sub&#34;</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">lookupUserIdBySub</span><span class="o">));</span>
    <span class="n">jwtDecoder</span><span class="o">.</span><span class="na">setClaimSetConverter</span><span class="o">(</span><span class="n">converter</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">jwtDecoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This will keep all the defaults, except it will override the default claim converter for <code>sub</code>.</p>
<h3 id="adding-a-claim">Adding a Claim</h3>
<p><code>MappedJwtClaimSetConverter</code> can also be used to add a custom claim, for example, to adapt to an existing system:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">MappedJwtClaimSetConverter</span><span class="o">.</span><span class="na">withDefaults</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">&#34;custom&#34;</span><span class="o">,</span> <span class="n">custom</span> <span class="o">-&gt;</span> <span class="s">&#34;value&#34;</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="removing-a-claim">Removing a Claim</h3>
<p>And removing a claim is also simple, using the same API:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">MappedJwtClaimSetConverter</span><span class="o">.</span><span class="na">withDefaults</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">&#34;legacyclaim&#34;</span><span class="o">,</span> <span class="n">legacy</span> <span class="o">-&gt;</span> <span class="kc">null</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="renaming-a-claim">Renaming a Claim</h3>
<p>In more sophisticated scenarios, like consulting multiple claims at once or renaming a claim, Resource Server accepts any class that implements <code>Converter&lt;map&lt;string, object=&quot;&quot;&gt;, Map&lt;string,object&gt;&gt;</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsernameSubClaimAdapter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MappedJwtClaimSetConverter</span> <span class="n">delegate</span> <span class="o">=</span>
            <span class="n">MappedJwtClaimSetConverter</span><span class="o">.</span><span class="na">withDefaults</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">emptyMap</span><span class="o">());</span>

    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">convert</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">claims</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">convertedClaims</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">delegate</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="n">claims</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">convertedClaims</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;user_name&#34;</span><span class="o">);</span>
        <span class="n">convertedClaims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;sub&#34;</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">convertedClaims</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>And then, the instance can be supplied like normal:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">NimbusJwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withJwkSetUri</span><span class="o">(</span><span class="n">jwkSetUri</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="n">jwtDecoder</span><span class="o">.</span><span class="na">setClaimSetConverter</span><span class="o">(</span><span class="k">new</span> <span class="n">UsernameSubClaimAdapter</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">jwtDecoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="11configuring-timeouts">11 Configuring Timeouts</h2>
<p>By default, Resource Server uses connection and socket timeouts of 30 seconds each for coordinating with the authorization server. This may be too short in some scenarios. Further, it doesn’t take into account more sophisticated patterns like back-off and discovery. To adjust the way in which Resource Server connects to the authorization server, <code>NimbusJwtDecoder</code> accepts an instance of <code>RestOperations</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">(</span><span class="n">RestTemplateBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">RestOperations</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">builder</span>
            <span class="o">.</span><span class="na">setConnectionTimeout</span><span class="o">(</span><span class="n">60000</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setReadTimeout</span><span class="o">(</span><span class="n">60000</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">NimbusJwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withJwkSetUri</span><span class="o">(</span><span class="n">jwkSetUri</span><span class="o">).</span><span class="na">restOperations</span><span class="o">(</span><span class="n">rest</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">jwtDecoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="12minimal-configuration-for-introspection">12 Minimal Configuration for Introspection</h2>
<p>Typically, an opaque token can be verified via an <a href="https://tools.ietf.org/html/rfc7662">OAuth 2.0 Introspection Endpoint</a>, hosted by the authorization server. This can be handy when revocation is a requirement. When using <a href="https://spring.io/projects/spring-boot">Spring Boot</a>, configuring an application as a resource server that uses introspection consists of two basic steps. First, include the needed dependencies and second, indicate the introspection endpoint details.</p>
<h3 id="specifying-the-authorization-server-1">Specifying the Authorization Server</h3>
<p>To specify where the introspection endpoint is, simply do:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">resourceserver</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">opaque-token</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">introspection-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.com/introspect<span class="w">
</span><span class="w"> </span><span class="k">client-id</span><span class="p">:</span><span class="w"> </span>client<span class="w">
</span><span class="w"> </span><span class="k">client-secret</span><span class="p">:</span><span class="w"> </span>secret<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Where <a href="https://idp.example.com/introspect"><code>https://idp.example.com/introspect</code></a> is the introspection endpoint hosted by your authorization server and <code>client-id</code> and <code>client-secret</code> are the credentials needed to hit that endpoint. Resource Server will use these properties to further self-configure and subsequently validate incoming JWTs.</p>
<blockquote>
<p>When using introspection, the authorization server’s word is the law. If the authorization server responses that the token is valid, then it is.</p>
</blockquote>
<p>And that’s it!</p>
<h3 id="startup-expectations-1">Startup Expectations</h3>
<p>When this property and these dependencies are used, Resource Server will automatically configure itself to validate Opaque Bearer Tokens. This startup process is quite a bit simpler than for JWTs since no endpoints need to be discovered and no additional validation rules get added.</p>
<h3 id="runtime-expectations-1">Runtime Expectations</h3>
<p>Once the application is started up, Resource Server will attempt to process any request containing an <code>Authorization: Bearer</code> header:</p>
<pre><code>GET / HTTP/1.1
Authorization: Bearer some-token-value # Resource Server will process this
</code></pre><p>So long as this scheme is indicated, Resource Server will attempt to process the request according to the Bearer Token specification. Given an Opaque Token, Resource Server will</p>
<ol>
<li>Query the provided introspection endpoint using the provided credentials and the token</li>
<li>Inspect the response for an <code>{ 'active' : true }</code> attribute</li>
<li>Map each scope to an authority with the prefix <code>SCOPE_</code></li>
</ol>
<p>The resulting <code>Authentication#getPrincipal</code>, by default, is a Spring Security <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/oauth2/core/OAuth2AuthenticatedPrincipal.html"><code>OAuth2AuthenticatedPrincipal</code></a> object, and <code>Authentication#getName</code> maps to the token’s <code>sub</code> property, if one is present. From here, you may want to jump to:</p>
<ul>
<li><a href="#oauth2resourceserver-opaque-attributes" title="12.3.13 Looking Up Attributes Post-Authentication">Looking Up Attributes Post-Authentication</a></li>
<li><a href="#oauth2resourceserver-opaque-authorization-extraction" title="Extracting Authorities Manually">Extracting Authorities Manually</a></li>
<li><a href="#oauth2resourceserver-opaque-jwt-introspector" title="12.3.17 Using Introspection with JWTs">Using Introspection with JWTs</a></li>
</ul>
<h2 id="13looking-up-attributes-post-authentication">13 Looking Up Attributes Post-Authentication</h2>
<p>Once a token is authenticated, an instance of <code>BearerTokenAuthentication</code> is set in the <code>SecurityContext</code>. This means that it’s available in <code>@Controller</code> methods when using <code>@EnableWebMvc</code> in your configuration:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/foo&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">foo</span><span class="o">(</span><span class="n">BearerTokenAuthentication</span> <span class="n">authentication</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getTokenAttributes</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;sub&#34;</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34; is the subject&#34;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Since <code>BearerTokenAuthentication</code> holds an <code>OAuth2AuthenticatedPrincipal</code>, that also means that it’s available to controller methods, too:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/foo&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">foo</span><span class="o">(</span><span class="nd">@AuthenticationPrincipal</span> <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">principal</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">principal</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;sub&#34;</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34; is the subject&#34;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="looking-up-attributes-via-spel">Looking Up Attributes Via SpEL</h3>
<p>Of course, this also means that attributes can be accessed via SpEL. For example, if using <code>@EnableGlobalMethodSecurity</code> so that you can use <code>@PreAuthorize</code> annotations, you can do:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&#34;principal?.attributes[&#39;sub&#39;] == &#39;foo&#39;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">forFoosEyesOnly</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;foo&#34;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="14overriding-or-replacing-boot-auto-configuration">14 Overriding or Replacing Boot Auto Configuration</h2>
<p>There are two <code>@Bean</code> s that Spring Boot generates on Resource Server’s behalf. The first is a <code>WebSecurityConfigurerAdapter</code> that configures the app as a resource server. When use Opaque Token, this <code>WebSecurityConfigurerAdapter</code> looks like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">http</span>
        <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
            <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
            <span class="o">.</span><span class="na">and</span><span class="o">()</span>
        <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">(</span><span class="n">OAuth2ResourceServerConfigurer</span><span class="o">::</span><span class="n">opaqueToken</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If the application doesn’t expose a <code>WebSecurityConfigurerAdapter</code> bean, then Spring Boot will expose the above default one. Replacing this is as simple as exposing the bean within the application:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCustomSecurityConfiguration</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/messages/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_message:read&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">opaqueToken</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">introspector</span><span class="o">(</span><span class="n">myIntrospector</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above requires the scope of <code>message:read</code> for any URL that starts with <code>/messages/</code>. Methods on the <code>oauth2ResourceServer</code> DSL will also override or replace auto configuration. For example, the second <code>@Bean</code> Spring Boot creates is an <code>OpaqueTokenIntrospector</code>, which decodes <code>String</code> tokens into validated instances of <code>OAuth2AuthenticatedPrincipal</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="n">introspectionUri</span><span class="o">,</span> <span class="n">clientId</span><span class="o">,</span> <span class="n">clientSecret</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If the application doesn’t expose a <code>OpaqueTokenIntrospector</code> bean, then Spring Boot will expose the above default one. And its configuration can be overridden using <code>introspectionUri()</code> and <code>introspectionClientCredentials()</code> or replaced using <code>introspector()</code>.</p>
<h3 id="using-introspectionuri">Using <code>introspectionUri()</code></h3>
<p>An authorization server’s Introspection Uri can be configured <a href="#">as a configuration property</a> or it can be supplied in the DSL:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredIntrospectionUri</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">opaqueToken</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">introspectionUri</span><span class="o">(</span><span class="s">&#34;https://idp.example.com/introspect&#34;</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">introspectionClientCredentials</span><span class="o">(</span><span class="s">&#34;client&#34;</span><span class="o">,</span> <span class="s">&#34;secret&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Using <code>introspectionUri()</code> takes precedence over any configuration property.</p>
<h3 id="using-introspector">Using <code>introspector()</code></h3>
<p>More powerful than <code>introspectionUri()</code> is <code>introspector()</code>, which will completely replace any Boot auto configuration of <code>OpaqueTokenIntrospector</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredIntrospector</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">opaqueToken</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">introspector</span><span class="o">(</span><span class="n">myCustomIntrospector</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This is handy when deeper configuration, like <a href="#oauth2resourceserver-opaque-authorization-extraction" title="Extracting Authorities Manually">authority mapping</a>, <a href="#oauth2resourceserver-opaque-jwt-introspector" title="12.3.17 Using Introspection with JWTs">JWT revocation</a>, or <a href="#oauth2resourceserver-opaque-timeouts" title="12.3.16 Configuring Timeouts">request timeouts</a>, is necessary.</p>
<h3 id="exposing-a-opaquetokenintrospector-bean">Exposing a <code>OpaqueTokenIntrospector</code> <code>@Bean</code></h3>
<p>Or, exposing a <code>OpaqueTokenIntrospector</code> <code>@Bean</code> has the same effect as <code>introspector()</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="n">introspectionUri</span><span class="o">,</span> <span class="n">clientId</span><span class="o">,</span> <span class="n">clientSecret</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="15configuring-authorization">15 Configuring Authorization</h2>
<p>An OAuth 2.0 Introspection endpoint will typically return a <code>scope</code> attribute, indicating the scopes (or authorities) it’s been granted, for example: <code>{ …​, &quot;scope&quot; : &quot;messages contacts&quot;}</code> When this is the case, Resource Server will attempt to coerce these scopes into a list of granted authorities, prefixing each scope with the string &quot;SCOPE_&quot;. This means that to protect an endpoint or method with a scope derived from an Opaque Token, the corresponding expressions should include this prefix:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MappedAuthorities</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">(</span><span class="n">authorizeRequests</span> <span class="o">-&gt;</span> <span class="n">authorizeRequests</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/contacts/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_contacts&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/messages/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_messages&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
            <span class="o">)</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">(</span><span class="n">OAuth2ResourceServerConfigurer</span><span class="o">::</span><span class="n">opaqueToken</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Or similarly with method security:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&#34;hasAuthority(&#39;SCOPE_messages&#39;)&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="nf">getMessages</span><span class="o">(...)</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="extracting-authorities-manually-1">Extracting Authorities Manually</h3>
<p>By default, Opaque Token support will extract the scope claim from an introspection response and parse it into individual <code>GrantedAuthority</code> instances. For example, if the introspection response were:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;active&#34;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&#34;scope&#34;</span> <span class="p">:</span> <span class="s2">&#34;message:read message:write&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then Resource Server would generate an <code>Authentication</code> with two authorities, one for <code>message:read</code> and the other for <code>message:write</code>. This can, of course, be customized using a custom <code>OpaqueTokenIntrospector</code> that takes a look at the attribute set and converts in its own way:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomAuthoritiesOpaqueTokenIntrospector</span> <span class="kd">implements</span> <span class="n">OpaqueTokenIntrospector</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">OpaqueTokenIntrospector</span> <span class="n">delegate</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="s">&#34;https://idp.example.org/introspect&#34;</span><span class="o">,</span> <span class="s">&#34;client&#34;</span><span class="o">,</span> <span class="s">&#34;secret&#34;</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="nf">introspect</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">principal</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">delegate</span><span class="o">.</span><span class="na">introspect</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">DefaultOAuth2AuthenticatedPrincipal</span><span class="o">(</span>
                <span class="n">principal</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">principal</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">(),</span> <span class="n">extractAuthorities</span><span class="o">(</span><span class="n">principal</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">extractAuthorities</span><span class="o">(</span><span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">principal</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">scopes</span> <span class="o">=</span> <span class="n">principal</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">OAuth2IntrospectionClaimNames</span><span class="o">.</span><span class="na">SCOPE</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">scopes</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">SimpleGrantedAuthority</span><span class="o">::</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Thereafter, this custom introspector can be configured simply by exposing it as a <code>@Bean</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">CustomAuthoritiesOpaqueTokenIntrospector</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="16configuring-timeouts">16 Configuring Timeouts</h2>
<p>By default, Resource Server uses connection and socket timeouts of 30 seconds each for coordinating with the authorization server. This may be too short in some scenarios. Further, it doesn’t take into account more sophisticated patterns like back-off and discovery. To adjust the way in which Resource Server connects to the authorization server, <code>NimbusOpaqueTokenIntrospector</code> accepts an instance of <code>RestOperations</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">(</span><span class="n">RestTemplateBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">RestOperations</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">builder</span>
            <span class="o">.</span><span class="na">basicAuthentication</span><span class="o">(</span><span class="n">clientId</span><span class="o">,</span> <span class="n">clientSecret</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setConnectionTimeout</span><span class="o">(</span><span class="n">60000</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setReadTimeout</span><span class="o">(</span><span class="n">60000</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="n">introspectionUri</span><span class="o">,</span> <span class="n">rest</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="17using-introspection-with-jwts">17 Using Introspection with JWTs</h2>
<p>A common question is whether or not introspection is compatible with JWTs. Spring Security’s Opaque Token support has been designed to not care about the format of the token — it will gladly pass any token to the introspection endpoint provided. So, let’s say that you’ve got a requirement that requires you to check with the authorization server on each request, in case the JWT has been revoked. Even though you are using the JWT format for the token, your validation method is introspection, meaning you’d want to do:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">resourceserver</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">opaque-token</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">introspection-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.org/introspection<span class="w">
</span><span class="w"> </span><span class="k">client-id</span><span class="p">:</span><span class="w"> </span>client<span class="w">
</span><span class="w"> </span><span class="k">client-secret</span><span class="p">:</span><span class="w"> </span>secret<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>In this case, the resulting <code>Authentication</code> would be <code>BearerTokenAuthentication</code>. Any attributes in the corresponding <code>OAuth2AuthenticatedPrincipal</code> would be whatever was returned by the introspection endpoint. But, let’s say that, oddly enough, the introspection endpoint only returns whether or not the token is active. Now what? In this case, you can create a custom <code>OpaqueTokenIntrospector</code> that still hits the endpoint, but then updates the returned principal to have the JWTs claims as the attributes:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtOpaqueTokenIntrospector</span> <span class="kd">implements</span> <span class="n">OpaqueTokenIntrospector</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">OpaqueTokenIntrospector</span> <span class="n">delegate</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="s">&#34;https://idp.example.org/introspect&#34;</span><span class="o">,</span> <span class="s">&#34;client&#34;</span><span class="o">,</span> <span class="s">&#34;secret&#34;</span><span class="o">);</span>
    <span class="kd">private</span> <span class="n">JwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NimbusJwtDecoder</span><span class="o">(</span><span class="k">new</span> <span class="n">ParseOnlyJWTProcessor</span><span class="o">());</span>

    <span class="kd">public</span> <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="nf">introspect</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">principal</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">delegate</span><span class="o">.</span><span class="na">introspect</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Jwt</span> <span class="n">jwt</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">jwtDecoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">DefaultOAuth2AuthenticatedPrincipal</span><span class="o">(</span><span class="n">jwt</span><span class="o">.</span><span class="na">getClaims</span><span class="o">(),</span> <span class="n">NO_AUTHORITIES</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JwtException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">OAuth2IntrospectionException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ParseOnlyJWTProcessor</span> <span class="kd">extends</span> <span class="n">DefaultJWTProcessor</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="n">JWTClaimsSet</span> <span class="nf">process</span><span class="o">(</span><span class="n">SignedJWT</span> <span class="n">jwt</span><span class="o">,</span> <span class="n">SecurityContext</span> <span class="n">context</span><span class="o">)</span>
                <span class="kd">throws</span> <span class="n">JOSEException</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="na">getJWTClaimSet</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Thereafter, this custom introspector can be configured simply by exposing it as a <code>@Bean</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JwtOpaqueTokenIntropsector</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="18calling-a-userinfo-endpoint">18 Calling a <code>/userinfo</code> Endpoint</h2>
<p>Generally speaking, a Resource Server doesn’t care about the underlying user, but instead about the authorities that have been granted. That said, at times it can be valuable to tie the authorization statement back to a user. If an application is also using <code>spring-security-oauth2-client</code>, having set up the appropriate <code>ClientRegistrationRepository</code>, then this is quite simple with a custom <code>OpaqueTokenIntrospector</code>. This implementation below does three things:</p>
<ul>
<li>Delegates to the introspection endpoint, to affirm the token’s validity</li>
<li>Looks up the appropriate client registration associated with the <code>/userinfo</code> endpoint</li>
<li>Invokes and returns the response from the <code>/userinfo</code> endpoint</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserInfoOpaqueTokenIntrospector</span> <span class="kd">implements</span> <span class="n">OpaqueTokenIntrospector</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">OpaqueTokenIntrospector</span> <span class="n">delegate</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="s">&#34;https://idp.example.org/introspect&#34;</span><span class="o">,</span> <span class="s">&#34;client&#34;</span><span class="o">,</span> <span class="s">&#34;secret&#34;</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">OAuth2UserService</span> <span class="n">oauth2UserService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultOAuth2UserService</span><span class="o">();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ClientRegistrationRepository</span> <span class="n">repository</span><span class="o">;</span>

    <span class="c1">// ... constructor
</span><span class="c1"></span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="nf">introspect</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">authorized</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">delegate</span><span class="o">.</span><span class="na">introspect</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
        <span class="n">Instant</span> <span class="n">issuedAt</span> <span class="o">=</span> <span class="n">authorized</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">ISSUED_AT</span><span class="o">);</span>
        <span class="n">Instant</span> <span class="n">expiresAt</span> <span class="o">=</span> <span class="n">authorized</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">EXPIRES_AT</span><span class="o">);</span>
        <span class="n">ClientRegistration</span> <span class="n">clientRegistration</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">repository</span><span class="o">.</span><span class="na">findByRegistrationId</span><span class="o">(</span><span class="s">&#34;registration-id&#34;</span><span class="o">);</span>
        <span class="n">OAuth2AccessToken</span> <span class="n">token</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OAuth2AccessToken</span><span class="o">(</span><span class="n">BEARER</span><span class="o">,</span> <span class="n">token</span><span class="o">,</span> <span class="n">issuedAt</span><span class="o">,</span> <span class="n">expiresAt</span><span class="o">);</span>
        <span class="n">OAuth2UserRequest</span> <span class="n">oauth2UserRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OAuth2UserRequest</span><span class="o">(</span><span class="n">clientRegistration</span><span class="o">,</span> <span class="n">token</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">oauth2UserService</span><span class="o">.</span><span class="na">loadUser</span><span class="o">(</span><span class="n">oauth2UserRequest</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you aren’t using <code>spring-security-oauth2-client</code>, it’s still quite simple. You will simply need to invoke the <code>/userinfo</code> with your own instance of <code>WebClient</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserInfoOpaqueTokenIntrospector</span> <span class="kd">implements</span> <span class="n">OpaqueTokenIntrospector</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">OpaqueTokenIntrospector</span> <span class="n">delegate</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="s">&#34;https://idp.example.org/introspect&#34;</span><span class="o">,</span> <span class="s">&#34;client&#34;</span><span class="o">,</span> <span class="s">&#34;secret&#34;</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">WebClient</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="nf">introspect</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">authorized</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">delegate</span><span class="o">.</span><span class="na">introspect</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">makeUserInfoRequest</span><span class="o">(</span><span class="n">authorized</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Either way, having created your <code>OpaqueTokenIntrospector</code>, you should publish it as a <code>@Bean</code> to override the defaults:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">UserInfoOpaqueTokenIntrospector</span><span class="o">(...);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="19supporting-both-jwt-and-opaque-token">19 Supporting both JWT and Opaque Token</h2>
<p>In some cases, you may have a need to access both kinds of tokens. For example, you may support more than one tenant where one tenant issues JWTs and the other issues opaque tokens. If this decision must be made at request-time, then you can use an <code>AuthenticationManagerResolver</code> to achieve it, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">AuthenticationManagerResolver</span><span class="o">&lt;</span><span class="n">HttpServletRequest</span><span class="o">&gt;</span> <span class="nf">tokenAuthenticationManagerResolver</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">BearerTokenResolver</span> <span class="n">bearerToken</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultBearerTokenResolver</span><span class="o">();</span>
    <span class="n">JwtAuthenticationProvider</span> <span class="n">jwt</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">();</span>
    <span class="n">OpaqueTokenAuthenticationProvider</span> <span class="n">opaqueToken</span> <span class="o">=</span> <span class="n">opaqueToken</span><span class="o">();</span>

    <span class="k">return</span> <span class="n">request</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">bearerToken</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isAJwt</span><span class="o">(</span><span class="n">token</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">jwt</span><span class="o">::</span><span class="n">authenticate</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">opaqueToken</span><span class="o">::</span><span class="n">authenticate</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>And then specify this <code>AuthenticationManagerResolver</code> in the DSL:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">http</span>
    <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
        <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
        <span class="o">.</span><span class="na">and</span><span class="o">()</span>
    <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
        <span class="o">.</span><span class="na">authenticationManagerResolver</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tokenAuthenticationManagerResolver</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="20multi-tenancy">20 Multi-tenancy</h2>
<p>A resource server is considered multi-tenant when there are multiple strategies for verifying a bearer token, keyed by some tenant identifier. For example, your resource server may accept bearer tokens from two different authorization servers. Or, your authorization server may represent a multiplicity of issuers. In each case, there are two things that need to be done and trade-offs associated with how you choose to do them:</p>
<ol>
<li>Resolve the tenant</li>
<li>Propagate the tenant</li>
</ol>
<h3 id="resolving-the-tenant-by-request-material">Resolving the Tenant By Request Material</h3>
<p>Resolving the tenant by request material can be done my implementing an <code>AuthenticationManagerResolver</code>, which determines the <code>AuthenticationManager</code> at runtime, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TenantAuthenticationManagerResolver</span>
        <span class="kd">implements</span> <span class="n">AuthenticationManagerResolver</span><span class="o">&lt;</span><span class="n">HttpServletRequest</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">BearerTokenResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultBearerTokenResolver</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">;</span> <span class="c1">// 1
</span><span class="c1"></span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AuthenticationManager</span><span class="o">&gt;</span> <span class="n">authenticationManagers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span> <span class="c1">// 2
</span><span class="c1"></span>
    <span class="kd">public</span> <span class="nf">TenantAuthenticationManagerResolver</span><span class="o">(</span><span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tenants</span> <span class="o">=</span> <span class="n">tenants</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">AuthenticationManager</span> <span class="nf">resolve</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">authenticationManagers</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">toTenant</span><span class="o">(</span><span class="n">request</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">fromTenant</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">toTenant</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">pathParts</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">pathParts</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">pathParts</span><span class="o">[</span><span class="n">1</span><span class="o">]</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">AuthenticationManager</span> <span class="nf">fromTenant</span><span class="o">(</span><span class="n">String</span> <span class="n">tenant</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenants</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">tenant</span><span class="o">))</span> <span class="c1">// 3
</span><span class="c1"></span>                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">JwtDecoders</span><span class="o">::</span><span class="n">fromIssuerLocation</span><span class="o">)</span> <span class="c1">// 4
</span><span class="c1"></span>                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">JwtAuthenticationProvider</span><span class="o">::</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;unknown tenant&#34;</span><span class="o">))::</span><span class="n">authenticate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>A hypothetical source for tenant information</li>
<li>A cache for <code>AuthenticationManager</code>s, keyed by tenant identifier</li>
<li>Looking up the tenant is more secure than simply computing the issuer location on the fly - the lookup acts as a tenant whitelist</li>
<li>Create a JwtDecoder via the discovery endpoint - the lazy lookup here means that you don’t need to configure all tenants at startup</li>
</ol>
<p>And then specify this <code>AuthenticationManagerResolver</code> in the DSL:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">http</span>
    <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
        <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
        <span class="o">.</span><span class="na">and</span><span class="o">()</span>
    <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
        <span class="o">.</span><span class="na">authenticationManagerResolver</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenantAuthenticationManagerResolver</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="resolving-the-tenant-by-claim">Resolving the Tenant By Claim</h3>
<p>Resolving the tenant by claim is similar to doing so by request material. The only real difference is the <code>toTenant</code> method implementation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TenantAuthenticationManagerResolver</span> <span class="kd">implements</span> <span class="n">AuthenticationManagerResolver</span><span class="o">&lt;</span><span class="n">HttpServletRequest</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">BearerTokenResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultBearerTokenResolver</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">;</span> <span class="c1">// 1
</span><span class="c1"></span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AuthenticationManager</span><span class="o">&gt;</span> <span class="n">authenticationManagers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span> <span class="c1">// 2
</span><span class="c1"></span>
    <span class="kd">public</span> <span class="nf">TenantAuthenticationManagerResolver</span><span class="o">(</span><span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tenants</span> <span class="o">=</span> <span class="n">tenants</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">AuthenticationManager</span> <span class="nf">resolve</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">authenticationManagers</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">toTenant</span><span class="o">(</span><span class="n">request</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">fromTenant</span><span class="o">);</span> <span class="c1">// 3
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">toTenant</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">resolver</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">JWTParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">token</span><span class="o">).</span><span class="na">getJWTClaimsSet</span><span class="o">().</span><span class="na">getIssuer</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">AuthenticationManager</span> <span class="nf">fromTenant</span><span class="o">(</span><span class="n">String</span> <span class="n">tenant</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenants</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">tenant</span><span class="o">))</span> <span class="c1">// 4
</span><span class="c1"></span>                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">JwtDecoders</span><span class="o">::</span><span class="n">fromIssuerLocation</span><span class="o">)</span> <span class="c1">// 5
</span><span class="c1"></span>                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">JwtAuthenticationProvider</span><span class="o">::</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;unknown tenant&#34;</span><span class="o">))::</span><span class="n">authenticate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#CO14-1"><img src="images/1.png" alt="1"></a></td>
<td></td>
<td>A hypothetical source for tenant information</td>
</tr>
<tr>
<td><a href="#CO14-2"><img src="images/2.png" alt="1"></a></td>
<td></td>
<td>A cache for <code>AuthenticationManager</code>s, keyed by tenant identifier</td>
</tr>
<tr>
<td><a href="#CO14-3"><img src="images/3.png" alt="1"></a></td>
<td><a href="#CO14-4"><img src="images/4.png" alt="1"></a></td>
<td>Looking up the tenant is more secure than simply computing the issuer location on the fly - the lookup acts as a tenant whitelist</td>
</tr>
<tr>
<td><a href="#CO14-5"><img src="images/5.png" alt="1"></a></td>
<td></td>
<td>Create a <code>JwtDecoder</code> via the discovery endpoint - the lazy lookup here means that you don’t need to configure all tenants at startup</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">http</span>
    <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
        <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
        <span class="o">.</span><span class="na">and</span><span class="o">()</span>
    <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
        <span class="o">.</span><span class="na">authenticationManagerResolver</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenantAuthenticationManagerResolver</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="parsing-the-claim-only-once">Parsing the Claim Only Once</h3>
<p>You may have observed that this strategy, while simple, comes with the trade-off that the JWT is parsed once by the <code>AuthenticationManagerResolver</code> and then again by the <code>JwtDecoder</code>. This extra parsing can be alleviated by configuring the <code>JwtDecoder</code> directly with a <code>JWTClaimSetAwareJWSKeySelector</code> from Nimbus:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TenantJWSKeySelector</span>
    <span class="kd">implements</span> <span class="n">JWTClaimSetAwareJWSKeySelector</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">;</span> <span class="n">1</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">JWSKeySelector</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;&gt;</span> <span class="n">selectors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span> <span class="n">2</span>

    <span class="kd">public</span> <span class="nf">TenantJWSKeySelector</span><span class="o">(</span><span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tenants</span> <span class="o">=</span> <span class="n">tenants</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Key</span><span class="o">&gt;</span> <span class="nf">selectKeys</span><span class="o">(</span><span class="n">JWSHeader</span> <span class="n">jwsHeader</span><span class="o">,</span> <span class="n">JWTClaimsSet</span> <span class="n">jwtClaimsSet</span><span class="o">,</span> <span class="n">SecurityContext</span> <span class="n">securityContext</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">KeySourceException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">selectors</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">toTenant</span><span class="o">(</span><span class="n">jwtClaimsSet</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">fromTenant</span><span class="o">)</span>
                <span class="o">.</span><span class="na">selectJWSKeys</span><span class="o">(</span><span class="n">jwsHeader</span><span class="o">,</span> <span class="n">securityContext</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">toTenant</span><span class="o">(</span><span class="n">JWTClaimsSet</span> <span class="n">claimSet</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">claimSet</span><span class="o">.</span><span class="na">getClaim</span><span class="o">(</span><span class="s">&#34;iss&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">JWSKeySelector</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="nf">fromTenant</span><span class="o">(</span><span class="n">String</span> <span class="n">tenant</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenantRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">tenant</span><span class="o">))</span> <span class="n">3</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">getAttrbute</span><span class="o">(</span><span class="s">&#34;jwks_uri&#34;</span><span class="o">))</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">fromUri</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;unknown tenant&#34;</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">JWSKeySelector</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="nf">fromUri</span><span class="o">(</span><span class="n">String</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">JWSAlgorithmFamilyJWSKeySelector</span><span class="o">.</span><span class="na">fromJWKSetURL</span><span class="o">(</span><span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">uri</span><span class="o">));</span> <span class="n">4</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#CO14-1"><img src="images/1.png" alt="1"></a></td>
<td>A hypothetical source for tenant information</td>
<td></td>
</tr>
<tr>
<td><a href="#CO14-2"><img src="images/2.png" alt="1"></a></td>
<td>A cache for <code>JWKKeySelector</code>s, keyed by tenant identifier</td>
<td></td>
</tr>
<tr>
<td><a href="#CO14-3"><img src="images/3.png" alt="1"></a></td>
<td>Looking up the tenant is more secure than simply calculating the JWK Set endpoint on the fly - the lookup acts as a tenant whitelist</td>
<td></td>
</tr>
<tr>
<td><a href="#CO14-4"><img src="images/4.png" alt="1"></a></td>
<td>Create a <code>JWSKeySelector</code> via the types of keys that come back from the JWK Set endpoint - the lazy lookup here means that you don’t need to configure all tenants at startupp</td>
<td></td>
</tr>
</tbody>
</table>
<p>The above key selector is a composition of many key selectors. It chooses which key selector to use based on the <code>iss</code> claim in the JWT.</p>
<blockquote>
<p>To use this approach, make sure that the authorization server is configured to include the claim set as part of the token’s signature. Without this, you have no guarantee that the issuer hasn’t been altered by a bad actor.</p>
</blockquote>
<p>Next, we can construct a <code>JWTProcessor</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JWTProcessor</span> <span class="nf">jwtProcessor</span><span class="o">(</span><span class="n">JWTClaimSetJWSKeySelector</span> <span class="n">keySelector</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ConfigurableJWTProcessor</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="n">jwtProcessor</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">DefaultJWTProcessor</span><span class="o">();</span>
    <span class="n">jwtProcessor</span><span class="o">.</span><span class="na">setJWTClaimSetJWSKeySelector</span><span class="o">(</span><span class="n">keySelector</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">jwtProcessor</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As you are already seeing, the trade-off for moving tenant-awareness down to this level is more configuration. We have just a bit more. Next, we still want to make sure you are validating the issuer. But, since the issuer may be different per JWT, then you’ll need a tenant-aware validator, too:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TenantJwtIssuerValidator</span> <span class="kd">implements</span> <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">JwtIssuerValidator</span><span class="o">&gt;</span> <span class="n">validators</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">TenantJwtIssuerValidator</span><span class="o">(</span><span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tenants</span> <span class="o">=</span> <span class="n">tenants</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">OAuth2TokenValidatorResult</span> <span class="nf">validate</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">validators</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">toTenant</span><span class="o">(</span><span class="n">token</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">fromTenant</span><span class="o">)</span>
                <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">toTenant</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">jwt</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="na">getIssuer</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">JwtIssuerValidator</span> <span class="nf">fromTenant</span><span class="o">(</span><span class="n">String</span> <span class="n">tenant</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenants</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">tenant</span><span class="o">))</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;issuer&#34;</span><span class="o">))</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">JwtIssuerValidator</span><span class="o">::</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;unknown tenant&#34;</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Now that we have a tenant-aware processor and a tenant-aware validator, we can proceed with creating our <code>JwtDecoder</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">(</span><span class="n">JWTProcessor</span> <span class="n">jwtProcessor</span><span class="o">,</span> <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">jwtValidator</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">NimbusJwtDecoder</span> <span class="n">decoder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NimbusJwtDecoder</span><span class="o">(</span><span class="n">processor</span><span class="o">);</span>
    <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">validator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DelegatingOAuth2TokenValidator</span><span class="o">&lt;&gt;</span>
            <span class="o">(</span><span class="n">JwtValidators</span><span class="o">.</span><span class="na">createDefault</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">jwtValidator</span><span class="o">);</span>
    <span class="n">decoder</span><span class="o">.</span><span class="na">setJwtValidator</span><span class="o">(</span><span class="n">validator</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">decoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We’ve finished talking about resolving the tenant. If you’ve chosen to resolve the tenant by request material, then you’ll need to make sure you address your downstream resource servers in the same way. For example, if you are resolving it by subdomain, you’ll need to address the downstream resource server using the same subdomain. However, if you resolve it by a claim in the bearer token, read on to learn about <a href="#oauth2resourceserver-bearertoken-resolver" title="12.3.21 Bearer Token Resolution">Spring Security’s support for bearer token propagation</a>.</p>
<h2 id="21bearer-token-resolution">21 Bearer Token Resolution</h2>
<p>By default, Resource Server looks for a bearer token in the <code>Authorization</code> header. This, however, can be customized in a couple of ways.</p>
<h3 id="reading-the-bearer-token-from-a-custom-header">Reading the Bearer Token from a Custom Header</h3>
<p>For example, you may have a need to read the bearer token from a custom header. To achieve this, you can wire a <code>HeaderBearerTokenResolver</code> instance into the DSL, as you can see in the following example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">http</span>
    <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
        <span class="o">.</span><span class="na">bearerTokenResolver</span><span class="o">(</span><span class="k">new</span> <span class="n">HeaderBearerTokenResolver</span><span class="o">(</span><span class="s">&#34;x-goog-iap-jwt-assertion&#34;</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="reading-the-bearer-token-from-a-form-parameter">Reading the Bearer Token from a Form Parameter</h3>
<p>Or, you may wish to read the token from a form parameter, which you can do by configuring the <code>DefaultBearerTokenResolver</code>, as you can see below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">DefaultBearerTokenResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultBearerTokenResolver</span><span class="o">();</span>
<span class="n">resolver</span><span class="o">.</span><span class="na">setAllowFormEncodedBodyParameter</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">http</span>
    <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
        <span class="o">.</span><span class="na">bearerTokenResolver</span><span class="o">(</span><span class="n">resolver</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="22bearer-token-propagation">22 Bearer Token Propagation</h2>
<p>Now that you’re in possession of a bearer token, it might be handy to pass that to downstream services. This is quite simple with <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/oauth2/server/resource/web/reactive/function/client/ServletBearerExchangeFilterFunction.html"><code>ServletBearerExchangeFilterFunction</code></a>, which you can see in the following example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">WebClient</span> <span class="nf">rest</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="k">new</span> <span class="n">ServletBearerExchangeFilterFunction</span><span class="o">())</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>When the above <code>WebClient</code> is used to perform requests, Spring Security will look up the current <code>Authentication</code> and extract any <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/oauth2/core/AbstractOAuth2Token.html"><code>AbstractOAuth2Token</code></a> credential. Then, it will propagate that token in the <code>Authorization</code> header. For example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="k">this</span><span class="o">.</span><span class="na">rest</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
        <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;https://other-service.example.com/endpoint&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
        <span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">.</span><span class="na">block</span><span class="o">()</span>
</code></pre></td></tr></table>
</div>
</div><p>Will invoke the <a href="https://other-service.example.com/endpoint"><code>https://other-service.example.com/endpoint</code></a>, adding the bearer token <code>Authorization</code> header for you. In places where you need to override this behavior, it’s a simple matter of supplying the header yourself, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="k">this</span><span class="o">.</span><span class="na">rest</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
        <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;https://other-service.example.com/endpoint&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">headers</span><span class="o">(</span><span class="n">headers</span> <span class="o">-&gt;</span> <span class="n">headers</span><span class="o">.</span><span class="na">setBearerAuth</span><span class="o">(</span><span class="n">overridingToken</span><span class="o">))</span>
        <span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
        <span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">.</span><span class="na">block</span><span class="o">()</span>
</code></pre></td></tr></table>
</div>
</div><p>In this case, the filter will fall back and simply forward the request onto the rest of the web filter chain.</p>
<blockquote>
<p>Unlike the <a href="https://docs.spring.io/spring-security/site/docs/current-SNAPSHOT/api/org/springframework/security/oauth2/client/web/reactive/function/client/ServletOAuth2AuthorizedClientExchangeFilterFunction.html">OAuth 2.0 Client filter function</a>, this filter function makes no attempt to renew the token, should it be expired. To obtain this level of support, please use the OAuth 2.0 Client filter.</p>
</blockquote>
<h3 id="resttemplate-support"><code>RestTemplate</code> support</h3>
<p>There is no dedicated support for <code>RestTemplate</code> at the moment, but you can achieve propagation quite simply with your own interceptor:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">RestTemplate</span> <span class="nf">rest</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">RestTemplate</span> <span class="n">rest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RestTemplate</span><span class="o">();</span>
    <span class="n">rest</span><span class="o">.</span><span class="na">getInterceptors</span><span class="o">().</span><span class="na">add</span><span class="o">((</span><span class="n">request</span><span class="o">,</span> <span class="n">body</span><span class="o">,</span> <span class="n">execution</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">authentication</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">execution</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(!(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getCredentials</span><span class="o">()</span> <span class="k">instanceof</span> <span class="n">AbstractOAuth2Token</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">execution</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">AbstractOAuth2Token</span> <span class="n">token</span> <span class="o">=</span> <span class="o">(</span><span class="n">AbstractOAuth2Token</span><span class="o">)</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getCredentials</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">setBearerAuth</span><span class="o">(</span><span class="n">token</span><span class="o">.</span><span class="na">getTokenValue</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">execution</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span>
    <span class="o">});</span>
    <span class="k">return</span> <span class="n">rest</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Spring推荐使用构造器注入</title>
                <link>https://wss.cool/spring%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5.html</link>
                <guid isPermaLink="true">https://wss.cool/spring%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5.html</guid>
                <pubDate>Sat, 18 Jan 2020 18:30:02 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>Spring团队通常提倡构造函数注入，因为它可以使应用程序组件实现不可变对象并确保所需的依赖项不为null。此外，构造函数注入的组件始终以完全初始化的状态返回到客户端（调用）代码。附带说明一下，大量的构造函数自变量是一种不好的代码味道，这意味着该类可能承担了太多的职责，应该对其进行重构以更好地解决关注点分离问题。</p>
<p>我们通常建议人们对所有必需的协作者使用构造函数注入，对所有其他属性使用setter注入。同样，构造函数注入可确保满足所有必需属性，并且根本不可能以无效状态（未通过其协作者）实例化对象。换句话说，在使用构造函数注入时，您不必使用专用机制来确保设置了必需的属性（普通Java机制除外）。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/spring/">spring</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5/">构造器注入</category>
                                
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/">依赖注入</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Spring Boot 中读取配置文件中的变量</title>
                <link>https://wss.cool/posts/%E5%90%8E%E7%AB%AF/spring/spring-boot%E4%B8%AD%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%90%8E%E7%AB%AF/spring/spring-boot%E4%B8%AD%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F/</guid>
                <pubDate>Sat, 18 Jan 2020 17:57:27 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>在application.yml中配置的变量，可以在代码中引用到。</p>
<h2 id="添加依赖">添加依赖</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-configuration-processor<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.2.0.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="定义变量">定义变量</h2>
<p>application.yml文件中加入自定义的变量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">my</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>wanngshushuo<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="对应的实体类">对应的实体类</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span> <span class="c1">// 文档中没有这个注释，但是不写会报错
</span><span class="c1"></span><span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&#34;my&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfig</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="c1">// getter setter
</span><span class="c1"></span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="在代码中使用">在代码中使用</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MyConfig</span> <span class="n">myConfig</span><span class="o">;</span>

    <span class="n">MainService</span><span class="o">(</span><span class="n">MyConfig</span> <span class="n">myConfig</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">myConfig</span> <span class="o">=</span> <span class="n">myConfig</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/update&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">updateBlog</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">myConfig</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/spring/">spring</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Java执行shell命令</title>
                <link>https://wss.cool/java%E6%89%A7%E8%A1%8Cshell%E5%91%BD%E4%BB%A4.html</link>
                <guid isPermaLink="true">https://wss.cool/java%E6%89%A7%E8%A1%8Cshell%E5%91%BD%E4%BB%A4.html</guid>
                <pubDate>Sat, 18 Jan 2020 17:53:17 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="添加依赖">添加依赖</h2>
<p>首先使用<code>Spring Boot</code>开启一个<code>RESTful</code>项目，额外的加上<code>Apache Commons Exec</code>的依赖。</p>
<blockquote>
<p>Exec官网<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>，<a href="https://commons.apache.org/proper/commons-exec/apidocs/index.html">API文档</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>commons-exec<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="代码实现">代码实现</h2>
<p>这里分两种情况。一个是最简的只关心执行是否成功，也就是code大于0为失败；另一个是需要拿到执行的标准输出和错误的信息。</p>
<h3 id="只关心是否成功">只关心是否成功</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">updateBlogFromGit</span><span class="o">(){</span>
        <span class="c1">// 1
</span><span class="c1"></span>        <span class="n">CommandLine</span> <span class="n">pull</span> <span class="o">=</span> <span class="n">CommandLine</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&#34;git pull&#34;</span><span class="o">);</span>

        <span class="c1">// 2
</span><span class="c1"></span>        <span class="n">DefaultExecutor</span> <span class="n">executor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultExecutor</span><span class="o">();</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">setWorkingDirectory</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;/home/ubuntu/blog&#34;</span><span class="o">));</span>

        <span class="c1">// 3，省略try_catch
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">exitValue</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">pull</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">exitValue</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">exitValue</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">hugo</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">exitValue</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>准备要运行的shell命令</li>
<li>创建执行器，并设置工作目录</li>
<li>最后执行命令，返回code</li>
</ol>
<h3 id="要拿到标准输出和错误的信息">要拿到标准输出和错误的信息</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">updateBlogFromGit</span><span class="o">(){</span>
        <span class="c1">// 1
</span><span class="c1"></span>        <span class="n">CommandLine</span> <span class="n">pull</span> <span class="o">=</span> <span class="n">CommandLine</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&#34;git pull&#34;</span><span class="o">);</span>
        <span class="n">CommandLine</span> <span class="n">hugo</span> <span class="o">=</span> <span class="n">CommandLine</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&#34;hugo&#34;</span><span class="o">);</span>

        <span class="c1">// 2
</span><span class="c1"></span>        <span class="n">ByteArrayOutputStream</span> <span class="n">outputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="n">ByteArrayOutputStream</span> <span class="n">errorStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="n">PumpStreamHandler</span> <span class="n">streamHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PumpStreamHandler</span><span class="o">(</span><span class="n">outputStream</span><span class="o">,</span> <span class="n">errorStream</span><span class="o">);</span>

        <span class="c1">// 3
</span><span class="c1"></span>        <span class="n">DefaultExecutor</span> <span class="n">executor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultExecutor</span><span class="o">();</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">setWorkingDirectory</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;/home/ubuntu/blog&#34;</span><span class="o">));</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">setStreamHandler</span><span class="o">(</span><span class="n">streamHandler</span><span class="o">);</span>

        <span class="c1">// 4
</span><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">exitValue</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">pull</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">exitValue</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">exitValue</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">hugo</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">String</span> <span class="n">result</span><span class="o">;</span>
            <span class="k">if</span><span class="o">(</span><span class="n">exitValue</span><span class="o">==</span><span class="n">0</span><span class="o">){</span>
                <span class="n">result</span><span class="o">=</span> <span class="n">outputStream</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">errorStream</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecuteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">errorStream</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>准备要运行的shell命令</li>
<li>准备接收标准输出和错误的Stream</li>
<li>创建执行器，并设置工作目录，设置StreamHandler</li>
<li>最后执行命令（如果执行时出错会返回大于0的整数），返回标准输出或错误信息或报错堆栈信息</li>
</ol>
<h2 id="收获">收获</h2>
<p>技能树：</p>
<pre><code>后端 --&gt; Java --&gt; 工具库 --&gt; Exec --&gt; 使用
后端 --&gt; Java --&gt; 语言基础 --&gt; ByteArrayOutputStream --&gt; 使用
</code></pre><h2 id="其他相关内容">其他相关内容</h2>
<ul>
<li><a href="https://wowfriday.cn/posts/linux-base/#%E4%BD%BF%E7%94%A8systemd%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%ADjava%E7%A8%8B%E5%BA%8F">使用systemd启动关闭Java程序</a></li>
<li><a href="https://wowfriday.cn/nginx.html#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE">配置Nginx</a></li>
</ul>
<hr>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Exec官网 <a href="https://commons.apache.org/proper/commons-exec/">https://commons.apache.org/proper/commons-exec/</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%8A%98%E8%85%BE/">折腾</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Spring探索与扫盲</title>
                <link>https://wss.cool/spring%E6%8E%A2%E7%B4%A2%E4%B8%8E%E6%89%AB%E7%9B%B2.html</link>
                <guid isPermaLink="true">https://wss.cool/spring%E6%8E%A2%E7%B4%A2%E4%B8%8E%E6%89%AB%E7%9B%B2.html</guid>
                <pubDate>Thu, 16 Jan 2020 23:55:23 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>刚刚接触Spring，感觉它是一个庞大的体系，内容很多。现在想要对它有一个总体的、感性的认识和了解。首先从官网入手。</p>
<p>spring.io官网下的第一个目录——projects，里面列举了Spring的项目。打开一个项目可以看到它的介绍，学习资料，文档，示例。</p>
<p>第二个目录是guides，里面包含很多的、各个方面的入门引导，这些入门引导都是很简单的。下面还有两个模块——Topical Guides和Tutorials，这两部分稍微长一点，比第一部分要详细一些、内容多一些。</p>
<p>第三个目录是一些付费的培训和认证。</p>
<h2 id="projects">Projects</h2>
<h3 id="spring-framework必学">Spring Framework，必学</h3>
<p>这个应该是通常说到Spring时代表的Spring本人。</p>
<blockquote>
<p>Spring框架可在任何类型的部署平台上为基于Java的现代企业应用程序提供全面的编程和配置模型。</p>
</blockquote>
<blockquote>
<p>Spring的一个关键元素是在应用程序级别的基础架构支持：Spring专注于企业应用程序的“管道”，以便团队可以专注于应用程序级别的业务逻辑，而不必与特定的部署环境建立不必要的联系。</p>
</blockquote>
<h3 id="spring-data要学">Spring Data，要学</h3>
<p><a href="https://spring.io/projects/spring-data">网址</a></p>
<p>它包含了所有数据存储的子项目，JDBC、JPA、MongoDB、Redis、REST，他们都被这个项目封装了，可以用一致的API使用。</p>
<blockquote>
<p>Spring Data的任务是为数据访问提供一个熟悉且一致的，基于Spring的编程模型，同时仍保留基础数据存储的特​​殊特征。</p>
</blockquote>
<blockquote>
<p>它使使用数据访问技术，关系和非关系数据库，map-reduce框架以及基于云的数据服务变得容易。这是一个总括项目，其中包含许多特定于给定数据库的子项目。这些项目是通过与这些令人兴奋的技术背后的许多公司和开发人员共同开发的。</p>
</blockquote>
<h3 id="spring-security要学">Spring Security，要学</h3>
<p>这个应该是用来做登录、权限管理的。下面是机翻介绍和特性。</p>
<blockquote>
<p>Spring Security是一个功能强大且高度可定制的身份验证和访问控制框架。它是用于保护基于Spring的应用程序的实际标准。</p>
</blockquote>
<blockquote>
<p>Spring Security是一个框架，致力于为Java应用程序提供身份验证和授权。与所有Spring项目一样，Spring Security的真正强大之处在于可以轻松扩展以满足自定义要求</p>
</blockquote>
<h4 id="特性">特性</h4>
<ul>
<li>对身份验证和授权的全面且可扩展的支持</li>
<li>防御会话固定，点击劫持，跨站点请求伪造等攻击</li>
<li>Servlet API集成</li>
<li>与Spring Web MVC的可选集成</li>
</ul>
<h3 id="spring-rest-docs可能要学">Spring REST Docs，可能要学</h3>
<p>貌似是用来生成RESTful服务的文档的。</p>
<blockquote>
<p>Spring REST Docs可帮助您记录RESTful服务。</p>
</blockquote>
<blockquote>
<p>它结合了用Asciidoctor编写的手写文档和Spring MVC Test生成的自动生成的代码片段。这种方法使您摆脱了Swagger之类的工具所产生的文档限制。</p>
</blockquote>
<blockquote>
<p>它可以帮助您生成准确，简洁且结构合理的文档。然后，该文档可让您的用户以最少的麻烦获得他们所需的信息。</p>
</blockquote>
<h3 id="spring-cloud要学">Spring Cloud，要学</h3>
<p>官方介绍的机翻如下，可以用来搭建微服务系统。</p>
<blockquote>
<p>Spring Cloud为开发人员提供了工具，以快速构建分布式系统中的某些常见模式（例如，配置管理，服务发现，断路器，智能路由，微代理，控制总线，一次性令牌，全局锁，领导选举，分布式会话，群集状态）。分布式系统的协调导致样板式样，并且使用Spring Cloud开发人员可以快速站起来实现这些样板的服务和应用程序。它们可以在任何分布式环境中正常工作，包括开发人员自己的笔记本电脑，裸机数据中心以及Cloud Foundry等托管平台。</p>
</blockquote>
<h3 id="spring-amqp可能要学">Spring AMQP，可能要学</h3>
<p>消息队列服务</p>
<p><strong>AMQP维基百科</strong></p>
<blockquote>
<p>高级消息队列协议即Advanced Message Queuing Protocol（AMQP）。高级消息队列协议是一种二进制应用层协议，用于应对广泛的面向消息应用程序的支持。协议提供了消息流控制，保证的一个消息对象的传递过程，如至多一次、保证多次、仅有一次等，和基于SASL和TLS的身份验证和消息加密.</p>
</blockquote>
<blockquote>
<p>是面向消息中间件提供的开放的应用层协议，其设计目标是对于消息的排序、路由（包括点对点和订阅-发布）、保持可靠性、保证安全性[1]。AMQP规范了消息传递方和接收方的行为，以使消息在不同的提供商之间实现互操作性，就像SMTP，HTTP，FTP等协议可以创建交互系统一样。与先前的中间件标准（如Java消息服务）不同的是，JMS在特定的API接口层面和实现行为上进行了统一，而高级消息队列协议则关注于各种消息如何以字节流的形式进行传递。因此，使用了符合协议实现的任意应用程序之间可以保持对消息的创建、传递。</p>
</blockquote>
<p><strong>Spring AMQP项目官方介绍的机翻</strong></p>
<blockquote>
<p>Spring AMQP项目将Spring的核心概念应用于基于AMQP的消息传递解决方案的开发。它提供了一个“模板”作为用于发送和接收消息的高级抽象。它还通过“侦听器容器”为消息驱动的POJO提供支持。这些库有助于AMQP资源的管理，同时促进对依赖项注入和声明性配置的使用。在所有这些情况下，您将看到与Spring Framework中的JMS支持相似的地方。</p>
</blockquote>
<blockquote>
<p>该项目包括两个部分；spring-amqp是基础抽象，spring-rabbit是RabbitMQ实现。</p>
</blockquote>
<h3 id="spring-batch可能要学">Spring Batch，可能要学</h3>
<p>批处理框架，公司的什么业务需要批处理呢？日志？统计？比如搞一个服务分析nginx的access.log，看一下访问日志，哪些资源被访问的多？</p>
<blockquote>
<p>一个轻量级，全面的批处理框架，旨在支持开发对企业系统的日常运行至关重要的强大的批处理应用程序。</p>
</blockquote>
<blockquote>
<p>Spring Batch提供了可重用的功能，这些功能对于处理大量记录至关重要，包括日志记录/跟踪，事务管理，作业处理统计信息，作业重新启动，跳过和资源管理。它还提供了更高级的技术服务和功能，这些功能和功能将通过优化和分区技术来实现极高容量和高性能的批处理作业。无论简单还是复杂，大批量处理作业，都可以以高度可扩展的方式利用框架来处理大量信息。</p>
</blockquote>
<h3 id="spring-web-flow可能要学">Spring Web Flow，可能要学</h3>
<blockquote>
<p>Spring Web Flow建立在Spring MVC之上，并允许实现Web应用程序的“流”。流程封装了一系列步骤，这些步骤指导用户完成某些业务任务。它跨越多个HTTP请求，具有状态，处理事务数据，可重用，并且本质上可以是动态的并且可以长期运行。</p>
</blockquote>
<blockquote>
<p>Spring Web Flow的最佳选择是具有导航功能的状态Web应用程序，例如，登机，申请贷款，购物车结帐，甚至向表单添加确认步骤。这些方案的共同点是以下一个或多个特征：</p>
</blockquote>
<ul>
<li>有一个明确的起点和终点。</li>
<li>用户必须按特定顺序浏览一组屏幕。</li>
<li>直到最后一步，更改才能最终确定。</li>
<li>完成后，就不可能意外重复交易</li>
</ul>
<h3 id="spring-for-apache-kafka可能要学">Spring for Apache Kafka，可能要学</h3>
<p>好像也是消息队列，或者数据处理引擎。</p>
<blockquote>
<p>用于Apache Kafka的Spring（spring-kafka）项目将核心Spring概念应用于基于Kafka的消息传递解决方案的开发。它提供了一个“模板”作为发送消息的高级抽象。它还支持带有@KafkaListener注释和“侦听器容器”的消息驱动的POJO 。这些库促进了依赖注入和声明式的使用。在所有这些情况下，您将看到与Spring框架中的JMS支持和Spring AMQP中的RabbitMQ支持相似。</p>
</blockquote>
<h3 id="spring-flo可能有用">Spring Flo，可能有用</h3>
<p>貌似可以做类似流程图的前端页面。</p>
<blockquote>
<p>Spring Flo是一个JavaScript库，为管道和简单图形提供了一个基本的可嵌入HTML5可视生成器。该库用作Spring Cloud Data Flow中流构建器的基础。</p>
</blockquote>
<blockquote>
<p>Flo包括集成流设计器的所有基本元素，例如连接器，控制节点，调色板，状态转换和图形拓扑-重要的是，它具有文本外壳，DSL支持和设计用于创建和查看全面工作流程的图形画布。</p>
</blockquote>
<h3 id="spring-shell可能有用">Spring Shell，可能有用</h3>
<p>gitee上传了代码，触发webhook，接口需要执行一个shell命令来打包博客。在java程序中执行shell命令是用这个项目？</p>
<blockquote>
<p>Spring Shell项目提供了一个交互式Shell，使您可以使用基于Spring的编程模型来插入自己的自定义命令。</p>
</blockquote>
<h3 id="spring-ldap暂时不学">Spring LDAP，暂时不学</h3>
<p>不知道应用场景。</p>
<p><strong>百度百科</strong></p>
<blockquote>
<p>轻型目录访问协议（英文：Lightweight Directory Access Protocol，缩写：LDAP，/ˈɛldæp/）是一个开放的，中立的，工业标准的应用协议，通过IP协议提供访问控制和维护分布式信息的目录信息。</p>
</blockquote>
<p><strong>官方介绍机翻</strong></p>
<blockquote>
<p>Spring LDAP是一个用于简化Java中LDAP编程的库，其建立原理与Spring Jdbc相同。</p>
</blockquote>
<blockquote>
<p>LdapTemplate类封装了传统LDAP编程中涉及的所有管道工作，例如创建，遍历NamingEnumerations，处理Exception和清理资源。这使程序员可以处理重要的事情-在何处查找数据（DN和筛选器）以及如何处理数据（与域对象进行映射，绑定，修改，取消绑定等），方法与JdbcTemplate缓解的方法相同除了实际的SQL之外的所有程序员，以及数据如何映射到域模型。</p>
</blockquote>
<h3 id="spring-hateoas暂时不学">Spring HATEOAS，暂时不学</h3>
<p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-SpringHATEOAS/index.html">介绍文章</a></p>
<blockquote>
<p>HATEOAS（Hypermedia as the engine of application state）是 REST 架构风格中最复杂的约束，也是构建成熟 REST 服务的核心。</p>
</blockquote>
<p>RESTful架构的最高（最牛叉）层次就要使用HATEOAS。</p>
<blockquote>
<p>第四个层次（Level 3）的 Web 服务使用 HATEOAS。在资源的表达中包含了链接信息。客户端可以根据链接来发现可以执行的动作。</p>
</blockquote>
<p>Spring HATEOAS的介绍</p>
<blockquote>
<p>当使用Spring特别是Spring MVC时，Spring HATEOAS提供了一些API来简化创建遵循HATEOAS原理的REST表示形式的API。它试图解决的核心问题是链接创建和表示组装。</p>
</blockquote>
<p>HATEOAS跟“链接”很有关系，一般的RESTful返回结果都只是JSON数据，HATEOAS原理返回的数据还要包含“链接”，客户端可以使用链接做各种事。我还想象不到应用场景。</p>
<hr>
<p>（下面都是不知道干嘛的，暂时不学）</p>
<h3 id="spring-web-services暂时不学">Spring Web Services，暂时不学</h3>
<p>不知道是干嘛的，什么叫“文档驱动的Web服务(document-driven Web services)”，“SOAP服务”好像是“简单数据交换服务”</p>
<blockquote>
<p>Spring Web Services（Spring-WS）是Spring社区的产品，致力于创建文档驱动的Web服务。Spring Web Services旨在促进合同优先SOAP服务的开发，从而允许使用多种操作XML负载的方式之一来创建灵活的Web服务。该产品基于Spring本身，这意味着您可以将诸如依赖项注入之类的Spring概念用作Web服务的组成部分。</p>
</blockquote>
<blockquote>
<p>人们使用Spring-WS的原因有很多，但是大多数人在遵循Web服务最佳实践时发现缺乏替代的SOAP堆栈后才被吸引使用。Spring-WS使最佳实践变得容易。这包括诸如WS-I基本概要文件，合同优先开发之类的实践，以及合同与实施之间的松散耦合。</p>
</blockquote>
<h3 id="spring-integration暂时不学">Spring Integration，暂时不学</h3>
<p>Integration是整合的意思，Spring Cloud Stream项目基于Spring Integration，其中Spring Integration用作消息驱动的微服务的引擎。貌似是用来整合各种服务的。</p>
<p>这里还有一个用它实现分布式锁的<a href="https://www.cnblogs.com/xuwenjin/p/10681187.html#commentform">例子</a></p>
<h3 id="spring-cloud-data-flow暂时不学">Spring Cloud Data Flow，暂时不学</h3>
<p>官方介绍的机翻，现在还不理解。</p>
<blockquote>
<p>用于Cloud Foundry和Kubernetes的基于微服务的流式处理和批处理数据处理。</p>
<p>Spring Cloud Data Flow提供了用于为流和批处理数据管道创建复杂拓扑的工具。数据管道包含使用Spring Cloud Stream或Spring Cloud Task微服务框架构建的Spring Boot应用程序。</p>
<p>Spring Cloud Data Flow支持从ETL到导入/导出，事件流和预测分析的一系列数据处理用例。</p>
</blockquote>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E5%85%A5%E9%97%A8/">入门</category>
                                
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/java/">Java</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>使用Gitlab的Ci</title>
                <link>https://wss.cool/gitlab-ci.html</link>
                <guid isPermaLink="true">https://wss.cool/gitlab-ci.html</guid>
                <pubDate>Fri, 29 Nov 2019 16:42:18 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h1 id="需求">需求</h1>
<p>一个前端项目需要分别发布到线上的测试环境和生产环境。在打包步骤，利用CI的环境变量功能，分别配置不同的API地址、项目地址等。完成打包后，将其上传到阿里oss中，完成发布。</p>
<h1 id="使用gitlab-cicd的准备工作">使用Gitlab CI/CD的准备工作</h1>
<p>需要准备三个东西：<code>.gitlab-ci.yml</code> 文件定义CI的工作流程、Runner执行流程、阿里云OSS的SDK及上传程序用于部署。</p>
<h2 id="gitlab-ciyml文件">.gitlab-ci.yml文件</h2>
<p>项目根目录下需要有一个 <code>.gitlab-ci.yml</code> 文件。</p>
<p><strong>声明流程</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">stages</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- install<span class="w">
</span><span class="w">  </span>- build<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><code>stages</code> 声明流程，这里就是包括 <code>install</code> 和 <code>build</code> 两个流程。这两个流程都做哪些工作呢？这里的声明相当于一个类型或者接口，需要在后面去实现它。</p>
<p><strong>实现流程</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">job_name</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">stage</span><span class="p">:</span><span class="w"> </span>install<span class="w">
</span><span class="w">  </span><span class="k">script</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- npm<span class="w"> </span>install<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>这个 <code>job</code> 就是实现 <code>stages</code> 中声明的 <code>install</code> 流程的，其中 <code>job_name</code> 随便写就是个名字，<code>stage</code> 字段是说这个 <code>job</code> 是实现的哪个接口。一个接口也可以被实现多次，但是要有条件区分开。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">build_develop</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">stage</span><span class="p">:</span><span class="w"> </span>build<span class="w">
</span><span class="w">  </span><span class="k">variables</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">REACT_APP_BASE_UR</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//develop.edinnovaedu.com<span class="p">:</span><span class="m">35040</span>/<span class="w">
</span><span class="w">    </span><span class="k">REACT_APP_LEARNBOT_URL</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//ng-api--dev.edinnovaedu.com/<span class="w">
</span><span class="w">  </span><span class="k">only</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- develop<span class="w">
</span><span class="w">  </span><span class="k">script</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- npm<span class="w"> </span>run<span class="w"> </span>build<span class="p">:</span>dev<span class="w">
</span><span class="w">    </span>- npm<span class="w"> </span>run<span class="w"> </span>deploy<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">build_production</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">stage</span><span class="p">:</span><span class="w"> </span>build<span class="w">
</span><span class="w">  </span><span class="k">variables</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">REACT_APP_BASE_URL</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//api-gray.v.edinnovaedu.com/<span class="w">
</span><span class="w">    </span><span class="k">REACT_APP_LEARNBOT_URL</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//api-gray.v.edinnovaedu.com<span class="w">
</span><span class="w">  </span><span class="k">only</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- master<span class="w">
</span><span class="w">  </span><span class="k">script</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- npm<span class="w"> </span>run<span class="w"> </span>build<span class="p">:</span>gray<span class="w">
</span><span class="w">    </span>- npm<span class="w"> </span>run<span class="w"> </span>deploy<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>上面的两个 <code>job</code>，都是 <code>build</code> 的实现，它们根据 <code>only</code> 字段定义的条件（分支名）做不同的工作。</p>
<p><strong>总结</strong></p>
<p><code>总结一下，stages</code> 声明流程，总的流程是第一步执行 <code>install</code> ，第二步执行 <code>build</code>
<img src="/images/gitlab-ci-1.jpg" alt="install-build"></p>
<p><code>job</code> 实现流程，多个 <code>job</code> 可以实现同一步流程。第一步执行 <code>install</code>；第二步执行 <code>build</code>，但是会根据条件去执行对应的那个实现。
<img src="/images/gitlab-ci-2.jpg" alt="install-mutl-build"></p>
<p><strong>变量</strong></p>
<p>在 job build_develop 中看到有一个 variables 字段，它定义了两个环境变量， npm run build 中会用到他们。</p>
<p>在 job 中声明的变量是局部变量，只在当前 job 中有效。还可以声明全局变量，写法一样，只是写的位置是与 stages 平级。</p>
<p><strong>缓存</strong></p>
<p>在执行不同的流程时，会清除掉.gitignore中的文件，比如 node_modules 就会每次都被删除。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">cache</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$CI_COMMIT_REF_SLUG&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- node_modules/<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>上面这段是分支不同时才清除 node_modules ，同个分支的不同 job 间会保留/共享它。</p>
<h2 id="runner">Runner</h2>
<p>在<code>.gitlab-ci.yml</code>文件中定义好流程后，需要配置一个Runner来执行这些操作。它是一个软件，需要单独安装，可以安装在运行gitlab的机器上，也可以安装在另一台机器上。</p>
<p><strong>安装</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># For Debian/Ubuntu</span>
$ curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.deb.sh <span class="p">|</span> sudo bash
$ sudo apt-get install gitlab-ci-multi-runner
</code></pre></td></tr></table>
</div>
</div><p><strong>注册</strong></p>
<p>注册是为了把gitlab和runner连接。gitlab的项目的设置中会提供一个url和一个token</p>
<p><img src="/images/gitlab-ci-runner.png" alt="runner"></p>
<p>拿到了这两个东西，回到刚才安装了runner的电脑，开始注册runner。</p>
<pre><code>sudo gitlab-ci-multi-runner register
</code></pre><p>然后依次输入URL、Token、名字、不用输入、shell，就完成了。</p>
<p>可以用 <code>sudo gitlab-ci-multi-runner list</code> 命令来查看各个 Runner 的状态。</p>
<p>有了<code>.gitlab-ci.yml</code>和 <code>runner</code> gitlab的<code>CI/CD</code>就可以工作了，默认的情况，每次上传<code>commit</code>都会触发<code>CI/CD</code>执行。</p>
<h2 id="部署">部署</h2>
<p>我使用了阿里云的oss部署前端项目，所以只需要把打包后的文件上传到对应的目录即可。这里使用<code>oss</code>的<code>python sdk</code>来上传。</p>
<p><code>python</code>程序放在了项目目录中，<code>runner</code>服务器也安装好了python和sdk。所以只需要运行<code>npm run deploy</code>执行<code>python</code>程序即可。</p>
<h1 id="遇到的问题">遇到的问题</h1>
<p>由于gitlab项目配置错误，clone项目的url与实际url不同。在CI执行时，使用的是错误的URL导致无法clone项目而报错。</p>
<p>解决方法是Runner的配置文件。文档链接是<strong>参考3</strong></p>
<p><code>root</code>用户的配置文件在<code>/etc/gitlab-runner/config.toml</code>，可以为一个<code>runner</code>设置一个<code>clone_url</code>即可解决问题。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-toml" data-lang="toml"><span class="p">[[</span><span class="nx">runners</span><span class="p">]]</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;ruby-2.1-docker&#34;</span>
  <span class="nx">url</span> <span class="p">=</span> <span class="s2">&#34;https://CI/&#34;</span>
  <span class="nx">token</span> <span class="p">=</span> <span class="s2">&#34;TOKEN&#34;</span>
  <span class="nx">limit</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="nx">executor</span> <span class="p">=</span> <span class="s2">&#34;docker&#34;</span>
  <span class="nx">builds_dir</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
  <span class="nx">shell</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
  <span class="nx">environment</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;ENV=value&#34;</span><span class="p">,</span> <span class="s2">&#34;LC_ALL=en_US.UTF-8&#34;</span><span class="p">]</span>
  <span class="nx">clone_url</span> <span class="p">=</span> <span class="s2">&#34;http://gitlab.example.local&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><a href="https://scarletsky.github.io/2016/07/29/use-gitlab-ci-for-continuous-integration/#cache-job-cache">参考1</a>
<a href="https://docs.gitlab.com/ce/ci/variables/README.html#masked-variables">参考2</a>
<a href="https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-global-section">参考3</a></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/">工具</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>未读</title>
                <link>https://wss.cool/posts/%E6%9C%AA%E8%AF%BB/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E6%9C%AA%E8%AF%BB/</guid>
                <pubDate>Mon, 18 Nov 2019 10:59:42 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>213</p>
<h2 id="康奈尔笔记法">康奈尔笔记法</h2>
<p>2019年11月25日12:26:15</p>
<p>上半右边为要点，左边为线索，下部为总结。看的过程中记录要点，看完了提炼线索。总结整个笔记，用自己的语言，最好与已经会的东西发生练习。</p>
<h2 id="postgresql与mysql对比">PostgreSQL与MySQL对比</h2>
<p><a href="https://www.zhihu.com/question/20010554">知乎帖子</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html">pg攻略</a></p>
<h2 id="python控制手机">python控制手机</h2>
<p><a href="https://zhuanlan.zhihu.com/p/57349184">https://zhuanlan.zhihu.com/p/57349184</a></p>
<h2 id="梯子攻略">梯子攻略</h2>
<p><a href="https://github.com/haoel/haoel.github.io">https://github.com/haoel/haoel.github.io</a></p>
<h2 id="javascript开发者应懂的33个概念">JavaScript开发者应懂的33个概念</h2>
<p><a href="https://github.com/stephentian/33-js-concepts">https://github.com/stephentian/33-js-concepts</a></p>
<h2 id="如何写文档">如何写文档</h2>
<p><a href="https://www.divio.com/blog/documentation/">https://www.divio.com/blog/documentation/</a></p>
<h2 id="反向面试的问题">反向面试的问题</h2>
<p><a href="https://github.com/yifeikong/reverse-interview-zh">https://github.com/yifeikong/reverse-interview-zh</a></p>
<h2 id="innodb架构">InnoDB架构</h2>
<p><a href="https://mp.weixin.qq.com/s/zKHNaWY5AS0OMmag1mQTKQ">https://mp.weixin.qq.com/s/zKHNaWY5AS0OMmag1mQTKQ</a></p>
<h2 id="uuid">uuid</h2>
<p><a href="https://zh.wikipedia.org/wiki/%E9%80%9A%E7%94%A8%E5%94%AF%E4%B8%80%E8%AF%86%E5%88%AB%E7%A0%81">https://zh.wikipedia.org/wiki/%E9%80%9A%E7%94%A8%E5%94%AF%E4%B8%80%E8%AF%86%E5%88%AB%E7%A0%81</a><br>
<a href="https://github.com/kelektiv/node-uuid">https://github.com/kelektiv/node-uuid</a><br>
<a href="https://www.zhihu.com/question/34876910">https://www.zhihu.com/question/34876910</a></p>
<h2 id="简书收藏可靠web验证">简书收藏：可靠web验证</h2>
<p>aaa</p>
<h2 id="tcp的简单介绍">TCP的简单介绍</h2>
<p><a href="https://robertovitillo.com/what-every-developer-should-know-about-tcp/">https://robertovitillo.com/what-every-developer-should-know-about-tcp/</a></p>
<h2 id="利用-github-action-自动发布电子书">利用 Github Action 自动发布电子书</h2>
<p><a href="https://devops.novalagung.com/en/cicd-serverless-ebook-gitbook-github-pages-actions-calibre.html">https://devops.novalagung.com/en/cicd-serverless-ebook-gitbook-github-pages-actions-calibre.html</a></p>
<h2 id="java实现的正则表达式引擎">Java实现的正则表达式引擎</h2>
<p><a href="https://github.com/xindoo/regex">https://github.com/xindoo/regex</a></p>
<h2 id="使用-lot-改善睡眠">使用 loT 改善睡眠</h2>
<p><a href="https://medium.com/memos-of-the-future/using-iot-to-optimize-your-sleep-c9747bd8633e">https://medium.com/memos-of-the-future/using-iot-to-optimize-your-sleep-c9747bd8633e</a></p>
<h2 id="利用webrtc进行端到端的文件传输">利用webRTC进行端到端的文件传输</h2>
<p><a href="https://webwormhole.io/">https://webwormhole.io/</a></p>
<h2 id="中文github项目排名">中文Github项目排名</h2>
<p><a href="https://github.com/kon9chunkit/GitHub-Chinese-Top-Charts">https://github.com/kon9chunkit/GitHub-Chinese-Top-Charts</a></p>
<h2 id="git的奇技淫巧">Git的奇技淫巧</h2>
<p><a href="https://github.com/521xueweihan/git-tips">https://github.com/521xueweihan/git-tips</a></p>
<h2 id="中国程序员容易发音错误的单词">中国程序员容易发音错误的单词</h2>
<p><a href="https://github.com/shimohq/chinese-programmer-wrong-pronunciation">https://github.com/shimohq/chinese-programmer-wrong-pronunciation</a></p>
<h2 id="程序员如何优雅的挣零花钱">程序员如何优雅的挣零花钱</h2>
<p><a href="https://github.com/easychen/howto-make-more-money">https://github.com/easychen/howto-make-more-money</a></p>
<h2 id="面试基础知识">面试基础知识</h2>
<p>算法、网络、系统设计等</p>
<p><a href="https://github.com/CyC2018/CS-Notes">https://github.com/CyC2018/CS-Notes</a></p>
<h2 id="程序员技术">程序员技术</h2>
<h3 id="程序员基础">程序员基础</h3>
<ol>
<li>算法、数据结构
基础的常用的要掌握：链表、散列表、树，排序、查找</li>
<li>网络协议
基础的：http、websocket
高级的：TCP/IP</li>
</ol>
<h3 id="前端程序员基础">前端程序员基础</h3>
<ol>
<li>程序运行的环境——浏览器——的工作原理
基础的：event loop 、重绘重排、跨域、事件（代理、冒泡）</li>
<li>语言HTML、CSS
块级上下文、盒子模型、居中</li>
<li>语言JavaScript
基础：数据类型、对象函数、创建对象（设计模式）、继承（原型）
中级：模块化、立即执行函数、闭包、变量提升、作用域、箭头函数
高级：深拷贝、截流</li>
<li>语言ES6+
箭头函数、代理、object、array、promise</li>
<li>语言TypeScript
枚举、泛型</li>
<li>框架React
生命周期</li>
</ol>
<h3 id="职业发展">职业发展</h3>
<ol>
<li>自己的有点长处、需要改进加强的地方</li>
<li>职业规划
现在不管是正常的业务需求还是技术难题都能独立地搞定，属于【能做】。接下来是希望【做好】，就是提高效率和质量，比如自动化、规范、设计组件和模块。再往后就做一些传帮带的工作。</li>
</ol>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%85%B6%E4%BB%96/">其他</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Redux Toolkit</title>
                <link>https://wss.cool/redux-toolkit.html</link>
                <guid isPermaLink="true">https://wss.cool/redux-toolkit.html</guid>
                <pubDate>Mon, 28 Oct 2019 10:54:37 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://redux-starter-kit.js.org/introduction/quick-start">Redux Toolkit</a>是 <code>Redux</code> 官方提供的工具箱🧰，它指定了一个 <code>Redux</code> 的使用规则，集成了 <code>immer</code> <code>thunk</code> 等常用的工具库，还有很好的 <code>typescript</code> 支持。</p>
<p>slice</p>
<h2 id="安装">安装</h2>
<pre><code>yarn add @reduxjs/toolkit
// 或者
npx create-react-app my-app --template redux
</code></pre><h2 id="初始化store">初始化store</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">configureStore</span><span class="p">,</span> <span class="nx">createReducer</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;redux-starter-kit&#39;</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">add</span> <span class="o">=</span> <span class="nx">createAction</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">initialState</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">number</span><span class="o">:</span> <span class="mi">0</span> <span class="p">}</span>
<span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">createReducer</span><span class="p">(</span><span class="nx">initialState</span><span class="p">,</span> <span class="p">{</span>
  <span class="p">[</span><span class="nx">add</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">number</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">number</span><span class="p">,</span>
<span class="p">})</span>
<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">configureStore</span><span class="p">({</span><span class="nx">reducer</span><span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">store</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="调用">调用</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// ...
</span><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Provider</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-redux&#39;</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">&#39;./store&#39;</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Provider</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="nx">App</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="err">/Provider&gt;, document.getElementById(&#39;root&#39;)</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// ...
</span><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">useSelector</span><span class="p">,</span> <span class="nx">useDispatch</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-redux&#39;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">add</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./store&#39;</span>
<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">number</span> <span class="o">=</span> <span class="nx">useSelector</span><span class="p">(</span><span class="nx">state</span> <span class="p">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">number</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">useDispatch</span><span class="p">()</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;App&#34;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">number</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">number</span><span class="o">+</span><span class="mi">1</span><span class="p">))}</span><span class="o">&gt;</span> <span class="o">+</span> <span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="创建store">创建store</h3>
<p>configureStore用于初始化redux仓库，可以合并reducer，可以方便的创建中间件等。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">configureStore</span><span class="p">({</span>
    <span class="c1">// A single reducer function that will be used as the root reducer,
</span><span class="c1"></span>    <span class="c1">// or an object of slice reducers that will be passed to combineReducers()
</span><span class="c1"></span>    <span class="nx">reducer</span><span class="o">:</span> <span class="nb">Object</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">ReducerFunction</span><span class="o">&gt;</span> <span class="o">|</span> <span class="nx">ReducerFunction</span><span class="p">,</span>
    <span class="c1">// An array of Redux middlewares.  If not supplied, uses getDefaultMiddleware()
</span><span class="c1"></span>    <span class="nx">middleware</span><span class="o">?:</span> <span class="nx">MiddlewareFunction</span><span class="p">[],</span>
    <span class="c1">// Enable support for the Redux DevTools Extension. Defaults to true.
</span><span class="c1"></span>    <span class="nx">devTools</span><span class="o">?:</span> <span class="kr">boolean</span> <span class="o">|</span> <span class="nx">EnhancerOptions</span><span class="p">,</span>
    <span class="c1">// Same as current createStore.
</span><span class="c1"></span>    <span class="nx">preloadedState</span><span class="o">?:</span> <span class="nx">State</span><span class="p">,</span>
    <span class="c1">// An optional array of Redux store enhancers
</span><span class="c1"></span>    <span class="nx">enhancers</span><span class="o">?:</span> <span class="nx">ReduxStoreEnhancer</span><span class="p">[],</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p>例子</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">configureStore</span><span class="p">({</span>
  <span class="nx">reducer</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">config</span><span class="o">:</span> <span class="nx">configReducer</span><span class="p">,</span>
    <span class="nx">counter</span><span class="o">:</span> <span class="nx">counterReducer</span>
  <span class="p">},</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react/">React</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>JavaScript语言精华</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/javascript/javascript%E8%AF%AD%E8%A8%80%E7%B2%BE%E5%8D%8E/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/javascript/javascript%E8%AF%AD%E8%A8%80%E7%B2%BE%E5%8D%8E/</guid>
                <pubDate>Wed, 23 Oct 2019 06:56:30 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="精华">精华</h2>
<p>我相信我精雕细琢出来的优雅子集大大地优于这门语言的整体，它更可靠、更易读、更易于维护。</p>
<p>浏览器API和DOM相当糟糕，连累了JavaScript。写一本DOM的精华的书是一项不可能完成的任务。</p>
<p>JavaScript中优秀的想法包括函数、弱类型、动态对象和富有变现力的对象字面量表示法。糟粕的想法包括基于全局变量的编程模型。</p>
<h2 id="对象">对象</h2>
<p>JavaScript包含一种原型链的特性，允许对象继承另一个对象的属性。</p>
<h3 id="原型">原型</h3>
<p>每个对象都连接到一个原型对象，并可以从中继承属性。对象字面量创建的对象都连接到Object.prototype，它是JavaScript中过的标配对象。</p>
<h2 id="函数">函数</h2>
<h3 id="函数对象">函数对象</h3>
<p>函数也是对象，对象字面量创建的对象连接到Object.prototype，函数对象连接到Function.prototype，而它又连接到Object.prototype</p>
<h3 id="函数字面量">函数字面量</h3>
<p>通过函数字面量创建的函数对象包含一个连到外部上下文的连接。这被称为闭包（closure）。</p>
<h3 id="调用">调用</h3>
<p>除了声明时定义的形式参数，每个函数还接收两个附加的参数：this和arguments。</p>
<p>this的值取决于调用的模式。有4中调用模式：方法、函数、构造器、apply。</p>
<h4 id="方法调用模式">方法调用模式</h4>
<p>函数被作为一个对象的属性，就教方法。此时this为该对象。</p>
<h4 id="函数调用模式">函数调用模式</h4>
<p>函数没有作为对象的属性，他就被当作一个函数调用了。此模式this被绑定到全局变量。</p>
<p>如果在一个方法内，又定义了一个函数，而这个函数中使用了this，那么这个this就是指向的全局变量。这是一个语言设计错误，正确的设计应该是指向方法中的this。有一个容易的解决方案：将方法中的一个变量赋值为this，函数中访问变量即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">myObject</span><span class="p">.</span><span class="kr">double</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">helper</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">that</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">helper</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>helper</code> 函数中如果使用 <code>this</code> 这个 <code>this</code> 就是指向全局变量。</p>
<h4 id="构造器调用模式">构造器调用模式</h4>
<p>JavaScript是一门基于<strong>原型</strong>继承的语言，这意味这一个对象可以从另一个对象继承属性。该语言是无类型的。（es6呢？）</p>
<p>用 <code>new</code> 调用一个函数，会创建一个连接到该函数的 <code>prototype</code> 成员的新对象，同时将 <code>this</code> 绑定到那个新对象上。这就是构造器调用。</p>
<h4 id="apply调用模式">Apply调用模式</h4>
<p>因为JavaScript是一门函数式的面向对象语言，所以函数可以拥有方法。</p>
<p>apply 方法接受2个参数，绑定的 this ，和参数数组。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">sum</span>  <span class="o">=</span> <span class="nx">add</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">array</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="闭包">闭包</h3>
<p>一个函数可以访问它被创建时的上下文环境就叫闭包。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">increment</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">inc</span><span class="p">){</span>
      <span class="nx">value</span> <span class="o">+=</span> <span class="k">typeof</span> <span class="nx">inc</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">?</span> <span class="nx">inc</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">getValue</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})()</span>
</code></pre></td></tr></table>
</div>
</div><p><code>incerment</code> 和 <code>getValue</code> 两个函数被创建的上下文中有一个 <code>value</code> 变量。这两个函数可以访问 <code>value</code> ，这就叫 <code>闭包</code> 。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>ARTS打卡</title>
                <link>https://wss.cool/arts%E6%89%93%E5%8D%A1.html</link>
                <guid isPermaLink="true">https://wss.cool/arts%E6%89%93%E5%8D%A1.html</guid>
                <pubDate>Tue, 22 Oct 2019 16:35:08 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h1 id="algorithm">Algorithm</h1>
<p>每周至少做一个LeetCode的算法题。为了编程训练和学习，只看书不训练是没用的。</p>
<h1 id="review">Review</h1>
<p>阅读并点评至少一篇英文技术文章。为了学习英文。</p>
<h1 id="tip">Tip</h1>
<p>学习至少一个技术技巧，为了总结和归纳在日常工作中遇到的知识点。</p>
<h1 id="share">Share</h1>
<p>分享一篇有观点和思考的技术文章，为了建立影响力，输出价值观。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%8A%98%E8%85%BE/">折腾</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>React Spring</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/react/react-spring/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/react/react-spring/</guid>
                <pubDate>Tue, 22 Oct 2019 14:19:59 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://www.react-spring.io">react-spring</a> 是一个基于弹簧物理学的动画库。</p>
<p>最基本的用法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span><span class="nx">useSpring</span><span class="p">,</span> <span class="nx">animated</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-spring&#39;</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">props</span> <span class="o">=</span> <span class="nx">useSpring</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">from</span><span class="o">:</span> <span class="p">{</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">}})</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">animated</span><span class="p">.</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">I</span> <span class="nx">will</span> <span class="nx">fade</span> <span class="k">in</span><span class="o">&lt;</span><span class="err">/animated.div&gt;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>其中的useSpring可以创造一个js动画，这种动画默认不需要设置持续时间，他通过一些弹簧参数来控制动画的表现。可以通过config设置这些参数，像这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">useSpring</span><span class="p">({</span> <span class="nx">config</span><span class="o">:</span> <span class="p">{</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">250</span> <span class="p">},</span> <span class="p">...</span> <span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p>参数有哪些可以看Common api这节文档。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">useSpring</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">from</span><span class="o">:</span> <span class="p">{</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">}})</span>
</code></pre></td></tr></table>
</div>
</div><p>from为动画开始的值，1为动画最后的值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">useSpring</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">to</span><span class="o">:</span> <span class="p">{</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">}})</span>
</code></pre></td></tr></table>
</div>
</div><p>1为动画开始的值，to为动画最后的值。</p>
<p>如果useSpring中变化的值可以直接使用，比如颜色、数字，则可以直接使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">animated</span><span class="p">.</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">I</span> <span class="nx">will</span> <span class="nx">fade</span> <span class="k">in</span><span class="o">&lt;</span><span class="err">/animated.div&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>或这样</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">animated</span><span class="p">.</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">number</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/animated.span&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>如果useSpring中变化的值需要组合成字符串，比如transform，则需要使用插值函数(interpolate)来实现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">animated</span><span class="p">.</span><span class="nx">div</span>
  <span class="nx">style</span><span class="o">=</span><span class="p">{{</span>
    <span class="nx">background</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">(</span><span class="nx">o</span> <span class="p">=&gt;</span> <span class="sb">`rgba(210, 57, 77, </span><span class="si">${</span><span class="nx">o</span><span class="si">}</span><span class="sb">)`</span><span class="p">),</span>
    <span class="nx">transform</span><span class="o">:</span> <span class="nx">xyz</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">((</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`translate3d(</span><span class="si">${</span><span class="nx">x</span><span class="si">}</span><span class="sb">px, </span><span class="si">${</span><span class="nx">y</span><span class="si">}</span><span class="sb">px, </span><span class="si">${</span><span class="nx">z</span><span class="si">}</span><span class="sb">px)`</span><span class="p">),</span>
    <span class="nx">border</span><span class="o">:</span> <span class="nx">interpolate</span><span class="p">([</span><span class="nx">o</span><span class="p">,</span> <span class="nx">color</span><span class="p">],</span> <span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">o</span> <span class="o">*</span> <span class="mi">10</span><span class="si">}</span><span class="sb">px solid </span><span class="si">${</span><span class="nx">c</span><span class="si">}</span><span class="sb">`</span><span class="p">),</span>
    <span class="nx">padding</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">({</span><span class="nx">range</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nx">output</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]}).</span><span class="nx">interpolate</span><span class="p">(</span><span class="nx">o</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">o</span><span class="si">}</span><span class="sb">%`</span><span class="p">),</span>
    <span class="nx">borderColor</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">({</span><span class="nx">range</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nx">output</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffaabb&#39;</span><span class="p">]}),</span>
    <span class="nx">opacity</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
  <span class="p">}}</span>
<span class="o">&gt;</span>
  <span class="p">{</span><span class="nx">o</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">(</span><span class="nx">n</span> <span class="p">=&gt;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="cm">/* innerText interpolation ... */</span><span class="p">}</span>
<span class="o">&lt;</span><span class="err">/animated.div&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>useSpring中传值可以是任意的字段</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">useSpring</span><span class="p">({</span><span class="nx">everything</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">to</span><span class="o">:</span> <span class="p">{</span><span class="nx">everything</span><span class="o">:</span> <span class="mi">0</span><span class="p">}})</span>
</code></pre></td></tr></table>
</div>
</div><p>可以在代码中更新spring</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="p">[</span><span class="nx">props</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">stop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useSpring</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">}))</span>

<span class="c1">// Update spring with new props
</span><span class="c1"></span><span class="nx">set</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="nx">toggle</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="c1">// Stop animation
</span><span class="c1"></span><span class="nx">stop</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>可以设置成多段动画</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">set</span><span class="p">({</span>
  <span class="nx">to</span><span class="o">:</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">next</span><span class="p">,</span> <span class="nx">cancel</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="nx">next</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;#ffaaee&#39;</span><span class="p">})</span>
    <span class="nx">await</span> <span class="nx">next</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;rgb(14,26,19)&#39;</span><span class="p">})</span>
  <span class="p">},</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p>动画结束时触发事件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">set</span><span class="p">({</span>
  <span class="c1">// 其他动画参数...
</span><span class="c1"></span>  <span class="nx">onRest</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 动画结束事件
</span><span class="c1"></span>    <span class="nx">props</span><span class="p">.</span><span class="nx">onWrong</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react%E5%BA%93/">React库</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>[机翻]如何解决问题</title>
                <link>https://wss.cool/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98.html</link>
                <guid isPermaLink="true">https://wss.cool/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98.html</guid>
                <pubDate>Mon, 21 Oct 2019 16:54:43 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>此为机翻文章，<a href="https://medium.com/free-code-camp/how-to-think-like-a-programmer-lessons-in-problem-solving-d1d8bf1de7d2">原文在此</a>。</p>
<h1 id="解决问题方法">解决问题方法</h1>
<p>当遇到新问题时，你该怎么做？</p>
<h1 id="1理解明白">1.理解、明白</h1>
<p>确切的知道要问什么。大多数难题之所以难是因为你不理解它。</p>
<p>怎么知道你理解一个问题呢？当你可以简单的术语解释它的时候。</p>
<p>你还记得吗，当你被一个问题卡住，你开始解释它，你会立即发现以前从未见过的逻辑漏洞？</p>
<p>多数程序员知道这种感觉。</p>
<blockquote>
<p>“If you can’t explain something in simple terms, you don’t understand it.” — Richard Feynman</p>
</blockquote>
<h1 id="2计划">2.计划</h1>
<p>不要没有计划就直接解决问题（以某种方式希望您能摸索到底）。规划您的解决方案！</p>
<p>如果你不能写下具体的步骤，将无济于事。在编程中，这意味着不要马上开始写代码。要给你的大脑时间，处理问题、分析信息。</p>
<p>为这个为题给出一个计划：</p>
<p>“当输入X时，有哪些必要的步骤才能输出Y？”</p>
<p>旁注：程序员有一个很棒的工具来帮助他们。</p>
<h1 id="3划分">3.划分</h1>
<p>请注意。这是最重要的一步。</p>
<p>不要试图解决一个大问题。你会哭。而是将其分解为多个子问题。这些子问题更容易解决。</p>
<p>然后，一个一个地解决每个子问题。从最简单的开始。最简单意味着您知道答案（或更接近答案）。</p>
<p>此后，最简单的方法意味着要解决的子问题不依赖于要解决的其他问题。</p>
<p>解决了每个子问题后，将点连接起来。连接所有“子解决方案”将为您解决原始问题。恭喜你！</p>
<p>该技术是解决问题的基石。记住这一点（如果需要，请再次阅读此步骤）。</p>
<h1 id="4卡住了吗">4.卡住了吗？</h1>
<p>到现在为止，您可能坐在那里想：“嗨，理查德……太酷了，但是，如果我被卡住甚至不能解决子问题怎么办？”</p>
<p>首先，深呼吸。第二，这很公平。</p>
<p>朋友，请不要担心。这发生在每个人身上！不同之处在于，最好的程序员/问题解决者对bugs/errors的好奇大于对错误的恼怒。</p>
<p>实际上，面对混乱时，可以尝试以下三件事：</p>
<ol>
<li>调试：逐步解决您的解决方案，尝试找出问题所在。程序员将其称为调试（实际上，这是调试器的全部工作）。</li>
<li>重新评估： 退后一步。从另一个角度看问题。有什么可以抽象为更通用的方法的吗？</li>
<li>研究： 啊，Google不错。您没看错。无论您遇到什么问题，都可能有人解决了。找到那个人/解决方案。实际上，即使您解决了问题，也要这样做！（您可以从其他人的解决方案中学到很多东西）。</li>
</ol>
<p>警告：不要为大问题寻找解决方案。只寻找子问题的解决方案。为什么？因为除非您奋斗（一点点），否则您将不会学到任何东西。如果您什么都不学，那您就浪费了时间。</p>
<h1 id="实践">实践</h1>
<p>仅仅一周之后，别指望自己变得很棒。如果您想成为一个好的问题解决者，请解决很多问题！</p>
<p>实践。实践。实践。认识到“使用“在此处插入概念”可以轻松解决此问题”只是时间问题。</p>
<p>怎么练习？wazoo有多种选择！</p>
<p>国际象棋难题，数学问题，数独，围棋，专卖，视频游戏，加密小猫，等等……等等……等等……。</p>
<p>实际上，在成功人士中，常见的习惯是练习“解决微观问题”的习惯。例如，彼得·泰尔（Peter Thiel）下棋，伊隆·马斯克（Elon Musk）玩电子游戏。</p>
<p>例如，我喜欢编码方面的挑战。每天，我都会尝试解决至少一个难题（通常在Coderbyte上）。</p>
<p>就像我说的，所有问题都有相似的模式。</p>
<h1 id="结论">结论</h1>
<p>那是所有人！
现在，您更好地了解了“像程序员一样思考”的含义。
您还知道解决问题是一种不可思议的技能（超能力）。
如果这还不够，请注意您还知道如何去练习解决问题的技能！
ew……挺酷的吧？
最后，祝您遇到许多问题。
您没看错。至少现在您知道如何解决它们了！（此外，您将了解到每种解决方案都可以改进）。</p>
<blockquote>
<p>“只要您认为自己已经成功克服了一个障碍，就会出现另一个障碍。但这就是让生活变得有趣的原因。
生活是突破这些障碍的过程，这是我们必须突破的一系列防御性路线。
每次，您都会学到一些东西。
每次，您都会发展力量，智慧和远见。
每次，更多的竞争都会消失。直到剩下的只有你：你最好的版本。” —瑞安·霍里</p>
</blockquote>
<p>现在，去解决一些问题！</p>
<p>祝你好运🙂</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/">心得与经验</category>
                                
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%9C%BA%E7%BF%BB/">机翻</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Hugo</title>
                <link>https://wss.cool/posts/%E5%B7%A5%E5%85%B7/hugo/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%B7%A5%E5%85%B7/hugo/</guid>
                <pubDate>Thu, 10 Oct 2019 14:15:23 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>这个博客是使用hugo搭建的，选择来一个大体喜欢的主题。但是有一些细节还是不够满意，所以如何改造hugo主题，加上自己想要的内容，就成了一个值得研究的问题。</p>
<h2 id="sections">Sections</h2>
<p>content目录下的各个一级子目录就是一个section，它们是first-level的section，可以为它们定义layout组织内容，并通过url来访问（默认就是目录）。</p>
<p>一级子目录下也可有任意深度的子目录，只要子目录中定义_index.md就可以作为一个section。</p>
<p>section除了可以通过以目录层级为url访问，还可以获得到属于它的子文章列表。</p>
<h2 id="分类法taxonomies">分类法（Taxonomies）</h2>
<p>我想解决的第一个问题就是文章的分类，因为一个单纯的列表看上去可能有点散乱。观察创建文章的可选参数，以及其他博客。可以确定hugo是支持分类的。在官网文档中的Content Management下有Taxonomies，阅读内容后可以确定，这就是我想找的东西。</p>
<p>在hugo中，用“Taxonomies”这个术语表示“文章的分类”。相关的有三个概念：</p>
<ul>
<li>Taxonomy -&gt; 一个分类</li>
<li>Term -&gt; 一个分类的项目</li>
<li>Value -&gt; 一个项目的值</li>
</ul>
<p>比如：</p>
<pre><code>Year                &lt;- Taxonomy
    2018              &lt;- Term
        前端入门          &lt;- Value
        Vue入门          &lt;- Value
        React入门        &lt;- Value
    2019              &lt;- Term
        前端进阶          &lt;- Value
        vue进阶           &lt;- Value
        react进阶         &lt;- Value
categories         &lt;- Taxonomy
    css              &lt;- Term
        flex布局          &lt;- Value
        css module       &lt;- Value
        background渐变色  &lt;- Value
    框架              &lt;- Term
        Vue入门           &lt;- Value
        React入门         &lt;- Value
        vue进阶           &lt;- Value
        react进阶         &lt;- Value
</code></pre><p>这里的“value”对应的都是文章的题目，“term”对应一个分类中具体有哪些项，“taxonomy”则是我们预先定义好的分类的名字。</p>
<p>这些需要通过站点配置和文章首部信息才可以实现。</p>
<p>在“站点配置”中设置有哪些Taxonomy，在“文章首部”标记该文章是哪个Taxonomy中的哪种Term</p>
<h3 id="站点配置">站点配置</h3>
<p>站点配置文件一般位于博客根目录中，叫做“config.toml”，在其中加上下面这段代码</p>
<pre><code>[taxonomies]
  category = &quot;categories&quot;
  year = &quot;year&quot;
</code></pre><h3 id="文章首部">文章首部</h3>
<p>创建每个文章时，都会有一些首部信息配置，现在这篇文章的首部信息如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml">---<span class="w">
</span><span class="w"></span><span class="k">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Hugo&#34;</span><span class="w">
</span><span class="w"></span><span class="k">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/Hugo&#34;</span><span class="w">
</span><span class="w"></span><span class="k">toc</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w"></span><span class="k">date</span><span class="p">:</span><span class="w"> </span><span class="ld">2019-10-10T14:15:23</span><span class="m">+08</span><span class="p">:</span><span class="m">00</span><span class="w">
</span><span class="w"></span><span class="k">author</span><span class="p">:</span><span class="w"> </span>王书硕<span class="w">
</span><span class="w"></span><span class="k">description</span><span class="p">:</span><span class="w"> </span>了解hugo，将它改造成你想要的样子。<span class="w">
</span><span class="w"></span><span class="k">categories</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- 工具<span class="w">
</span><span class="w"></span><span class="k">year</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="m">2019</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>其中最下面的两项——“categories”和“year”——就是上面提到的“Taxonomy”，“工具”和“2019”则是“Term”，而这篇文章就是“value”了。</p>
<p>准备好了这些配置以后，</p>
<p>……两种方式展示分类，一种是在一个特定的页面，一种是在其他地方。两种方式引用题目的方法不同。</p>
<h3 id="展示分类">展示分类</h3>
<p>第一种展示方式是在<code>layouts/_default/terms.html</code>中，如下面的代码即可展示一种terms。通过访问地址<code>localhost:1313/categories/</code>或<code>localhost:1313/year/</code>即可查看到该页面。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{{ define &#34;main&#34; }}
<span class="p">&lt;</span><span class="nt">main</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;main&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ .Title }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {{ range .Data.Terms.ByCount  }}
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ .Page.RelPermalink }}&#34;</span><span class="p">&gt;</span>{{ printf &#34;%s&#34; .Page.Title }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ printf &#34;(%d)&#34; .Count }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {{ end }}
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
{{ end }}
</code></pre></td></tr></table>
</div>
</div><p>第二种展示方式是任意一个页面，比如主页<code>layouts/index.html</code>模板中，通过<code>Site</code>变量引用分类数据。同样的其中的<code>categories</code>也可以替换成定义好的其他terms。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
  {{ range .Site.Taxonomies.categories }}
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ .Page.Permalink }}&#34;</span><span class="p">&gt;</span>{{ .Page.Title }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> {{ .Count }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  {{ end }}
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>排序</p>
<p>按字母排序</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {{ range .Data.Terms.Alphabetical }}
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ .Page.Permalink }}&#34;</span><span class="p">&gt;</span>{{ .Page.Title }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> {{ .Count }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {{ end }}
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>按数量排序</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {{ range .Data.Terms.ByCount }}
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ .Page.Permalink }}&#34;</span><span class="p">&gt;</span>{{ .Page.Title }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> {{ .Count }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {{ end }}
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>……有了这些还不够还需要term页面</p>
<p>……综上……实现了分类……</p>
<h2 id="seo">SEO</h2>
<p>robots.txt</p>
<p>setmap.xml</p>
<p>google search console</p>
<p>head模版</p>
<h2 id="摘要summary">摘要（summary）</h2>
<p>摘要最重要的一个用处是生成head中的description标签（这个是主题的head.html部分定义的，可以修改成其他内容），搜索引擎会将其中的内容展示在搜索结果中。（搜索结果中也可能不显示摘要，而现实搜索引擎自己生成的内容）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;description&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;测试一哈&#34;</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>另一个用处是用来在文章列表中展示，比如在网站首页展示10篇最近的文章，并显示其摘要。</p>
<p>两种方式可以定义一篇文章的摘要：在首部定义summary变量、在文章中使用摘要分隔符<code>&lt;!--more--&gt;</code>。后者权重更高。</p>
<p>当文章开头的几行可以准确的概括文章包含内容时，摘要分隔符<code>&lt;!--more--&gt;</code>比较适用。不然的话，就自己编辑一段摘要放在首部的summary变量中。</p>
<p>另外可以在网站配置中使用<code>summaryLength</code>控制摘要的字符长度，但是对中文貌似不起作用。</p>
<h2 id="函数">函数</h2>
<p><a href="https://gohugo.io/functions/">文档</a></p>
<p>遍历集合用<code>range</code></p>
<pre><code>&lt;ul&gt;
  {{ range .Site.Taxonomies.categories }}
    &lt;li style=&quot;text-align:left;&quot;&gt;&lt;a href=&quot;{{ .Page.Permalink }}&quot;&gt;{{ .Page.Title }}&lt;/a&gt; {{ .Count }}&lt;/li&gt;
  {{ end }}
&lt;/ul&gt;
</code></pre><p>对集合进行排序用<code>sort</code>，相较上面的代码，其中<code>count</code>是用哪个字段进行排序，<code>desc</code>表示降序</p>
<pre><code>&lt;ul&gt;
  {{ range sort .Site.Taxonomies.categories &quot;Count&quot; &quot;desc&quot; }}
    &lt;li style=&quot;text-align:left;&quot;&gt;&lt;a href=&quot;{{ .Page.Permalink }}&quot;&gt;{{ .Page.Title }}&lt;/a&gt; {{ .Count }}&lt;/li&gt;
  {{ end }}
&lt;/ul&gt;
</code></pre><h2 id="多语言模式">多语言模式</h2>
<p>hugo可以管理多种语言，但是要自己翻译内容</p>
<p><a href="https://gohugo.io/content-management/multilingual/">配置多种语言</a>
<a href="https://regisphilibert.com/blog/2018/08/hugo-multilingual-part-1-managing-content-translation/">翻译内容</a></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/">工具</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>职业发展</title>
                <link>https://wss.cool/posts/%E5%BF%83%E5%BE%97/%E8%81%8C%E4%B8%9A%E5%8F%91%E5%B1%95/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%BF%83%E5%BE%97/%E8%81%8C%E4%B8%9A%E5%8F%91%E5%B1%95/</guid>
                <pubDate>Mon, 07 Oct 2019 18:05:05 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h1 id="七个对我最重要的职业建议阮一峰翻译">七个对我最重要的职业建议（阮一峰翻译）</h1>
<p><a href="http://www.ruanyifeng.com/blog/2015/09/career-advice.html">ruanyifeng</a></p>
<h2 id="一不要别人点什么就做什么">一、不要别人点什么就做什么</h2>
<p>“不要做一个别人点了什么才就烧什么的厨师，也不要这样的地方工作，你要去一个地方，那里的人能肯定你对产品的想法，相信你的能力，放手让你去做。”</p>
<p>单单实现一个产品是不够的，你还必须参与决定怎么实现。好的工程师并不仅仅服从命令，而且还会给出反馈，帮助产品的拥有者改进它。</p>
<p>🤔从技术角度改进产品？或者技术角度的feature吗？比如实现更好的交互，新的技术可以做更好的事情？</p>
<p>🤔不能只是让别人给你一个技术方案你只负责实现它，而是要自己能设计一个方案，甚至可以根据自己的技术给出一个让不同feature变成高级的feature。比如更节省成本，时间少人力少、效率高机器成本低、交互好、更美观、用户体验更好等等。总之就是，因为你的一些想法，原来那个别人提出来的东西别的更好了。</p>
<p>🤔对自己有什么好处呢？输出一些想法，肯定是要付出精力的，那么这些精力能不能有所回报呢？首先，它能体现分析、解决问题的能力，体现积极、负责，其次，进一步端粒自己分析、解决问题的能力，锻炼表达能力，这些经验多了起来，就相对其他人来说是一种优势，能创造出一些价值，可以写在简历中，对某某功能提出哪些想法，使成本降低了多少，收益增加了多少。</p>
<h2 id="二推销自己">二、推销自己</h2>
<p>“为了让其他人相信你，你必须首先让别人知道你做了什么。你需要推销自己，引起别人的注意。”</p>
<p>公司的其他人需要明白你的价值，最好的办法就是告诉别人你做了什么。</p>
<p>🤔写邮件告诉别人真的好吗？可能还是写博客好一点吧，但是博客很难找到读者，可以通过掘金、csdn之类的引流一下。</p>
<h2 id="三学会带领团队">三、学会带领团队</h2>
<p>&quot;当你的技术能力过关以后，就要考验你与他人相处的能力了。&quot;</p>
<p>如何带领一个团队，有效地与其他人协同工作，取到更大的成果。</p>
<p>🤔先看一下左耳朵的文章学习一下沟通技术。</p>
<p>🤔目前我只需要考虑一二三这几个问题。</p>
<h2 id="四生活才是最重要的">四、生活才是最重要的</h2>
<h2 id="五自己找到道路">五、自己找到道路</h2>
<p>&quot;以前都是我们告诉你做什么，从现在开始，你必须自己回答这个问题了，我期待你来告诉我，什么事情需要做。&quot;</p>
<p>很多工程师都没有完成这个转变，如果能够做到，可能就说明你成熟了，学会了取舍。你不可能把时间花在所有事情上面，必须找到一个重点。</p>
<h2 id="六把自己当成主人">六、把自己当成主人</h2>
<p>&quot;不要再去开这样的会了。你参加一个会，那是因为你参与了某件事。如果不确定自己为什么要在场，就停下来问。如果这件事不需要你，就离开。不要从头到尾都静静地参加一个会，要把自己当成负责人，大家会相信你的。&quot;</p>
<p>从那时起，我从没有一声不发地参加会议。我确保只参加那些需要我参加的会议。</p>
<h2 id="七找到水平更高的人">七、找到水平更高的人</h2>
<p>&quot;找到那些比你水平更高、更聪明的人，尽量和他们在一起，吃饭或者喝咖啡，向他们讨教，了解他们拥有的知识。你的职业，甚至你的生活，都会因此变得更好。&quot;</p>
<h1 id="面试时如何向公司提问">面试时，如何向公司提问？</h1>
<p><a href="http://www.ruanyifeng.com/blog/2012/08/questions_you_need_to_ask_in_an_interview.html">ruanyifeng</a></p>
<p>有一些注意点，你需要知道：</p>
<ol>
<li>面试之前，一定要做准备，多了解公司的情况。</li>
<li>你提出的问题，应该围绕&quot;这份工作是否合适我&quot;这个中心点，其他与应聘关系不大的问题，不宜多问。</li>
<li>提问的时候，要自然放松，不要害羞，就把它当作普通的聊天。你要表现出对公司的真诚兴趣。</li>
<li>提问要直接了当，不要绕圈子。提出问题之后，你要保持安静，让面试官多说话。</li>
<li>面试官回答的时候，你可以做笔记，或者事先询问能不能做。笔记必须简短，你的大部分时间，要用来全神贯注倾听面试官的回答，并与其有眼神的交流。</li>
<li>面试结束后一周内，最好打一个电话或发一封邮件，了解公司对你的反馈意见。即使面试失败，你不妨也问一下原因，这会有助于你以后的面试。</li>
</ol>
<p>6个问题</p>
<ol>
<li>为什么招人，之前的人离职了还是公司增长扩张。</li>
<li>为什么大家想留在你们公司。公司的文化、价值观、环境对员工的影响。</li>
<li>如果被录用了，在上班的头两三个月，公司希望我做到的三件事是什么？</li>
<li>一个人像成功地做好这份工作，需要哪些东西？</li>
<li>我刚才说过的话里，是否有哪些内容让你华裔我不适合这份工作。</li>
<li>你们什么时候会做最后的决定？</li>
</ol>
<p><strong>围绕“这份工作是否合适我”提问</strong></p>
<p>下面是一些你可以问的典型问题。</p>
<p><strong>问题一：你们为什么要招聘这个职位？</strong></p>
<p>这个问题会使得面试官开始谈论当前的项目，或者谈论前一位离职人员。无论哪种情况，都会让你了解，一些与你最密切相关的公司情况。</p>
<p><strong>问题二：你们的新员工多吗？</strong></p>
<p>这个问题起一个过渡作用，使得谈话导向公司内部的情况。但是，它本身也能说明一些问题。如果公司成立已经超过四年，又没有新项目，但是新员工却很多，这往往说明公司文化不是很健康。</p>
<p><strong>问题三：你们公司（团队）目前面临的最大挑战是什么？</strong></p>
<p>如果面试官开始谈论一些具体的技术问题，这很好；如果他的回答是项目时间紧迫，或者需要更多的资金，那你就要小心一点了，公司管理上面可能有问题。</p>
<p><strong>问题四：什么新技术（编程语言）是你们未来希望采用的？</strong></p>
<p>如果你申请的是技术职位，面试官恰巧又是技术负责人，那么这个问题将会非常合适。你会对公司的技术路线有所了解和准备，一旦入职，就能更好地适应公司的需要。</p>
<p><strong>问题五：在业务方面，有没有什么地方是你们不满意的，未来想要改进的？</strong></p>
<p>很少有公司，会百分之百满意自身的现状，即使那些状况很良好的公司也是如此。这个问题可以让你对公司管理层的关注重点和担忧之处，有所了解。</p>
<p><strong>问题六：我申请的这个职位，对公司的业务有何影响？</strong></p>
<p>这个问题会让你了解自己在公司的角色，以及你的岗位对公司是否重要。</p>
<h1 id="如何提高求职时的谈判能力">如何提高求职时的谈判能力？</h1>
<p>（1）记住你不是在求职，不是在展示编程技巧，而是在推销某种商业问题（增加收入或降低成本）的解决方案。</p>
<p>（2）面试时，要有自信，要平等的对话。你要的是一个互利的录用合同，不要每次对方提出要求，你都说Yes。</p>
<p>（3）雇主可能会问&quot;你的上一份工资是多少&quot;，他们其实在说&quot;给我一个理由，压低你的报酬&quot;。你要想好如何适当地回答这个问题。</p>
<p>（4）要还价。这里不仅仅指钱，还指其它你关心的方面。如果你无法要求更高的薪水，那就试着要求更多的假期。</p>
<p>（5）在对方决定录用你以后，才开始讨论薪水。因为那时，他们已经在你身上，投入了大量的时间和金钱，产生了一定的成本，此时他们可能觉得一些小问题已经不值得再纠缠了，比如每年的工资增加几千元。</p>
<h1 id="产品五问">产品五问</h1>
<ol>
<li>给谁用？</li>
<li>他们用这个产品来解决什么问题？</li>
<li>这个问题对他们而言有多重要？</li>
<li>我们的方法是否足够简单方便？</li>
<li>他们要付出的代价与所得是否匹配？</li>
</ol>
<h1 id="创业公式">创业公式</h1>
<p>Paul Graham的创业公式就是：搭建原型、上线运营（别管bug）、收集反馈、调整产品、成长壮大。</p>
<h1 id="程序员的能力">程序员的能力</h1>
<p><strong>基础：掌握语言。</strong></p>
<p>比如熟悉js——看《忍者秘籍》《语言精髓》《es6》等，而掌握语言的基础</p>
<p><strong>进阶：掌握框架、语言细节、重要的工具。babel等的插件，开发一个通用sdk。</strong></p>
<p>比如掌握react和vue的原理，状态数据管理redux和vuex等等。</p>
<p>比如git的各种常用用法。</p>
<p><strong>高级：通用解决方案。</strong></p>
<p>比如：算法、并发、分布式、沟通技巧、表达能力、领导能力</p>
<p><strong>亮点：</strong></p>
<p>技能和能力有多种，不可能也不需要掌握太多，有一两种能够给别人留下深刻印象即可。</p>
<p>比如java方向的可以是这些：</p>
<ul>
<li>你特别熟悉Spring，跟它有关的啥问题啥需求你都能搞定</li>
<li>你特别会建数据库索引，分析慢SQL原因</li>
<li>你特别会写脚本进行自动化</li>
<li>你特别会看源代码，会debug</li>
<li>你对多线程特别熟悉</li>
<li>你特别会对JVM调优</li>
<li>你特别会进行性能调优</li>
</ul>
<p>前端方向可以有哪些呢？</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/">心得与经验</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>内容分发网络</title>
                <link>https://wss.cool/cdn.html</link>
                <guid isPermaLink="true">https://wss.cool/cdn.html</guid>
                <pubDate>Fri, 27 Sep 2019 13:16:55 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<blockquote>
<p>以下将内容分发网络简称为CDN</p>
</blockquote>
<h2 id="cdn是什么">CDN是什么</h2>
<p>如果没有CDN</p>
<pre><code>www.baidu.com 
-&gt; DNS解析 
-&gt; 123.123.123.123
</code></pre><p>加入了CDN以后</p>
<pre><code>访问 www.baidu.com  
-&gt; DNS解析为CNAME域名 
-&gt; CDN地址image.baidu.cnd258.com 
-&gt; 在CDN服务器中未发现请求的资源 
-&gt; 到源服务器请求资源
</code></pre><p>当再次请求相同的资源时，CDN服务器会直接返回资源，而不会访问源服务器。</p>
<ol>
<li>由于有了cdn缓存资源，源服务器的压力大大减小。避免了由于访问量过多而无法响应请求。</li>
<li>cdn服务商有大量的服务器分布于广阔的地理范围内，可以就近响应请求，从而提高响应请求的速度。</li>
<li>可以通过cdn的api提前将cdn没有缓存的资源添加到缓存中，这样用户第一次访问资源就可以享受到cdn的缓存加速。</li>
</ol>
<h2 id="配置">配置</h2>
<ol>
<li>提供给CDN服务商需要加速的网址和源服务器的ip或域名。服务商会给我们一个cdn网址</li>
<li>域名解析：在网址的dns解析处，加一条CNAME解析，将原来的网址解析为cdn网址</li>
</ol>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Nginx的简单使用</title>
                <link>https://wss.cool/nginx.html</link>
                <guid isPermaLink="true">https://wss.cool/nginx.html</guid>
                <pubDate>Fri, 27 Sep 2019 13:08:38 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://www.linode.com/docs/web-servers/nginx/how-to-configure-nginx/">攻略1</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-18-04">攻略2</a></p>
<h2 id="安装">安装</h2>
<pre><code>sudo apt-get install nginx
</code></pre><h2 id="配置文件">配置文件</h2>
<p>ubuntu</p>
<pre><code>/etc/nginx/conf.d/*.conf
</code></pre><p>centos</p>
<pre><code>/usr/local/nginx/conf/
</code></pre><h2 id="常用命令">常用命令</h2>
<pre><code>sudo nginx -s reload
</code></pre><h2 id="日志">日志</h2>
<pre><code>cat /var/log/nginx/access.log
</code></pre><h2 id="http转https">http转https</h2>
<pre><code>server {
    listen 80;
    server_name www.test.com;
    rewrite ^(.*)$ https://${server_name}$1 permanent; 
}
</code></pre><h2 id="https配置">https配置</h2>
<pre><code>server {
    listen 443 ssl http2;
    server_name  blog.wowfriday.cn;

    ssl                      on;
    ssl_certificate          /etc/nginx/1_blog.wowfriday.cn_bundle.crt;
    ssl_certificate_key      /etc/nginx/2_blog.wowfriday.cn.key;

    ssl_session_timeout  5m;

    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers   on;

    location / {
        proxy_pass https://wowfriday.cn;
    }
}
</code></pre><h2 id="静态网站配置">静态网站配置</h2>
<pre><code>server {
  listen 80 http;
  server_name  wowfriday.cn;

  location / {
      root   /usr/share/nginx/html;
      index  index.html index.htm;
  }
}
</code></pre><h2 id="反向代理配置">反向代理配置</h2>
<pre><code>server {
  listen 80 http;
  server_name  wowfriday.cn;

  location / {
      proxy_pass http://blog.wowfriday.cn;
  }
}
</code></pre><h2 id="websocket代理">websocket代理</h2>
<pre><code>location /wss {
  proxy_pass http://127.0.0.1:8765;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection &quot;Upgrade&quot;;
  proxy_set_header X-Real-IP $remote_addr;
}
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/nginx/">nginx</category>
                                
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E5%85%A5%E9%97%A8/">入门</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>CSS知识点汇总</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/css/css%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/css/css%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/</guid>
                <pubDate>Sun, 15 Sep 2019 21:53:21 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS">MDN</a></p>
<h2 id="选择器">选择器</h2>
<h2 id="优先级">优先级</h2>
<h2 id="伪类">伪类</h2>
<h2 id="伪元素">伪元素</h2>
<h2 id="盒子模型">盒子模型</h2>
<ul>
<li>内容、内边距、边框、外边距、box-sizing</li>
<li>背景颜色、背景图片、背景渐变色</li>
<li>outline、box-shadow</li>
</ul>
<h2 id="外边距合并">外边距合并</h2>
<p>块级元素的上外边距和下外边距有时会合并（或折叠）为一个外边距，其大小取其中的最大者</p>
<h2 id="布局">布局</h2>
<ul>
<li>浮动和定位在内的传统布局方法</li>
<li>弹性盒（flexbox）布局</li>
</ul>
<h2 id="书写规范">书写规范</h2>
<h2 id="less">less</h2>
<p><a href="http://lesscss.org">官网</a></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/css/">CSS</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>React With Gesture</title>
                <link>https://wss.cool/react-with-gesture.html</link>
                <guid isPermaLink="true">https://wss.cool/react-with-gesture.html</guid>
                <pubDate>Wed, 28 Aug 2019 13:21:48 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://www.npmjs.com/package/react-with-gesture">文档</a></p>
<p>yarn add react-with-gesture</p>
<p>import { useGesture, withGesture, Gesture } from 'react-with-gesture'</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react%E5%BA%93/">React库</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E6%89%8B%E5%8A%BF/">手势</category>
                                
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E6%8B%96%E6%8B%BD/">拖拽</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>React Rangeslider</title>
                <link>https://wss.cool/react-rangeslider.html</link>
                <guid isPermaLink="true">https://wss.cool/react-rangeslider.html</guid>
                <pubDate>Wed, 28 Aug 2019 13:15:47 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://whoisandy.github.io/react-rangeslider/">官网</a></p>
<h2 id="使用">使用</h2>
<p>yarn add react-rangeslider --save</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">Slider</span> <span class="nx">from</span> <span class="s1">&#39;react-rangeslider&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;react-rangeslider/lib/index.css&#39;</span>

<span class="p">&lt;</span><span class="nt">Slider</span>
  <span class="na">min</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span>
  <span class="na">max</span><span class="o">=</span><span class="p">{</span><span class="mi">100</span><span class="p">}</span>
  <span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">value</span><span class="p">}</span>
  <span class="na">onChangeStart</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleChangeStart</span><span class="p">}</span>
  <span class="na">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleChange</span><span class="p">}</span>
  <span class="na">onChangeComplete</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleChangeComplete</span><span class="p">}</span>
<span class="p">/&gt;</span>

<span class="p">&lt;</span><span class="nt">Slider</span>
  <span class="na">min</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span>
  <span class="na">max</span><span class="o">=</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>
  <span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">reverseValue</span><span class="p">}</span>
  <span class="na">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span>
  <span class="na">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleChangeReverse</span><span class="p">}</span>
<span class="p">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react%E5%BA%93/">React库</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>workbox</title>
                <link>https://wss.cool/workbox/</link>
                <guid isPermaLink="true">https://wss.cool/workbox/</guid>
                <pubDate>Wed, 28 Aug 2019 09:53:21 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://developers.google.com/web/tools/workbox/guides/get-started">官网</a></p>
<h2 id="需求">需求</h2>
<ol>
<li>资源本地化：上课时课件的所有资源预先下载。</li>
<li>绘本插件图片资源多，需要预先下载。</li>
</ol>
<h2 id="实现方案">实现方案</h2>
<p>workbox</p>
<h2 id="使用">使用</h2>
<ol>
<li>安装 workbox
<pre><code>npm install workbox-cli --global
</code></pre></li>
<li>在项目目录下运行命令，进行 workbox 的配置，会生成一个配置文件 workbox-config.js
<pre><code>cd ./a/b/project_path
workbox wizard
</code></pre></li>
<li>默认生成的 workbox 的依赖是 google 的 cdn ，国内无法访问，可通过配置改为使用本地依赖。在配置文件（workbox-config.js）中添加或修改为
<pre><code>&quot;importWorkboxFrom&quot;: &quot;local&quot;,
</code></pre></li>
<li>根据配置文件让 workbox 工作，会生成一些 service worker 相关的文件，入口是 sw.js 文件
<pre><code>workbox generateSW workbox-config.js
</code></pre></li>
<li>在项目入口的html文件（index.html）中引入 workbox 。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span> <span class="k">in</span> <span class="nx">navigator</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;/sw.js&#39;</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>workbox 会遍历它的工作目录下的所有html文件，将html文件及其中依赖的图片、css和js文件全部加入一个列表中。当第一个页面载入后 workbox 开始工作，利用 service worker 的 api 预下载列表中的文件（缓存）。当访问其他网页或者没有网络/弱网时，就可以使用缓存工作。</p>
<p>通过 workbox 的配置，也可以通过 workbox 的 api 实现一个高级功能。</p>
<p>比如缓存的优先级的设置。资源可能会更新，当网络可用时，workbox 是使用缓存的资源还是请求网络上的资源，可以通过设置缓存的优先级策略来根据需要配置。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>授课项目优化</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/%E6%8E%88%E8%AF%BE%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/%E6%8E%88%E8%AF%BE%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/</guid>
                <pubDate>Wed, 28 Aug 2019 07:19:34 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h1 id="现象">现象</h1>
<p>epp项目在pad端家在需要10-30s时间。</p>
<h1 id="为什么会这样">为什么会这样？</h1>
<p>pad端是RN项目，前面2个界面的操作之后开启webview访问学生端网址，加载epp项目。</p>
<p>观察epp学生端项目的加载：</p>
<p><img src="/images/%E4%BC%98%E5%8C%96-%E5%89%8D.jpg" alt="优化前"></p>
<p>这个是渲染第一帧前加载资源的截图，可以看到有17个js文件，而很明显的，fabric、ckeditor、aliplayer这些体积很大的库在学生端是不需要的（这3个文件都是编辑器用的，epp项目分学生端、教师端、编辑器），而且资源数量较多。</p>
<p><strong>两个原因导致了pad端需要加载10s的问题：资源数量多、很多不需要的代码被加载。</strong></p>
<p>30s的情况出现在网络差的时候，比如上课时，有30个学生同时使用pad，瓜分宽带导致资源下载速度更慢。这个后面也有方案尝试解决。</p>
<h1 id="问题处在哪">问题处在哪？</h1>
<p>从代码的入口文件看起，发现了这段代码：</p>
<p><img src="/images/%E4%BC%98%E5%8C%96-%E4%BB%A3%E7%A0%81.png" alt="懒加载"></p>
<p>这段代码的作用是根据url来加载不同的场景（学生端、教师端、编辑器），重点是下面这段代码。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">importScene</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span>
  <span class="kr">import</span><span class="p">(</span><span class="sb">`@/scene/</span><span class="si">${</span><span class="nx">sceneName</span><span class="si">}</span><span class="sb">Scene/</span><span class="si">${</span><span class="nx">sceneName</span><span class="si">}</span><span class="sb">Scene`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">module</span> <span class="p">=&gt;</span> <span class="nx">module</span><span class="p">.</span><span class="k">default</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>使用webpack的代码分割、懒加载机制，<a href="/images/%E4%BC%98%E5%8C%96-%E4%BB%A3%E7%A0%81.png">文档链接</a>。webpack会将<code>import(&quot;./module&quot;)</code>作为分割点，将其放在单独的chunk文件中，实现懒加载。<br>
<code>import()</code>也可以接受动态表达式，比如这样<code>import(./routes/${path}/route)</code>，此时<code>import() </code>为每一个<strong>可能的模块</strong>创建独立的chunk，这句话的重点是<strong>可能的模块</strong>，也就是上面代码的问题所在。</p>
<p>对于前面那段代码，import的动态的部分就是sceneName，对于webpack来说它是一个未知变量，所以webpack认为它是<strong>可能的模块</strong>。</p>
<p>在我们的业务中，<strong>可能的模块</strong>包含来学生端、教室端、编辑器，那么webpack会将3个大模块全部分别打包，而且将其全部下载。从而导致来前面提到的2个问题。</p>
<h1 id="解决问题">解决问题</h1>
<p>尝试着把上面提到的那段动态表达式改成确定的语句，比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">importStudentScene</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span>
    <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;@/scene/studentScene/studentScene&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">module</span> <span class="p">=&gt;</span> <span class="nx">module</span><span class="p">.</span><span class="k">default</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">edApplication</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">(</span><span class="s1">&#39;edinnova&#39;</span><span class="p">);</span>
<span class="nx">importStudentScene</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">studentScene</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">addScene</span><span class="p">(</span><span class="k">new</span> <span class="nx">studentScene</span><span class="p">());</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">startScene</span><span class="p">(</span><span class="s1">&#39;studentScene&#39;</span><span class="p">,</span> <span class="s1">&#39;#app&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>再次开启项目：</p>
<p><img src="/images/%E4%BC%98%E5%8C%96-%E5%90%8E.jpg" alt="优化后"></p>
<p>可以看到数量和体积都小了很多。</p>
<p><img src="/images/%E4%BC%98%E5%8C%96-%E5%90%8E2.jpg" alt="优化后"></p>
<p>这是在电脑上的截图，优化后首屏从3.4s变为2.1s，效果明显。这只是一个几乎没有改动代码的一步优化。</p>
<p>可以看到优化后还是有1个600k，1个200k两个chunk文件，后面还需要分析这两个chunk文件，看是否有优化空间。</p>
<h1 id="30个学生同时使用pad">30个学生同时使用pad</h1>
<p>有一个猜想，因为30个学生是在同一个教室的局域网内。考虑使用webRTC的种子下载技术，实现下载速度的优化。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>正则表达式</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/javascript/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/javascript/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</guid>
                <pubDate>Sun, 25 Aug 2019 20:13:08 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="精准匹配">精准匹配</h2>
<p>一个字符跟着一个字符，完全匹配</p>
<pre><code>/test/
</code></pre><h2 id="匹配一类字符">匹配一类字符</h2>
<p>匹配组合中的任意一个👇</p>
<pre><code>[abc]
</code></pre><p>除了组合中的所有👇</p>
<pre><code>[^abc]
</code></pre><p>☢️歧义：<code>^</code>有2中含义：在<code>[]</code>中表示“非”，在正则表达式的开头<code>/^abc/</code>，表示匹配以<code>abc</code>开头的字符串。</p>
<p>从a到m之间👇</p>
<pre><code>[a-m]
</code></pre><h2 id="转义">转义</h2>
<p>字母和数字都可以表示自己。但<code>$``-``^</code>可以表达自身以外的东西，要使用反斜杠“\”来转义。</p>
<h2 id="重复">重复</h2>
<p><code>/t?est/</code>👉字符后加<code>?</code>表示一次或零次出现</p>
<p><code>/t+est/</code>👉<code>+</code>表示一次或多次出现</p>
<p><code>/t*est/</code>👉 <code>*</code>表示零次或多次出现</p>
<p><code>/t{4}est/</code>👉<code>{4}</code>表示4次出现</p>
<p><code>/t{4,10}est/</code>👉<code>{4-10}</code>表示4-10次出现</p>
<p><code>/t{4,}est/</code>👉<code>{4,}</code>表示4-多次出现</p>
<h2 id="预定义字符">预定义字符</h2>
<p><code>\t</code>表示水平制表符tab</p>
<p><code>\s</code>表示任何空字符，如空格、tab、回车等</p>
<p>还有很多</p>
<h2 id="分组">分组</h2>
<p>操作符（如<code>+``*``?</code>)只能影响它前面的<span title="字符" class="trans">术语</span>。使用小括号<code>()</code>可以使操作符作用于<strong>一组术语</strong>。</p>
<p>例子：<code>/(ab)+/</code>会匹配<code>&quot;ab&quot;</code>字符串一次或多次。</p>
<p>☢️歧义：<code>()</code>同时还有捕获的作用。</p>
<h2 id="或">或</h2>
<p>使用竖线表示或的关系，比如<code>/a|b/</code>匹配a或b，与<code>/[ab]/</code>类似</p>
<h2 id="反向引用">反向引用</h2>
<p>看这个正则<code>/^([abc])a\1)/</code>，其中<code>()</code>为捕获，可能捕获到<code>a</code>或<code>b</code>或<code>c</code>，<code>\1</code>就表示被捕获到的那个字符。</p>
<p>比如，对于字符串<code>bab</code>，首先<code>([abc])</code>捕获到了<code>b</code>，<code>\1</code>就代表<code>b</code>，所以<code>bab</code>可以匹配。</p>
<h2 id="捕获及捕获的引用">捕获及捕获的引用</h2>
<p><code>/(hello) (world)/</code> 在匹配字符串 <code>hello world</code> 时会将 () 中的字符进行捕获，可以用 <code>$1</code> <code>$2</code> 表示。</p>
<p>在<code>string.replace()</code>中，使用&quot;$1&quot;表示被捕获到的字符。</p>
<p>比如，<code>'hello world'.replace(/(hello) (world)/, '$1 666-$2')</code>，会输出<code>&quot;hello 666-world&quot;</code></p>
<p>(?: . . .)表示非捕获分组，也就是不会被捕获，仅表示分组。</p>
<h2 id="trim的实现">trim()的实现</h2>
<h3 id="方法1">方法1</h3>
<p><code>str.replace(/^\s+|\s+$/g,&quot;&quot;)</code>，在头尾分别替换掉空字符</p>
<h3 id="方法2">方法2</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s\s*/</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">),</span> <span class="c1">//在头部替换
</span><span class="c1"></span>    <span class="nx">ws</span> <span class="o">=</span> <span class="sr">/\s/</span><span class="p">,</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

<span class="k">while</span><span class="p">(</span><span class="nx">ws</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="o">--</span><span class="nx">i</span><span class="p">)));</span> <span class="c1">// 看在尾部有几个空字符
</span><span class="c1"></span>
<span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 剔除空字符
</span></code></pre></td></tr></table>
</div>
</div><p>方法2比方法1在长文档中性能更好。</p>
<h2 id="其他">其他</h2>
<h3 id="匹配换行符">匹配换行符</h3>
<ol>
<li>术语点<code>.</code>不能匹配到换行符<code>\n</code></li>
<li><code>/\s*/g</code>匹配不到连续多个空字符，可以用<code>/\s+/g</code>可以。</li>
</ol>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/javascript/">JavaScript</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>React Popup</title>
                <link>https://wss.cool/react-popup.html</link>
                <guid isPermaLink="true">https://wss.cool/react-popup.html</guid>
                <pubDate>Thu, 22 Aug 2019 10:43:25 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://react-popup.elazizi.com/component-api/">React Popup</a> 是一个弹窗组件的库。</p>
<h2 id="安装">安装</h2>
<pre><code>yarn add reactjs-popup

npm install reactjs-popup
</code></pre><h2 id="基本用法">基本用法</h2>
<ul>
<li>contentStyle：设置<strong>内容区</strong>的样式</li>
<li>overlayStyle：设置<strong>遮罩</strong>的样式</li>
</ul>
<h2 id="占位弹窗1">占位弹窗1</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Popup</span> <span class="nx">from</span> <span class="s2">&#34;reactjs-popup&#34;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">PopupExample</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">Popup</span> <span class="na">trigger</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">button</span><span class="p">&gt;</span> <span class="nx">Trigger</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;}</span> <span class="na">position</span><span class="o">=</span><span class="s">&#34;right center&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Popup</span> <span class="nx">content</span> <span class="nx">here</span> <span class="o">!!</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">Popup</span><span class="p">&gt;</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="占位弹窗2">占位弹窗2</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">const</span> <span class="nx">PopupExample</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">Popup</span> <span class="na">trigger</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">button</span><span class="p">&gt;</span><span class="nx">Trigger</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;}</span> <span class="na">position</span><span class="o">=</span><span class="s">&#34;top left&#34;</span><span class="p">&gt;</span>
    <span class="p">{</span><span class="nx">close</span> <span class="p">=&gt;</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="nx">Content</span> <span class="nx">here</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">close</span><span class="p">}&gt;</span>
          <span class="o">&amp;</span><span class="nx">times</span><span class="p">;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)}</span>
  <span class="p">&lt;/</span><span class="nt">Popup</span><span class="p">&gt;</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="受控modal">受控Modal</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">const</span> <span class="nx">Modal</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
   <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">openModal</span><span class="p">}&gt;</span>
      <span class="nx">Controlled</span> <span class="nx">Popup</span>
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">Popup</span>
      <span class="na">open</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">open</span><span class="p">}</span>
      <span class="na">closeOnDocumentClick</span>
      <span class="na">onClose</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">closeModal</span><span class="p">}</span>
    <span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;modal&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">closeModal</span><span class="p">}&gt;</span><span class="o">&amp;</span><span class="nx">times</span><span class="p">;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span><span class="mi">666</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">Popup</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react%E5%BA%93/">React库</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>D3学习笔记</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/d3/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/d3/</guid>
                <pubDate>Sat, 20 Jul 2019 12:29:41 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>参考：<a href="https://bl.ocks.org/mbostock">例子网站1</a>，<a href="https://observablehq.com/">例子网站2</a>，<a href="https://observablehq.com/@mbostock/tree-of-life">树1</a></p>
<h2 id="circle">circle</h2>
<p>circle（圆形）有3个主要属性</p>
<ol>
<li>cx、cy，圆心的坐标</li>
<li>r，半径</li>
</ol>
<h2 id="线性映射">线性映射</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">scale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleLiner</span><span class="p">();</span>
<span class="nx">scale</span><span class="p">.</span><span class="nx">domain</span> <span class="o">=</span> <span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">]);</span>
<span class="nx">scale</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">]);</span>
<span class="kr">const</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">scale</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>3个概念：</p>
<ol>
<li>scaleLiner，线性映射。</li>
<li>domain（域），存放的是真实的数据。</li>
<li>range（范围），映射后的范围。
domain中的数据会被线性映射到range中。<code>scale(50);</code>中的<code>50</code>是domain中的值，output为映射后的值。</li>
</ol>
<h2 id="最值">最值</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">positionData</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="kr">const</span> <span class="nx">maxZ</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">positionData</span><span class="p">,</span> <span class="p">(</span><span class="nx">d</span><span class="p">)=&gt;</span><span class="nx">d</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="动态缩放">动态缩放</h2>
<p>处理复杂数据的第一步是确定缩放比例，才能让所有数据点都包含在svg画布中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">xScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleLinear</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">d</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
  <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="nx">padding</span><span class="p">,</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">padding</span><span class="p">]);</span>
</code></pre></td></tr></table>
</div>
</div><p>在数据集中找到最大最小值，作为<code>domain</code>的边界，将数据集映射到画布大小的<code>range</code>中</p>
<h2 id="坐标轴">坐标轴</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">yAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisLeft</span><span class="p">(</span><span class="nx">yScale</span><span class="p">);</span>

<span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;g&#34;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;transform&#34;</span><span class="p">,</span> <span class="s2">&#34;translate(0,&#34;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">h</span> <span class="o">-</span> <span class="nx">padding</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;)&#34;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">xAxis</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="svg的image元素">svg的image元素</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">image</span> 
  <span class="nx">fill</span><span class="o">=</span><span class="s2">&#34;#000000&#34;</span> 
  <span class="nx">x</span><span class="o">=</span><span class="p">{</span><span class="nx">x</span><span class="p">}</span> <span class="nx">y</span><span class="o">=</span><span class="p">{</span><span class="nx">x</span><span class="p">}</span>
  <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="nx">w</span><span class="p">}</span> <span class="nx">height</span><span class="o">=</span><span class="p">{</span><span class="nx">h</span><span class="p">}</span> 
  <span class="nx">preserveAspectRatio</span><span class="o">=</span><span class="s2">&#34;none&#34;</span>
  <span class="nx">xlinkHref</span><span class="o">=</span><span class="p">{</span><span class="nx">mark</span><span class="p">.</span><span class="nx">point</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span> 
<span class="err">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Git常用操作</title>
                <link>https://wss.cool/posts/%E5%B7%A5%E5%85%B7/git/git/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%B7%A5%E5%85%B7/git/git/</guid>
                <pubDate>Thu, 18 Jul 2019 10:53:36 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="标签">标签</h2>
<p>将某次commit打上标签
<code>git tag &lt;name </code> 默认给最新提交打标签。<br>
<code>git tag</code> 查看所有标签
<code>git tag v0.9 f52c633</code> 根据commit id给某次提交打标签</p>
<h2 id="暂存改动">暂存改动</h2>
<table>
<thead>
<tr>
<th align="center">操作</th>
<th align="center">代码</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">暂存</td>
<td align="center">git stash</td>
</tr>
<tr>
<td align="center">列表</td>
<td align="center">git stash list</td>
</tr>
<tr>
<td align="center">取出</td>
<td align="center">git stash pop 1</td>
</tr>
</tbody>
</table>
<h2 id="获取上一次commit的message">获取上一次commit的message</h2>
<pre><code>git log -1 --pretty=%B  
</code></pre><h2 id="使用一次新的commit替代上一次提交">使用一次新的commit，替代上一次提交</h2>
<p>如果代码没有任何新变化，则用来改写上一次commit的提交信息</p>
<pre><code>git commit --amend -m &quot;666&quot;
</code></pre><p>代码有变动，要制定文件</p>
<pre><code>git commit --amend src\plugins\icElement_vote\components\config.vue src\plugins\icElement_chose\components\config.vue
  -m &quot;fix(编辑器-选择题/投票题):删除不是当前选中的选项&quot;
</code></pre><h2 id="分支间摘-commit">分支间摘 commit</h2>
<p>分支A有5次提交，想把其中的第二三次提交拿到B分支，先拿到 commit 的 id 可通过 <code>git log -1 --pretty=%B</code> 取到。然后使用摘樱桃命令：</p>
<pre><code>git cherry-pick 5cf6d24
</code></pre><p>分支B就把这次commit摘过来了。</p>
<h2 id="取消追踪">取消追踪</h2>
<pre><code>git rm -r --cached 文件或目录
</code></pre><h2 id="在缓存中移除某个目录">在缓存中移除某个目录</h2>
<p><code>git rm -r --cached some-directory</code></p>
<h2 id="查看记录log">查看记录log</h2>
<p><code>git log</code> 这样会打印出超级多的信息，包括SHA-1、作者、时间、message,很啰嗦，还是不要这么用得好。<br>
<code>git log --pretty=format:&quot;%h - %an, %ar : %s&quot;</code> 按格式打印信息，具体选项如下 <br>
git log --graph
git log --graph --oneline --decorate</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>%H</td>
<td>提交对象（commit）的完整哈希字串</td>
</tr>
<tr>
<td>%h</td>
<td>提交对象的简短哈希字串</td>
</tr>
<tr>
<td>%T</td>
<td>树对象（tree）的完整哈希字串</td>
</tr>
<tr>
<td>%t</td>
<td>树对象的简短哈希字串</td>
</tr>
<tr>
<td>%P</td>
<td>父对象（parent）的完整哈希字串</td>
</tr>
<tr>
<td>%p</td>
<td>父对象的简短哈希字串</td>
</tr>
<tr>
<td>%an</td>
<td>作者（author）的名字</td>
</tr>
<tr>
<td>%ae</td>
<td>作者的电子邮件地址</td>
</tr>
<tr>
<td>%ad</td>
<td>作者修订日期（可以用 -date= 选项定制格式）</td>
</tr>
<tr>
<td>%ar</td>
<td>作者修订日期，按多久以前的方式显示</td>
</tr>
<tr>
<td>%cn</td>
<td>提交者(committer)的名字</td>
</tr>
<tr>
<td>%ce</td>
<td>提交者的电子邮件地址</td>
</tr>
<tr>
<td>%cd</td>
<td>提交日期</td>
</tr>
<tr>
<td>%cr</td>
<td>提交日期，按多久以前的方式显示</td>
</tr>
<tr>
<td>%s</td>
<td>提交说明</td>
</tr>
</tbody>
</table>
<p><code>git log -2 --oneline</code> 打印最近两次的简化后的记录，其中<code>--oneline</code>为	<code>--pretty=oneline --abbrev-commit</code> 命令的简化用法。<code>-n</code>为最近n次的提交。<br>
<code>git log --since=2.weeks</code> 打印2周内的记录，具体选项如下</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-(n)</td>
<td>仅显示最近的 n 条提交</td>
</tr>
<tr>
<td>--since, --after</td>
<td>仅显示指定时间之后的提交。</td>
</tr>
<tr>
<td>--until, --before</td>
<td>仅显示指定时间之前的提交。</td>
</tr>
<tr>
<td>--author</td>
<td>仅显示指定作者相关的提交。</td>
</tr>
<tr>
<td>--committer</td>
<td>仅显示指定提交者相关的提交。</td>
</tr>
</tbody>
</table>
<p><code>git log --pretty=&quot;%h - %s&quot; --author=wss --since=&quot;2008-10-01&quot; --before=&quot;2008-11-01&quot;</code> 各种条件可以一起用<br>
<code>git log -p -2</code> 查看最近两次提交，并显示提交内容（具体改动了什么）</p>
<h2 id="攻略">攻略</h2>
<p>Git 原理入门 <a href="http://www.ruanyifeng.com/blog/2018/10/git-internals.html">http://www.ruanyifeng.com/blog/2018/10/git-internals.html</a></p>
<p>Git 分支管理策略 <a href="http://www.ruanyifeng.com/blog/2012/07/git.html">http://www.ruanyifeng.com/blog/2012/07/git.html</a></p>
<p>Git 工作流程 <a href="http://www.ruanyifeng.com/blog/2015/12/git-workflow.html">http://www.ruanyifeng.com/blog/2015/12/git-workflow.html</a></p>
<p>Git 使用规范流程 <a href="http://www.ruanyifeng.com/blog/2015/08/git-use-process.html">http://www.ruanyifeng.com/blog/2015/08/git-use-process.html</a></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/git/">git</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Fetch 与 Axios</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/fetch%E4%B8%8Eaxios/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/fetch%E4%B8%8Eaxios/</guid>
                <pubDate>Wed, 17 Jul 2019 10:27:44 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>原文：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch">使用Fetch</a> 、<a href="https://github.com/axios/axios">axios文档</a></p>
<h1 id="什么是-fetch-">什么是 fetch ？</h1>
<p>以前通过JS进行网络请求都是使用<code>ajax</code>也就是<code>XMLHttpRequest</code>实现的。如果用原生方式实现起来比较麻烦。</p>
<p><code>Fetch API</code>是浏览器提供的一个代替<code>XMLHttpRequest</code>的新方法。</p>
<h2 id="怎么使用-fetch-">怎么使用 fetch ？</h2>
<p>最简单的形式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://example.com/movies.json&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">})</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">myJson</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myJson</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>⚠️需要注意:</p>
<ol>
<li><code>fetch()</code>方法返回的是<code>promise</code>。</li>
<li>当<code>Http状态码</code>是<code>404</code>或者<code>500</code>时也是<code>resolve</code>，但是会将<code>resolve</code>的返回值的<code>ok</code>属性设置为<code>false</code>。</li>
<li>只有当网络故障或者请求被阻止时才会是<code>reject</code>。</li>
<li><code>resolve</code>中进行<code>response.json()</code>才能拿到返回数据。</li>
</ol>
<h2 id="怎么设置-methodheader等参数呢">怎么设置 method、header等参数呢？</h2>
<p>fetch() 方法接受第二个可选参数——一个对象——用来设置请求的参数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="c1">// must match &#39;Content-Type&#39; header
</span><span class="c1"></span>  <span class="nx">cache</span><span class="o">:</span> <span class="s1">&#39;no-cache&#39;</span><span class="p">,</span> <span class="c1">// *default, no-cache, reload, force-cache, only-if-cached
</span><span class="c1"></span>  <span class="nx">credentials</span><span class="o">:</span> <span class="s1">&#39;same-origin&#39;</span><span class="p">,</span> <span class="c1">// include, same-origin, *omit
</span><span class="c1"></span>  <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;user-agent&#39;</span><span class="o">:</span> <span class="s1">&#39;Mozilla/4.0 MDN Example&#39;</span><span class="p">,</span>
    <span class="s1">&#39;content-type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span>
  <span class="p">},</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="c1">// *GET, POST, PUT, DELETE, etc.
</span><span class="c1"></span>  <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;cors&#39;</span><span class="p">,</span> <span class="c1">// no-cors, cors, *same-origin
</span><span class="c1"></span>  <span class="nx">redirect</span><span class="o">:</span> <span class="s1">&#39;follow&#39;</span><span class="p">,</span> <span class="c1">// manual, *follow, error
</span><span class="c1"></span>  <span class="nx">referrer</span><span class="o">:</span> <span class="s1">&#39;no-referrer&#39;</span><span class="p">,</span> <span class="c1">// *client, no-referrer
</span><span class="c1"></span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p>⚠️<code>credentials: 'include'</code> 这个字段可以让请求带上 cookie 。</p>
<h2 id="上传json数据">上传JSON数据</h2>
<p>⚠️需要设置<code>header</code>的<code>'Content-Type': 'application/json'</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="c1">// or &#39;PUT&#39;
</span><span class="c1"></span>  <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="c1">// data can be `string` or {object}!
</span><span class="c1"></span>  <span class="nx">headers</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">({</span>
    <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="上传文件">上传文件</h2>
<p>⚠️需要使用<code>FormData</code>类作为<code>request</code>的<code>body</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">fileField</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;input[type=&#39;file&#39;]&#34;</span><span class="p">);</span>

<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;abc123&#39;</span><span class="p">);</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="nx">fileField</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://example.com/profile/avatar&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span>
  <span class="nx">body</span><span class="o">:</span> <span class="nx">formData</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="什么是-axios-">什么是 axios ？</h1>
<p>它是一个库，可以用<code>Promise</code>的方式进行网络请求。</p>
<h2 id="怎么使用-axios-">怎么使用 axios ？</h2>
<h3 id="最简单的几种方式">最简单的几种方式</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// get请求1
</span><span class="c1"></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user?ID=12345&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">();</span>
<span class="c1">// get请求2
</span><span class="c1"></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,{</span>
  <span class="nx">params</span><span class="o">:</span><span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">12345</span><span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">();</span>
<span class="c1">// post请求
</span><span class="c1"></span><span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">firstName</span><span class="o">:</span> <span class="s1">&#39;Fred&#39;</span><span class="p">,</span>
    <span class="nx">lastName</span><span class="o">:</span> <span class="s1">&#39;Flintstone&#39;</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="同时进行多个请求">同时进行多个请求</h3>
<p>几个请求都成功后，进行后续操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">getUserAccount</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user/12345&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getUserPermissions</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user/12345/permissions&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">axios</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">getUserAccount</span><span class="p">(),</span> <span class="nx">getUserPermissions</span><span class="p">()])</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">spread</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">acct</span><span class="p">,</span> <span class="nx">perms</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Both requests are now complete
</span><span class="c1"></span>  <span class="p">}));</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="使用asyncawait">使用<code>async/await</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">async</span> <span class="kd">function</span> <span class="nx">getUser</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user?ID=12345&#39;</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="创建实例统一配置设置统一处理请求响应">创建实例——统一配置、设置，统一处理请求、响应</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">baseURL</span><span class="o">:</span> <span class="s1">&#39;https://some-domain.com/api/&#39;</span><span class="p">,</span>
  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span> <span class="s1">&#39;foobar&#39;</span><span class="p">},</span>
  <span class="nx">transformRequest</span><span class="o">:</span> <span class="p">[</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">headers</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do whatever you want to transform the data
</span><span class="c1"></span>    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">}],</span>
  <span class="nx">transformResponse</span><span class="o">:</span> <span class="p">[</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do whatever you want to transform the data
</span><span class="c1"></span>    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">}],</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>注意⚠️</p>
<ol>
<li>没有transformResponse属性时，resopnse中的data是一个对象。</li>
<li>加了transformResponse属性后（即便它是空的方法），resopnse的data会变成字符串。</li>
<li>如果想对response做统一处理，可以在拦截中做。</li>
</ol>
<h3 id="拦截响应或请求">拦截响应或请求</h3>
<p>这里的data会受到上面的transformResponse影响，不加的时候就是对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 响应拦截器
</span><span class="c1"></span><span class="nx">instance</span><span class="p">.</span><span class="nx">interceptors</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 对响应数据做点什么
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">error</span> <span class="o">===</span> <span class="mi">1500</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;ed_token失效，error code:1500&#39;</span><span class="p">);</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;ed_token&#39;</span><span class="p">)</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;ed_user_info&#39;</span><span class="p">)</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;authErrorAngToLogin&#39;</span><span class="p">))</span>
        <span class="c1">// return Promise.reject(response.data);
</span><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 对响应错误做点什么
</span><span class="c1"></span>    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>初始的header的Authorization可能是无效的，需要在登录后更新</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">my_axios</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">token</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="上传文件-1">上传文件</h3>
<p>两点需要注意：</p>
<ol>
<li><code>file</code>文件对象使用<code>Form</code>类存放</li>
<li><code>content-type</code>为<code>multipart/form-data</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span>
<span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
  <span class="s1">&#39;https://develop.com/upload&#39;</span><span class="p">,</span>
  <span class="nx">formData</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;Authorization&#39;</span><span class="o">:</span> <span class="s1">&#39;token&#39;</span><span class="p">,</span>
      <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;multipart/form-data&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="取消请求">取消请求</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">login</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">cancelToken</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`/user`</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">cancelToken</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">isCancel</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Request canceled&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">message</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">},</span>
</code></pre></td></tr></table>
</div>
</div><p>其中cancelToken每次调用login时需要重新生成：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">CancelToken</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">CancelToken</span><span class="p">;</span><span class="c1">// 可以全局一个
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">CancelToken</span><span class="p">.</span><span class="nx">source</span><span class="p">();</span><span class="c1">// 每次请求都要时调用生成cancelToken
</span></code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>利用useContext使用ReactRouter</title>
                <link>https://wss.cool/react-router-hook.html</link>
                <guid isPermaLink="true">https://wss.cool/react-router-hook.html</guid>
                <pubDate>Mon, 08 Jul 2019 09:36:38 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="react-router-的historypush">React Router 的history.push</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useContext</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">__RouterContext</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react-router&#34;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">Login</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">token</span><span class="p">,</span> <span class="nx">setToken</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">history</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">__RouterContext</span><span class="p">);</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;/list&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">token</span><span class="p">,</span> <span class="nx">history</span><span class="p">]);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()=&gt;</span><span class="nx">setToken</span><span class="p">(</span><span class="s1">&#39;666&#39;</span><span class="p">)}&gt;</span><span class="nx">登录</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="o">&lt;</span><span class="err">/&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这段代码的逻辑是，等级登录按钮，设置token变量。当token变量变化时，触发useEffect调用ReactRouter的history.push切换路由。history对象是通过useContext获得到的，可以拿到location、history、match等3个对象。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react/">React</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>web前端对密码加密的意义</title>
                <link>https://wss.cool/posts/%E5%BF%83%E5%BE%97/web%E5%89%8D%E7%AB%AF%E5%AF%B9%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86%E7%9A%84%E6%84%8F%E4%B9%89/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%BF%83%E5%BE%97/web%E5%89%8D%E7%AB%AF%E5%AF%B9%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86%E7%9A%84%E6%84%8F%E4%B9%89/</guid>
                <pubDate>Sat, 06 Jul 2019 10:04:07 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h1 id="web前端对密码加密的意义httpswwwv2excomt522221"><a href="https://www.v2ex.com/t/522221">web前端对密码加密的意义</a></h1>
<blockquote>
<p>有的运维或者后台会记录包含请求体的 access log，如果不加密，log 里面就是明文密码。这种在架构上垂直扩展&amp;多层的公司很容易发生。GitHub 就翻车过一次，在请求日志里发现了明文密码，然后就群发邮件通知用户改密码。 @lincanbin</p>
</blockquote>
<blockquote>
<p>用单向函数“加密”等同于明文 @hanru</p>
</blockquote>
<blockquote>
<p>能增加攻击的难度。安全领域并不是非黑即白的，如果小量成本能挡住小学 3 年级的傻子攻击，那就有意义 @otakustay</p>
</blockquote>
<blockquote>
<p>任何提高攻击门槛的做法都是有意义的 @newmlp</p>
</blockquote>
<blockquote>
<p>感觉一般加密意义不大，中间人重放就可以了，但聊胜于无。顺便一说 B 站采用的是前端非对称加密 @lzvezr</p>
</blockquote>
<blockquote>
<p>非对称加密。用公钥加密，知道 JS 源码也没用。但是我觉得在 HTTPS 下面没必要。另外，如果进日志，肯定不要存密码啊。如果原封进日志，那所有加密都没有意义。因为这个加密过的密码本来就可以从前端登录进去。我只是不知道明文而已。CDN 商是可以拦截保存，所以不要啥的都经过 CDN。基于上面的分析，还有一种比较稳妥的方式是前端密码提交的时候，附上 timestamp，用 RSA 公钥加密，服务器私钥解密后验证时间，然后登录一次 timestamp 作废。这样日志泄露或者被拦截，也无法用原密文重放 @lhx2008</p>
</blockquote>
<blockquote>
<p>看了下苹果、微软、谷歌、fb 这几个登录页面都是明文传输密码的，百度、淘宝、qq 都是先前端加密，总结一下就是在国外没意义，国内有意义 @iiji86</p>
</blockquote>
<h1 id="用户密码安全性设计httpsblogcoderzhcom20160103security-design"><a href="https://blog.coderzh.com/2016/01/03/security-design/">用户密码安全性设计</a></h1>
<h1 id="即使被拖库也可以保证密码不泄露httpsblogcoderzhcom20160110a-password-security-design-example"><a href="https://blog.coderzh.com/2016/01/10/a-password-security-design-example/">即使被拖库，也可以保证密码不泄露</a></h1>
<h1 id="前端rsa私钥加密httpsgithubcomtravistjsencrypt"><a href="https://github.com/travist/jsencrypt">前端rsa私钥加密</a></h1>
<h1 id="web前端密码加密是否有意义---w2014的回答httpswwwzhihucomquestion25539382answer539557939"><a href="https://www.zhihu.com/question/25539382/answer/539557939">Web前端密码加密是否有意义？ - w2014的回答</a></h1>
<p>事实上现代密码学已经可以做到很多让人难以想象的事情了下面是一些有一点“反常识”的结论<br>
1.A可以向B证明自己拥有一个密码，但是如果B是假冒的验证者，A不会透露关于密码的任何信息给B。——“零知识证明”<br>
2.A可以和B比较自己持有的一个值的大小关系，而不泄露这个值给对方。——“百万富翁问题”<br>
3.A可以给B发来的一段信息进行电子签名，而不知道信息的内容。——“盲签名”<br>
4.A和B可以，在没有公正第三人的情况下，进行等概率胜负的博弈。——“电子博弈”<br>
5.邮件服务，如果不考虑法律风险的话，是可以做到让服务器看不到你的邮件内容的。——PGP<br>
6.破解4096位RSA是困难的。——即使用超算也如此。破解256位AES是困难的。——即使用量子计算也如此。破解OTP系统是困难（划掉）不可能的。——即使天顶星人来了也如此。<br>
7.一个好的加密算法真的应该是公开的——它可以接受更多人的检验。    一个好的密码系统不一定是公开的——但是它应该按照可以公开除了密码之外的一切而依旧安全来设计。<br>
8.可以实现这样的算法，使得班干部中的任何一个均可以以班委会的名义下达通知，且其他人，除了班长之外，都不知道具体下达者。<br>
9.密码系统的安全性取决于最弱的一环……当年是谁说的“只用https保护登录界面就够了”的来着…你的token也会被盗<br>
10.大多数密码系统都不是被正面攻破的…而是实现过程中出了差错…<br>
11.以上内容，真的，真的，在大多数的密码学教材上都能找到——甚至还有用到的一些算法安全性的数学证明…</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/">心得与经验</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>为博客打造在线编辑器</title>
                <link>https://wss.cool/online-editor-for-markdown-blog/</link>
                <guid isPermaLink="true">https://wss.cool/online-editor-for-markdown-blog/</guid>
                <pubDate>Sun, 23 Jun 2019 21:12:32 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="初衷">初衷</h2>
<p>博客的内容时使用git管理的。在公司的电脑和家里的两台电脑上都有写博客的需求，那么在3个端的每次的pull和push就显得有一点麻烦。如果有一个基于浏览器访问的编辑器就舒服多了。</p>
<h2 id="构思">构思</h2>
<p>我的博客使用了hugo，它的内容是基于markdown或html的，所以如果把博客源文件放在服务器上，同时搭建一个可以编辑这些源文件的后台，就可以实现基于浏览器编辑博客了。</p>
<p>vscode开源了他们的编辑器monaco-editor，可以使用它作为浏览器中的编辑器。</p>
<p>在搭建一个后台程序来读取博客文章内容，配合若干接口实现保存、创建、删除、登录等功能即可。</p>
<h2 id="editor项目">editor项目</h2>
<p>此项目作为后台服务，需要提供的接口有：</p>
<ol>
<li>创建文章</li>
<li>保存文章</li>
<li>提交到git并push到仓库，并打包发布。</li>
</ol>
<p>准备使用golang实现。需要用到的golang的api有：
……</p>
<h3 id="制作image">制作image</h3>
<pre><code>sudo docker image build -t myeditor .
</code></pre><h3 id="启动容器">启动容器</h3>
<pre><code>sudo docker container run -d  --rm -p 3000:3000 -v &quot;/home/wang/code/hugo/content/posts&quot;:/app/blog myeditor
</code></pre><h2 id="hugo项目中的docker">hugo项目中的docker</h2>
<h3 id="生成image">生成image</h3>
<pre><code>sudo docker image build -t site .
</code></pre><h3 id="启动nginx容器">启动nginx容器</h3>
<pre><code>sudo docker container run --rm --name myblog \
-p 80:80 -p 443:443 -d \
--volume &quot;$PWD/public&quot;:/usr/share/nginx/html site
</code></pre><h3 id="打包hugo">打包hugo</h3>
<pre><code>hugo --baseURL https://wowfriday.cn/
</code></pre><pre><code>hugo serve --renderToDisk --baseURL https://wowfriday.cn/ --appendPort=false
hugo serve --renderToDisk --appendPort=false
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%8A%98%E8%85%BE/">折腾</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>前端知识点</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E7%82%B9/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E7%82%B9/</guid>
                <pubDate>Mon, 17 Jun 2019 02:03:56 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://time.geekbang.org/column/article/12271">左耳朵耗子</a></p>
<h1 id="css">css</h1>
<ul>
<li>选择器
<ul>
<li>优先级</li>
<li>伪类</li>
<li>伪元素</li>
</ul>
</li>
<li>盒子
<ul>
<li>盒子模型</li>
<li>内容、内边距、边框、外边距、box-sizing</li>
<li>背景颜色、背景图片、背景渐变色</li>
<li>outline、box-shadow</li>
</ul>
</li>
<li>外边距合并</li>
<li>布局</li>
<li>浮动和定位在内的传统布局方法</li>
<li>弹性盒（flexbox）布局</li>
<li>书写规范</li>
<li>less</li>
</ul>
<h1 id="js核心原理">JS核心原理</h1>
<p>了解好的特性和各种坑。</p>
<ul>
<li>《JS语言精粹》</li>
<li>《JS忍者秘籍》</li>
<li>《Effective JS》的68条精华建议</li>
<li>《深入浅出ES6》</li>
</ul>
<h1 id="浏览器原理">浏览器原理</h1>
<h2 id="how-browsers-works">How browsers works</h2>
<p>原文的翻译<a href="link1">How browsers works</a></p>
<h2 id="virtual">Virtual</h2>
<hr>
<h1 id="网络协议">网络协议</h1>
<ul>
<li>High Performance Browser Networking</li>
<li>http2</li>
<li>websocket</li>
</ul>
<h1 id="前端性能">前端性能</h1>
<h1 id="框架">框架</h1>
<h1 id="实践">实践</h1>
<ul>
<li>跨域</li>
<li>AJAX &amp; Fetch &amp; Axios</li>
</ul>
<p>[link1][https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/]</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Favicon Emoji</title>
                <link>https://wss.cool/favicon-emoji.html</link>
                <guid isPermaLink="true">https://wss.cool/favicon-emoji.html</guid>
                <pubDate>Wed, 12 Jun 2019 17:58:07 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>先加一个这个</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;icon&#34;</span> <span class="na">data-emoji</span><span class="o">=</span><span class="s">&#34;🛰&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;image/png&#34;</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>在来一段js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">favicon</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;link[rel=icon]&#34;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">favicon</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">emoji</span> <span class="o">=</span> <span class="nx">favicon</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&#34;data-emoji&#34;</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">emoji</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;canvas&#34;</span><span class="p">);</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>

    <span class="kr">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&#34;2d&#34;</span><span class="p">);</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s2">&#34;64px serif&#34;</span><span class="p">;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">emoji</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>

    <span class="nx">favicon</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Linux的简单使用</title>
                <link>https://wss.cool/linux.html</link>
                <guid isPermaLink="true">https://wss.cool/linux.html</guid>
                <pubDate>Tue, 11 Jun 2019 23:02:30 +0800</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="安装二进制软件">安装二进制软件</h2>
<ol>
<li>下载tar.gz压缩包</li>
<li>use the command <code>tar vxzf hugo.tar.gz </code></li>
<li>move lib to <code>/usr/local/bin</code>, command:<code>mv ~/download/hugo /usr/local/bin/hugo</code></li>
<li>set path <code>vim ~/.zshrc</code></li>
<li>add <code>export PATH=/usr/local/bin/hugo:$PATH</code></li>
<li><code>source ~/.zshrc</code></li>
</ol>
<h2 id="复制">复制</h2>
<pre><code>sudo cp -r public /usr/share/nginx/html/blog
</code></pre><h2 id="端口被占用">端口被占用</h2>
<p>lsof -i :80</p>
<h2 id="解析域名">解析域名</h2>
<pre><code>apt install dig

dig wss.cool
</code></pre><h2 id="设置梯子-客户端">设置梯子-客户端</h2>
<p>使用shadowsocks-libev，</p>
<p>安装 <code>sudo apt-get install shadowsocks-libev</code></p>
<p>配置文件在 <code>/etc/shadowsocks-libev/config.json</code></p>
<p>修改后启动服务 <code>systemctl start shadowsocks-livev-local@config</code></p>
<p>开机自启动 <code>systemctl enable shadowsocks-livev-local@config</code></p>
<p>可以查看日志 <code>journalctl -u shadowsocks-livev-local@config</code></p>
<h2 id="使用systemd启动关闭java程序">使用systemd启动关闭Java程序</h2>
<p><a href="https://stackoverflow.com/a/28704296/6021280">参考1</a></p>
<p>使用spring boot创建的项目，使用maven打包出来成jar包。上传到服务器，这里使用linux的systemd来开启和关闭java程序。</p>
<p>首先找到用户定义的service目录，ubuntu是在<code>/etc/systemd/system</code>，其他发行版可能在<code>/usr/lib/systemd/system/</code></p>
<p>第二步，在其中创建文件<code>名字.service</code>，我的是叫<code>blog.service</code>，编辑文件。</p>
<pre><code>[Unit]
Description=webserver Daemon

[Service]
ExecStart=/usr/bin/java -jar /web/server.jar
User=ubuntu

[Install]
WantedBy=multi-user.target
</code></pre><pre><code>[Unit]
Description=dinghe de image service

[Service]
ExecStart=/usr/bin/java -XX:+UseSerialGC -Xss512k -XX:MaxRAM=128m -jar /home/ubuntu/image-0.0.4-SNAPSHOT.jar
User=ubuntu

[Install]
WantedBy=multi-user.target
</code></pre><p>第三步，启动/关闭/查看状态。</p>
<p>命令可以这样用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo systemctl start blog.service <span class="c1"># starts the service</span>
sudo systemctl stop blog.service <span class="c1"># stops the service</span>

sudo systemctl status blog.service
sudo systemctl restart blog.service <span class="c1"># restarts the service</span>

sudo systemctl <span class="nb">enable</span> blog.service <span class="c1"># auto starts the service</span>
sudo systemctl disable blog.service <span class="c1"># stops autostart</span>
</code></pre></td></tr></table>
</div>
</div><p>还可以这样用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo service blog start/stop/status/restart
</code></pre></td></tr></table>
</div>
</div><p>修改了service文件后需要刷新</p>
<pre><code>sudo systemctl daemon-reload
</code></pre><h2 id="ubuntu-安装python3">ubuntu 安装python3</h2>
<ol>
<li>wget <a href="http://www.python.org/ftp/python/3.7.4/Python-3.7.4.tgz">http://www.python.org/ftp/python/3.7.4/Python-3.7.4.tgz</a></li>
<li>tar -xvzf Python-3.7.4.tgz</li>
<li>cd Python-3.7.4</li>
<li>./configure --with-ssl</li>
<li>make</li>
<li>sudo make install</li>
</ol>
<h2 id="修改root密码">修改root密码</h2>
<p>使用普通给用户密码切换到root，在使用passwd修改密码</p>
<pre><code>sudo su
passwd root
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/linux/">linux</category>
                                
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/%E5%85%A5%E9%97%A8/">入门</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>docker</title>
                <link>https://wss.cool/docker.html</link>
                <guid isPermaLink="true">https://wss.cool/docker.html</guid>
                <pubDate>Thu, 06 Jun 2019 01:47:46 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="ubuntu安装docker">ubuntu安装docker</h2>
<p>使用清华源安装，<a href="https://mirror.tuna.tsinghua.edu.cn/help/docker-ce/">地址</a>，按照文档操作即可。</p>
<h2 id="设置docker源为阿里镜像">设置docker源为阿里镜像</h2>
<pre><code>sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  &quot;registry-mirrors&quot;: [&quot;https://2sjdzxnu.mirror.aliyuncs.com&quot;]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre><h2 id="操作">操作</h2>
<p>进入 container</p>
<pre><code>docker exec -it container-name/id /bin/sh
</code></pre><p>最后的 <code>/bin/sh</code> 可以换成 <code>/bin/bash</code></p>
<h2 id="tensorflow">tensorflow</h2>
<p>系统ubuntu 18.04，显卡Gtx950，驱动390。</p>
<ol>
<li>安装<code>nvidia-docker</code>和<code>nvidia-container-runtime</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey <span class="p">|</span> <span class="se">\
</span><span class="se"></span>  sudo apt-key add -
<span class="nv">distribution</span><span class="o">=</span><span class="k">$(</span>. /etc/os-release<span class="p">;</span><span class="nb">echo</span> <span class="nv">$ID$VERSION_ID</span><span class="k">)</span>
curl -s -L https://nvidia.github.io/nvidia-docker/<span class="nv">$distribution</span>/nvidia-docker.list <span class="p">|</span> <span class="se">\
</span><span class="se"></span>  sudo tee /etc/apt/sources.list.d/nvidia-docker.list
sudo apt-get update
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt-get install -y nvidia-docker2<span class="o">=</span>2.0.3+docker18.09.1-1 nvidia-container-runtime<span class="o">=</span>2.0.0+docker18.08.1-1
sudo pkill -SIGHUP dockerd
</code></pre></td></tr></table>
</div>
</div><p>测试一下</p>
<p><code>docker run --runtime=nvidia --rm nvidia/cuda:9.0-base nvidia-smi</code></p>
<p><a href="https://github.com/NVIDIA/nvidia-docker/issues/578">如果报错<code>docker: Error response from daemon: Unknown runtime specified nvidia.</code></a></p>
<p>解决方法：</p>
<blockquote>
<p>Systemd drop-in file
sudo mkdir -p /etc/systemd/system/docker.service.d
sudo tee /etc/systemd/system/docker.service.d/override.conf &lt;&lt;EOF
[Service]
ExecStart=
ExecStart=/usr/bin/dockerd --host=fd:// --add-runtime=nvidia=/usr/bin/nvidia-container-runtime
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
Daemon configuration file
sudo tee /etc/docker/daemon.json &lt;&lt;EOF
{
&quot;runtimes&quot;: {
&quot;nvidia&quot;: {
&quot;path&quot;: &quot;/usr/bin/nvidia-container-runtime&quot;,
&quot;runtimeArgs&quot;: []
}
}
}
EOF
sudo pkill -SIGHUP dockerd
再次测试。</p>
</blockquote>
<ol start="2">
<li>安装tensorflow的docker，<a href="https://github.com/NVIDIA/nvidia-docker/issues/931">由于驱动旧，不能使用最新的tensorflow版本</a>，就先用1.11.0版本。还要用python3，所以安装的docker image是这个<code>sudo docker pull tensorflow/tensorflow:1.11.0-gpu-py3</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo docker run -p 8888:8888 --volume <span class="s2">&#34;</span><span class="nv">$PWD</span><span class="s2">&#34;</span>:/notebooks --runtime<span class="o">=</span>nvidia -it tensorflow/tensorflow:1.11.0-gpu-py3
</code></pre></td></tr></table>
</div>
</div><p>启动后会直接打开一个jupyter，可以先做一下gpu的测试。
这样就算是搭号GPU环境了。</p>
<p>但是这个环境中没有安装opencv-python或者opencv-contrib-python，也没有～/.keras/modelsinception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5文件。</p>
<p>这里可能需要自己再打包一个image，可以参考这个<a href="https://blog.csdn.net/chenming_hnu/article/details/70184543">链接</a><br>
还可以试一下用映射解决</p>
<p><code>--volume</code>为“映射”，当前目录（$PWD）中的文件，会反映容器中个的<code>/notebooks</code>目录下。<br>
tensorflow这个image会启动一个jupyter，其中就可以访问到<code>$PWD</code>目录。</p>
<h2 id="腾讯云的docker仓库">腾讯云的docker仓库</h2>
<p>账号w..........<br>
密码w...1......</p>
<p><code>docker image build -t site . </code></p>
<p>方案1：使用<code>hugo</code>命令手动将也构建到public目录，然后启动docker是映射目录<br>
<code>sudo docker container run --rm --name myblog -p 80:80 -p 443:443 --volume &quot;$PWD/public&quot;:/usr/share/nginx/html site</code></p>
<p>方案2：使用<code>hugo server -D</code>命令运行测试服务器，修改nginx的default.conf文件，加入反向代理配置。</p>
<p>登录腾讯云 docker registry</p>
<p><code>sudo docker login --username=wangshushuo hub.tencentyun.com</code><br>
登录 registry 的用户名是您 Tencent Hub 的用户名，密码是您开通   Tencent Hub 用户时设置的密码。</p>
<p>从 registry 拉取镜像</p>
<p><code>sudo docker pull hub.tencentyun.com/wangshushuo/site:[tag]</code></p>
<p>其中 [tag] 请根据您的镜像版本信息进行填写。</p>
<p>将镜像推送到 registry</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo docker tag <span class="o">[</span>ImageId<span class="o">]</span> hub.tencentyun.com/wangshushuo/site:<span class="o">[</span>tag<span class="o">]</span>

sudo docker login --username<span class="o">=</span>wangshushuo hub.tencentyun.com
sudo docker tag site hub.tencentyun.com/wangshushuo/site
sudo docker push hub.tencentyun.com/wangshushuo/site
</code></pre></td></tr></table>
</div>
</div><h2 id="加速image文件上传到云服务器">加速image文件上传到云服务器。</h2>
<p>云服务器的快带只有1m，我猜测上传速度会很慢，一个image文件有七八十兆，可能要上传很久。</p>
<p>腾讯云有免费的docker仓库，可以上传image文件。</p>
<p>再从腾讯云服务器pull image文件，就很快。</p>
<h2 id="将wordpress的nginx配置改掉了">将wordpress的nginx配置改掉了</h2>
<p>docker开启在8080端口，修改了原来wp的配置为：</p>
<pre><code class="language-conf" data-lang="conf">server {
  listen 80;
  listen 443 ssl http2;
  ssl_certificate /usr/local/nginx/conf/ssl/1_wowfriday.cn_bundle.crt;
  ssl_certificate_key /usr/local/nginx/conf/ssl/2_wowfriday.cn.key;
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
  ssl_prefer_server_ciphers on;
  ssl_session_timeout 10m;
  ssl_session_cache builtin:1000 shared:SSL:10m;
  ssl_buffer_size 1400;
  add_header Strict-Transport-Security max-age=15768000;
  ssl_stapling on;
  ssl_stapling_verify on;
  server_name wowfrday.cn;
  access_log /data/wwwlogs/wowfrday.cn_nginx.log combined;
  index index.html index.htm index.php;
  root /data/wwwroot/wowfrday.cn/;

  if ($ssl_protocol = &quot;&quot;) { return 301 https://$host$request_uri; }
  

  location /{
    proxy_pass https://localhost:8080;
  }
}
</code></pre><h2 id="phpmyadmin">phpmyadmin</h2>
<pre><code>docker run --name myphpadmin -d -e PMA_ARBITRARY=1 -p 8080:80 phpmyadmin/phpmyadmin
</code></pre>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/">工具</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>GraphQl介绍</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/graphql/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/graphql/</guid>
                <pubDate>Fri, 10 May 2019 06:58:48 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="什么是graphql">什么是GraphQL？</h2>
<p>官网的介绍：一种用于API的查询语言。</p>
<p>通常说到API都是说调用，那查询API是什么操作呢？</p>
<p>大家都知道SQL，数据库的查询语言。其实gql和sql就有些相似。</p>
<p>比如sql是这样的语句：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-1.png" alt="" class="wp-image-356"   /> </figure></p>
<p>gql也是个语句，它可以写成这样：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-2.png" alt="" class="wp-image-357" /> </figure></p>
<p>他们都是一种查询语言，用一定的语法来描述你想要的数据。</p>
<p>上面的gql会返回一个json：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-3.png" alt="" class="wp-image-358"   /> </figure></p>
<p>这个查询语句就是GraphQL（gql）。</p>
<h2 id="graphql能干嘛">GraphQL能干嘛？</h2>
<p>知道了它是什么，还得了解它是做什么事的。</p>
<p>举个例子：</p>
<p>首先，我们要做一个需求，是一个这样的页面，里面有若干数据。<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-4-1024x212.png" alt="" class="wp-image-359"   /> </figure></p>
<p>这些数据由一个API接口返回：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-5.png" alt="" class="wp-image-360" /> </figure></p>
<p>后来需求变了，有些数据不需要显示了：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-6.png" alt="" class="wp-image-361"   /> </figure></p>
<p>那么API接口也可能做对应的变化。<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-7.png" alt="" class="wp-image-362"   /> </figure></p>
<p>这次是减字段，也可能是加字段。还可能要考虑兼容旧版本（APP或灰度），不改原来的API，通过加API来做新需求。</p>
<p>这些修改不仅消耗时间和精力。长时间的积累，也会在前后端，出现很多冗余的字段，冗余的API。给项目积累了一些混乱和风险。</p>
<p>这时候GraphQL就能派上用场了。看下面的视频。上半部分是gql语句，下半部分是查询到的结果。<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/屏幕录制-2019-05-07-下午11.36.17.mp4" alt="" class="wp-image-363" /> </figure></p>
<p>我们看到，对于hero对象，gql可以只查询一个name字段，也可以查询3个字段。</p>
<p>如果用gql来查询API接口，是不是就能避免上面提到的“冗余的字段，冗余的API。混乱和风险。”</p>
<p>这里大致介绍了GraphQL能做的事。</p>
<h2 id="实现">实现</h2>
<p>知道了GraphQL是什么和能做什么事，接下来该介绍怎么实现这个技术方案了。</p>
<p>我们知道sql查询的是数据库，我们运行一个sql语句需要在数据库服务器的环境。同样的运行一个gql也需要一个gql的服务器。</p>
<p>实现gql服务器前，需要先了解ji个gql的概念：schema和类型。</p>
<h3 id="gql的类型">gql的类型</h3>
<p>GraphQl是通过<strong>类型</strong>系统来定义数据和行为。这些<strong>类型</strong>就需要通过schema语句定义的。先看一段schema语句：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-8-1024x570.png" alt="" class="wp-image-364"   /> </figure></p>
<p>使用type声明一个类型，图中有3个类型，其中<strong>Query</strong>和<strong>Mutation</strong>是原始类型，分别表示<strong>查询</strong>和<strong>变更</strong>，这两个类型内部就是定义查询和变更的行为。</p>
<p><strong>Book</strong>类型是我们的数据类型，是自定义类型。</p>
<p>schema只是定义了数据类型和行为类型。有了类型，我们还需要根据类型执行不同的任务。执行这些任务的角色就叫解析器。</p>
<h3 id="resolver解析器">Resolver解析器</h3>
<p>解析器是行为类型的实现，它需要与数据库对接，来查询数据库。比如上面定义的Query和Mutation类型的实现：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-9-1024x644.png" alt="" class="wp-image-365"   /> </figure></p>
<p>这个解析器是通过MongoDB实现的：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-11-1024x302.png" alt="" class="wp-image-367"   /> </figure></p>
<p>所以具体的getAll和getById实际上都是执行的mongoDB的查询。</p>
<p>服务器上主要做这两件事，通过schema定义类型，和实现具体的解析器。</p>
<p>server的代码在这里<a href="https://gitee.com/wss1942/appllo-serve.git">https://gitee.com/wss1942/appllo-serve.git</a></p>
<p>这个server的实现用到了mongoDB数据库，需要自己安装，我是按照菜鸟的教程做的，很简单。</p>
<h2 id="客户端网页">客户端（网页）</h2>
<p>代码在这里<a href="https://gitee.com/wss1942/apollo-client.git">https://gitee.com/wss1942/apollo-client.git</a></p>
<p>实现一个gql的客户端主要需要2部分，网络层和存储层。<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-12.png" alt="" class="wp-image-368"   /> </figure></p>
<p>用了client就可以执行gql语句进行查询了：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-13.png" alt="" class="wp-image-369"   /> </figure></p>
<p>还有变更：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/05/image-14-1024x726.png" alt="" class="wp-image-370"   /> </figure></p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>如何拥有技术领导力？</title>
                <link>https://wss.cool/lead.html</link>
                <guid isPermaLink="true">https://wss.cool/lead.html</guid>
                <pubDate>Mon, 06 May 2019 02:38:58 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="">左耳听风专栏</a></p>
<h2 id="第一吃透基础技术基础技术是各种上层技术的共同的基础">第一，吃透基础技术，基础技术是各种上层技术的共同的基础。</h2>
<p>计算机技术太多，但仔细分析你会发现，知识表现形式多，而基础技术并不多。学好基础技术，能让你一通百通，更快地使用各种新技术，从而可以更轻松地与时代同步。</p>
<p>基础技术主要是两部分：编程和系统。</p>
<h3 id="编程部分">编程部分：</h3>
<p>**C语言：**更接近底层，能更好地理解程序的运行。</p>
<p>**编程范式：**培养抽象思维，提高编程效率，提高程序的结构合理性、可读性和可维护性，降低冗余度。学习编程范式：多了解各种程序设计语言的功能特性。</p>
<p>**算法和数据结构：**任何有技术含量的软件中一定有高级的算法和数据结构。比如epoll中使用红黑树，数据库索引使用B+树。业务中的各种排序、过滤、查找也用到算法。</p>
<h3 id="系统部分">系统部分：</h3>
<p><strong>网络基础：</strong>《TCP/IP详解》，学习基础的网络协议，可以为我们的高纬度分布式架构中的一些技术问题提供很多的技术方案。比如TCP的滑动窗口限流，完全可以用于分布式服务中的限流方案。</p>
<p>**数据库原理：**文件系统适合存放连续的信息，比如图片，文章。如果保存很短的信息也保存文件的画，会浪费大量的磁盘空间，而且无法方便地查询。数据库更适合存放短的数据。且能方便的查询。流行的两类数据库管理系统：SQL和NoSQL。前者B+数，强一致性，后者弱一致性，高存取效率，基于哈希表和其他技术。</p>
<p>学习数据库原理，能了解数据库访问性调优的要点。以及保证并发情况下的数据操作的原子性。</p>
<p>**分布式技术架构：**数据库和应用程序服务器需要横向扩展，才能提供做够高的性能。为了做到这一点，要学习分布式技术架构，包括负载均衡、DNS解析、多子域名、无状态应用层、缓存层、数据库分片、容错和恢复机制、Paxos、Map/Reduce操作、分布式SQL数据库一致性等知识点。</p>
<p>学习分布式技术架构的有效途径是参与到分布式项目的开发中去，并阅读相关论文。</p>
<h2 id="第二提高学习能力就是能够很快地学习新技术又能在关键技术上深入的能力">第二，提高学习能力。就是能够很快地学习新技术，又能在关键技术上深入的能力。</h2>
<p>只有掌握了上述基础原理之上，才能拥有好的学习能力。</p>
<h2 id="第三坚持做正确的事">第三，坚持做正确的事。</h2>
<p>做正确的事，比用正确的方法做事更重要。因为这样才始终会向目的地靠拢。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/">心得与经验</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>网站的兼容性</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/%E7%BD%91%E7%AB%99%E7%9A%84%E5%85%BC%E5%AE%B9%E6%80%A7/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/%E7%BD%91%E7%AB%99%E7%9A%84%E5%85%BC%E5%AE%B9%E6%80%A7/</guid>
                <pubDate>Wed, 03 Apr 2019 02:41:47 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="适配方案">适配方案</h2>
<p>两种方案做适配不同屏幕：一种是淘宝的按照尺寸缩放，一种是bootstrap的响应式布局。</p>
<p>bootstrap有一个react-bootstrap的项目，如果需要支持ie9，需要引入bootstrap3的css。因为4不支持ie9，有些特性使用不了。</p>
<h2 id="回流与重绘-reflow--repaint">回流与重绘 (Reflow &amp; Repaint)</h2>
<p>ie（9-11）中使用absolute和fixed，滚动式抖动。在整个文档中间某些位置设置了<br>
absolute和fixed，会导致页面抖动，查看性能记录，会有大量时间在【画图】，将absolute和fixed的元素移动到文档的尾部，也就是他们的后面没有其他元素，就能解决抖动的问题。</p>
<p>利用 <code>ReactDOM.createPortal</code>将absolute\fixed的元素放置到整个文档最后</p>
<p>利用modernizr检测浏览器不支持的功能\样式。</p>
<h2 id="ie9的某些样式与标准写法不同">IE9的某些样式与标准写法不同</h2>
<p>文字两段对齐:</p>
<pre class="wp-block-code"><code>text-align: justify;
text-justify: distribute; //IE9
-ms-text-align-last: justify;
text-align-last: justify;</code></pre>
<p>文字竖排：</p>
<pre class="wp-block-code"><code>writing-mode: vertical-rl;
-ms-writing-mode: tb-rl;//IE9</code></pre>
<p>居中写法（top/left有bug）：</p>
<pre class="wp-block-code"><code>position: absolute;
bottom: 50%;
right: 50%;
transform: translate(50%, 50%);</code></pre><blockquote>
</blockquote>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>自定义事件</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/dom/%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/dom/%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6/</guid>
                <pubDate>Wed, 27 Mar 2019 05:19:04 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/Events/Creating_and_triggering_events">创建和触发events</a></p>
<h1 id="监听">监听</h1>
<p>通常将事件监听绑定在<code>document</code>上即可，也可以绑定在其他DOM元素。</p>
<p>监听<code>build</code>事件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> 
  <span class="c1">//  do something
</span><span class="c1"></span><span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="传数据的事件">传数据的事件</h1>
<p>使用<code>CustomEvent</code>创建事件。并且只能用<code>detail</code>字段名来存放数据。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomEvent</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;detail&#39;</span><span class="o">:</span> <span class="nx">anydata</span> <span class="p">});</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="不传数据的事件">不传数据的事件</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 创建事件
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/Events/Creating_and_triggering_events">MDN</a>上还有冒泡等其他内容</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/dom/">DOM</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>CSS命名</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/css/css%E5%91%BD%E5%90%8D/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/css/css%E5%91%BD%E5%90%8D/</guid>
                <pubDate>Wed, 27 Mar 2019 05:08:59 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>使用less和css module。在A和B两个less文件中分别写如下的样式。</p>
<pre><code>.textfillsContainer{
  background-color:red;
  .textfills{
      background-color:red;
  }
}
</code></pre><p>A文件：
<img src="/images/css_class_name/image-9.png" alt="A文件" title="A文件">
B文件：
<img src="/images/css_class_name/image-8.png" alt="B文件" title="B文件"></p>
<p>在编译打包后的文件中观察：</p>
<p>A文件打包出来的css代码：
<img src="/images/css_class_name/image-6.png" alt="B文件" title="A文件的实际css代码"></p>
<p>B文件打包出来的css代码：
<img src="/images/css_class_name/image-7.png" alt="B文件" title="B文件的实际css代码"></p>
<p>可以看到，即使是相同的class名，由于less或者css module的作用，会视文件为一个模块，在打包时，根据模块对class名做混淆哈希。</p>
<p>所以只要不在一个文件（模块）中使用相同class名就能避免命名冲突。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/css/">CSS</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>浏览器缓存</title>
                <link>https://wss.cool/browser-cache.html</link>
                <guid isPermaLink="true">https://wss.cool/browser-cache.html</guid>
                <pubDate>Thu, 14 Mar 2019 02:23:03 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>看了<a href="https://juejin.im/entry/5ad86c16f265da505a77dca4">这篇文章</a>后记录下自己的理解。</p>
<p>缓存有2步：强制缓存和协商缓存。就是通过一些手段，设置强制缓存，让文件保存在本地硬盘，当强制缓存失效后，再通过与服务器协商看是否更新缓存文件。</p>
<h2 id="强制缓存">强制缓存</h2>
<p>强制缓存会把文件缓存在本地，当缓存未过期时访问网站，浏览器会直接使用缓存的资源。</p>
<p>控制强制缓存的字段分别是Expires和Cache-Control，其中Cache-Control优先级比Expires高。</p>
<p>Expires是过时的方式，不推荐使用。推荐使用Cache-Control来控制。</p>
<p>Cache-Control用的多的值是如下几个：</p>
<ul>
<li>public：（强制缓存）所有内容都将被缓存（客户端和代理服务器都可缓存）</li>
<li>private：<br>
（强制缓存） 所有内容只有客户端可以缓存，Cache-Control的默认取值</li>
<li>no-cache：（协商缓存）客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定</li>
<li>no-store：（决定不使用缓存）所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存</li>
<li>max-age=xxx (xxx is numeric)：缓存内容将在xxx秒后失效</li>
</ul>
<h2 id="协商缓存">协商缓存</h2>
<p>协商缓存就是强制缓存失效后，浏览器携带<strong>缓存标识</strong>向服务器发起请求，由服务器根据<strong>缓存标识</strong>决定是否使用缓存的过程。</p>
<p><strong>缓存标识</strong>是响应报文的HTTP头中和请求结果一起返回给浏览器的。</p>
<p><strong>缓存标识</strong>有2组：</p>
<ul>
<li>【Last-Modified / If-Modified-Since 】</li>
<li>【Etag / If-None-Match】</li>
</ul>
<p>【Etag / If-None-Match】优先级较高。</p>
<h3 id="last-modified--if-modified-since">Last-Modified / If-Modified-Since</h3>
<p>Last-Modified是服务器响应请求时，返回该资源文件在服务器最后被修改的时间。</p>
<p>If-Modified-Since则是客户端再次发起该请求时，携带上次请求返回的Last-Modified值。服务器通过比较这个值判断缓存是否失效。</p>
<p>协商缓存生效，返回304，浏览器使用缓存。</p>
<p>协商缓存失效，返回200和请求结果 。</p>
<h3 id="etag--if-none-match">Etag / If-None-Match</h3>
<p>Etag是服务器响应请求时，返回当前资源文件的一个唯一标识（由服务器生成）。</p>
<p>If-None-Match是客户端再次发起该请求时，携带上次请求返回的唯一标识Etag值。服务器通过比较这个值判断缓存是否失效。</p>
<p>协商缓存生效，返回304，浏览器使用缓存。</p>
<p>协商缓存失效，返回200和请求结果 。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>加载script标签</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/js-script-tag/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/js-script-tag/</guid>
                <pubDate>Wed, 13 Mar 2019 02:03:07 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>将script标签写在2个地方——head中和body中——进行观察：</p>
<p>head中，他们大概是同时开始加载，运行后，body中的才开始加载运行。也及时body中的，会等待head中的加载完成运行完毕后，才开始加载。也就是页面会阻塞。<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/03/image-4-1024x409.png" alt="" class="wp-image-296"   /> </figure></p>
<p>还有可能在head中编写一段js代码，它会在head中再添加几个script标签。就会出现下面的情况。<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/03/image-5-1024x437.png" alt="" class="wp-image-297"   /> </figure></p>
<p>第一部分是head中写死的，第二部分是JS添加到head中的，第三部分是写在body中的。</p>
<p>第二部分会开始加载，然后body中的不会等待第二部分加载完成，也就是JS添加的script不会阻塞页面。</p>
<p>当body中的script依赖了JS添加的script，就有可能出现找不到依赖报错的情况。</p>
<h2 id="defer-async"><strong>defer async</strong></h2>
<p>**async：**异步加载资源，且加载完JS资源立即执行，并不会按顺序，谁快谁先上， 网页不会失去响应。</p>
<p>**defer：**异步加载资源，在DOM渲染后之后再按顺序执行JS。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>字体</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/%E5%AD%97%E4%BD%93/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/%E5%AD%97%E4%BD%93/</guid>
                <pubDate>Tue, 05 Mar 2019 05:16:17 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>一个bug——页面中的字体无缘无故的而变成了宋体，而且有区别，用electron打包的页面是宋体，用chrome浏览器打开的是雅黑或者果方。</p>
<p>由于span被设置了一个fontFamily只为雅黑，而苹果系统没有雅黑字体，所以它没有找父级元素继承字体，而是选择了浏览器的环境变量（设置）。</p>
<p>在mac的chrome的设置中，看字体。有标准、serif、sans-serif、宽度固定四中设置。在修改了 sans-serif 以后，原本只在electron中出现的宋体，也出现在了chrome中，由此推断，是这个设置的锅了。</p>
<p>electron也是一个浏览器环境，有一些配置项，发现 webPreferences 有如下配置：<figure class="wp-block-image"></p>
<p><img src="/uploads/2019/03/image-1.png" alt="" class="wp-image-281"   /> </figure></p>
<p>此处设置为微软雅黑后，mac下表现就和chrome一致了。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/">前端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Cheerio</title>
                <link>https://wss.cool/cheerio.html</link>
                <guid isPermaLink="true">https://wss.cool/cheerio.html</guid>
                <pubDate>Fri, 25 Jan 2019 01:20:58 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="1解析表格table">1.解析表格table</h2>
<pre class="wp-block-code"><code><tr class="listingTrailer">
	<td>
		</td><td colspan="2">Summa tillgodoräknade poäng:
		</td><td class="credits">10,5
		</td><td>
</td></tr></code></pre>
<p>如果只是一段tr，cheerio不会识别，需要是一个完整的table才可以，而且table外面好像还有包一层div之类的东西，cheerio才能解析。</p>
<h2 id="2遍历">2.遍历</h2>
<p>使用each方法可以return false跳出遍历：</p>
<blockquote class="wp-block-quote">
  <p>
    To break out of the <code>each</code> loop early, return with <code>false</code>.
  </p>
<p><cite><a href="https://cheerio.js.org/"><a href="https://cheerio.js.org/">https://cheerio.js.org/</a></a></cite></p>
</blockquote>
<h3 id="21-使用this">2.1. 使用this</h3>
<p>使用this的话，要使用function函数，不能使用箭头函数。function函数的this指向tr。</p>
<pre class="wp-block-code"><code>$('tbody tr').each(function(i, elem) {
	const id = $(this).data();
	console.log(id);
});</code></pre>
<h3 id="22-使用箭头函数就别用this">2.2. 使用箭头函数就别用this</h3>
<p>因为this不会指向tr，所以要用回调函数的第二个参数。</p>
<pre class="wp-block-code"><code>$('tbody tr').each((i, elem)=>{
	const id = $(elem).data();
	console.log(id);
});</code></pre><blockquote>
</blockquote>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/">后端</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>React 与 Typescript</title>
                <link>https://wss.cool/typescript-react.html</link>
                <guid isPermaLink="true">https://wss.cool/typescript-react.html</guid>
                <pubDate>Sun, 20 Jan 2019 14:15:47 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="input的事件类型">input的事件类型</h2>
<p>需要注意两点。</p>
<ol>
<li>事件类型可能有两种</li>
</ol>
<ul>
<li><code>ChangeEvent</code> 对应 <code>event.target</code></li>
<li><code>FormEvent</code> 对应 <code>event.currentTarget</code></li>
</ul>
<ol start="2">
<li>泛型对应元素，可能是<code>HTMLInputElement</code> 或 <code>HTMLSelectElement</code> 等。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">const</span> <span class="nx">handleSearch</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span>: <span class="kt">React.ChangeEvent</span><span class="o">&lt;</span><span class="nx">HTMLInputElement</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">setKeywords</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
        <span class="nx">props</span><span class="p">.</span><span class="nx">onUpdateKeyword</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="class组件的类型">class组件的类型</h2>
<p>class组件需要定义props和state的类型：</p>
<pre><code>interface IProps {
  addTodo: (input: string) =&gt; void;
}
interface IState {
  input: string;
}
class AddTodo extends React.Component&lt;IProps, IState&gt;{}
</code></pre><h2 id="创建项目">创建项目</h2>
<p><a href="https://github.com/Microsoft/TypeScript-React-Starter#typescript-react-starter">creact-react-app</a>可以直接创建 typescript 项目。</p>
<pre><code>create-react-app my-app --scripts-version=react-scripts-ts
</code></pre><h2 id="修改配置">修改配置</h2>
<p>把 tslint.json 修改为这样，能舒服一点：</p>
<pre><code>{
  &quot;extends&quot;: [
    &quot;tslint:recommended&quot;, 
    &quot;tslint-react&quot;, 
    &quot;tslint-config-prettier&quot;
  ],
  &quot;defaultSeverity&quot;: &quot;warning&quot;,
  &quot;linterOptions&quot;: {
    &quot;exclude&quot;: [
      &quot;config/**/*.js&quot;,
      &quot;node_modules/**/*.ts&quot;,
      &quot;coverage/lcov-report/*.js&quot;
    ]
  },
  &quot;rules&quot;: {
    &quot;object-literal-sort-keys&quot;: false,
    &quot;no-console&quot;: false
  }
}
</code></pre><p>在package.json的script中加入这条，可以让tslint自动修复问题：</p>
<pre><code>&quot;lint&quot;: &quot;tslint --fix -c ./tslint.json 'src/**/*{.ts,.tsx}'&quot;
</code></pre><p>千万要注意，你的代码将被修改，所以要<a href="https://stackoverflow.com/a/44850320/6021280">注意以下事项</a>⚠️：</p>
<ul>
<li>Commit the changes you have made to your code</li>
<li>Run TSLint with the <code>--fix</code> flag like above</li>
<li>Quickly review the changes TSLint has made</li>
<li>Make a new commit with these changes, or simply amend them to your previous commit</li>
</ul>
<p><code>.d.ts</code> 文件是使用js编写的api才用的。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react/">React</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>命令行发送email</title>
                <link>https://wss.cool/mac-ubuntu-send-email.html</link>
                <guid isPermaLink="true">https://wss.cool/mac-ubuntu-send-email.html</guid>
                <pubDate>Fri, 04 Jan 2019 04:49:13 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p><a href="http://www.ruanyifeng.com/blog/2017/06/smtp-protocol.html">如何验证 Email 地址：SMTP 协议入门教程</a>
<a href="http://fred.itxfd.com/2017/08/08/ubuntu-mail-%E7%94%A8-qq-%E9%82%AE%E7%AE%B1%E5%8F%91%E9%82%AE%E4%BB%B6/">ubuntu mail 用 qq 邮箱发邮件</a></p>
<p>我先尝试在我的mac上发送，先是找到了sendmail相关的介绍，然后找到了mac自带的postfix类似于sendmail，于是研究postfix，将近一天的时间我经历了各种配置与失败。</p>
<p>晚上下班的路上，看了阮一峰的smtp介绍，了解到smtp服务器的身份验证是为了防止垃圾邮件，为了控制垃圾邮件，许多邮件服务器会用自己的方法验证邮件地址，下面就是其中的一些方法。</p>
<ul>
<li>example.com 是否有 MX 记录</li>
<li>example.com 是否可以 Ping 通</li>
<li>是否存在 <a href="mailto:postmaster@example.com">postmaster@example.com</a> 这个邮箱</li>
<li>发起连接的 IP 地址是否在黑名单之中</li>
<li>IP 地址的反向 DNS 解析，是否指向一个邮件服务器</li>
</ul>
<p>qq邮箱也许用了其中某些方法，使用mac链接smtp的话，135应该都是不能通过的，所以导致了在mac上mail失败。具体什么原因导致的不能成功就不深究了。</p>
<p>由于得知了上面的信息，于是尝试用我的云服务器来实验一下，因为云服务器可以ping，有MX记录。正好还发现了一个ubuntu发邮件的文章。步骤如下：（以下主要是某网友的博文）</p>
<p>先用 <code>which mail</code> 看看有没有 <code>mail</code>。</p>
<p>如果没有的话，可以安装如下软件：</p>
<pre><code>sudo apt-get install -y heirloom-mailx
</code></pre><p>有了 <code>mail</code> 后，直接用命令行测试</p>
<pre><code>echo &quot;mail body&quot; | \
mail -v \
-r 6666666@qq.com \
-s &quot;subject&quot; \
-S form=6666666@qq.com \
-S smtp-auth-password=密码或授权码 \
-S smtp-auth-user=6666666@qq.com \
-S smtp-auth=login \
-S smtp-use-starttls \
-S smtp=smtps://smtp.qq.com:465 \
-S ssl-verify=ignore \
6666666@qq.com
</code></pre><p>在配置文件里面配置账号，首先找到相应的配置文件：</p>
<pre><code>strings `which mail` | grep '\.rc'
sudo vim /etc/s-nail.rc﻿
</code></pre><p>在文件尾部添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">set</span> <span class="nx">from</span><span class="o">=</span><span class="mi">6666666</span><span class="err">@</span><span class="nx">qq</span><span class="p">.</span><span class="nx">com</span>
<span class="nx">set</span> <span class="nx">smtp</span><span class="o">-</span><span class="nx">auth</span><span class="o">-</span><span class="nx">password</span><span class="o">=</span><span class="nx">密码或授权码</span>
<span class="nx">set</span> <span class="nx">smtp</span><span class="o">-</span><span class="nx">auth</span><span class="o">-</span><span class="nx">user</span><span class="o">=</span><span class="mi">6666666</span><span class="err">@</span><span class="nx">qq</span><span class="p">.</span><span class="nx">com</span>
<span class="nx">set</span> <span class="nx">smtp</span><span class="o">-</span><span class="nx">auth</span><span class="o">=</span><span class="nx">login</span>
<span class="nx">set</span> <span class="nx">smtp</span><span class="o">=</span><span class="nx">smtps</span><span class="o">:</span><span class="c1">//smtp.qq.com:465
</span><span class="c1"></span><span class="nx">set</span> <span class="nx">ssl</span><span class="o">-</span><span class="nx">verify</span><span class="o">=</span><span class="nx">ignore</span>
</code></pre></td></tr></table>
</div>
</div><p>然后测试：</p>
<pre><code>echo &quot;mail body&quot; | mail -s &quot;subject1&quot; 6666666@qq.com
</code></pre><p>至此，我的qq邮箱可以成功接收到邮件。这件事总算有了结果。</p>
<p>发送邮件虽然能成功，但是我的命令行会打印一个警告</p>
<pre><code>mail: /usr/local/openssl/lib/libssl.so.1.0.0: no version information available (required by mail)
</code></pre><p>经查，及尝试。将警告的2个文件移除即可，也可以改名字：</p>
<pre><code>mv /usr/local/openssl/lib/libssl.so.1.0.0 /usr/local/openssl/lib/libssl.so.1.0.0_bk
</code></pre><p>之后再发邮件就一切顺利了。</p>
<hr>
<p>事情有了新的进展：2019年1月7日。</p>
<p>我又想，为什么mac的邮件app可以发送而命令行却不行吗？应该都是用的SMTP方式来发送邮件的。那么可能还是我配置SMTP参数的问题。</p>
<p>经过搜索了解到，mac的命令行mail是一个旧版的，新版的叫heirloom-mailx或者s-nail。</p>
<p>我通过Homebrew安装了s-nail，将上面测试代码的mail换成s-nail是可以发送邮件的，但是同样的写s-nail.rc后，却不能发送邮件。而且看了man s-nail以后还是不会写抄送参数的配置。</p>
<p>上面的这个过程又消耗了我一天的时间，直接使用s-nail的人似乎很少，没有查到一个能运行的例子，这一天就在各种搜索、配置、测试中度过了。后来又想到安装mail的新本的二进制文件来更新mail似乎也是个办法。但是想到还要重新配置还是很麻烦。就放弃了。</p>
<p>今天早晨坐地铁时想到，shell不行，那就试试python吧。到公司后，在stackoverflow上找到了一个例子，修改smtp地址，账号密码，加上抄送字段。整个过程差不多半个多小时，顺利的发出了邮件🥳🤙🕺💃🎉🎊</p>
<p>幸甚至哉，歌以咏志。</p>
<p>真的惊喜，我真是太蠢了，傻了吧唧地折腾了4天的，最后用python半小时就解决了。</p>
<p>最后奉上python发送邮件的代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#! /usr/local/bin/python</span>

<span class="n">SMTPserver</span> <span class="o">=</span> <span class="s1">&#39;smtp.qq.com:465&#39;</span>
<span class="n">sender</span> <span class="o">=</span>     <span class="s1">&#39;666666@qq.com&#39;</span>
<span class="n">cc</span> <span class="o">=</span> <span class="s2">&#34;888888@163.com&#34;</span>
<span class="n">to</span> <span class="o">=</span> <span class="s2">&#34;666666@qq.com&#34;</span>

<span class="n">USERNAME</span> <span class="o">=</span> <span class="s2">&#34;666666@qq.com&#34;</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&#34;PASSWORD&#34;</span>

<span class="c1"># typical values for text_subtype are plain, html, xml</span>
<span class="n">text_subtype</span> <span class="o">=</span> <span class="s1">&#39;plain&#39;</span>


<span class="n">content</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;</span><span class="se">\
</span><span class="se"></span><span class="s2">Test message
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="n">subject</span><span class="o">=</span><span class="s2">&#34;Sent from Python&#34;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">smtplib</span> <span class="kn">import</span> <span class="n">SMTP_SSL</span> <span class="k">as</span> <span class="n">SMTP</span> <span class="c1"># this invokes the secure SMTP protocol (port 465, uses SSL)</span>
<span class="c1"># from smtplib import SMTP # use this for standard SMTP protocol   (port 25, no encryption)</span>

<span class="c1"># old version</span>
<span class="c1"># from email.MIMEText import MIMEText</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">rcpt</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">to</span><span class="p">]</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">text_subtype</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span><span class="o">=</span>       <span class="n">subject</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">sender</span> <span class="c1"># some SMTP servers will do this automatically, not all</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Cc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cc</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">SMTP</span><span class="p">(</span><span class="n">SMTPserver</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">set_debuglevel</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">USERNAME</span><span class="p">,</span> <span class="n">PASSWORD</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">rcpt</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

<span class="k">except</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="s2">&#34;mail failed; </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="s2">&#34;CUSTOM_ERROR&#34;</span> <span class="p">)</span> <span class="c1"># give an error message</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E6%8A%98%E8%85%BE/">折腾</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>dva取消异步任务</title>
                <link>https://wss.cool/dva-saga-cancel-effect.html</link>
                <guid isPermaLink="true">https://wss.cool/dva-saga-cancel-effect.html</guid>
                <pubDate>Mon, 31 Dec 2018 09:54:21 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>先声明一个axios的网络请求函数login🤪：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">//service.js
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">&#39;axios&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">login</span><span class="o">:</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">cancelToken</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">ApiServer</span><span class="si">}</span><span class="sb">/auth/user`</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">cancelToken</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">isCancel</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Request canceled&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">message</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
</code></pre></td></tr></table>
</div>
</div><p>这段代码可以处理3中情况的异常：</p>
<ul>
<li>axios.interceptors.response中throw Error</li>
<li>http status code !== 200时的promise reject，不使用async时是在catch中处理</li>
<li>axios请求被代码cancel掉</li>
</ul>
<p>有了网络请求，可以写saga函数了：</p>
<p>如果是在dva中，saga函数会被写在model中的effects对象中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">CancelToken</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">CancelToken</span><span class="p">;</span>
<span class="p">...</span>  
<span class="nx">effects</span><span class="o">:</span> <span class="p">{</span>
    <span class="o">*</span><span class="nx">startLogin</span><span class="p">({</span> <span class="nx">payload</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">put</span><span class="p">,</span> <span class="nx">call</span><span class="p">,</span> <span class="nx">race</span> <span class="p">})</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">CancelToken</span><span class="p">.</span><span class="nx">source</span><span class="p">();</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">timeout</span> <span class="p">}</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">race</span><span class="p">({</span>
        <span class="nx">data</span><span class="o">:</span> <span class="nx">call</span><span class="p">(</span><span class="nx">login</span><span class="p">,</span> <span class="p">{</span><span class="nx">username</span><span class="o">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">username</span><span class="p">,},</span> <span class="p">{</span><span class="nx">cancelToken</span><span class="o">:</span> <span class="nx">source</span><span class="p">.</span><span class="nx">token</span><span class="p">,}),</span>
        <span class="nx">timeout</span><span class="o">:</span> <span class="nx">call</span><span class="p">(</span><span class="nx">delay</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
      <span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="nx">payload</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span> <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">yield</span> <span class="nx">source</span><span class="p">.</span><span class="nx">cancel</span><span class="p">(</span><span class="s1">&#39;登录超时&#39;</span><span class="p">);</span>
        <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="nx">payload</span><span class="o">:</span> <span class="s1">&#39;timeout&#39;</span> <span class="p">});</span>
      <span class="p">}</span>
     <span class="p">},</span>
   <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>当然startLogin函数也可以写成generator函数作为普通saga，在不用dva的情况下使用。</p>
<p>这段代码调用了上面👆的login函数进行网络请求，其中race是saga提供的一种effect，是一种竞赛模式，race下面的多个任务，只有一个胜利者，即第一个完成的任务，其他任务会被取消。</p>
<p>所以这段代码就是用race实现的网络请求任务的超时处理。</p>
<p>但是网络请求任务只是一个saga任务一个异步任务，异步任务被取消了，但是网络请求并没有被取消，所以取消网络请求需要单独处理。</p>
<p>对于axios这个库来说，就是使用CancelToken这个api了。👆上面两段代码就是一个完整的CancelToken使用的例子。</p>
<p>上面说了什么呢？上文使用两段代码，介绍了一种——在使用dva或者redux-saga时——取消effect（取消异步任务、cancel effect、处理异步任务超时、处理网路请求超时、取消axios请求）的写法。下面介绍另一种写法。</p>
<p>除了用race以外，还可以用take Effect来写。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"> <span class="nx">namespace</span><span class="o">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
 <span class="nx">effects</span><span class="o">:</span> <span class="p">{</span>
  <span class="o">*</span><span class="nx">start</span><span class="p">(){},</span>
  <span class="o">*</span><span class="nx">stop</span><span class="p">(){},</span>
  <span class="nx">watchLogin</span><span class="o">:</span> <span class="p">[</span>
      <span class="kd">function</span><span class="o">*</span> <span class="p">({</span> <span class="nx">take</span><span class="p">,</span> <span class="nx">put</span><span class="p">,</span> <span class="nx">call</span><span class="p">,</span> <span class="nx">cancel</span><span class="p">,</span> <span class="nx">fork</span><span class="p">,</span> <span class="nx">cancelled</span> <span class="p">})</span> <span class="p">{</span>
          <span class="k">yield</span> <span class="nx">take</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">);</span>
          <span class="kr">const</span> <span class="nx">timerTask</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">fork</span><span class="p">(</span><span class="nx">timer</span><span class="p">)</span>
          <span class="kr">const</span> <span class="nx">bgSyncTask</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">fork</span><span class="p">(</span><span class="nx">bgSync</span><span class="p">)</span>
          <span class="k">yield</span> <span class="nx">take</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">)</span>
          <span class="k">yield</span> <span class="nx">cancel</span><span class="p">(</span><span class="nx">bgSyncTask</span><span class="p">)</span>
          <span class="k">yield</span> <span class="nx">cancel</span><span class="p">(</span><span class="nx">timerTask</span><span class="p">)</span>

        <span class="kd">function</span><span class="o">*</span> <span class="nx">bgSync</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">try</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
              <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">call</span><span class="p">(</span><span class="nx">delay</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
              <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;stop&#39;</span> <span class="p">})</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">yield</span> <span class="nx">cancelled</span><span class="p">())</span>
              <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="nx">payload</span><span class="o">:</span> <span class="s1">&#39;fetch🛑&#39;</span> <span class="p">})</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="kd">function</span><span class="o">*</span> <span class="nx">timer</span><span class="p">(</span><span class="nx">time</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
          <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="nx">payload</span><span class="o">:</span> <span class="nx">i</span><span class="o">++</span> <span class="p">})</span>
            <span class="k">yield</span> <span class="nx">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;watcher&#39;</span> <span class="p">},</span>
    <span class="p">],</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>多说一句，这段代码还是在dva中的写法，它也可以被轻易的改成redux-saga的写法。</p>
<p>watchLogin是一个saga，它被dva自动run运行，它的第一个take在等待一个type为start的action被dispatch或者put，take(‘start’)被触发后，2个非阻塞任务运行，同时等待take(‘stop’)被触发。</p>
<p>action stop触发take(‘stop’)，下面2行代码执行，取消了2个非阻塞任务🤪。</p>
<p>我们看到fork的2个任务都是generator函数，也就是saga，它们可以写在dva的model的effects下，被disptach或者put发送action调用触发，如果这样的话就无法通过代码将其cancel。</p>
<p>所以为了实现取消异步任务，可以像这样写在一个effect中，通过take帮助，实现cancel。</p>
<p>其实dva中每个model的effects被看作一个大saga，会被当作sagaMiddleware.run()方法的参数，而effects下面的每个方法，都会被fork成一个子任务。</p>
<p>综上所述，现在我们可以处理一种问题了——在使用dva或者redux-saga时——取消effect、取消异步任务、cancel effect、处理异步任务超时、处理网路请求超时、取消axios请求。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react/">React</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>如何处理大量bug</title>
                <link>https://wss.cool/%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%A4%A7%E9%87%8Fbug.html</link>
                <guid isPermaLink="true">https://wss.cool/%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%A4%A7%E9%87%8Fbug.html</guid>
                <pubDate>Fri, 21 Dec 2018 16:21:39 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>处理bug分三步：确认位置及原因，解决方案，实现代码。</p>
<p>bug数量很多时，领导的心里会有压力，所以先解决容易改的，让数量降下来，领导的压力小了就可以不加班了。如果你改的数量多还可能认为你比别人有些。</p>
<h2 id="处理问题的1-2-3升级策略">处理问题的“1-2-3”升级策略</h2>
<p>遇到问题的时候，</p>
<ol>
<li>自己一个人处理1小时内没有思路，请找他人小范围讨论</li>
<li>如果与他人2小时内没有结果，请上升到团队范围</li>
<li>如果在团队范围3小时内没有思路</li>
<li>我们就需要借助外部力量了。比如：找产品改需求，找公司外的技术高手做咨询，外包</li>
</ol>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/">心得与经验</category>
                                
                            
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title>Redux Saga</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/react/redux-saga/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/react/redux-saga/</guid>
                <pubDate>Sun, 02 Dec 2018 11:04:48 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="redux-saga中使用fetch">redux-saga中使用fetch</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">call</span><span class="p">(</span><span class="nx">fetch</span><span class="p">,</span> <span class="s1">&#39;/consult/v1/headCarousel&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="nx">payload</span><span class="o">:</span> <span class="nx">data</span> <span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>为了对它有一个感性的认识，首先看一下 <a rel="noreferrer noopener" href="http://link.zhihu.com/?target=http%3A//leonshi.com/redux-saga-in-chinese/docs/api/index.html%23effect-" target="_blank">中文文档</a> 把dome写出来，跑一下。另外还需要了解 <a href="http://es6.ruanyifeng.com/#docs/generator">ES6的Generator</a> 。</p>
<p>跑完了文档中的dome之后，在来看一个例子。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 类 thunk 的 worker “进程”
</span><span class="c1"></span><span class="kd">function</span><span class="o">*</span> <span class="nx">load</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">BEGIN_LOAD_DATA</span> <span class="p">});</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">call</span><span class="p">(</span><span class="nx">fetch</span><span class="p">,</span> <span class="nx">UrlMap</span><span class="p">.</span><span class="nx">loadData</span><span class="p">);</span>
    <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">LOAD_DATA_SUCCESS</span> <span class="p">,</span><span class="nx">payload</span><span class="o">:</span> <span class="nx">result</span> <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nx">LOAD_DATA_ERROR</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="o">*</span> <span class="nx">saga</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 创建一个监听“进程”
</span><span class="c1"></span>  <span class="k">yield</span> <span class="nx">fork</span><span class="p">(</span><span class="nx">watch</span><span class="p">(</span><span class="nx">CLICK_LOAD_BUTTON</span><span class="p">,</span> <span class="nx">load</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这里有几个 redux-saga 的概念需要再了解一下。</p>
<h3 id="1put">1、put</h3>
<p>作用和 redux 中的 dispatch 相同。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;CLICK_BTN&#39;</span> <span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="2select">2、select</h3>
<p>作用和 redux thunk 中的 getState 相同。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">select</span><span class="p">(</span><span class="nx">state</span> <span class="p">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="3take">3、take</h3>
<p>等待 redux dispatch 匹配某个 pattern 的 action 。</p>
<p>在这个例子中，先等待一个按钮点击的 action ，然后执行按钮点击的 saga：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">yield</span> <span class="nx">take</span><span class="p">(</span><span class="s1">&#39;CLICK_BUTTON&#39;</span><span class="p">);</span>
  <span class="k">yield</span> <span class="nx">fork</span><span class="p">(</span><span class="nx">clickButtonSaga</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>再举一个利用 take 实现 logMiddleware 的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">take</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">newState</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">select</span><span class="p">();</span>
  
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;received action:&#39;</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;state become:&#39;</span><span class="p">,</span> <span class="nx">newState</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这种监听一个 action ，然后执行相应任务的方式，在 redux-saga 中非常常用，因此 redux-saga 提供了一个辅助 Effect —— takeEvery ，让 watch/worker 的代码更加清晰。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">yield</span> <span class="nx">takeEvery</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">logger</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">newState</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">select</span><span class="p">();</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;received action:&#39;</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;state become:&#39;</span><span class="p">,</span> <span class="nx">newState</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="4阻塞调用和无阻塞调用">4、阻塞调用和无阻塞调用</h3>
<p>redux-saga 可以用 fork 和 call 来调用子 saga ，其中 fork 是无阻塞型调用，call 是阻塞型调用。</p>
<h3 id="41forknbsp">4.1、fork </h3>
<p>下面写一个倒数的例子，当接收到 BEGIN_COUNT 的 action，则开始倒数，而接收到 STOP_COUNT 的 action， 则停止倒数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span><span class="o">*</span> <span class="nx">count</span><span class="p">(</span><span class="nx">number</span><span class="p">){</span>
  <span class="kd">let</span> <span class="nx">currentNum</span> <span class="o">=</span> <span class="nx">number</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="nx">currentNum</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">currentNum</span><span class="o">--</span><span class="p">);</span>
    <span class="k">yield</span> <span class="nx">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kd">function</span><span class="o">*</span> <span class="nx">countSaga</span><span class="p">(){</span>
  <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">){</span>
    <span class="kr">const</span> <span class="p">{</span><span class="nx">payload</span><span class="o">:</span><span class="nx">number</span><span class="p">}</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">take</span><span class="p">(</span><span class="nx">BEGIN_COUNT</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">countTaskId</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">fork</span><span class="p">(</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">number</span> <span class="p">);</span>

    <span class="k">yield</span> <span class="nx">take</span><span class="p">(</span><span class="nx">STOP_COUNT</span><span class="p">);</span>
    <span class="k">yield</span> <span class="nx">cancel</span><span class="p">(</span><span class="nx">countTaskId</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>因为使用 fork 开启的任务，所以不需要等 count 这个saga执行完， STOP_COUNT 任务已经被监听了，当 count 执行的过程中，如果STOP_COUNT任务被触发，会执行下一行代码，也就是取消 fork 开启的那个任务，中断 count 的执行。</p>
<h3 id="42call">4.2、call</h3>
<p>下面这个例子：</p>
<pre><code>const project = yield call(fetch, { url: UrlMap.fetchProject });
const members = yield call(fetchMembers, project.id)
</code></pre><p>有阻塞地调用 saga 或者返回 promise 的函数。可以理解为 fetch 执行完有了返回结果了，才会执行下一行。</p>
<h2 id="effects">Effects</h2>
<p>上面提到的几个 redux-saga 的概念都是 Effect 。Effect 是一个 javascript 对象，里面包含描述副作用的信息，可以通过 yield 传达给 sagaMiddleware 执行</p>
<p>在 redux-saga 世界里，所有的 Effect 都必须被 yield 才会执行，所以有人写了 <a href="http://link.zhihu.com/?target=https%3A//github.com/pke/eslint-plugin-redux-saga" target="_blank" rel="noreferrer noopener">eslint-plugin-redux-saga</a> 来检查是否每个 Effect 都被 yield。并且原则上来说，所有的 yield 后面也只能跟Effect，以保证代码的易测性。</p>
<p>例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">yield</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">UrlMap</span><span class="p">.</span><span class="nx">fetchData</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>应该用 call Effect ：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">yield</span> <span class="nx">call</span><span class="p">(</span><span class="nx">fetch</span><span class="p">,</span> <span class="nx">UrlMap</span><span class="p">.</span><span class="nx">fetchData</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>从而可以使代码可测：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">iterator</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">,</span> <span class="nx">call</span><span class="p">(</span><span class="nx">fetch</span><span class="p">,</span> <span class="nx">UrlMap</span><span class="p">.</span><span class="nx">fetchData</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>关于各个 Effect 的具体介绍，文档已经写得很详细了，这里只做简要介绍。</p>
<h2 id="传统异步中间件简介">传统异步中间件简介</h2>
<p>在介绍 redux-saga 优缺点之前，这里先简要介绍传统的 redux 异步中间件，以便和 redux-saga 做比较。对传统异步中间件已经充分了解的读者，可以直接跳到 “redux-saga 优缺点分析” 进行阅读。</p>
<h3 id="1-fetch-middleware">1. fetch-middleware</h3>
<p>使用redux的前端技术团队或个人，大多数都有一套自己 fetch-middleware，一来可以封装异步请求的业务逻辑，避免重复代码，二来可以写一些公共的异步请求逻辑，比如异常接口数据采集、接口缓存、接口处理等等。例如 <a href="http://link.zhihu.com/?target=https%3A//github.com/jasonslyvia/redux-composable-fetch" target="_blank" rel="noreferrer noopener">redux-composable-fetch</a>，<a href="http://link.zhihu.com/?target=https%3A//github.com/agraboso/redux-api-middleware" target="_blank" rel="noreferrer noopener">redux-api-middleware</a>。</p>
<p>在当前 redux 社区中，fetch-middleware 封装结果一般如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">loadData</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/api.json&#39;</span><span class="p">,</span>
    <span class="nx">types</span><span class="o">:</span> <span class="p">[</span><span class="nx">LOADING_ACTION_TYPE</span><span class="p">,</span> <span class="nx">SUCCESS_ACTION_TYPE</span><span class="p">,</span> <span class="nx">FAILURE_ACTION_TYPE</span><span class="p">],</span>
    <span class="nx">params</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">id</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>值得一提的是，大多数 fetch-middleware 都会用到一个小技巧 —— 把最终处理好的 promise 返回出来，以便在 thunk-middleware 中复用，并组织不同异步过程的先后逻辑。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">loadDetailThunk</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 先请求到 loadData 的结果，再请求 loadDetail
</span><span class="c1"></span>    <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadData</span><span class="p">(</span><span class="nx">id</span><span class="p">)).</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">detailId</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
      <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadDetail</span><span class="p">(</span><span class="nx">detailId</span><span class="p">));</span>
    <span class="p">});</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这个技巧在 redux-saga 中也同样有效。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span><span class="o">*</span> <span class="nx">loadDetailSaga</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">put</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">loadData</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">detailId</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>

  <span class="k">yield</span> <span class="nx">put</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">loadDetail</span><span class="p">(</span><span class="nx">detailId</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="redux-saga-优缺点分析">redux-saga 优缺点分析</h2>
<h3 id="缺点">缺点</h3>
<ul>
<li>
<p>redux-saga 不强迫我们捕获异常，这往往会造成异常发生时难以发现原因。因此，一个良好的习惯是，相信任何一个过程都有可能发生异常。如果出现异常但没有被捕获，redux-saga 的错误栈会给你一种一脸懵逼的感觉。</p>
</li>
<li>
<p>generator 的调试环境比较糟糕，babel 的 source-map 经常错位，经常要手动加 debugger 来调试。</p>
</li>
<li>
<p>你团队中使用的其它异步中间件，或许难以和 redux-saga 搭配良好。或许需要花费一些代价，用 redux-saga 来重构一部分中间件。</p>
</li>
</ul>
<h3 id="优点">优点</h3>
<ul>
<li>保持 action 的简单纯粹，aciton 不再像原来那样五花八门，让人眼花缭乱。task 的模式使代码更加清晰。</li>
<li>redux-saga 提供了丰富的 Effects，以及 sagas 的机制（所有的 saga 都可以被中断），在处理复杂的异步问题上十分趁手。如果你的应用属于写操作密集型或者业务逻辑复杂，快让 redux-saga 来拯救你。</li>
<li>扩展性强。</li>
<li>声明式的 Effects，使代码更易测试，<a href="http://link.zhihu.com/?target=http%3A//leonshi.com/redux-saga-in-chinese/docs/basics/DeclarativeEffects.html" target="_blank" rel="noreferrer noopener">查看详情</a>。</li>
</ul>
<h2 id="利用-redux-saga-写-redux-中间件">利用 redux-saga 写 redux 中间件</h2>
<p>用 redux-saga 来写中间件，可谓事半功倍。这里举一个轮询中间件的例子。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span><span class="o">*</span> <span class="nx">pollingSaga</span><span class="p">(</span><span class="nx">fetchAction</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">defaultInterval</span><span class="p">,</span> <span class="nx">mockInterval</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">fetchAction</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">put</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">fetchAction</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">mockInterval</span> <span class="o">||</span> <span class="nx">result</span><span class="p">.</span><span class="nx">interval</span><span class="p">;</span>

      <span class="k">yield</span> <span class="nx">delay</span><span class="p">(</span><span class="nx">interval</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">yield</span> <span class="nx">delay</span><span class="p">(</span><span class="nx">defaultInterval</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="o">*</span> <span class="nx">beginPolling</span><span class="p">(</span><span class="nx">pollingAction</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">pollingUrl</span><span class="p">,</span> <span class="nx">defaultInterval</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="nx">mockInterval</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span>
    <span class="nx">params</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">pollingAction</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">types</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;pollingAction pattern error&#39;</span><span class="p">,</span> <span class="nx">pollingAction</span><span class="p">);</span>
    <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;pollingAction types[1] is null&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">const</span> <span class="nx">fetchAction</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">url</span><span class="o">:</span> <span class="nx">pollingUrl</span><span class="p">,</span>
    <span class="nx">types</span><span class="p">,</span>
    <span class="nx">params</span><span class="p">,</span>
    <span class="nx">mockInterval</span><span class="p">,</span>
    <span class="nx">defaultInterval</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kr">const</span> <span class="nx">pollingTaskId</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">fork</span><span class="p">(</span><span class="nx">pollingSaga</span><span class="p">,</span> <span class="nx">fetchAction</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="nx">action</span> <span class="p">=&gt;</span> <span class="nx">action</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">types</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">action</span><span class="p">.</span><span class="nx">stopPolling</span><span class="p">;</span>

  <span class="k">yield</span> <span class="nx">take</span><span class="p">(</span><span class="nx">pattern</span><span class="p">);</span>
  <span class="k">yield</span> <span class="nx">cancel</span><span class="p">(</span><span class="nx">pollingTaskId</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="o">*</span> <span class="nx">pollingSagaMiddleware</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">yield</span> <span class="nx">takeEvery</span><span class="p">(</span><span class="nx">action</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">pollingUrl</span><span class="p">,</span> <span class="nx">types</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">action</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">pollingUrl</span> <span class="o">&amp;&amp;</span> <span class="nx">types</span> <span class="o">&amp;&amp;</span> <span class="nx">types</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="p">},</span> <span class="nx">beginPolling</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><pre class="wp-block-verse">本文来自知乎“<a href="https://zhuanlan.zhihu.com/p/23012870">redux-saga 实践总结</a>”，作者“<a rel="noreferrer noopener" target="_blank" href="https://www.zhihu.com/people/huang-jason">Jason</a>”，<a href="https://zhuanlan.zhihu.com/p/23012870">原文链接</a></pre>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react/">React</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Redux 概要</title>
                <link>https://wss.cool/posts/%E5%89%8D%E7%AB%AF/react/redux-%E6%A6%82%E8%A6%81/</link>
                <guid isPermaLink="true">https://wss.cool/posts/%E5%89%8D%E7%AB%AF/react/redux-%E6%A6%82%E8%A6%81/</guid>
                <pubDate>Wed, 28 Nov 2018 14:24:04 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p id="page-title" class="asset-name entry-title">
  参考：<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html">Redux 入门教程</a>
</p>
<h2 id="基本概念">基本概念</h2>
<p>store：保存数据的容器，整个应用通常只有一个store。</p>
<p>state：store在某时点的一个快照，一个state对应一个view。</p>
<p>action：定义一个用户对view的操作。</p>
<p>可以暂时这样理解：<br>
<img class="aligncenter size-medium wp-image-81" src="http://58.87.109.73/wpBlog/wp-content/uploads/2018/11/屏幕快照-2018-11-28-下午10.24.34-300x184.png" alt="" width="300" height="184"   /><br>
store生成一个快照state，state对应一个view，view发出action来通知store变化，使store变化而生成一个新的state，新的state又对应新的view。</p>
<p>ActionCreator：通常action只是一个对象，且只有type属性使必须的。我们知道action代表着view的操作，所以action可能有很多个又被经常使用，所以用一个函数来生成各种action是比较合理的操作，这个函数就叫做ActionCreator。</p>
<pre><code class="language-javascript">const ADD_TODO = '添加 TODO';
function addTodo(text) {
  return {
    type: ADD_TODO,
    text
  }
}
const action = addTodo('Learn Redux');</code></pre>
<h2 id="redux的api">Redux的API</h2>
<p>生成store、获得state</p>
<pre><code class="language-javascript">import { createStore } from 'redux';
const store = createStore(fn);
const state = store.getState();</code></pre>
<p>view通过store.dispatch() 发出action：</p>
<pre><code class="language-javascript">store.dispatch({
  type: 'ADD_TODO',
  payload: 'Learn Redux'
});
// store.dispatch(addTodo('learn Redux'));</code></pre>
<p>store在接收到action时，会根据action生成一个新的state，那么如何生成新的state，这个计算过程怎么定义呢？</p>
<h3 id="reducer">Reducer</h3>
<p>Reducer是一个函数，它定义store在接收到action时state如何发生变化。action只描述发生了什么，而reducer描述state如何变化。这个函数是这样的：</p>
<pre><code class="language-javascript">const reducer = function (state, action) {
  // ...
  return new_state;
};
// 或
const defaultState = 0;
const reducer = (state = defaultState, action) =&gt; {
  switch (action.type) {
    case 'ADD':
      return state + action.payload;
    default: 
      return state;
  }
};
const state = reducer(1, {
  type: 'ADD',
  payload: 2
});
</code></pre>
<p>实际应用中，Reducer 函数不用像上面这样手动调用，store.dispatch方法会触发 Reducer 的自动执行。为此，Store 需要知道 Reducer 函数，做法就是在生成 Store 的时候，将 Reducer 传入createStore方法：</p>
<pre><code class="language-javascript">import { createStore } from 'redux';
const store = createStore(reducer);</code></pre>
<p>⚠️ Reducer必须是纯函数：只要是同样的输入，必定得到同样的输出，必须遵守以下一些约束：</p>
<ul>
<li>不得改写参数</li>
<li>不能调用系统 I/O 的API</li>
<li>不能调用<code>Date.now()</code>或者<code>Math.random()</code>等不纯的方法，因为每次会得到不一样的结果</li>
</ul>
<p>⚠️ Reducer 函数里面不能改变 State，必须返回一个全新的对象：</p>
<pre><code class="language-javascript">return { ...state, ...newState };
// return [...state, newItem];</code></pre>
<p>现在我们知道了Ruducer是处理state变化过程的，那么state变化以后又会发生什么呢？上面说过，通常一个state对应一个view，也就是说state改变后view也要随之变化，但是view怎么知道自己应该改变呢？</p>
<h3 id="storesubscribe">store.subscribe()</h3>
<p>Store 允许使用<code>store.subscribe</code>方法设置监听函数，一旦 State 发生变化，就自动执行这个监听函数，view也就可以通过它来更新。比如React的setState()。</p>
<h3 id="工作流程大概可以这样理解">工作流程大概可以这样理解：</h3>
<div style="width: 640px;" class="wp-video">
  <!--[if lt IE 9]><![endif]--><video class="wp-video-shortcode" id="video-78-1" width="640" height="436" preload="metadata" controls="controls"><source type="video/mp4" src="http://58.87.109.73/wpBlog/wp-content/uploads/2018/11/redux.mp4?_=1" />
<p><a href="http://58.87.109.73/wpBlog/wp-content/uploads/2018/11/redux.mp4">http://58.87.109.73/wpBlog/wp-content/uploads/2018/11/redux.mp4</a></video></p>
</div>
<p> </p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react/">React</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/api/">api</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>元素与组件</title>
                <link>https://wss.cool/react-element-and-component.html</link>
                <guid isPermaLink="true">https://wss.cool/react-element-and-component.html</guid>
                <pubDate>Sat, 24 Nov 2018 04:49:54 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<p>原文链接：<a href="https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html">React Components, Elements, and Instances</a></p>
<h2 id="什么是react元素element">什么是React元素(element)？</h2>
<p><strong>元素(element)是描述组件实例或DOM节点及其所需属性的普通对象</strong>这个对象仅仅包含了有关组件类型、属性、子元素的信息。</p>
<p>元素不是实际的实例。相反，它是一种告诉React你想在屏幕上看到什么的方法。你不能在元素上调用任何方法。它只是一个带有两个字段的不可变描述对象：type:(string | ReactClass) 和 props: Object 。</p>
<p>可以把一个这样的DOM节点描述成下面这样的对象，这个对象就叫元素（element）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">children</span><span class="o">:</span> <span class="s1">&#39;Login&#39;</span><span class="p">,</span>
    <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;login-btn&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>元素可以通过createElement方法创建。</p>
<h2 id="dom元素">DOM元素</h2>
<p>当element的type为英文字符串时，它表示同名的DOM节点，element的props对应其属性。这就是React将呈现的内容。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;button&#39;</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;button button-blue&#39;</span><span class="p">,</span>
    <span class="nx">children</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
      <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">children</span><span class="o">:</span> <span class="s1">&#39;OK!&#39;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>此元素只是将以下HTML表示为普通对象的一种方法：</p>
<h2 id="组件元素">组件元素</h2>
<p>但是，element的type也可以是与React组件对应的函数或类：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">Button</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
    <span class="nx">children</span><span class="o">:</span> <span class="s1">&#39;OK!&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>描述组件的element与描述DOM节点的element一样，都是element，它们可以嵌套并互相混合。</p>
<p>此功能允许您将DangerButton组件定义为具有特定color属性值的Button组件，而无需关心是否完全Button组件会呈现为DOM的button还是</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">DangerButton</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">({</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">Button</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="nx">children</span><span class="o">:</span> <span class="nx">children</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>你可以在单个元素树中混合DOM和组件元素：</p>
<pre><code>const DeleteAccount = () =&gt; ({
  type: 'div',
  props: {
    children: [{
      type: 'p',
      props: {
        children: 'Are you sure?'
      }
    }, {
      type: DangerButton,
      props: {
        children: 'Yep'
      }
    }]
});
</code></pre><p>也可以用JSX写：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">DeleteAccount</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Are</span> <span class="nx">you</span> <span class="nx">sure</span><span class="o">?&lt;</span><span class="err">/p&gt;</span>
    <span class="o">&lt;</span><span class="nx">DangerButton</span><span class="o">&gt;</span><span class="nx">Yep</span><span class="o">&lt;</span><span class="err">/DangerButton&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>这种混合有助于保持组件彼此分离，因为它们可以通过组合表达is-a和has-a关系：</p>
<ul>
<li>DangerButton是一个Button具有特定属性的</li>
<li>DeleteAccount包含一个Button和一个DangerButton内部</code></li>
</ul>
<h2 id="components-encapsulate-element-trees">组件封装元素树</h2>
<p>当React发现一个element的type时函数或者类时，它会问那个组件，给你相关的props你会render一个怎样的element。</p>
<p>比如当React看到这个element时：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-hs" data-lang="hs"><span class="p">{</span>
  <span class="kr">type</span><span class="kt">:</span> <span class="kt">Button</span><span class="p">,</span>
  <span class="n">props</span><span class="kt">:</span> <span class="p">{</span>
    <span class="n">color</span><span class="kt">:</span> <span class="n">&#39;blue&#39;</span><span class="p">,</span>
    <span class="n">children</span><span class="kt">:</span> <span class="kt">&#39;OK</span><span class="o">!</span><span class="sc">&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>React 会问 Button 组件想render一个什么样的element，  Button 组件返回一个这样的 element 给React:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;button&#39;</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;button button-blue&#39;</span><span class="p">,</span>
    <span class="nx">children</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
      <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">children</span><span class="o">:</span> <span class="s1">&#39;OK!&#39;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>React将重复这个过程，直到它知道了页面内的所有组件的element都是基本DOM标签element。</p>
<p>React就像一个孩子，问你每个“X是Y”的“Y是什么”，你向他们解释，直到他们弄清楚世界上的每一件小事。</p>
<p>对于React组件，props是输入，元素树是输出。</p>
<p><strong>返回的元素树可以包含描述DOM节点的元素和描述其他组件的元素。这使得您可以在不依赖于其内部DOM结构的情况下组成UI的独立部分。</strong></p>
<h2 id="top-down-reconciliation">Top-Down Reconciliation</h2>
<p>当你这样调用时：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">({</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">Form</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">isSubmitted</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">buttonText</span><span class="o">:</span> <span class="s1">&#39;OK!&#39;</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">));</span>
</code></pre></td></tr></table>
</div>
</div><p>React 会问 Form 组件，结合所给的props返回怎样的元素树。它将逐步“改进”对组件树的理解：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// React: You told me this...
</span><span class="c1"></span><span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">Form</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">isSubmitted</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">buttonText</span><span class="o">:</span> <span class="s1">&#39;OK!&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// React: ...And Form told me this...
</span><span class="c1"></span><span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">Button</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">children</span><span class="o">:</span> <span class="s1">&#39;OK!&#39;</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;blue&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// React: ...and Button told me this! I guess I&#39;m done.
</span><span class="c1"></span><span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;button&#39;</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;button button-blue&#39;</span><span class="p">,</span>
    <span class="nx">children</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
      <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">children</span><span class="o">:</span> <span class="s1">&#39;OK!&#39;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这就是被叫做reconciliation的过程的一部分，当你调用 <a href="https://reactjs.org/docs/top-level-api.html#reactdom.render">ReactDOM.render()</a> or <a href="https://reactjs.org/docs/component-api.html#setstate">setState()</a> 时 reconciliation 就会开始。当 reconciliation 结束时，React就知道了最后的DOM树 ，然后一个像 react-dom or react-native 这样的渲染器将应用最小变更集来更新DOM节点。</p>
<h2 id="实例instances">实例instances</h2>
<p>您可能已经注意到，此博客条目对组件和元素进行了大量讨论，而不是实例。事实上，实例在React中的重要性远远低于大多数面向对象的UI框架。</p>
<p>只有声明为类的组件才有实例，而且你永远不会直接创建它们：React会为你做这件事。虽然<a href="https://reactjs.org/docs/more-about-refs.html">存在父组件实例访问子组件实例的机制</a>，但它们仅用于命令性操作（例如将焦点设置在字段上），并且通常应该避免。</p>
<p>React负责为每个类组件创建一个实例，因此您可以使用方法和本地状态以面向对象的方式编写组件，但除此之外，实例在React的编程模型中不是很重要，并且由React本身管理。</p>
<h2 id="摘要summary">摘要Summary</h2>
<p><strong>元素</strong>是一个简单的对象，用来描述你想让什么样的DOM节点或组件出现在屏幕上。元素可以在其props中包含其他元素。创建React元素很简单。一旦创建了一个元素，它就永远不会发生变异(mutated)。</p>
<p><strong>组件</strong>可以以多种不同的方式来声明(declared)。它可以是一个带有render()方法的类。或者，在简单的情况下，可以将其定义为函数。在任何一种情况下，它都将props作为输入，并返回一个元素树作为输出。</p>
<p>当一个组件接收props作为输入时，这是因为一个特定的父组件返回了一个带有它的type和props的元素。这就是人们说道具在React中以一种方式流动的原因：从父母到孩子。</p>
<p>在您编写的组件类中可以用this引用的<strong>实例</strong>。它对于<a href="https://reactjs.org/docs/component-api.html">存储本地状态和对生命周期事件做出反应</a>非常有用。</p>
<p>功能组件根本没有实例。类组件有实例，但您永远不需要直接创建组件实例–React负责这一点。</p>
<p>最后，为了创建元素，使用<a href="https://reactjs.org/docs/top-level-api.html#react.createelement">React.createElement()</a>，<a href="https://reactjs.org/docs/jsx-in-depth.html">JSX</a>或<a href="https://reactjs.org/docs/top-level-api.html#react.createfactory">元素工厂帮手</a>。不要在真实代码中将元素写为普通对象 – 只要知道它们是引擎下的普通对象。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react%E5%8E%9F%E7%90%86/">React原理</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/knowledge/">knowledge</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Diff</title>
                <link>https://wss.cool/react-reconciliation.html</link>
                <guid isPermaLink="true">https://wss.cool/react-reconciliation.html</guid>
                <pubDate>Sat, 17 Nov 2018 08:33:37 +0000</pubDate>
                
                    <author>wss.six@foxmail.com (王书硕)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</copyright>
                
                    <description><![CDATA[<h2 id="react-element">React Element</h2>
<p>首先我们要知道react的diff比较的是新旧两颗 react element 树。那什么是 react element 呢？</p>
<p>react element 是一个普通对象，它描述组件实例或DOM节点。</p>
<p>它是这样的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">children</span><span class="o">:</span> <span class="s1">&#39;Login&#39;</span><span class="p">,</span>
    <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;login-btn&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>或这样的（区别是type一个是字符串，一个是函数或类）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">Button</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
    <span class="nx">children</span><span class="o">:</span> <span class="s1">&#39;OK!&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>React.render()方法，会把 react element 解析成所有type都是字符串（DOM标签），形成一棵虚拟DOM树。</p>
<p>当 state 或 props 更新时，render方法会解析出另一个树。React不会直接将新的树渲染为真实的DOM，而是找出新旧树之间的差异，只更新差异部分的真实DOM。这个“找出新旧树之间的差异”的算法就是diff。</p>
<p>如果直接比较两颗树，算法的时间复杂度为O(n<sup>3</sup>) ，不使用于react的场景。</p>
<p>React基于两点假设，实现了一个复杂度为O(n)的算法：</p>
<ol>
<li>两个不同类型的元素将产生不同的树。</li>
<li>开发人员可以通过key参数提示哪些子元素可以在不同渲染中保持稳定。</li>
</ol>
<p>实践中，上述假设适用于大部分应用场景。</p>
<h2 id="diff算法">diff算法</h2>
<p>在对比新旧两棵树时，React首先比较两个根元素的类型，然后根据两个元素的类型采取不同的行动。</p>
<h3 id="根元素的类型">根元素的类型</h3>
<p>对比两个根元素的类型可能以下几种情况：</p>
<ul>
<li>elements of different types，不同类型的元素</li>
<li>DOM elements of the same type，相同类型的DOM元素</li>
<li>component elements of the same type，相同类型的组件元素</li>
</ul>
<h3 id="不同类型的元素">不同类型的元素</h3>
<p>每当根元素具有不同的类型时，React将拆除旧树并从头开始构建新树。无论从<code>&lt;a&gt;</code>到<code>&lt;img&gt;</code>或从<code>&lt;Article&gt;</code>到<code>&lt;Comment&gt;</code>，或从<code>&lt;Button&gt;</code> 到 <code>&lt;div&gt;</code>，任何的调整都会导致全部重建。</p>
<p>当树被卸载，旧的DOM节点将被销毁。组件实例会调用<code>componentWillUnmount()</code>。当构建一棵新树，新的DOM节点被插入到DOM中。组件实例将依次调用<code>componentWillMount()</code>和<code>componentDidMount()</code>。任何与旧树有关的状态都将丢弃。</p>
<p>这个根节点下所有的组件都将会被卸载，同时他们的状态将被销毁。 例如，以下节点对比之后：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">Counter</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">Counter</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>这将会销毁旧的<code>Counter</code>并重装新的<code>Counter</code>。</p>
<h3 id="相同类型的dom元素">相同类型的DOM元素</h3>
<p>当比较两个相同类型的React DOM元素时，React则会观察二者的属性，保持相同的底层DOM节点，并仅更新变化的属性。</p>
<h3 id="相同类型的组件元素">相同类型的组件元素</h3>
<p>当组件更新时，实例仍保持一致，以让状态能够在渲染之间保留。React通过更新底层组件实例的props来产生新元素，并在底层实例上依次调用<code>componentWillReceiveProps()</code> 和 <code>componentWillUpdate()</code> 方法。</p>
<p>接下来，<code>render()</code>方法被调用，同时对比算法会递归处理之前的结果和新的结果。</p>
<h2 id="递归子节点">递归子节点</h2>
<p>默认情况下，当对DOM节点的子节点进行递归时，React会同时迭代两个<strong>子项列表</strong>，并在出现差异时生成变异。（应该是两个树的子项列表吧？）</p>
<p>例如，当在子节点末尾增加一个元素，两棵树的转换效果很好：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>first<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>second<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>first<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>second<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>third<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>React将会匹配两棵树的<code>&lt;li&gt;first&lt;/li&gt;</code>，匹配两棵树的<code>&lt;li&gt;second&lt;/li&gt;</code> 节点，然后插入<code>&lt;li&gt;third&lt;/li&gt;</code>节点树。</p>
<p>如果你天真地在开头插入一个元素就会有糟糕的表现。 例如，在这两棵树之间进行转换效果不佳：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Duke<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Villanova<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Connecticut<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Duke<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Villanova<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>React会调整每个子节点，而非意识到可以完整保留<code>&lt;li&gt;Duke&lt;/li&gt;</code> 和 <code>&lt;li&gt;Villanova&lt;/li&gt;</code>子树。低效成了一个问题。</p>
<h2 id="key">Key</h2>
<p>React提供了一个key属性来解决这种低效问题。当子元素有key属性时，React使用key将旧树中的子元素与新树中的子元素相匹配并比较。</p>
<p>例如，增加一个<code>key</code>在之前效率不高的样例中能让树的转换变得高效：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="s">&#34;2015&#34;</span><span class="p">&gt;</span>Duke<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="s">&#34;2016&#34;</span><span class="p">&gt;</span>Villanova<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="s">&#34;2014&#34;</span><span class="p">&gt;</span>Connecticut<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="s">&#34;2015&#34;</span><span class="p">&gt;</span>Duke<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="s">&#34;2016&#34;</span><span class="p">&gt;</span>Villanova<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>现在React知道带有<code>2014</code>的key的元素是新的，仅移动带有<code>2015</code>和<code>2016</code>的key的元素。</p>
<p>实践中，为元素找到一个key通常不难。你将展示的元素可能已经带有一个唯一的ID，比如key可以来自于你的数据中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="s">{item.id}</span><span class="p">&gt;</span>{item.name}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>当这已不再是问题，你可以给你的数据增加一个新的ID属性，或根据数据的某些内容创建一个哈希值来作为key。key必须在其兄弟节点中是唯一的，而非全局唯一。</p>
<h2 id="权衡">权衡</h2>
<p>重要的是要记住，协调算法是一个实现细节。 React可以在每个动作上重新呈现整个应用程序; 最终结果是一样的。 为了清楚起见，在这种情况下重新渲染意味着为所有组件调用渲染，这并不意味着React将卸载并重新安装它们。 它只会按照前面章节中规定的规则<strong>应用差异(apply the differences)</strong>。(什么叫apply the differences)</p>
<p>我们经常改进启发式方法，以便使常见用例更快。 在当前的实现中，您可以表达一个子树已经在其兄弟之间移动的事实，但您不能说它已移动到其他地方。<em>算法将重新渲染完整的子树。(最后一句话根前面两句是什么逻辑关系？)</em></p>
<p>因为React依赖于启发式，如果不满足它们背后的假设，性能将受到影响。</p>
<ol>
<li>该算法不会尝试匹配不同组件类型的子树。 如果您发现自己在具有非常相似输出的两种组件类型之间交替，则可能需要使其成为相同类型。 在实践中，我们没有发现这是一个问题。</li>
<li>key应该是稳定的，可预测的和独特的。 不稳定的key（如Math.random（）生成的键）将导致许多组件实例和DOM节点被不必要地重新创建，这可能导致子组件中的性能下降和丢失状态。</li>
</ol>
<p> </p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/categories/react%E5%8E%9F%E7%90%86/">React原理</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://wss.cool/tags/knowledge/">knowledge</category>
                                
                            
                        
                    
                
            </item>
        
    </channel>
</rss>
