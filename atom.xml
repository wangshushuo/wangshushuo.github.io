<?xml version="1.0" encoding="utf-8"?>


<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-CN">
    <title type="text">WSS.COOL</title>
    <subtitle type="html">记录代码生涯，前端，React，Java，Spring，Nginx</subtitle>
    <updated>2020-04-13T13:35:20+00:00</updated>
    <id>https://wss.cool/</id>
    <link rel="alternate" type="text/html" href="https://wss.cool/" />
    <link rel="self" type="application/atom+xml" href="https://wss.cool/atom.xml" />
    <author>
            <name>WangShuShuo</name>
            <uri>https://wss.cool/</uri>
            
                <email>wss.six@foxmail.com</email>
            </author>
    <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    <generator uri="https://gohugo.io/" version="0.68.3">Hugo</generator>
        <entry>
            <title type="text">JavaScript</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/javascript.html" />
            <id>https://wss.cool/javascript.html</id>
            <updated>2020-04-04T02:13:49+08:00</updated>
            <published>2020-04-04T02:13:49+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[上传图片时，怎么拿到图片的src地址？ input选中图片以后，只是得到了file对象……]]></summary>
            
                <content type="html"><![CDATA[<h1 id="上传图片时怎么拿到图片的src地址">上传图片时，怎么拿到图片的src地址？</h1>
<p>input选中图片以后，只是得到了file对象，如果想在img中显示该图片的话，并不知道src，所以想得到src还需要额外的操作。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">getObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">createObjectURL</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// basic
</span><span class="c1"></span>    <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">URL</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// mozilla(firefox)
</span><span class="c1"></span>    <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">webkitURL</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// webkit or chrome
</span><span class="c1"></span>    <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitURL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="js操作样式class">JS操作样式class</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;c&#34;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&#34;c&#34;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s2">&#34;c&#34;</span><span class="p">);</span>    <span class="c1">// false 因为&#34;c&#34;上面remove掉了
</span><span class="c1"></span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">className</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="避免高频率调用">避免高频率调用</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">throttle</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">method</span><span class="p">.</span><span class="nx">tId</span><span class="p">)</span> <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">method</span><span class="p">.</span><span class="nx">tId</span><span class="p">);</span>
  <span class="nx">method</span><span class="p">.</span><span class="nx">tId</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">method</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">200</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="es6新语法--扩展运算符三个点">ES6新语法--扩展运算符（三个点）</h1>
<h2 id="第二个参数以及之后的任意多个参数都会被放到values数组中">第二个参数以及之后的任意多个参数都会被放到values数组中</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">a</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="p">...</span><span class="nx">values</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span><span class="nx">values</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">a</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>

<span class="c1">// [&#34;a&#34;, &#34;b&#34;]
</span><span class="c1">// [1, 2, 3]
</span></code></pre></td></tr></table>
</div>
</div><h2 id="合并数组">合并数组</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// ES5 的合并数组
</span><span class="c1"></span><span class="nx">arr1</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">arr2</span><span class="p">,</span> <span class="nx">arr3</span><span class="p">);</span>

<span class="c1">// ES6 的合并数组
</span><span class="c1"></span><span class="p">[...</span><span class="nx">arr1</span><span class="p">,</span> <span class="p">...</span><span class="nx">arr2</span><span class="p">,</span> <span class="p">...</span><span class="nx">arr3</span><span class="p">]</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="与解构赋值结合">与解构赋值结合</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">111</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">333</span><span class="p">,</span><span class="mi">444</span><span class="p">]</span>
<span class="c1">// ES5
</span><span class="c1"></span><span class="nx">a</span> <span class="o">=</span> <span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">rest</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">//a 111
</span><span class="c1">//b [111,222,333,444]
</span><span class="c1">// ES6
</span><span class="c1"></span><span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span><span class="p">]</span> <span class="o">=</span> <span class="nx">list</span>
<span class="c1">//a 111
</span><span class="c1">//b [111,222,333,444]
</span></code></pre></td></tr></table>
</div>
</div><h2 id="js正则">js正则</h2>
<p>制表符tab  \t<br>
换行符  \r<br>
汉字  \S<br>
任意 .<br>
小写字母 [a-z]</p>
<h2 id="数组排序">数组排序</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="nx">numbers</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/javascript/" term="JavaScript" label="JavaScript" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">开平方</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/square-root-dichotomy-and-newton-iteration.html" />
            <id>https://wss.cool/square-root-dichotomy-and-newton-iteration.html</id>
            <updated>2020-04-03T11:36:01+08:00</updated>
            <published>2020-04-03T11:36:01+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[使用二分法或牛顿迭代法计算开平方，]]></summary>
            
                <content type="html"><![CDATA[<p>计算开平方可以用二分查找来计算。
如：求根号10</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 用二分查找，精度0.0001
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">二分开根号</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">x</span><span class="p">,</span><span class="nx">count</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mid</span> <span class="o">=</span> <span class="nx">start</span> <span class="o">+</span> <span class="p">(</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">sq</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">*</span> <span class="nx">mid</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">sq</span> <span class="o">-</span> <span class="nx">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="nx">e</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">mid</span><span class="p">,</span><span class="nx">count</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sq</span> <span class="o">&lt;</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">start</span> <span class="o">=</span> <span class="nx">mid</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sq</span> <span class="o">&gt;</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">end</span> <span class="o">=</span> <span class="nx">mid</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">mid</span><span class="p">,</span><span class="nx">count</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">二分开根号</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="c1">// 3.1622695922851562  18次循环
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 用牛顿迭代，精度0.0001
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">牛顿开根号</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// n_ = (n+a/n)/2;
</span><span class="c1"></span>  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">n_</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">/</span> <span class="nx">n</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="nx">n_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="nx">e</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">n</span> <span class="o">=</span> <span class="nx">n_</span><span class="p">;</span>
    <span class="nx">n_</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">/</span> <span class="nx">n</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">n_</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">牛顿开根号</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="c1">// 3.162277660168379   6次循环
</span></code></pre></td></tr></table>
</div>
</div><h1 id="牛顿迭代法适用条件">牛顿迭代法适用条件</h1>
<p>求函数f(x)=0的解α。<br>
必须满足如下条件才能用牛顿迭代法求方程的近似解。<br>
函数的导数不为0；x属于区间[α−r, α+r]；x0为α的近似值，即r&gt;=|a-x0|;<br>
函数在[α−r, α+r]内二阶导数连续；<br>
x0足够接近根 α。</p>
<p><a href="https://zh.wikipedia.org/wiki/%E7%89%9B%E9%A1%BF%E6%B3%95">牛顿法的维基百科</a></p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E7%9F%A5%E8%AF%86%E7%82%B9/" term="知识点" label="知识点" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E7%AE%97%E6%B3%95/" term="算法" label="算法" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">MySQL</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/mysql.html" />
            <id>https://wss.cool/mysql.html</id>
            <updated>2020-04-02T22:24:03+08:00</updated>
            <published>2020-04-02T22:24:03+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[安装MySQL 1 2 sudo apt-get –y install mysql-server mysql-client sudo apt-get install mysql-server mysql-client 服务器环境为腾讯云Ubuntu 16.04.1 LTS，使……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="安装mysql">安装MySQL</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo apt-get –y install mysql-server mysql-client
sudo apt-get install mysql-server mysql-client
</code></pre></td></tr></table>
</div>
</div><p>服务器环境为腾讯云Ubuntu 16.04.1 LTS，使用上面的命令安装mysql服务端与客户端。安装完成后会出现一个设置密码的界面，输入两次密码即完成了安装，然后使用 <code>netstat -anp</code> 命令，会发现 <code>3306</code> 端口正在被监听，即说明安装成功且已运行。</p>
<h2 id="检查mysql是否启动">检查MySQL是否启动</h2>
<p><code>ps -ef | grep mysqld</code>
会看到类似结果说明正在运行：</p>
<pre><code>mysql      519     1  0 17:44 ?        00:00:00 /usr/sbin/mysqld
</code></pre><h2 id="开关mysql">开关MySQL</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 开启</span>
sudo /etc/init.d/mysql start
<span class="c1"># 关闭命令:</span>
sudo /etc/init.d/mysql stop
<span class="c1"># 重启</span>
sudo /etc/init.d/mysql restart
</code></pre></td></tr></table>
</div>
</div><h2 id="命令行中连接数据库">命令行中连接数据库：</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">-</span><span class="n">p</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="退出数据库">退出数据库：</h2>
<pre><code>exit
</code></pre><h2 id="建库删库">建库/删库</h2>
<p>CREATE DATABASE <code>yys</code> DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
DROP DATABASE <code>yys</code>;</p>
<h2 id="建表">建表</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">yuhun</span><span class="o">`</span><span class="p">(</span>
<span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">INT</span><span class="p">,</span>
<span class="o">`</span><span class="k">position</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span>
<span class="o">`</span><span class="k">type</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span>
<span class="o">`</span><span class="n">v</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="k">COMMENT</span> <span class="s1">&#39;表注释&#39;</span><span class="p">,</span>
<span class="o">`</span><span class="n">bs</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="k">COMMENT</span> <span class="s1">&#39;爆伤&#39;</span><span class="p">,</span>
<span class="o">`</span><span class="n">bj</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="k">COMMENT</span> <span class="s1">&#39;表注释&#39;</span><span class="p">,</span>
 <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="p">)</span>
<span class="p">)</span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="增删改查">增删改查</h2>
<h3 id="where">where</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">WHERE</span> <span class="n">CustomerID</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>Operator</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>=</td>
<td>Equal</td>
</tr>
<tr>
<td>&lt;&gt;</td>
<td>Not equal. Note: In some versions of SQL this operator may be written as !=</td>
</tr>
<tr>
<td>&gt;</td>
<td>Greater than</td>
</tr>
<tr>
<td>&lt;</td>
<td>Less than</td>
</tr>
<tr>
<td>&gt;=</td>
<td>Greater than or equal</td>
</tr>
<tr>
<td>&lt;=</td>
<td>Less than or equal</td>
</tr>
<tr>
<td>BETWEEN</td>
<td>Between an inclusive range</td>
</tr>
<tr>
<td>LIKE</td>
<td>Search for a pattern</td>
</tr>
<tr>
<td>IN</td>
<td>To specify multiple possible values for a column</td>
</tr>
</tbody>
</table>
<h3 id="update">update</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="k">table_name</span>
<span class="k">SET</span> <span class="n">column1</span> <span class="o">=</span> <span class="n">value1</span><span class="p">,</span> <span class="n">column2</span> <span class="o">=</span> <span class="n">value2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="delete">delete</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="insert">insert</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">table_name</span> <span class="p">(</span><span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span><span class="p">,</span> <span class="p">...)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="n">value3</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></td></tr></table>
</div>
</div><p>use demo
select zhuanye from runoob_tbl where id=1;
insert into pe (id,name) values (1,'前');</p>
<h2 id="导入">导入</h2>
<p>先将数据处理成一定格式，比如将excel中的数据复制到文档中，这些数据每一行的字段间是被制表符\t分隔，行与行指间被换行符\r\n分隔。<br>
如果excel中的数据不是很复杂，没有复杂的文本，没有换行之类的字符，就可以直接保存，然后将保存的文件导入数据库。如果文本比较复杂，比如招公务员的岗位的excel的文本中就有很多换行符，这时需要自己处理一下，是整个文本以特定的字符代替\t\r\n来分隔文本，因为导入数据的时候，mysql会考\t\n之类的字符来划分数据。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">load</span> <span class="k">data</span> <span class="k">local</span> <span class="n">infile</span> <span class="s2">&#34;~/yuhun.txt&#34;</span> <span class="k">into</span> <span class="k">table</span> <span class="n">yuhun</span>  <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">UTF8</span> <span class="n">fields</span> <span class="n">terminated</span> <span class="k">by</span> <span class="s2">&#34;\t&#34;</span> <span class="n">lines</span> <span class="n">terminated</span> <span class="k">by</span> <span class="s2">&#34;\n&#34;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>我将真正换行的地方替换成了&amp;符号。<br>
向服务器上传文件
scp /Users/wangshushuo/Desktop/yuhun.txt <a href="mailto:ubuntu@58.87.109.73">ubuntu@58.87.109.73</a>:~/yuhun.txt</p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/load-data.html">导入官方语法如下</a>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">LOAD</span> <span class="k">DATA</span> <span class="p">[</span><span class="n">LOW_PRIORITY</span> <span class="o">|</span> <span class="n">CONCURRENT</span><span class="p">]</span> <span class="p">[</span><span class="k">LOCAL</span><span class="p">]</span> <span class="n">INFILE</span> <span class="s1">&#39;file_name&#39;</span>
    <span class="p">[</span><span class="k">REPLACE</span> <span class="o">|</span> <span class="k">IGNORE</span><span class="p">]</span>
    <span class="k">INTO</span> <span class="k">TABLE</span> <span class="n">tbl_name</span>
    <span class="p">[</span><span class="n">PARTITION</span> <span class="p">(</span><span class="n">partition_name</span> <span class="p">[,</span> <span class="n">partition_name</span><span class="p">]</span> <span class="p">...)]</span>
    <span class="p">[</span><span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">charset_name</span><span class="p">]</span>
    <span class="p">[</span><span class="err">{</span><span class="n">FIELDS</span> <span class="o">|</span> <span class="n">COLUMNS</span><span class="err">}</span>
        <span class="p">[</span><span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;string&#39;</span><span class="p">]</span>
        <span class="p">[[</span><span class="n">OPTIONALLY</span><span class="p">]</span> <span class="n">ENCLOSED</span> <span class="k">BY</span> <span class="s1">&#39;char&#39;</span><span class="p">]</span>
        <span class="p">[</span><span class="n">ESCAPED</span> <span class="k">BY</span> <span class="s1">&#39;char&#39;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="p">[</span><span class="n">LINES</span>
        <span class="p">[</span><span class="n">STARTING</span> <span class="k">BY</span> <span class="s1">&#39;string&#39;</span><span class="p">]</span>
        <span class="p">[</span><span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;string&#39;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="p">[</span><span class="k">IGNORE</span> <span class="nb">number</span> <span class="err">{</span><span class="n">LINES</span> <span class="o">|</span> <span class="k">ROWS</span><span class="err">}</span><span class="p">]</span>
    <span class="p">[(</span><span class="n">col_name_or_user_var</span>
        <span class="p">[,</span> <span class="n">col_name_or_user_var</span><span class="p">]</span> <span class="p">...)]</span>
    <span class="p">[</span><span class="k">SET</span> <span class="n">col_name</span><span class="o">=</span><span class="err">{</span><span class="n">expr</span> <span class="o">|</span> <span class="k">DEFAULT</span><span class="err">}</span><span class="p">,</span>
        <span class="p">[,</span> <span class="n">col_name</span><span class="o">=</span><span class="err">{</span><span class="n">expr</span> <span class="o">|</span> <span class="k">DEFAULT</span><span class="err">}</span><span class="p">]</span> <span class="p">...]</span>
</code></pre></td></tr></table>
</div>
</div><p>一个例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">LOAD</span> <span class="k">DATA</span> <span class="n">INFILE</span> <span class="s1">&#39;file&#39;</span>
<span class="k">IGNORE</span> <span class="k">INTO</span> <span class="k">TABLE</span> <span class="k">table</span>
<span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">UTF8</span>
<span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;;&#39;</span>
<span class="n">OPTIONALLY</span> <span class="n">ENCLOSED</span> <span class="k">BY</span> <span class="s1">&#39;&#34;&#39;</span>
<span class="n">LINES</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;\n&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="远程连接新建一个帐号帐号名不能为root">远程连接新建一个帐号（帐号名不能为root）</h2>
<p>如：添加一个用户名为db_user，密码为db_pass，授权为% （%表示所有外围IP能连接）对db_name数据库所有权限，命令如下
/# mysql -uroot -p
MySQL [(none)]&gt; grant all privileges on db_name.* to db_user@’%’ identified by ‘db_pass’; #授权语句，特别注意有分号
MySQL [(none)]&gt; flush privileges;
MySQL [(none)]&gt; exit; #退出数据库控制台，特别注意有分号</p>
<h2 id="数据类型">数据类型</h2>
<h3 id="varchar">varchar</h3>
<p><code>varchar(666)</code>，其中参数<code>666</code>为字节数。</p>
<p><code>varchar</code>是可变长度的字符串，大小为<code>0-65535</code>字节。对应的字符串长度会受到字符集影响，若使用<code>utf-8</code>存储汉字，一个汉字字符对应<code>3</code>个字节。</p>
<p><code>varchar</code>还需要存储数据长度，当小于等于<code>255</code>个字节时，使用<code>1</code>个字节存储长度。大于<code>255</code>长度时，使用<code>2</code>个字节存储长度。</p>
<p>比如<code>varchar(666)</code>，使用<code>2</code>个字节存储长度，剩下的<code>664</code>个字节存储实际内容，</p>
<h3 id="text">text</h3>
<p>TEXT数据不存储在数据库服务器的内存中，因此，每当查询TEXT数据时，MySQL都必须从磁盘读取它，这与CHAR和VARCHAR相比要慢得多。
<img src="/images/mysql-1.png" alt="mysql文档"></p>
<blockquote>
<p>mysql的性能只有在上千万条纪律的时候才需要考虑。
——潘老师</p>
</blockquote>
<h3 id="datetime">DATETIME</h3>
<p>将js的Date对象传进去，会直接保存，查出来返回到前端页面时，可以这样使用<code>new Date(props.time)</code>转换成Date对象。</p>
<h3 id="没有布尔值使用tinyint">没有布尔值，使用tinyint</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">ed_class_price_user</span><span class="o">`</span><span class="p">(</span>
   <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">INT</span> <span class="n">UNSIGNED</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="o">`</span><span class="n">user_name</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">unique</span><span class="p">,</span>
   <span class="o">`</span><span class="n">password</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="o">`</span><span class="n">disable</span><span class="o">`</span> <span class="n">TINYINT</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="p">)</span>
<span class="p">)</span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="表结构">表结构</h2>
<h3 id="修改表结构">修改表结构</h3>
<ol>
<li>查看列：<code>desc 表名;</code></li>
<li>修改表名：<code>alter table t_book rename to bbb;</code></li>
<li>添加列：<code>alter table 表名 add column 列名 varchar(30);</code></li>
<li>删除列：<code>alter table 表名 drop column 列名;</code></li>
<li>修改列名MySQL： <code>alter table bbb change nnnnn hh int;</code></li>
<li>修改列名SQLServer：<code>exec sp_rename't_student.name','nn','column';</code></li>
<li>修改列名Oracle：<code>lter table bbb rename column nnnnn to hh int;</code></li>
<li>修改列属性：<code>alter table t_book modify name varchar(22);</code></li>
</ol>
<h3 id="唯一性约束">唯一性约束</h3>
<h4 id="建表时加上唯一性约束">建表时加上唯一性约束：</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">t_user</span><span class="o">`</span> <span class="p">(</span>
    <span class="o">`</span><span class="n">Id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span> 
    <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">unique</span><span class="p">,</span> 
    <span class="o">`</span><span class="n">password</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> 
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">Id</span><span class="o">`</span><span class="p">)</span> 
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1018</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">gbk</span><span class="p">;</span> 
</code></pre></td></tr></table>
</div>
</div><h4 id="给已经建好的表加上唯一性约束">给已经建好的表加上唯一性约束：</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">t_user</span><span class="o">`</span> <span class="k">ADD</span> <span class="k">unique</span><span class="p">(</span><span class="o">`</span><span class="n">username</span><span class="o">`</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>或者：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">unique</span> <span class="k">index</span> <span class="n">UserNameIndex</span> <span class="k">on</span> <span class="s1">&#39;t_user&#39;</span> <span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="索引">索引</h3>
<h4 id="mysql索引类型">mysql索引类型</h4>
<ul>
<li>primary：唯一索引，不允许为null。</li>
<li>key：普通非唯一索引。</li>
<li>unique：表示唯一的，不允许重复的索引，可以为null。</li>
<li>fulltext: 表示全文搜索的索引。 FULLTEXT用于搜索很长一篇文章的时候，效果最好。用在比较短的文本，如果就一两行字的，普通的INDEX 也可以。</li>
<li>spatial：空间索引。</li>
</ul>
<h2 id="表连接">表连接</h2>
<p>使用了连接语句以后，这两张表就被拼成了一张表。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">A</span>  
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">B</span> <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">book_id</span><span class="o">=</span><span class="n">B</span><span class="p">.</span><span class="n">book_id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>四种连接会像下图一样拼装2个表，空白的地方会被填充null</p>
<p><img src="/images/mysql-1.png" alt="表连接1"></p>
<p>然后where等语句就可以像操作一张表一样了。</p>
<h2 id="数据">数据</h2>
<h3 id="crud">CRUD</h3>
<h4 id="create">create</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tasks</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="p">,</span><span class="n">description</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;Learn MySQL INSERT&#39;</span><span class="p">,</span><span class="s1">&#39;2017-07-21&#39;</span><span class="p">,</span><span class="s1">&#39;2017-07-22&#39;</span><span class="p">,</span><span class="s1">&#39;Start learning..&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="read-左右链接">read 左右链接</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
    <span class="n">plugin_of_user</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">plugin_of_user</span><span class="p">.</span><span class="n">user_plugin_name</span><span class="p">,</span>
    <span class="n">plugin_info</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">plugin_info</span><span class="p">.</span><span class="n">avatar</span><span class="p">,</span> <span class="n">plugin_info</span><span class="p">.</span><span class="n">link</span><span class="p">,</span> <span class="n">plugin_info</span><span class="p">.</span><span class="k">type</span>
<span class="k">FROM</span> <span class="n">plugin_of_user</span>
<span class="k">RIGHT</span> <span class="k">JOIN</span> <span class="n">plugin_info</span>
<span class="k">ON</span> <span class="n">plugin_of_user</span><span class="p">.</span><span class="n">plugin_id</span><span class="o">=</span><span class="n">plugin_info</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span> <span class="n">plugin_of_user</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="update-1">update</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="p">[</span><span class="n">LOW_PRIORITY</span><span class="p">]</span> <span class="p">[</span><span class="k">IGNORE</span><span class="p">]</span> <span class="k">table_name</span> 
<span class="k">SET</span> 
    <span class="n">column_name1</span> <span class="o">=</span> <span class="n">expr1</span><span class="p">,</span>
    <span class="n">column_name2</span> <span class="o">=</span> <span class="n">expr2</span><span class="p">,</span>
    <span class="p">...</span>
<span class="k">WHERE</span>
    <span class="n">condition</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="无则添加有则修改">无则添加，有则修改</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">insert</span> <span class="k">into</span> <span class="n">student</span>
  <span class="p">(</span><span class="nb">number</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> 
<span class="k">values</span>
  <span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="err">‘张三’</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">DUPLICATE</span> <span class="k">KEY</span> <span class="k">UPDATE</span> 
<span class="nb">number</span> <span class="o">=</span> <span class="mi">46</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="err">‘李四’</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="delete-1">delete</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="实践">实践</h2>
<p>评论回帖表</p>
<p>轮子哥 vczh
专业造轮子，拉黑抢前排。gaclib.net
75 人赞同了该回答
CommentID: GUID (primary key)
UnderWhichAnswer: GUID (index + foreign key)
ReplyWhichComment: GUID (nullable + foreign key)
Author: GUID (foreign key)
Time: datetime (ascend)
Content: string</p>
<h2 id="性能测试">性能测试</h2>
<p>mysqlslap是mysql自带的测试工具</p>
<p>下面为测试一条sql的效率</p>
<pre><code>mysqlslap --create-schema mind -q &quot;select * from test1&quot; --number-of-queries=100 -uroot -p123456
</code></pre><p>其中<code>--create-schema</code>后为数据库名，<code>-q</code>后为sql语句，<code>--number-of-queries</code>为重复次数。</p>
<h2 id="工具">工具</h2>
<h3 id="phpmyadmin">phpmyadmin</h3>
<p>通过docker使用：拉镜像，然后运行，然后访问本地的<a href="http://localhost:8080">localhost:8080</a></p>
<pre><code>docker pull phpmyadmin/phpmyadmin
docker run --name myphpadmin -d -e PMA_ARBITRARY=1 -p 8080:80 phpmyadmin/phpmyadmin
</code></pre><h4 id="连本地的mysqlubuntu">连本地的mysql(ubuntu)</h4>
<p>将<code>/etc/mysql/mysql.conf.d/mysql.cnf</code>中的<code>bind-address=127.0.0.1</code>改成<code>bind-address=0.0.0.0</code>，使可以远程访问。</p>
<p>然后使用本机ip访问(192.168.<em>.</em>)，登录的主机地址也是前面那个ip</p>
<h2 id="资料">资料</h2>
<p><a href="https://www.yiibai.com/mysql/update-data.html">易百教程MySQL</a>
<a href="https://www.kancloud.cn/thinkphp/mysql-design-optimalize/39325">Mysql设计与优化专题</a>
<a href="/images/mysql-1.png">image1</a>:/images/mysql-1.jpg</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/" term="后端" label="后端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/mysql/" term="mysql" label="mysql" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">重构旧项目-1</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/refactoring-old-projects-part-1.html" />
            <id>https://wss.cool/refactoring-old-projects-part-1.html</id>
            <updated>2020-04-02T15:17:52+08:00</updated>
            <published>2020-04-02T15:17:52+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[背景 这个项目有点老旧 &quot;dva&quot;: &quot;2.1.0&quot;, &quot;react&quot;: &quot;^16.2.0&quot;, 我打算用最新的react和@reduxjs/toolki……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="背景">背景</h2>
<p>这个项目有点老旧</p>
<pre><code>&quot;dva&quot;: &quot;2.1.0&quot;,
&quot;react&quot;: &quot;^16.2.0&quot;,
</code></pre><p>我打算用最新的react和@reduxjs/toolkit开始重构，旧的依赖只能使用connect方式来获取store，使用useSelector和useDispatch很方便也很易读。<code>@reduxjs/toolkit</code>提供的immer和actionCreater也很好用。</p>
<p>首先重构的是一个643行的组件，它的render方法有580行。</p>
<h2 id="重复代码">重复代码</h2>
<p>很容易的发现了一大段重复代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">numbers_wrapper</span><span class="p">}&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">member_count</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span><span class="nx">班级总人数</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">male_count</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span><span class="nx">男生人数</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">female_count</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span><span class="nx">女生人数</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">group_count</span> <span class="o">&amp;&amp;</span><span class="p">(</span> <span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">group_count</span><span class="p">[</span><span class="nx">userDetail</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span><span class="nx">分组数</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{(</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">user_lecture_count</span> <span class="o">?</span> <span class="p">(</span><span class="nx">detail</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">user_lecture_count</span><span class="p">[</span><span class="nx">userDetail</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span><span class="nx">授课次数</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>可以将他们组织成2个组件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">NumberWithLabel</span><span class="p">({</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">count</span> <span class="p">})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number_item</span><span class="p">}&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">number</span><span class="p">}&gt;{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;{</span><span class="nx">label</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">numbers_wrapper</span><span class="p">}&gt;</span>
    <span class="p">&lt;</span><span class="nt">NumberWithLabel</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;班级总人数&#34;</span> <span class="na">count</span><span class="o">=</span><span class="p">{</span><span class="nx">member_count</span><span class="p">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">NumberWithLabel</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;男生人数&#34;</span> <span class="na">count</span><span class="o">=</span><span class="p">{</span><span class="nx">male_count</span><span class="p">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">NumberWithLabel</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;女生人数&#34;</span> <span class="na">count</span><span class="o">=</span><span class="p">{</span><span class="nx">female_count</span><span class="p">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">NumberWithLabel</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;分组数&#34;</span> <span class="na">count</span><span class="o">=</span><span class="p">{</span><span class="nx">group_count</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">group_count</span><span class="p">[</span><span class="nx">userId</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">NumberWithLabel</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;授课次数&#34;</span> <span class="na">count</span><span class="o">=</span><span class="p">{(</span><span class="nx">user_lecture_count</span> <span class="o">?</span> <span class="p">(</span><span class="nx">user_lecture_count</span><span class="p">[</span><span class="nx">userId</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)}</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>数据使用useSelector获取，这样代码看起来简单读了。</p>
<h2 id="封装组件">封装组件</h2>
<p>然后发现了一大段代码可以封装成一个独立的组件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">card_body</span><span class="p">}&gt;</span>
<span class="p">{</span>
    <span class="nx">groupList</span> <span class="o">&amp;&amp;</span> <span class="nx">groupList</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">group</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_item</span><span class="p">}</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span> <span class="na">onDrop</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">handleStudentDrop</span><span class="p">(</span><span class="nx">group</span><span class="p">)}</span> <span class="na">onDragOver</span><span class="o">=</span><span class="p">{</span><span class="nx">handleStudentDragOver</span><span class="p">}</span>                                                <span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_item_header</span><span class="p">}&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_item_info</span><span class="p">}&gt;</span>
                    <span class="p">{</span><span class="nx">group</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
                    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">trophy_icon</span><span class="p">}</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_item_btns</span><span class="p">}&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">Radio</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_student_list_radio</span><span class="p">}</span> <span class="na">checked</span><span class="o">=</span><span class="p">{</span><span class="nx">group</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">curGroup</span><span class="p">}</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">selectCurGroup</span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">id</span><span class="p">)}</span> <span class="p">/&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">group_student_list</span><span class="p">}&gt;</span>
                <span class="p">{</span>
                    <span class="nx">group</span><span class="p">.</span><span class="nx">members</span> <span class="o">&amp;&amp;</span> <span class="nx">group</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="p">(</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="p">{{</span>
                            <span class="nx">textAlign</span><span class="o">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="nx">fontSize</span><span class="o">:</span><span class="mi">14</span><span class="p">,</span>
                            <span class="nx">color</span><span class="o">:</span><span class="s1">&#39;#666&#39;</span><span class="p">,</span>
                        <span class="p">}}&gt;</span><span class="nx">该小组没有学生</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;)</span> <span class="o">:</span> <span class="p">(</span>
                        <span class="nx">group</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">stu</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(&lt;</span><span class="nt">StudentItem</span>
                            <span class="na">isDrage</span>
                            <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span>
                            <span class="na">stu</span><span class="o">=</span><span class="p">{</span><span class="nx">stu</span><span class="p">}</span>
                            <span class="na">group</span><span class="o">=</span><span class="p">{</span><span class="nx">group</span><span class="p">}</span>
                            <span class="na">gender</span><span class="o">=</span><span class="p">{</span><span class="nx">stu</span><span class="p">.</span><span class="nx">gender</span><span class="p">}</span>
                            <span class="na">headimg_res_url</span><span class="o">=</span><span class="p">{</span><span class="nx">stu</span><span class="p">.</span><span class="nx">headimg_res_url</span><span class="p">}</span>
                            <span class="na">name</span><span class="o">=</span><span class="p">{</span><span class="nx">stu</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
                            <span class="na">groupStuStyle</span>
                            <span class="na">onDragStart</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">handleDragStart</span><span class="p">(</span><span class="nx">stu</span><span class="p">,</span> <span class="nx">group</span><span class="p">.</span><span class="nx">id</span><span class="p">)}</span>
                            <span class="na">onSetLeader</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">handleSetLeader</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">stu</span><span class="p">,</span><span class="nx">group</span><span class="p">)}</span>
                            <span class="na">onSetHeader</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">handleSetHeader</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">stu</span><span class="p">)}</span>
                        <span class="p">/&gt;))</span>
                    <span class="p">)</span>
                <span class="p">}</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">))</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>还有它相关的方法都是像这样的dispatch，大概有五六个，它们都写在render函数内，这非常糟糕。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">handleDragStart</span> <span class="o">=</span> <span class="p">(</span><span class="nx">stu</span><span class="p">,</span> <span class="nx">org_id</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;classDetail/updateState&#39;</span><span class="p">,</span>
        <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">onDragStudent</span><span class="o">:</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">stu</span><span class="p">,</span>
                <span class="nx">org_id</span><span class="p">,</span>
                <span class="nx">type</span><span class="o">:!!</span><span class="nx">org_id</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>我要讲这个<code>dispatch</code>中的<code>action</code>放到一个<code>action_creater.js</code>文件中，将组建放在<code>GroupItem.jsx</code>文件中。这可以让次要的信息不占用篇幅，主要的信息就会一目了然了。
这段代码就编程了2个组件和1个<code>action creater</code>文件。相关的代码封装在一起，再也不用为了看一个函数而滚动300行代码或者要用搜索才能找到了。</p>
<blockquote>
<p>这3个文件目前都只有40-50行。</p>
</blockquote>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%8A%98%E8%85%BE/" term="折腾" label="折腾" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">vim</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/vim.html" />
            <id>https://wss.cool/vim.html</id>
            <updated>2020-04-01T21:27:14+08:00</updated>
            <published>2020-04-01T21:27:14+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[vim常用操作，替换、缩紧等]]></summary>
            
                <content type="html"><![CDATA[<h2 id="替换">替换</h2>
<div class="shortcodes_withTitle" title="buiiuiuiu">abbnbnbn</div>
<pre><code>:[range]s/search/replace/optioins 1️⃣
:%s/aa/bb/g 2️⃣
:%s/aa/bb/gc 3️⃣
</code></pre><ul>
<li>1️⃣ range表示搜索的范围， <code>:8,10 s/</code> 表示第8-10行，<code>:%s/</code> 表示全文。</li>
<li>2️⃣ <code>g</code> 是一个option(global)，表示要替换所有匹配项，不加它的话只会替换第一个匹配项。</li>
<li>3️⃣ <code>c</code> 是一个option(confirm)，表示替换前需要确认。</li>
</ul>
<h3 id="confirm">confirm</h3>
<p>加了confirm选项后，替换时会出现这样的提示，需要你回复。</p>
<pre><code>replace with foo (y/n/a/q/l/^E/^Y)?
</code></pre><table>
<thead>
<tr>
<th align="center">回复</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">y</td>
<td align="left">yes</td>
</tr>
<tr>
<td align="center">n</td>
<td align="left">no</td>
</tr>
<tr>
<td align="center">a</td>
<td align="left">go ahead，替换所有</td>
</tr>
<tr>
<td align="center">q</td>
<td align="left">quit 取消、退出操作</td>
</tr>
<tr>
<td align="center">l</td>
<td align="left">替换当前这个，然后退出操作</td>
</tr>
<tr>
<td align="center">^E/^Y</td>
<td align="left">scroll the text using Ctrl-e and Ctrl-y</td>
</tr>
</tbody>
</table>
<h2 id="配置">配置</h2>
<pre><code>set nocompatible 
set number
set relativenumber
set cursorline
set wrap
set laststatus=2
set ruler

syntax on
set showmode
set showcmd

set shiftwidth=4
set tabstop=2
set expandtab
set softtabstop=2
</code></pre><p>依次：不兼容vi，显示行号，行号是相对当前行的，光标所在的当前行高亮，换行，显示状态栏，状态栏中显示光标的位置，语法高亮开启，模式，指令，<code>&gt;&gt;&lt;&lt;==</code> 操作的空格数，tab键的空格数，缩紧使用空格，tab等于几个空格</p>
<h2 id="缩紧">缩紧</h2>
<p>在文本上按下&gt;&gt;（增加一级缩进）、&lt;&lt;（取消一级缩进）或者==（取消全部缩进）时，每一级的字符数。</p>
<h2 id="reference">reference</h2>
<ul>
<li>搜索与替换：<a href="https://www.linux.com/training-tutorials/vim-tips-basics-search-and-replace/">https://www.linux.com/training-tutorials/vim-tips-basics-search-and-replace/</a></li>
<li>配置：<a href="http://vim.spf13.com/">http://vim.spf13.com/</a></li>
<li>攻略1：<a href="https://github.com/vim-china/hello-vim">https://github.com/vim-china/hello-vim</a></li>
<li>攻略2：<a href="https://github.com/oldratlee/vim-practice">https://github.com/oldratlee/vim-practice</a></li>
<li>攻略3：<a href="https://github.com/wsdjeg/vim-galore-zh_cn">https://github.com/wsdjeg/vim-galore-zh_cn</a></li>
<li>阮一峰：<a href="https://www.ruanyifeng.com/blog/2018/09/vimrc.html">https://www.ruanyifeng.com/blog/2018/09/vimrc.html</a></li>
</ul>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/" term="工具" label="工具" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">ReactRouter的哲学</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/reactrouter-philosophy.html" />
            <id>https://wss.cool/reactrouter-philosophy.html</id>
            <updated>2020-03-31T13:11:28+08:00</updated>
            <published>2020-03-31T13:11:28+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[机翻文档，新版的react-router是动态路由，它与传统的静态路由在使用上有很大的不同]]></summary>
            
                <content type="html"><![CDATA[<h2 id="哲学">哲学</h2>
<p>本指南的目的是解释使用React Router时的心智模型。 我们将其称为“动态路由”，这与您可能更熟悉的“静态路由”完全不同。</p>
<h3 id="静态路由">静态路由</h3>
<p>如果您使用过Rails，Express，Ember，Angular等，那么您已经使用了静态路由。 在这些框架中，您可以在进行任何渲染之前将路由声明为应用程序初始化的一部分。 React Router pre-v4也是静态的（大多数情况下）。<br>
请注意在应用侦听之前如何声明路由。 我们使用的客户端路由器是类似的。 在Angular中，您可以预先声明您的路由，然后在渲染之前将它们导入顶级AppModule.<br>
Ember有一个传统的routes.js文件，构建会读取并导入到应用程序中。 同样，这会在您的应用呈现之前发生。<br>
尽管API不同，但它们都共享“静态路由”模型。 React Router也使用“静态路由”直到v4。要成功使用React Router，您需要忘记这一切！：o</p>
<h3 id="背景故事">背景故事</h3>
<p>坦率地说，我们对我们在React Router的v2版本中方向感到非常沮丧。 我们（Michael和Ryan）觉得受到API的限制，认识到我们重新实现了React（生命周期等）的部分，而且它与React给我们创作UI的心理模型不符。我们走过走廊在研讨会讨论如何应对之前的酒店。我们互相问道：“如果我们使用我们在工作室教授的模式构建路由器会是什么样子？”开发只需要几个小时，我们就有了一个概念验证，我们知道它是未来 我们想要路由。 我们最终得到的API并不是React的“外部”，这是一个由React的其余部分组成或自然落实到位的API。 我们认为你会喜欢它。</p>
<h3 id="动态路由">动态路由</h3>
<p>当我们说动态路由时，我们指的是在您的应用呈现时发生的路由，而不是在正在运行的应用之外的配置或约定中。 这意味着几乎所有东西都是React Router中的一个组件。 以下是对API的60秒回顾，了解它的工作原理：首先，为自己定位的环境抓住自己的路由器组件，并将其呈现在应用的顶部。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">BrowserRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router-dom&#39;</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">((</span>
  <span class="o">&lt;</span><span class="nx">BrowserRouter</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">App</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="err">/BrowserRouter&gt;</span>
<span class="p">),</span> <span class="nx">el</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>接下来，抓取链接组件以链接到新位置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">nav</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&#34;/dashboard&#34;</span><span class="o">&gt;</span><span class="nx">Dashboard</span><span class="o">&lt;</span><span class="err">/Link&gt;</span>
    <span class="o">&lt;</span><span class="err">/nav&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>最后，当用户访问/仪表板时渲染Route来显示一些UI。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">nav</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&#34;/dashboard&#34;</span><span class="o">&gt;</span><span class="nx">Dashboard</span><span class="o">&lt;</span><span class="err">/Link&gt;</span>
    <span class="o">&lt;</span><span class="err">/nav&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&#34;/dashboard&#34;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Dashboard</span><span class="p">}</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Route将呈现<code>&lt;Dashboard {... props} /&gt;</code>，其中<code>props</code>是一些特定于路由器的东西，看起来像<code>{match，location，history}</code>。 如果用户不在<code>/dashboard</code>，则Route将呈现为null。 这就是它的全部内容。</p>
<h3 id="嵌套路由">嵌套路由</h3>
<p>很多路由器都有一些“嵌套路由”的概念。如果您在v4之前使用过React Router的版本，那么您也会知道它也是如此！当您从静态路由配置移动到动态渲染路由时，如何“嵌套路由”？那么，你如何潜逃一个div？</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">BrowserRouter</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="cm">/* here&#39;s a div */</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="cm">/* here&#39;s a Route */</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&#34;/tacos&#34;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Tacos</span><span class="p">}</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="o">&lt;</span><span class="err">/BrowserRouter&gt;</span>
<span class="p">)</span>

<span class="c1">// when the url matches `/tacos` this component renders
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">Tacos</span>  <span class="o">=</span> <span class="p">({</span> <span class="nx">match</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">(</span>
  <span class="c1">// here&#39;s a nested div
</span><span class="c1"></span>  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="cm">/* here&#39;s a nested Route,
</span><span class="cm">        match.url helps us make a relative path */</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="nx">Route</span>
      <span class="nx">path</span><span class="o">=</span><span class="p">{</span><span class="nx">match</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;/carnitas&#39;</span><span class="p">}</span>
      <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Carnitas</span><span class="p">}</span>
    <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>看看路由器没有“嵌套”API？ 路由只是一个组件，就像div一样。 因此，为了筑巢路线或div，你只需......做它。让我变得更加棘手。</p>
<h3 id="响应路线">响应路线</h3>
<p>考虑用户导航到<code>/invoices</code>。 您的应用适用于不同的屏幕尺寸，它们具有较窄的视口，因此您只需向其显示发票列表和发票仪表板的链接。他们可以从那里更深入地导航。<br>
在大屏幕上，<code>/invoices</code>不是有效的路线，但在小屏幕上它是！ 为了让事情变得更有趣，请考虑一个拥有巨型手机的人。 他们可以纵向查看/发票，然后将手机旋转到横向。 突然间，我们有足够的空间来显示主 - 细节用户界面，所以你应该立即重定向！</p>
<pre><code>
</code></pre><p>当用户将手机从纵向旋转到横向时，此代码会自动将其重定向到仪表板。 该组有效路由根据用户手中的移动设备的动态特性而改变。
这只是一个例子。 还有很多其他我们可以讨论的内容，但我们总结一下这个建议：为了让你的直觉与React Router的一致，考虑组件，而不是静态路由。 考虑如何使用React的声明可组合性来解决问题，因为几乎每个“React Router问题”都可能是“React问题”。</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/knowledge/" term="knowledge" label="knowledge" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/front-end/" term="front end" label="front end" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/react/" term="react" label="react" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">渐变色</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/linear-gradient.html" />
            <id>https://wss.cool/linear-gradient.html</id>
            <updated>2020-03-31T08:41:24+08:00</updated>
            <published>2020-03-31T08:41:24+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[先说草图布局 现在工作的公司设计的页面似乎从来不考虑体验。比如说加载数据的loadin……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="先说草图布局">先说草图布局</h2>
<p>现在工作的公司设计的页面似乎从来不考虑体验。比如说加载数据的loading界面，目前我发现B站、知乎等很多的APP、网页都在用下面图片这种效果。就是在没有拿到数据前，页面用条条框框的图形来代表内容和数据。<br>
<img src="/images/linear-gradient-1.jpg" alt="草图布局"><br>
这个效果其实好像还没有一个正式的名字，“草图布局”这个名字是从<a href="https://weibo.com/1400854834/FAbzPbKqE?type=comment#_rnd1531902658334">阮一峰的微博</a>看来的，我认为挺恰当的就这么叫吧。下图来自他的微博，微博里还有demo可以参考。</p>
<p>这个demo的实现原始是，在<code>background-image</code>中使用各种<code>gradient</code>来画圆形、矩形，使用<code>background-size</code>控制各个图形的尺寸，主要是宽度。再使用<code>background-position</code>控制各个图形的位置来布局。这里就用到的渐变色，只不过用来画了非渐变的图形。</p>
<p>demo中有一个高亮的动画效果，是使用一个有旋转了100度的<code>linear-gradient</code>加一个位置动画的效果实现的。我在我的项目中实现这个效果时遇到了问题——怎么确定这个渐变色的起始位置。比如，下图这条白色的线，和另一条红线。<br>
<img src="/images/linear-gradient-3.gif" alt="草图布局">
<img src="/images/linear-gradient-4.gif" alt="草图布局"></p>
<p>红线的效果由这段代码实现的：（白线也类似）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">background-image</span><span class="o">:</span> <span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">120deg</span><span class="o">,</span> <span class="nt">transparent</span> <span class="nt">308px</span><span class="o">,</span> <span class="nt">red</span> <span class="nt">323px</span> <span class="o">,</span><span class="nt">transparent</span> <span class="nt">338px</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>代码中的308px是红线的起始位置，338是结束位置，他们的差是线的宽度。但是308这个数是怎么算出来的呢？</p>
<h2 id="渐变色的方向与位置">渐变色的方向与位置</h2>
<p>如果想使用<code>linear-gradient</code>画出那条红线，计算起始位置是关键（308px）。想计算起始位置需要先了解几个概念：渐变线、起始点和终点。<br>
<img src="/images/linear-gradient-2.png" alt="渐变色" title="渐变线、起始点和终点"></p>
<blockquote>
<p>渐变线由包含渐变图形的容器的中心点和一个角度来定义的。渐变线上的颜色值是由不同的点来定义，包括起始点，终点，以及两者之间的可选的中间点（中间点可以有多个）。<br>
起始点是渐变线上代表起始颜色值的点。起始点由渐变线和过容器顶点的垂直线之间的交叉点来定义。（垂直线跟渐变线在同一象限内）<br>
同样的，终点是渐变线上代表最终颜色值的点。终点也是由渐变线和从最近的顶点发出的垂直线之间的交叉点定义的，然而从起始点的对称点来定义终点是更容易理解的一种方式，因为终点是起点关于容器的中心点的反射点。</p>
</blockquote>
<p>上面的图片和定义来自<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/linear-gradient">MDZ文档</a></p>
<p>由这些概念可以知道渐变色是从起始点开始沿着渐变线的方向绘制，渐变色的交界会垂直与渐变线。也就是说我们想做的红线是垂直于渐变线的。那么我们看下图
<img src="/images/linear-gradient-5.gif" alt="渐变色"> <br>
已知红线与上边成60度角（自己定义的），所以渐变线应该是120deg，过点B做120deg渐变线的垂直线，相交于点C，点A点C的线段A的长度就是红色的起始位置，如果上边长度为375，由勾股定理可知线段A长度为309，所以红线的起始位置就是309px，（我的代码里取了308px没什么区别）<br>
由此可以写出上面的代码来实现红线。（其实就是顶点到红线的距离）<br>
所以当我们想实现一个有角度的渐变色的时候，就可以用类似的方法来计算颜色的起始位置。</p>
<p>如果渐变方向是平行与上下边或者左右边，可以这样写：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">background-image</span><span class="o">:</span> <span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">to</span> <span class="nt">bottom</span><span class="o">,</span><span class="nt">red</span> <span class="nt">25px</span> <span class="o">,</span><span class="nt">blue</span> <span class="nt">0</span><span class="o">);</span>
<span class="nt">background-image</span><span class="o">:</span> <span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">to</span> <span class="nt">right</span><span class="o">,</span> <span class="nt">red</span> <span class="nt">25px</span> <span class="o">,</span><span class="nt">blue</span> <span class="nt">0</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>另外下面代码的效果是一样的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">background-image</span><span class="o">:</span> <span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">red</span> <span class="nt">25px</span> <span class="o">,</span><span class="nt">blue</span> <span class="nt">0</span><span class="o">);</span>
<span class="nt">background-image</span><span class="o">:</span> <span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">180deg</span><span class="o">,</span> <span class="nt">red</span> <span class="nt">25px</span> <span class="o">,</span><span class="nt">blue</span> <span class="nt">0</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>另外，第二个颜色后面的数值便是渐变结束的位置，如果小雨前面颜色的位置就不会有渐变效果，利用这点可以用来实现草图布局。</p>
<p>例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">body</span><span class="o">,</span><span class="nt">html</span><span class="p">{</span>
	<span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">empty</span><span class="p">:</span><span class="nd">empty</span> <span class="p">{</span>
	<span class="k">margin</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
	<span class="k">width</span><span class="p">:</span> <span class="mi">702</span><span class="kt">px</span><span class="p">;</span>
	<span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
	
	<span class="k">background-image</span><span class="p">:</span>
		<span class="nb">linear-gradient</span><span class="p">(</span><span class="mi">100</span><span class="kt">deg</span><span class="p">,</span> 
			<span class="kc">transparent</span> <span class="mi">600</span><span class="kt">px</span><span class="p">,</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="mi">630</span><span class="kt">px</span> <span class="p">,</span><span class="kc">transparent</span> <span class="mi">660</span><span class="kt">px</span><span class="p">),</span>
		<span class="nb">linear-gradient</span><span class="p">(</span> <span class="kc">lightgray</span> <span class="mi">150</span><span class="kt">px</span><span class="p">,</span> <span class="kc">transparent</span> <span class="mi">0</span> <span class="p">),</span>
		<span class="nb">linear-gradient</span><span class="p">(</span> <span class="kc">lightgray</span> <span class="mi">150</span><span class="kt">px</span><span class="p">,</span> <span class="kc">transparent</span> <span class="mi">0</span> <span class="p">),</span>
		<span class="nb">linear-gradient</span><span class="p">(</span> <span class="kc">lightgray</span> <span class="mi">30</span><span class="kt">px</span><span class="p">,</span> <span class="kc">transparent</span> <span class="mi">0</span> <span class="p">),</span>
		<span class="nb">linear-gradient</span><span class="p">(</span> <span class="kc">lightgray</span> <span class="mi">88</span><span class="kt">px</span><span class="p">,</span> <span class="kc">transparent</span> <span class="mi">0</span> <span class="p">);</span>

	<span class="k">background-size</span><span class="p">:</span>
		<span class="mi">100</span><span class="kt">%</span> <span class="mi">100</span><span class="kt">%</span><span class="p">,</span> <span class="c">/* highlight */</span>
		<span class="mi">336</span><span class="kt">px</span> <span class="mi">150</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">336</span><span class="kt">px</span> <span class="mi">150</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">570</span><span class="kt">px</span> <span class="mi">30</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">720</span><span class="kt">px</span> <span class="mi">88</span><span class="kt">px</span><span class="p">;</span>

	<span class="k">background-position</span><span class="p">:</span>
		<span class="mi">-700</span><span class="kt">px</span> <span class="mi">0</span><span class="p">,</span>
		<span class="mi">0</span> <span class="mi">24</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">387</span><span class="kt">px</span> <span class="mi">24</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">0</span> <span class="mi">230</span><span class="kt">px</span><span class="p">,</span>
		<span class="mi">0</span> <span class="mi">284</span><span class="kt">px</span><span class="p">;</span>
	
	<span class="k">background-repeat</span><span class="p">:</span> <span class="kc">no-repeat</span><span class="p">;</span>

	<span class="k">animation</span><span class="p">:</span> <span class="n">shine</span> <span class="mi">2</span><span class="kt">s</span> <span class="kc">infinite</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">@</span><span class="k">keyframes</span> <span class="nt">shine</span> <span class="p">{</span>
	<span class="nt">to</span> <span class="p">{</span>
		<span class="k">background-position</span><span class="p">:</span>
			<span class="mi">160</span><span class="kt">px</span> <span class="mi">0</span><span class="p">,</span>
			<span class="mi">0</span> <span class="mi">24</span><span class="kt">px</span><span class="p">,</span>
			<span class="mi">387</span><span class="kt">px</span> <span class="mi">24</span><span class="kt">px</span><span class="p">,</span>
			<span class="mi">0</span> <span class="mi">230</span><span class="kt">px</span><span class="p">,</span>
			<span class="mi">0</span> <span class="mi">284</span><span class="kt">px</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/css/" term="css" label="css" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">SSH</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/ssh.html" />
            <id>https://wss.cool/ssh.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2020-03-31T08:37:31+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[在自己的电脑上生成公钥、密钥。公钥放在远程服务器上，密钥在自己电脑里不用管。连接远程服务器时就不用输入密码了。]]></summary>
            
                <content type="html"><![CDATA[<p>在自己的电脑上生成公钥、密钥。公钥放在远程服务器上，密钥在自己电脑里不用管。连接远程服务器时就不用输入密码了。</p>
<h2 id="安装">安装</h2>
<p>新装的系统可能没有ssh服务，需要自己安装</p>
<pre><code>sudo apt-get install openssh-server
</code></pre><h2 id="配置">配置</h2>
<p>新安装的 <code>ssh server</code> 需要一点配置：开启密码登录，开启公钥登录。</p>
<ol>
<li>编辑配置文件
<pre><code>sudo vim /etc/ssh/sshd_config
</code></pre></li>
<li>开启密码登录、公钥登录
<pre><code>PasswordAuthentication yes
PubkeyAuthentication yes
</code></pre></li>
<li>重启 <code>ssh server</code>
<pre><code>service ssh reload <span class="shortcodes_tag">退出vim重启ssh</span>
</code></pre></li>
</ol>
<h2 id="生成key">生成key</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">ssh-keygen -t rsa
</code></pre></td></tr></table>
</div>
</div><h2 id="复制公钥">复制公钥</h2>
<p>将本机的公钥copy到远程机器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">ssh-copy-id username@remote_host_B
</code></pre></td></tr></table>
</div>
</div><p>然后输入密码。</p>
<blockquote>
<p>该命令会把本机的公钥复制到远程机器的 .ssh/authorized_keys 文件中。</p>
</blockquote>
<h2 id="登陆服务器">登陆服务器</h2>
<p>配置好公钥以后就可以使用如下命令登录了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">ssh username@hostname
</code></pre></td></tr></table>
</div>
</div><h2 id="配置别名">配置别名</h2>
<p>每次都使用 <code>ssh username@hostname</code> 登录会有点麻烦，可以通过配置将命令简化。比如下面的配置，可以将登录的命令简化为 <code>ssh azu</code> 。配置文件为 <code>~/.ssh/config</code> 。</p>
<pre><code>Host azu
   HostName 192.168.1.5
   User azu
   IdentityFile /homt/xx/.ssh/id_rsa
</code></pre><h2 id="alias命令">alias命令</h2>
<p>在终端中定义缩写的命令，比如：</p>
<pre><code>alias totx='ssh username@hostname'
</code></pre><p>这样就可以使用<code>totx</code>命令直接登陆远程服务器了，但是alias命令会在重启终端时</p>
<h2 id="永久保留alias命令">永久保留alias命令</h2>
<p>每次登陆时.bash_profile文件是会自动执行，此过程会调用.bashrc，将alias命令写入.bashrc文件就可以将alias命令永久生效了。（如果没有此文件就创建一个）</p>
<h2 id="报错">报错</h2>
<pre><code>WARNING: UNPROTECTED PRIVATE KEY FILE!
Permissions 0644 '' are too open.
...
</code></pre><p>我装了window是10和ubuntu双系统，将windows的一个公钥文件复制到ubuntu后，使用ssh的config配置了它。在使用ssh登录时，就报了这个错。</p>
<p>是文件权限的问题，改成只读的权限即可解决。</p>
<pre><code>chmod 400 ～/.ssh/id_rsa
</code></pre><h2 id="指定私钥证书登录">指定私钥(证书)登录</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">ssh name@6.6.6.6 -i ./identity_file.pem

scp -i ./identity_file.pem file_a name@1.1.1.1:~/
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" term="服务器" label="服务器" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/linux/" term="LINUX" label="LINUX" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">跨域CORS</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/%E8%B7%A8%E5%9F%9Fcors.html" />
            <id>https://wss.cool/%E8%B7%A8%E5%9F%9Fcors.html</id>
            <updated>2020-03-31T08:33:05+08:00</updated>
            <published>2020-03-31T08:33:05+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[摘要，显示在meta的description中，]]></summary>
            
                <content type="html"><![CDATA[<h2 id="什么是跨域问题">什么是跨域问题</h2>
<p>在网页中使用AJAX时，AJAX请求的URL与网页的URL相比较，如果是属于同一个域名才可以正常访问，如果不属于一个域名就会出现跨域问题。所以，怎么判断两个URL是不是属于同一个域名呢？</p>
<p>比如一个网页的URL是&quot;https://segmentfault.com/a/1190000011145364?aaa=666&quot;，可以把它拆分开：<br>
origin: &quot;https://segmentfault.com&quot;<br>
pathname: &quot;/a/1190000011145364&quot;<br>
search: &quot;?aaa=666&quot;</p>
<p>只有当两个URL的origin完全相同时，才不会出现跨域问题。所以以下origin都会出现跨域问题：<br>
子域名：https://abc.segmentfault.com<br>
不同协议：http://segmentfault.com<br>
不同端口：https://segmentfault.com:8080<br>
IP地址：https://192.168.4.12</p>
<p>当出现跨域问题时，AJAX请求返回后浏览器控制台会报错，AJAX的回调拿不到返回值。</p>
<h2 id="两种常用的解决方法jsonp和cors">两种常用的解决方法：JSONP和CORS</h2>
<h3 id="jsonp">JSONP</h3>
<p>原理是利用浏览器允许跨域引用JavaScript资源。<br>
发送请求时，通过URL告诉服务器函数名，如：<code>http://some.com?callback=handle</code>.<br>
服务器的通常是函数调用的形式，如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">handle</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>页面中需要先准备好函数<code>handle</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="cors">CORS</h3>
<p>这个方案好像不需要在JS代码中的额外操作。另外，默认情况下，Cookie不包括在CORS请求之中，如果需要请求中带着cookie，设置withCredentials参数即可。<br>
<a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">阮一峰——跨域资源共享 CORS 详解</a></p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E7%9F%A5%E8%AF%86%E7%82%B9/" term="知识点" label="知识点" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/javascript/" term="JavaScript" label="JavaScript" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">AJAX</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/ajax.html" />
            <id>https://wss.cool/ajax.html</id>
            <updated>2020-03-31T08:20:17+08:00</updated>
            <published>2020-03-31T08:20:17+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[介绍AJAX的基本API和作用]]></summary>
            
                <content type="html"><![CDATA[<p>AJAX——异步的JavaScript和XML，就是使用<code>XMLHttpRequest</code>对象与服务器通信。</p>
<h2 id="发送http请求">发送http请求</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">httpRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.example.org/some.file&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>创建XMLHttpRequest对象</li>
<li>告诉它</li>
<li>与哪个服务器交互</li>
<li>以哪种方法交互</li>
<li>给服务器的数据</li>
</ol>
<h2 id="open方法">open()方法</h2>
<p>这个方法是选择互动的目标，比如玩游戏时，你要告诉服务器我要用这个账号玩，用微信要先选择一个人才能发消息。</p>
<p>由于<a href="/2018/06/22/cors.html">跨域问题</a>，<code>open()</code> 方法的 <code>URL</code> 参数默认*..不能..*使用第三方域名。<br>
第一个参数如果不大写某些浏览器可能无法处理（比如FireFox，不知道哪些版本会有这个问题？）</p>
<h2 id="send方法">send()方法</h2>
<p>选择了目标后，就可以发消息了。发微信是说人类的语言，这个send方法就是说机器能听懂的语言。</p>
<h3 id="指定发送给服务器的数据">指定发送给服务器的数据</h3>
<p><code>send()</code> 方法的参数就是要发送的数据，将会发送到服务器。像查询语句：<code>&quot;name=wss&amp;age=66&quot;</code>，<br>
或者其他格式, 例如multipart/form-data，JSON，XML等。</p>
<h3 id="指定返回数据的格式">指定返回数据的格式</h3>
<p>服务区收到了我们的请求后，会给我们一个响应。我们要事先告诉服务器我们想要的数据的格式。</p>
<p>当以POST方式获取数据时，需要设置请求的<em>MIME类型</em>。</p>
<blockquote>
<p>用于定义网络文件的类型和网页的编码，决定浏览器将以什么形式、什么编码读取这个文件）</p>
</blockquote>
<p>比如表单数据：<code>httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');</code></p>
<h2 id="处理服务器响应">处理服务器响应</h2>
<p><code>httpRequest.onreadystatechange</code>函数负责处理响应，函数内应该怎么处理呢？</p>
<p>第一步：检查请求的状态。</p>
<p>请求的状态会经历如下变化：（每当状态变化是都会调用onreadystatechange方法？）</p>
<ul>
<li>0 (未初始化) or (请求还未初始化) UNSENT</li>
<li>1 (正在加载) or (已建立服务器链接) OPENED</li>
<li>2 (加载成功) or (请求已接受) HEADERS_RECEIVED</li>
<li>3 (交互) or (正在处理请求) LOADING</li>
<li>4 (完成) or (请求已完成并且响应已准备好) DONE</li>
</ul>
<p>第二步：请求完成时，检查http状态码。</p>
<p>当请求完成，意味着完成了与服务器的交互。接下来就可以检查 <a href="http://www.runoob.com/http/http-status-codes.html">HTTP状态码</a> 了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">DONE</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Everything is good, the response was received.
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Perfect!
</span><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// There was a problem with the request.
</span><span class="c1"></span>        <span class="c1">// For example, the response may have a 404 (Not Found)
</span><span class="c1"></span>        <span class="c1">// or 500 (Internal Server Error) response code.
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Not ready yet.
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在检查完HTTP响应码后，就可以使用服务器返回的数据了，有两个方法去访问这些数据：</p>
<ul>
<li><code>httpRequest.responseText</code> – 服务器以文本字符的形式返回</li>
<li><code>httpRequest.responseXML</code> – 以 XMLDocument 对象方式返回，之后就可以使用JavaScript来处理
（返回JSON怎么处理？）</li>
</ul>
<h2 id="responsetype属性">responseType属性</h2>
<p>可以通过设置一个 XMLHttpRequest 对象的 responseType 属性来改变一个从服务器上返回的响应的<em>数据类型</em><br>
比如二进制数据:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="s2">&#34;arraybuffer&#34;</span><span class="p">;</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="监测进度">监测进度</h2>
<p>XMLHttpRequest 提供了各种在请求被处理期间发生的事件以供监听。包括定期进度通知、错误通知，等等。(这些事件与上面说的“请求状态readyState”有什么关系？)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;progress&#34;</span><span class="p">,</span> <span class="nx">updateProgress</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span> <span class="nx">transferComplete</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">,</span> <span class="nx">transferFailed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;abort&#34;</span><span class="p">,</span> <span class="nx">transferCanceled</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>

<span class="c1">// 如果 lengthComputable 属性的值是 false，那么意味着总字节数是未知并且 total 的值为零。
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">updateProgress</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">percentComplete</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span>
  <span class="p">}</span> 
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>progress 事件同时存在于下载和上传的传输。上传相关事件在 XMLHttpRequest.upload 对象上被触发，像下面这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">req</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;progress&#34;</span><span class="p">,</span> <span class="nx">updateProgress</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span> <span class="nx">transferComplete</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">,</span> <span class="nx">transferFailed</span><span class="p">);</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;abort&#34;</span><span class="p">,</span> <span class="nx">transferCanceled</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>使用 loadend 事件可以侦测到所有的三种加载结束条件（abort、load、error）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;loadend&#34;</span><span class="p">,</span> <span class="nx">loadEnd</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="参考">参考</h1>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/AJAX/Getting_Started">MDN AJAX Getting Started</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/Sending_and_Receiving_Binary_Data">使用JavaScript类型数组接受二进制数据</a></p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E7%9F%A5%E8%AF%86%E7%82%B9/" term="知识点" label="知识点" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/javascript/" term="JavaScript" label="JavaScript" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">DOM</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/dom.html" />
            <id>https://wss.cool/dom.html</id>
            <updated>2020-03-30T23:25:37+08:00</updated>
            <published>2020-03-30T23:25:37+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[摘要，显示在meta的description中，]]></summary>
            
                <content type="html"><![CDATA[<h2 id="获取dataset">获取dataset</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">+</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/dom/" term="DOM" label="DOM" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">React</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/react.html" />
            <id>https://wss.cool/react.html</id>
            <updated>2020-03-30T23:19:26+08:00</updated>
            <published>2020-03-30T23:19:26+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[摘要，显示在meta的description中，]]></summary>
            
                <content type="html"><![CDATA[<h2 id="生命周期">生命周期</h2>
<p>用于初始化 state  constructor() {}</p>
<p>用于替换 <code>componentWillReceiveProps</code> ，该函数会在初始化和 <code>update</code> 时被调用，</p>
<p>如果需要对比 <code>prevProps</code> 需要单独在 <code>state</code> 中维护  <code>static getDerivedStateFromProps(nextProps, prevState) {}</code> ，因为该函数是静态函数，所以取不到 <code>this</code> 。</p>
<p>判断是否需要更新组件，多用于组件性能优化  <code>shouldComponentUpdate(nextProps, nextState) {}</code></p>
<p>用于获得最新的 <code>DOM</code> 数据  <code>getSnapshotBeforeUpdate() {}</code></p>
<p>以下函数不建议使用  <code>UNSAFE_componentWillMount() {}</code>，<code>UNSAFE_componentWillUpdate(nextProps, nextState) {}</code>，<code>UNSAFE_componentWillReceiveProps(nextProps) {}</code></p>
<h2 id="props中没有historylocationmatchwithrouter可以解决">props中没有history,location,match？withRouter可以解决</h2>
<p>如果A组件的父组件是Route（react-router-dom）,A的props参数会含有history,location,match，但是A组件的子组件B的props参数就不包含history,location,match。<br>
如果想在B组件中使用history的API，但是没有history对象该怎么办呢。这时就用到withRouter了<a href="https://reacttraining.com/react-router/web/api/withRouter">文档</a>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">withRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router&#39;</span><span class="p">;</span>
<span class="kr">class</span> <span class="nx">ShowTheLocation</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// this.props中会包含history,location,match
</span><span class="c1"></span><span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">withRouter</span><span class="p">(</span><span class="nx">ShowTheLocation</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/react/" term="react" label="react" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">博客文章分类</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB.html" />
            <id>https://wss.cool/%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB.html</id>
            <updated>2020-03-30T22:49:40+08:00</updated>
            <published>2020-03-30T22:49:40+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[介绍 分类以树状展开，能体现出难易程度和关系，体现出自己的知识结构。 最简单和基础的是“……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="介绍">介绍</h2>
<p>分类以树状展开，能体现出难易程度和关系，体现出自己的知识结构。</p>
<p>最简单和基础的是“api”分类，它是一些简单的语法，或者简单的API的用法的汇总，以前后端、服务器等划分子类，下面再展开具体的语言、类库、框架的API。使用这些API可以完成一些简单的日常工作。</p>
<p>进阶一点的是“知识点”分类，它是在API的背后的工作原理。掌握原理可以让工作中少踩坑。工作原理也可以在框架之间，在语言之间迁移。</p>
<p>第三个分类是“折腾”，它是由一些列的API、知识点经过一些步骤组合而成，一般是为了解决问题。</p>
<blockquote>
<p>折腾这个名字不大好，叫“实践”？</p>
</blockquote>
<p>再然后就是“心得与经验”分类，折腾实践多了，肯定会有好的经验和坏的教训，就需要思考总结，把它们沉淀为经验和套路。</p>
<h2 id="分类">分类</h2>
<ul>
<li>api （简单的API操作的记录）
<ul>
<li>前端
<ul>
<li>css</li>
<li>react</li>
<li>axios</li>
</ul>
</li>
<li>后端
<ul>
<li>java hashmap 使用</li>
<li>spring security</li>
<li>Spring mvc</li>
<li>Spring oauth2</li>
</ul>
</li>
<li>服务器
<ul>
<li>nginx
<ul>
<li>静态网站</li>
<li>反向代理</li>
</ul>
</li>
<li>linux
<ul>
<li>使用源码安装软件</li>
<li>ssh 登录，指定私钥文件（证书）</li>
</ul>
</li>
</ul>
</li>
<li>工具
<ul>
<li>git</li>
</ul>
</li>
</ul>
</li>
<li>知识点 （技术原理）
<ul>
<li>react
<ul>
<li>diff</li>
<li>元素</li>
<li>virtual dom</li>
<li>hooks</li>
<li>生命周期</li>
</ul>
</li>
<li>nginx
<ul>
<li>负载均衡</li>
</ul>
</li>
<li>java
<ul>
<li>hashmap原理</li>
</ul>
</li>
</ul>
</li>
<li>折腾（需要若干步骤、若干知识点、若干API操作组合而解决问题）
<ul>
<li>博客支持服务</li>
<li>gitlab的ci</li>
</ul>
</li>
<li>心得与经验（经历了一些事情后的想法，总结规律，思考结果。思想活动）
<ul>
<li>如何改bug</li>
<li>老板评价员工的逻辑</li>
<li>如何应付需求变动</li>
<li>如何写出好的代码</li>
<li>如何少加班</li>
<li>面试时总是没什么聊的怎么办？</li>
</ul>
</li>
<li>其他</li>
</ul>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%85%B6%E4%BB%96/" term="其他" label="其他" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">css</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/css.html" />
            <id>https://wss.cool/css.html</id>
            <updated>2020-03-29T22:10:30+08:00</updated>
            <published>2020-03-29T22:10:30+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[常用的 css 属性]]></summary>
            
                <content type="html"><![CDATA[<h2 id="居中">居中</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css">  <span class="nt">top</span><span class="p">:</span><span class="nd">50</span><span class="o">%;</span>
  <span class="nt">left</span><span class="p">:</span><span class="nd">50</span><span class="o">%;</span>
  <span class="nt">transform</span><span class="o">:</span> <span class="nt">translate</span><span class="o">(</span><span class="nt">-50</span><span class="o">%,</span> <span class="nt">-50</span><span class="o">%);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="flex">Flex</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">class</span><span class="p">{</span>
  <span class="k">display</span><span class="p">:</span><span class="kc">flex</span><span class="p">;</span>
  <span class="k">justify-content</span><span class="p">:</span><span class="kc">flex</span><span class="o">-</span><span class="kc">start</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span><span class="kc">center</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="简易镂空效果">简易镂空效果</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">outline</span><span class="o">:</span>  <span class="nt">9999px</span> <span class="nt">solid</span> <span class="nt">rgba</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span><span class="nt">0</span><span class="o">,</span><span class="nt">0</span><span class="o">,</span><span class="p">.</span><span class="nc">76</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="多行文字英文数字换行限制行数">多行文字（英文、数字换行、限制行数）</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css">  <span class="nt">overflow</span><span class="o">:</span> <span class="nt">hidden</span><span class="o">;</span>
  <span class="nt">text-overflow</span><span class="p">:</span><span class="nd">ellipsis</span><span class="o">;</span>
  <span class="nt">white-space</span><span class="o">:</span> <span class="nt">nowrap</span><span class="o">;</span>
  <span class="nt">word-wrap</span><span class="p">:</span><span class="nd">break-word</span><span class="o">;</span>
  <span class="nt">word-break</span><span class="p">:</span><span class="nd">break-all</span><span class="o">;</span>

  <span class="nt">display</span><span class="p">:</span><span class="nd">-webkit-box</span><span class="o">;</span>
  <span class="nt">-webkit-box-orient</span><span class="p">:</span><span class="nd">vertical</span><span class="o">;</span>
  <span class="nt">-webkit-line-clamp</span><span class="p">:</span><span class="nd">2</span><span class="o">;</span>
  <span class="nt">overflow</span><span class="p">:</span><span class="nd">hidden</span><span class="o">;</span>
  <span class="nt">word-wrap</span><span class="p">:</span><span class="nd">break-word</span><span class="o">;</span>
  <span class="nt">word-break</span><span class="p">:</span><span class="nd">break-all</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="flex布局时使子元素不被缩放">flex布局时使子元素不被缩放</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css">  <span class="nt">flex-grow</span><span class="o">:</span> <span class="nt">0</span><span class="o">;</span>
  <span class="nt">flex-shrink</span><span class="p">:</span><span class="nd">0</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="ios滚动不流畅">ios滚动不流畅</h2>
<pre><code>-webkit-overflow-scrolling : touch; 
</code></pre><h2 id="placeholder的样式">placeholder的样式</h2>
<pre><code>.className::-webkit-input-placeholder {
  color: #B7B7B7;
}
</code></pre><h2 id="渐变色文字">渐变色文字</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">text</span><span class="p">{</span>
  <span class="k">background-image</span><span class="p">:</span> <span class="kp">-webkit-</span><span class="nf">gradient</span><span class="p">(</span><span class="kc">linear</span><span class="p">,</span><span class="mi">0</span><span class="kt">%</span> <span class="mi">0</span><span class="kt">%</span><span class="p">,</span><span class="mi">25</span><span class="kt">%</span> <span class="mi">100</span><span class="kt">%</span><span class="p">,</span><span class="nf">from</span><span class="p">(</span><span class="mh">#ff2c2c</span><span class="p">),</span><span class="nf">to</span><span class="p">(</span><span class="mh">#7a5e91</span><span class="p">));</span>
  <span class="kp">-webkit-</span><span class="k">background-clip</span><span class="p">:</span> <span class="kc">text</span><span class="p">;</span>
  <span class="kp">-webkit-</span><span class="n">text-fill-color</span><span class="p">:</span> <span class="kc">transparent</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">span</span> <span class="p">{</span>
  <span class="k">background</span><span class="p">:</span> <span class="nb">linear-gradient</span><span class="p">(</span><span class="kc">to</span> <span class="kc">right</span><span class="p">,</span> <span class="kc">red</span><span class="p">,</span> <span class="kc">blue</span><span class="p">);</span>
  <span class="kp">-webkit-</span><span class="k">background-clip</span><span class="p">:</span> <span class="kc">text</span><span class="p">;</span>
  <span class="k">color</span><span class="p">:</span> <span class="kc">transparent</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="ios-阴影-input-textarea">IOS 阴影 input textarea</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">input</span><span class="o">,</span><span class="nt">textarea</span><span class="p">{</span>
	<span class="kp">-webkit-</span><span class="k">appearance</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="margin塌陷">margin塌陷</h2>
<p>在标准文档流中，竖直方向的margin会出现叠加现象，即较大的margin会覆盖掉较小的margin，竖直方向的两个盒子中间只有一个较大的margin，这就是margin的塌陷现象。<br>
margin的塌陷现象分两种情况：
1.兄弟关系的盒子：
比如ul的li，相邻的li之间的margin会重叠取较大的一个;
2.父子关系的盒子。
子盒子的margin-top大于父盒子时，子的margin-top会覆盖父的。</p>
<p>解决方法：<br>
当给父盒子设置边框或padding时，不会出现父子盒子的塌陷现象。<br>
当父盒子设置display:flex;时，不会出现这2种坍塌现象。</p>
<h2 id="盒子模型">盒子模型</h2>
<h2 id="清除浮动">清除浮动</h2>
<h2 id="css优先级">css优先级</h2>
<p>!important最高
行内style属性 &gt; 内联style标签 &gt; 外联css文件
id &gt; class &gt; tag
计算：
行内style属性 = 1000
ID选择器 = 100
类选择器、属性选择器、伪类 = 10
元素/伪元素 = 1
*通配选择器 = 0</p>
<h2 id="伪类伪元素">伪类&amp;伪元素</h2>
<p>伪元素：
::before
::after
::placeholder
::first-line
伪类：
:first-child
:nth-child
:empty</p>
<h2 id="inline-block元素有间隙">inline-block元素有间隙</h2>
<p>解决方法：在这些inline-block元素的父元素设置样式——fontsize：0；</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/css/" term="css" label="css" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">vscode</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/vscode.html" />
            <id>https://wss.cool/vscode.html</id>
            <updated>2020-03-28T05:02:40+08:00</updated>
            <published>2020-03-28T05:02:40+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[Git自动刷新 git 插件会不停的刷新文件的状态，间隔大概5秒。可以在设置中关掉它。 Autorefresh 是否……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="git自动刷新">Git自动刷新</h2>
<p>git 插件会不停的刷新文件的状态，间隔大概5秒。可以在设置中关掉它。</p>
<pre><code>Autorefresh
是否启用自动刷新。
</code></pre>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/" term="工具" label="工具" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">hugo常用格式</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/hugo%E5%B8%B8%E7%94%A8%E6%A0%BC%E5%BC%8F.html" />
            <id>https://wss.cool/hugo%E5%B8%B8%E7%94%A8%E6%A0%BC%E5%BC%8F.html</id>
            <updated>2020-03-28T05:02:40+08:00</updated>
            <published>2020-03-28T02:52:52+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[代说明的图片，reference，表格]]></summary>
            
                <content type="html"><![CDATA[<h2 id="自定义shortcodes">自定义shortcodes</h2>
<pre><code><span>{</span>{< tag nihao >}}</code></pre>
<p><strong>效果</strong>⬇️</p>
<span class="shortcodes_tag">nihao</span>
<h2 id="图片">图片</h2>
<p>下面引号内的文字是可以不加的，加了的话，会显示在图片下方，作为说明文字。</p>
<pre><code>![alt](/images/xx.png &quot;说明文字&quot;)
</code></pre><p><strong>效果</strong>⬇️
<img src="/images/hugo01.jpg" alt="52区" title="外域52区"></p>
<h2 id="引用-reference">引用 reference</h2>
<p>引用图片、网址等，在内容出标出。在文章最后列出所有引用。引用和标记可以互相跳转。</p>
<pre><code>某文章[^1]说到某技术非常厉害

[^1]: https://github.com/wangshushuo/abc.html
</code></pre><p><strong>效果</strong>⬇️</p>
<p>某文章<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>说到某技术非常厉害</p>
<h2 id="链接">链接</h2>
<p><strong>第一种：行内</strong></p>
<p><strong>效果</strong>⬇️</p>
<pre><code>[链接的文字](https://www.wss.cool)
</code></pre><p><a href="https://wss.cool">链接的文字</a></p>
<p><strong>第二种：简写</strong></p>
<pre><code>[链接的文字][a1]

[a1]: https://wss.cool
</code></pre><p><strong>效果</strong>⬇️</p>
<p><a href="https://wss.cool">链接的文字</a></p>
<h2 id="表格">表格</h2>
<pre><code>操作 | 代码 
:---:|:---:
暂存 | git stash
列表 | git stash list
取出 | git stash pop 1
</code></pre><pre><code>:---: 表示文字居中
:---  居左
---:  局右，
</code></pre><p><strong>效果</strong>⬇️</p>
<table>
<thead>
<tr>
<th align="center">操作</th>
<th align="center">代码</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">暂存</td>
<td align="center">git stash</td>
</tr>
<tr>
<td align="center">列表</td>
<td align="center">git stash list</td>
</tr>
<tr>
<td align="center">取出</td>
<td align="center">git stash pop 1</td>
</tr>
</tbody>
</table>
<h2 id="行内代码">行内代码</h2>
<p>这是一段代码 <code>a = b + c</code> 它是这样的。</p>
<hr>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://github.com/wangshushuo/abc.html">https://github.com/wangshushuo/abc.html</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%85%B6%E4%BB%96/" term="其他" label="其他" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">代码大全</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8.html" />
            <id>https://wss.cool/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2020-03-26T10:37:50+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[在参与过几个项目之后，尤其是烂项目，会觉得《代码大全》这本书真的非常棒。]]></summary>
            
                <content type="html"><![CDATA[<p>这本书的原名是《Code Complete》，指的是软件项目中的“构建”这个步。</p>
<blockquote>
<p>需求设计，架构设计，构建（写代码），测试，发布。</p>
</blockquote>
<p>内容的主要是如何把代码写好，可以应对需求变动，管理复杂度等等。</p>
<h1 id="从目录看书的结构">从目录看书的结构</h1>
<p>目录上把书分成了7个部分</p>
<ol>
<li>打好构建的基础</li>
<li>高质量的代码</li>
<li>变量</li>
<li>语句</li>
<li>改善代码</li>
<li>系统考虑</li>
<li>软件工艺</li>
</ol>
<p>首先，要在构建前打好基础。构建过程的目标之一就是高质量的代码。更进一步，以高质量的代码为前提，如何写好变量和语句。不论是新代码的构建过程中，还是已有代码的改造，或者是修复bug，都会涉及到对已有代码的改善。最后是一些更高角度的考虑。</p>
<p>第二三四部分是说如何写出高质量的代码，</p>
<blockquote>
<p>这本书主要是说如何把代码写好。这件事的意义在于，高质量的代码，能使维护开发成本变低，同时也可以快速的响应新的需求。如果代码质量低，可能会让维护成本很高，甚至限制公司的发展。
对自己来说，高质量的代码是易于维护的，可以较少加班的时间。就算是996也可以有更多的时间做别的事，比如刷算法题、学其他技术。
同时也是训练自己的编程思维，高质量的代码的思维可能也适用于架构。高质量代码得心应手之后，再思考和学习架构。
不管哪种语言哪种技术的程序员，都应该把这本书作为一个手册常放在身边，经常的翻阅。
在程序员工作的头几年，在学习和实践技术的同时，也不断学习这本书来提高能力。随着技术和能力的不断完善和提高，逐渐形成架构的意识。</p>
</blockquote>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/" term="心得与经验" label="心得与经验" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">多快好省</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/%E5%A4%9A%E5%BF%AB%E5%A5%BD%E7%9C%81.html" />
            <id>https://wss.cool/%E5%A4%9A%E5%BF%AB%E5%A5%BD%E7%9C%81.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2020-02-26T13:45:16+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[经常会有一些不懂软件开发的领导，幻想着可以“多快好省”地开发出软件。]]></summary>
            
                <content type="html"><![CDATA[<p>经常会有一些不懂软件开发的领导，幻想着可以“多快好省”地开发出软件。但通常是不现实的。</p>
<table>
<thead>
<tr>
<th align="left">幻想</th>
<th align="left">幻想</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">多</td>
<td align="left">开发的功能多</td>
</tr>
<tr>
<td align="left">快</td>
<td align="left">开发的时间短</td>
</tr>
<tr>
<td align="left">好</td>
<td align="left">软件bug少</td>
</tr>
<tr>
<td align="left">省</td>
<td align="left">又少又便宜的人力</td>
</tr>
</tbody>
</table>
<h2 id="快和省">快和省</h2>
<p>快和省是最诱人的，因为这意味着成本低，它们的对立面就是“多、好”。少人力、少时间开发出来的东西如果想“好”，那么功能就要少，如果要功能多，那就好不了，会有很多bug。</p>
<h2 id="好与多">好与多</h2>
<p>要想开发多个功能，质量又好的软件。要么多花钱，请牛人设计开发，越想快就多招人，就不能省钱。想省钱就快不起来。</p>
<p>非要多快好省的话，最后的结果肯定是“多快省”的做出来了，然后软件很多问题，很不好用，体验差。生意就会很难做，软件也维护不下去，最后钱赔光了。</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/" term="心得与经验" label="心得与经验" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Java后端开发常用工具</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/java%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7.html" />
            <id>https://wss.cool/java%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2020-01-30T01:19:02+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[常用的文档和工具的集合]]></summary>
            
                <content type="html"><![CDATA[<h2 id="spring-web-mvc-reference">Spring Web MVC Reference</h2>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">Spring Web MVC Reference</a></p>
<h2 id="spring-security-reference">Spring Security Reference</h2>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.2.2.BUILD-SNAPSHOT/reference/htmlsingle/">Spring Security Reference</a>，内容很多。OAuth2相关的内容，不包含授权服务器。</p>
<h2 id="spring-security-oauth2-boot">Spring Security OAuth2 Boot</h2>
<p><a href="https://docs.spring.io/spring-security-oauth2-boot/docs/current-SNAPSHOT/reference/htmlsingle/">Spring Security OAuth2 Boot</a>，这里介绍了：授权服务器、资源服务器、客户端、单点登录等</p>
<h2 id="spring-boot-reference">Spring Boot Reference</h2>
<p><a href="https://docs.spring.io/spring-boot/docs/2.2.4.RELEASE/reference/html/spring-boot-features.html">Spring Boot Reference</a>，内容很多。</p>
<h2 id="apachecommonslogging">apache.commons.logging</h2>
<p><a href="https://commons.apache.org/proper/commons-logging/guide.html">https://commons.apache.org/proper/commons-logging/guide.html</a></p>
<h2 id="maven仓库">Maven仓库</h2>
<p><a href="https://mvnrepository.com/">Maven仓库</a>，根据名字搜索依赖包，可以得到版本pom等信息。</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/" term="后端" label="后端" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">我的博客支持服务</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%94%AF%E6%8C%81%E6%9C%8D%E5%8A%A1.html" />
            <id>https://wss.cool/%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%94%AF%E6%8C%81%E6%9C%8D%E5%8A%A1.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2020-01-29T17:20:32+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[使用 Apache Commons Exec 和 Spring MVC 开发一个在 ubuntu 服务器上执行 shell 命令的服务，用于更新博客。]]></summary>
            
                <content type="html"><![CDATA[<h1 id="背景需求">背景需求</h1>
<p>我的博客是使用Hugo开发的，代码存放在Gitee上，每次写来新的东西后<code>git push</code>上去，然后到服务器上<code>git pull &amp;&amp; hugo</code>来更新。</p>
<p>这里会有一个需求——通过程序来执行这个更新代码并编译的操作。Gitee有WebHook功能，我需要开发一个接口绑定到WebHook，接口内执行更新操作即可。</p>
<h1 id="设计思路">设计思路</h1>
<h2 id="需求1过滤非法请求">需求1.过滤非法请求</h2>
<p>WebHook会发起一个Post请求，在Request Header中通过<code>X-Gitee-Token</code>携带令牌。所以需要一个Interceptor过滤掉没有带有这个Header的请求。</p>
<h2 id="需求2通过java执行shell命令">需求2.通过Java执行Shell命令</h2>
<p>原来是手动在命令行执行<code>git pull &amp;&amp; hugo</code>。现在需要在Java程序中执行Shell命令，所以需要一个工具来做这个事，<code>Apache Commons Exec</code>是一个这样的库。<a href="https://wowfriday.cn/java%E6%89%A7%E8%A1%8Cshell%E5%91%BD%E4%BB%A4.html">这里有一个简单的例子</a>。</p>
<h1 id="技术方案">技术方案</h1>
<ul>
<li><code>Spring Boot</code>创建项目</li>
<li><code>Spring Web</code>提供Web接口</li>
<li><code>Apache Commons Exec</code>提供执行shell命令的能力。<a href="https://commons.apache.org/proper/commons-exec/">exec官网</a>，<a href="https://commons.apache.org/proper/commons-exec/apidocs/index.html">API文档</a></li>
</ul>
<h1 id="流程图">流程图</h1>
<p><img src="/images/blogServer.svg" alt="流程图"></p>
<p>这其中有两个点是我没有做过的，一个是拦截器（检查是否带有X-Gitee-Token的），一个是执行shell命令。</p>
<h1 id="代码实现">代码实现</h1>
<h2 id="拦截器">拦截器</h2>
<p>找到了<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-handlermapping-interceptor">Spring Web MVC的文档</a>，分两步，一是实现<code>org.springframework.web.servlet</code>的<code>HandlerInterceptor</code>拦截器接口，二是配置拦截器。</p>
<h3 id="实现拦截器">实现拦截器</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GiteeInterceptorAdapter</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">){</span>
        <span class="c1">// ...
</span><span class="c1"></span>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="配置拦截器">配置拦截器</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MvcConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="n">GiteeInterceptorAdapter</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="执行shell命令">执行shell命令</h2>
<p>我把这部分单独写了一篇博客——<a href="https://wowfriday.cn/java%E6%89%A7%E8%A1%8Cshell%E5%91%BD%E4%BB%A4.html">《Java执行Shell命令》</a>。</p>
<h1 id="部署">部署</h1>
<ol>
<li>打包——使用maven的package打包</li>
<li>上传到服务器——maven的deploy用不好，需要花些时间学习一下。暂时使用scp命令上传。</li>
<li>运行Jar包——使用systemd运行，参考这篇博客<a href="https://wowfriday.cn/posts/linux-base/#%E4%BD%BF%E7%94%A8systemd%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%ADjava%E7%A8%8B%E5%BA%8F">《使用systemd启动关闭Java程序》</a>。</li>
</ol>
<h1 id="收获">收获</h1>
<ol>
<li>把一个手动工作实现了自动化。</li>
<li>通过查看<code>Spring Web MVC</code>的文档，找到并实现了拦截器的代码。</li>
<li>发现了一个工具库，通过查看它的文档，将它运用了起来。</li>
<li>第一次接触<code>OutputStream</code>和<code>ByteArrayOutputStream</code>。</li>
<li>Jar包的部署❗️</li>
</ol>
<h1 id="总结">总结</h1>
<p>从这个服务的实现可以提炼出一种解决问题的方法吗？</p>
<ul>
<li>首先是确定目标，也就是需求——自动化。</li>
<li>然后思考如何实现它——WebHook + 自己实现服务端功能——确定一个方案。</li>
<li>设计流程。</li>
<li>功能点和技术难题。</li>
<li>解决技术难题——查文档/google/stackoverflow等。</li>
<li>整个过程需要大量思考，需要多写，落实到纸上，以免遗忘和疏漏。</li>
<li>尤其是对流程的思考。</li>
<li>尤其是对难题的记录。</li>
<li>完成后</li>
<li>要总结学习到的知识点，计作“收获”</li>
<li>要总结提炼方法，使其能沉淀为经验，计作“总结”</li>
<li>更新技能树</li>
</ul>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%8A%98%E8%85%BE/" term="折腾" label="折腾" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Spring Security JWT</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/spring-security-jwt.html" />
            <id>https://wss.cool/spring-security-jwt.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2020-01-19T13:51:29+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[Spring Security Architecture Spring Security 架构，入门介绍：网址 Authentication and Access Control 应用程序安全性归结为或多或少的两个独立问题：身……]]></summary>
            
                <content type="html"><![CDATA[<h1 id="spring-security-architecture">Spring Security Architecture</h1>
<p>Spring Security 架构，入门介绍：<a href="https://spring.io/guides/topicals/spring-security-architecture/">网址</a></p>
<h2 id="authentication-and-access-control">Authentication and Access Control</h2>
<p>应用程序安全性归结为或多或少的两个独立问题：身份验证（您是谁？）和授权（您可以做什么？）。有时人们会说“访问控制”而不是“授权”，这可能会造成混淆，但是以这种方式思考可能会有所帮助，因为“授权”在其他地方超载。 Spring Security的体系结构旨在将身份验证与授权分开，并具有策略和扩展点。</p>
<h3 id="authentication">Authentication</h3>
<p>身份验证的主要策略接口是AuthenticationManager，它只有一种方法：</p>
<hr>
<h1 id="oauth-20-resource-server"> OAuth 2.0 Resource Server</h1>
<p>Spring Security supports protecting endpoints using two forms of OAuth 2.0 <a href="https://tools.ietf.org/html/rfc6750.html">Bearer Tokens</a>:</p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc7519">JWT</a></li>
<li>Opaque Tokens</li>
</ul>
<p>This is handy in circumstances where an application has delegated its authority management to an <a href="https://tools.ietf.org/html/rfc6749">authorization server</a> (for example, Okta or Ping Identity). This authorization server can be consulted by resource servers to authorize requests.</p>
<blockquote>
<p>Working samples for both <a href="https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2resourceserver">JWTs</a> and <a href="https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2resourceserver-opaque">Opaque Tokens</a> are available in the <a href="https://github.com/spring-projects/spring-security/tree/master/samples">Spring Security repository</a>.</p>
</blockquote>
<h2 id="1dependencies">1 Dependencies</h2>
<p>Most Resource Server support is collected into <code>spring-security-oauth2-resource-server</code>. However, the support for decoding and verifying JWTs is in <code>spring-security-oauth2-jose</code>, meaning that both are necessary in order to have a working resource server that supports JWT-encoded Bearer Tokens.</p>
<h2 id="2minimal-configuration-for-jwts">2 Minimal Configuration for JWTs</h2>
<p>When using <a href="https://spring.io/projects/spring-boot">Spring Boot</a>, configuring an application as a resource server consists of two basic steps. First, include the needed dependencies and second, indicate the location of the authorization server.</p>
<h3 id="specifying-the-authorization-server">Specifying the Authorization Server</h3>
<p>In a Spring Boot application, to specify which authorization server to use, simply do:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">resourceserver</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">jwt</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">issuer-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.com/issuer<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Where <a href="https://idp.example.com/issuer"><code>https://idp.example.com/issuer</code></a> is the value contained in the <code>iss</code> claim for JWT tokens that the authorization server will issue. Resource Server will use this property to further self-configure, discover the authorization server’s public keys, and subsequently validate incoming JWTs.</p>
<blockquote>
<p>To use the <code>issuer-uri</code> property, it must also be true that one of <code>https://idp.example.com/issuer/.well-known/openid-configuration</code>, <code>https://idp.example.com/.well-known/openid-configuration/issuer</code>, or <code>https://idp.example.com/.well-known/oauth-authorization-server/issuer</code> is a supported endpoint for the authorization server. This endpoint is referred to as a <a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfig">Provider Configuration</a> endpoint or a <a href="https://tools.ietf.org/html/rfc8414#section-3">Authorization Server Metadata</a> endpoint.</p>
</blockquote>
<p>And that’s it!</p>
<h3 id="startup-expectations">Startup Expectations</h3>
<p>When this property and these dependencies are used, Resource Server will automatically configure itself to validate JWT-encoded Bearer Tokens. It achieves this through a deterministic startup process:</p>
<ol>
<li>Hit the Provider Configuration or Authorization Server Metadata endpoint, processing the response for the <code>jwks_url</code> property</li>
<li>Configure the validation strategy to query <code>jwks_url</code> for valid public keys</li>
<li>Configure the validation strategy to validate each JWTs <code>iss</code> claim against <a href="https://idp.example.com"><code>https://idp.example.com</code></a>.</li>
</ol>
<p>A consequence of this process is that the authorization server must be up and receiving requests in order for Resource Server to successfully start up.</p>
<blockquote>
<p>If the authorization server is down when Resource Server queries it (given appropriate timeouts), then startup will fail.</p>
</blockquote>
<h3 id="runtime-expectations">Runtime Expectations</h3>
<p>Once the application is started up, Resource Server will attempt to process any request containing an <code>Authorization: Bearer</code> header:</p>
<pre><code>GET / HTTP/1.1
Authorization: Bearer some-token-value # Resource Server will process this
</code></pre><p>So long as this scheme is indicated, Resource Server will attempt to process the request according to the Bearer Token specification. Given a well-formed JWT, Resource Server will:</p>
<ol>
<li>Validate its signature against a public key obtained from the <code>jwks_url</code> endpoint during startup and matched against the JWTs header</li>
<li>Validate the JWTs <code>exp</code> and <code>nbf</code> timestamps and the JWTs <code>iss</code> claim, and</li>
<li>Map each scope to an authority with the prefix <code>SCOPE_</code>.</li>
</ol>
<blockquote>
<p>As the authorization server makes available new keys, Spring Security will automatically rotate the keys used to validate the JWT tokens.</p>
</blockquote>
<p>The resulting <code>Authentication#getPrincipal</code>, by default, is a Spring Security <code>Jwt</code> object, and <code>Authentication#getName</code> maps to the JWT’s <code>sub</code> property, if one is present. From here, consider jumping to:</p>
<ul>
<li><a href="#oauth2resourceserver-jwt-jwkseturi" title="12.3.3 Specifying the Authorization Server JWK Set Uri Directly">How to Configure without Tying Resource Server startup to an authorization server’s availability</a></li>
<li><a href="#oauth2resourceserver-jwt-sansboot" title="12.3.4 Overriding or Replacing Boot Auto Configuration">How to Configure without Spring Boot</a></li>
</ul>
<h2 id="3specifying-the-authorization-server-jwk-set-uri-directly">3 Specifying the Authorization Server JWK Set Uri Directly</h2>
<p>If the authorization server doesn’t support any configuration endpoints, or if Resource Server must be able to start up independently from the authorization server, then the <code>jwk-set-uri</code> can be supplied as well:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">resourceserver</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">jwt</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">issuer-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.com<span class="w">
</span><span class="w"> </span><span class="k">jwk-set-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.com/.well-known/jwks.json<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>The JWK Set uri is not standardized, but can typically be found in the authorization server’s documentation</p>
</blockquote>
<p>Consequently, Resource Server will not ping the authorization server at startup. We still specify the <code>issuer-uri</code> so that Resource Server still validates the <code>iss</code> claim on incoming JWTs.</p>
<blockquote>
<p>This property can also be supplied directly on the <a href="#oauth2resourceserver-jwt-jwkseturi-dsl" title="Using jwkSetUri()">DSL</a>.</p>
</blockquote>
<h2 id="4overriding-or-replacing-boot-auto-configuration">4 Overriding or Replacing Boot Auto Configuration</h2>
<p>There are two <code>@Bean</code> s that Spring Boot generates on Resource Server’s behalf. The first is a <code>WebSecurityConfigurerAdapter</code> that configures the app as a resource server. When including <code>spring-security-oauth2-jose</code>, this <code>WebSecurityConfigurerAdapter</code> looks like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">http</span>
        <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
            <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
            <span class="o">.</span><span class="na">and</span><span class="o">()</span>
        <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">(</span><span class="n">OAuth2ResourceServerConfigurer</span><span class="o">::</span><span class="n">jwt</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If the application doesn’t expose a <code>WebSecurityConfigurerAdapter</code> bean, then Spring Boot will expose the above default one. Replacing this is as simple as exposing the bean within the application:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCustomSecurityConfiguration</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/messages/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_message:read&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">jwt</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">jwtAuthenticationConverter</span><span class="o">(</span><span class="n">myConverter</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above requires the scope of <code>message:read</code> for any URL that starts with <code>/messages/</code>. Methods on the <code>oauth2ResourceServer</code> DSL will also override or replace auto configuration. For example, the second <code>@Bean</code> Spring Boot creates is a <code>JwtDecoder</code>, which decodes <code>String</code> tokens into validated instances of <code>Jwt</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">JwtDecoders</span><span class="o">.</span><span class="na">fromIssuerLocation</span><span class="o">(</span><span class="n">issuerUri</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Calling <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/oauth2/jwt/JwtDecoders.html#fromIssuerLocation-java.lang.String-"><code>JwtDecoders#fromIssuerLocation</code></a> is what invokes the Provider Configuration or Authorization Server Metadata endpoint in order to derive the JWK Set Uri.</p>
</blockquote>
<p>If the application doesn’t expose a <code>JwtDecoder</code> bean, then Spring Boot will expose the above default one. And its configuration can be overridden using <code>jwkSetUri()</code> or replaced using <code>decoder()</code>.</p>
<h3 id="using-jwkseturi">Using <code>jwkSetUri()</code></h3>
<p>An authorization server’s JWK Set Uri can be configured <a href="#oauth2resourceserver-jwt-jwkseturi" title="12.3.3 Specifying the Authorization Server JWK Set Uri Directly">as a configuration property</a> or it can be supplied in the DSL:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredJwkSetUri</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">jwt</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">jwkSetUri</span><span class="o">(</span><span class="s">&#34;https://idp.example.com/.well-known/jwks.json&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Using <code>jwkSetUri()</code> takes precedence over any configuration property.</p>
<h3 id="using-decoder">Using <code>decoder()</code></h3>
<p>More powerful than <code>jwkSetUri()</code> is <code>decoder()</code>, which will completely replace any Boot auto configuration of <code>JwtDecoder</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredJwtDecoder</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">jwt</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">decoder</span><span class="o">(</span><span class="n">myCustomDecoder</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This is handy when deeper configuration, like <a href="#oauth2resourceserver-jwt-validation" title="12.3.9 Configuring Validation">validation</a>, <a href="#oauth2resourceserver-jwt-claimsetmapping" title="12.3.10 Configuring Claim Set Mapping">mapping</a>, or <a href="#oauth2resourceserver-jwt-timeouts" title="12.3.11 Configuring Timeouts">request timeouts</a>, is necessary.</p>
<h3 id="exposing-a-jwtdecoder-bean">Exposing a <code>JwtDecoder</code> <code>@Bean</code></h3>
<p>Or, exposing a <code>JwtDecoder</code> <code>@Bean</code> has the same effect as <code>decoder()</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withJwkSetUri</span><span class="o">(</span><span class="n">jwkSetUri</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="5configuring-trusted-algorithms">5 Configuring Trusted Algorithms</h2>
<p>By default, <code>NimbusJwtDecoder</code>, and hence Resource Server, will only trust and verify tokens using <code>RS256</code>. You can customize this via <a href="#oauth2resourceserver-jwt-boot-algorithm" title="Via Spring Boot">Spring Boot</a>, <a href="#oauth2resourceserver-jwt-decoder-builder" title="Using a Builder">the NimbusJwtDecoder builder</a>, or from the <a href="#oauth2resourceserver-jwt-decoder-jwk-response" title="From JWK Set response">JWK Set response</a>.</p>
<h3 id="via-spring-boot">Via Spring Boot</h3>
<p>The simplest way to set the algorithm is as a property:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">resourceserver</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">jwt</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">jws-algorithm</span><span class="p">:</span><span class="w"> </span>RS512<span class="w">
</span><span class="w">          </span><span class="k">jwk-set-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.org/.well-known/jwks.json<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="using-a-builder">Using a Builder</h3>
<p>For greater power, though, we can use a builder that ships with <code>NimbusJwtDecoder</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">fromJwkSetUri</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">jwkSetUri</span><span class="o">)</span>
            <span class="o">.</span><span class="na">jwsAlgorithm</span><span class="o">(</span><span class="n">RS512</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Calling <code>jwsAlgorithm</code> more than once will configure <code>NimbusJwtDecoder</code> to trust more than one algorithm, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">fromJwkSetUri</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">jwkSetUri</span><span class="o">)</span>
            <span class="o">.</span><span class="na">jwsAlgorithm</span><span class="o">(</span><span class="n">RS512</span><span class="o">).</span><span class="na">jwsAlgorithm</span><span class="o">(</span><span class="n">EC512</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Or, you can call <code>jwsAlgorithms</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">fromJwkSetUri</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">jwkSetUri</span><span class="o">)</span>
            <span class="o">.</span><span class="na">jwsAlgorithms</span><span class="o">(</span><span class="n">algorithms</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="n">algorithms</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">RS512</span><span class="o">);</span>
                    <span class="n">algorithms</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">EC512</span><span class="o">);</span>
            <span class="o">}).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="from-jwk-set-response">From JWK Set response</h3>
<p>Since Spring Security’s JWT support is based off of Nimbus, you can use all it’s great features as well. For example, Nimbus has a <code>JWSKeySelector</code> implementation that will select the set of algorithms based on the JWK Set URI response. You can use it to generate a <code>NimbusJwtDecoder</code> like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// makes a request to the JWK Set endpoint
</span><span class="c1"></span>    <span class="n">JWSKeySelector</span> <span class="o">&lt;</span><span class="n">securitycontext</span><span class="o">&gt;</span><span class="n">jwsKeySelector</span> <span class="o">=</span>
            <span class="n">JWSAlgorithmFamilyJWSKeySelector</span><span class="o">.</span><span class="na">fromJWKSetURL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">jwkSetUrl</span><span class="o">);</span>

    <span class="n">DefaultJWTProcessor</span> <span class="o">&lt;</span><span class="n">securitycontext</span><span class="o">&gt;</span><span class="n">jwtProcessor</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">DefaultJWTProcessor</span><span class="o">&lt;&gt;();</span>
    <span class="n">jwtProcessor</span><span class="o">.</span><span class="na">setJWSKeySelector</span><span class="o">(</span><span class="n">jwsKeySelector</span><span class="o">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">NimbusJwtDecoder</span><span class="o">(</span><span class="n">jwtProcessor</span><span class="o">);</span>
<span class="o">}&lt;/</span><span class="n">securitycontext</span><span class="o">&gt;&lt;/</span><span class="n">securitycontext</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="6trusting-a-single-asymmetric-key">6 Trusting a Single Asymmetric Key</h2>
<p>Simpler than backing a Resource Server with a JWK Set endpoint is to hard-code an RSA public key. The public key can be provided via <a href="#oauth2resourceserver-jwt-decoder-public-key-boot" title="Via Spring Boot">Spring Boot</a> or by <a href="#oauth2resourceserver-jwt-decoder-public-key-builder" title="Using a Builder">Using a Builder</a>.</p>
<h3 id="via-spring-boot-1">Via Spring Boot</h3>
<p>Specifying a key via Spring Boot is quite simple. The key’s location can be specified like so:</p>
<pre><code>spring:
 security:
 oauth2:
 resourceserver:
 jwt:
 public-key-location: classpath:my-key.pub
</code></pre><p>Or, to allow for a more sophisticated lookup, you can post-process the <code>RsaKeyConversionServicePostProcessor</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">BeanFactoryPostProcessor</span> <span class="nf">conversionServiceCustomizer</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">beanFactory</span> <span class="o">-&gt;</span>
        <span class="n">beanFactory</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">RsaKeyConversionServicePostProcessor</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setResourceLoader</span><span class="o">(</span><span class="k">new</span> <span class="n">CustomResourceLoader</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Specify your key’s location:</p>
<pre><code>key.location: hfds://my-key.pub
</code></pre><p>And then autowire the value:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${key.location}&#34;</span><span class="o">)</span>
<span class="n">RSAPublicKey</span> <span class="n">key</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="using-a-builder-1">Using a Builder</h3>
<p>To wire an <code>RSAPublicKey</code> directly, you can simply use the appropriate <code>NimbusJwtDecoder</code> builder, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withPublicKey</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">key</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="7trusting-a-single-symmetric-key">7 Trusting a Single Symmetric Key</h2>
<p>Using a single symmetric key is also simple. You can simply load in your <code>SecretKey</code> and use the appropriate <code>NimbusJwtDecoder</code> builder, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withSecretKey</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">key</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="8configuring-authorization">8 Configuring Authorization</h2>
<p>A JWT that is issued from an OAuth 2.0 Authorization Server will typically either have a <code>scope</code> or <code>scp</code> attribute, indicating the scopes (or authorities) it’s been granted, for example: <code>{ …​, &quot;scope&quot; : &quot;messages contacts&quot;}</code> When this is the case, Resource Server will attempt to coerce these scopes into a list of granted authorities, prefixing each scope with the string &quot;SCOPE_&quot;. This means that to protect an endpoint or method with a scope derived from a JWT, the corresponding expressions should include this prefix:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredJwkSetUri</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">(</span><span class="n">authorizeRequests</span> <span class="o">-&gt;</span> <span class="n">authorizeRequests</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/contacts/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_contacts&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/messages/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_messages&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
            <span class="o">)</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">(</span><span class="n">OAuth2ResourceServerConfigurer</span><span class="o">::</span><span class="n">jwt</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Or similarly with method security:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&#34;hasAuthority(&#39;SCOPE_messages&#39;)&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">List</span> <span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span><span class="n">getMessages</span><span class="o">(...)</span> <span class="o">{}&lt;/</span><span class="n">message</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="extracting-authorities-manually">Extracting Authorities Manually</h3>
<p>However, there are a number of circumstances where this default is insufficient. For example, some authorization servers don’t use the <code>scope</code> attribute, but instead have their own custom attribute. Or, at other times, the resource server may need to adapt the attribute or a composition of attributes into internalized authorities. To this end, the DSL exposes <code>jwtAuthenticationConverter()</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredJwkSetUri</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">jwt</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">jwtAuthenticationConverter</span><span class="o">(</span><span class="n">grantedAuthoritiesExtractor</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">Converter</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">,</span> <span class="n">AbstractAuthenticationToken</span><span class="o">&gt;</span> <span class="nf">grantedAuthoritiesExtractor</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">JwtAuthenticationConverter</span> <span class="n">jwtAuthenticationConverter</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">JwtAuthenticationConverter</span><span class="o">();</span>
    <span class="n">jwtAuthenticationConverter</span><span class="o">.</span><span class="na">setJwtGrantedAuthoritiesConverter</span>
            <span class="o">(</span><span class="k">new</span> <span class="n">GrantedAuthoritiesExtractor</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">jwtAuthenticationConveter</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>which is responsible for converting a <code>Jwt</code> into an <code>Authentication</code>. As part of its configuration, we can supply a subsidiary converter to go from <code>Jwt</code> to a <code>Collection</code> of granted authorities. That final converter might be something like <code>GrantedAuthoritiesExtractor</code> below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="kd">class</span> <span class="nc">GrantedAuthoritiesExtractor</span>
        <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">convert</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">jwt</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span>
                <span class="n">jwt</span><span class="o">.</span><span class="na">getClaims</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;mycustomclaim&#34;</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">authorities</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">SimpleGrantedAuthority</span><span class="o">::</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>For more flexibility, the DSL supports entirely replacing the converter with any class that implements <code>Converter&lt;jwt, abstractauthenticationtoken=&quot;&quot;&gt;</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomAuthenticationConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">,</span> <span class="n">AbstractAuthenticationToken</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">AbstractAuthenticationToken</span> <span class="nf">convert</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">jwt</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">CustomAuthenticationToken</span><span class="o">(</span><span class="n">jwt</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="9configuring-validation">9 Configuring Validation</h2>
<p>Using <a href="#oauth2resourceserver-jwt-minimalconfiguration" title="12.3.2 Minimal Configuration for JWTs">minimal Spring Boot configuration</a>, indicating the authorization server’s issuer uri, Resource Server will default to verifying the <code>iss</code> claim as well as the <code>exp</code> and <code>nbf</code> timestamp claims. In circumstances where validation needs to be customized, Resource Server ships with two standard validators and also accepts custom <code>OAuth2TokenValidator</code> instances.</p>
<h3 id="customizing-timestamp-validation">Customizing Timestamp Validation</h3>
<p>JWT’s typically have a window of validity, with the start of the window indicated in the <code>nbf</code> claim and the end indicated in the <code>exp</code> claim. However, every server can experience clock drift, which can cause tokens to appear expired to one server, but not to another. This can cause some implementation heartburn as the number of collaborating servers increases in a distributed system. Resource Server uses <code>JwtTimestampValidator</code> to verify a token’s validity window, and it can be configured with a <code>clockSkew</code> to alleviate the above problem:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
     <span class="n">NimbusJwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="o">(</span><span class="n">NimbusJwtDecoder</span><span class="o">)</span>
             <span class="n">JwtDecoders</span><span class="o">.</span><span class="na">fromIssuerLocation</span><span class="o">(</span><span class="n">issuerUri</span><span class="o">);</span>

     <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">withClockSkew</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DelegatingOAuth2TokenValidator</span><span class="o">&lt;&gt;(</span>
            <span class="k">new</span> <span class="n">JwtTimestampValidator</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="n">60</span><span class="o">)),</span>
            <span class="k">new</span> <span class="n">IssuerValidator</span><span class="o">(</span><span class="n">issuerUri</span><span class="o">));</span>

     <span class="n">jwtDecoder</span><span class="o">.</span><span class="na">setJwtValidator</span><span class="o">(</span><span class="n">withClockSkew</span><span class="o">);</span>

     <span class="k">return</span> <span class="n">jwtDecoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>By default, Resource Server configures a clock skew of 30 seconds.</p>
</blockquote>
<h3 id="configuring-a-custom-validator">Configuring a Custom Validator</h3>
<p>Adding a check for the <code>aud</code> claim is simple with the <code>OAuth2TokenValidator</code> API:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AudienceValidator</span> <span class="kd">implements</span> <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">OAuth2Error</span> <span class="n">error</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OAuth2Error</span><span class="o">(</span><span class="s">&#34;invalid_token&#34;</span><span class="o">,</span> <span class="s">&#34;The required audience is missing&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">OAuth2TokenValidatorResult</span> <span class="nf">validate</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">jwt</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">jwt</span><span class="o">.</span><span class="na">getAudience</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;messaging&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">OAuth2TokenValidatorResult</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">OAuth2TokenValidatorResult</span><span class="o">.</span><span class="na">failure</span><span class="o">(</span><span class="n">error</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then, to add into a resource server, it’s a matter of specifying the <code>JwtDecoder</code> instance:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">NimbusJwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="o">(</span><span class="n">NimbusJwtDecoder</span><span class="o">)</span>
        <span class="n">JwtDecoders</span><span class="o">.</span><span class="na">fromIssuerLocation</span><span class="o">(</span><span class="n">issuerUri</span><span class="o">);</span>

    <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">audienceValidator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AudienceValidator</span><span class="o">();</span>
    <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">withIssuer</span> <span class="o">=</span> <span class="n">JwtValidators</span><span class="o">.</span><span class="na">createDefaultWithIssuer</span><span class="o">(</span><span class="n">issuerUri</span><span class="o">);</span>
    <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">withAudience</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DelegatingOAuth2TokenValidator</span><span class="o">&lt;&gt;(</span><span class="n">withIssuer</span><span class="o">,</span> <span class="n">audienceValidator</span><span class="o">);</span>

    <span class="n">jwtDecoder</span><span class="o">.</span><span class="na">setJwtValidator</span><span class="o">(</span><span class="n">withAudience</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">jwtDecoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="10configuring-claim-set-mapping">10 Configuring Claim Set Mapping</h2>
<p>Spring Security uses the <a href="https://bitbucket.org/connect2id/nimbus-jose-jwt/wiki/Home">Nimbus</a> library for parsing JWTs and validating their signatures. Consequently, Spring Security is subject to Nimbus’s interpretation of each field value and how to coerce each into a Java type. For example, because Nimbus remains Java 7 compatible, it doesn’t use <code>Instant</code> to represent timestamp fields. And it’s entirely possible to use a different library or for JWT processing, which may make its own coercion decisions that need adjustment. Or, quite simply, a resource server may want to add or remove claims from a JWT for domain-specific reasons. For these purposes, Resource Server supports mapping the JWT claim set with <code>MappedJwtClaimSetConverter</code>.</p>
<h3 id="customizing-the-conversion-of-a-single-claim">Customizing the Conversion of a Single Claim</h3>
<p>By default, <code>MappedJwtClaimSetConverter</code> will attempt to coerce claims into the following types:</p>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Java Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aud</code></td>
<td><code>Collection</code></td>
</tr>
<tr>
<td><code>exp</code></td>
<td><code>Instant</code></td>
</tr>
<tr>
<td><code>iat</code></td>
<td><code>Instant</code></td>
</tr>
<tr>
<td><code>iss</code></td>
<td><code>String</code></td>
</tr>
<tr>
<td><code>jti</code></td>
<td><code>String</code></td>
</tr>
<tr>
<td><code>nbf</code></td>
<td><code>Instant</code></td>
</tr>
<tr>
<td><code>sub</code></td>
<td><code>String</code></td>
</tr>
</tbody>
</table>
<p>An individual claim’s conversion strategy can be configured using <code>MappedJwtClaimSetConverter.withDefaults</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">NimbusJwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withJwkSetUri</span><span class="o">(</span><span class="n">jwkSetUri</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MappedJwtClaimSetConverter</span> <span class="n">converter</span> <span class="o">=</span> <span class="n">MappedJwtClaimSetConverter</span>
            <span class="o">.</span><span class="na">withDefaults</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">&#34;sub&#34;</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">lookupUserIdBySub</span><span class="o">));</span>
    <span class="n">jwtDecoder</span><span class="o">.</span><span class="na">setClaimSetConverter</span><span class="o">(</span><span class="n">converter</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">jwtDecoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This will keep all the defaults, except it will override the default claim converter for <code>sub</code>.</p>
<h3 id="adding-a-claim">Adding a Claim</h3>
<p><code>MappedJwtClaimSetConverter</code> can also be used to add a custom claim, for example, to adapt to an existing system:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">MappedJwtClaimSetConverter</span><span class="o">.</span><span class="na">withDefaults</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">&#34;custom&#34;</span><span class="o">,</span> <span class="n">custom</span> <span class="o">-&gt;</span> <span class="s">&#34;value&#34;</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="removing-a-claim">Removing a Claim</h3>
<p>And removing a claim is also simple, using the same API:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">MappedJwtClaimSetConverter</span><span class="o">.</span><span class="na">withDefaults</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">&#34;legacyclaim&#34;</span><span class="o">,</span> <span class="n">legacy</span> <span class="o">-&gt;</span> <span class="kc">null</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="renaming-a-claim">Renaming a Claim</h3>
<p>In more sophisticated scenarios, like consulting multiple claims at once or renaming a claim, Resource Server accepts any class that implements <code>Converter&lt;map&lt;string, object=&quot;&quot;&gt;, Map&lt;string,object&gt;&gt;</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsernameSubClaimAdapter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MappedJwtClaimSetConverter</span> <span class="n">delegate</span> <span class="o">=</span>
            <span class="n">MappedJwtClaimSetConverter</span><span class="o">.</span><span class="na">withDefaults</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">emptyMap</span><span class="o">());</span>

    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">convert</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">claims</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">convertedClaims</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">delegate</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="n">claims</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">convertedClaims</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;user_name&#34;</span><span class="o">);</span>
        <span class="n">convertedClaims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;sub&#34;</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">convertedClaims</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>And then, the instance can be supplied like normal:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">NimbusJwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withJwkSetUri</span><span class="o">(</span><span class="n">jwkSetUri</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="n">jwtDecoder</span><span class="o">.</span><span class="na">setClaimSetConverter</span><span class="o">(</span><span class="k">new</span> <span class="n">UsernameSubClaimAdapter</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">jwtDecoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="11configuring-timeouts">11 Configuring Timeouts</h2>
<p>By default, Resource Server uses connection and socket timeouts of 30 seconds each for coordinating with the authorization server. This may be too short in some scenarios. Further, it doesn’t take into account more sophisticated patterns like back-off and discovery. To adjust the way in which Resource Server connects to the authorization server, <code>NimbusJwtDecoder</code> accepts an instance of <code>RestOperations</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">(</span><span class="n">RestTemplateBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">RestOperations</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">builder</span>
            <span class="o">.</span><span class="na">setConnectionTimeout</span><span class="o">(</span><span class="n">60000</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setReadTimeout</span><span class="o">(</span><span class="n">60000</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">NimbusJwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="n">NimbusJwtDecoder</span><span class="o">.</span><span class="na">withJwkSetUri</span><span class="o">(</span><span class="n">jwkSetUri</span><span class="o">).</span><span class="na">restOperations</span><span class="o">(</span><span class="n">rest</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">jwtDecoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="12minimal-configuration-for-introspection">12 Minimal Configuration for Introspection</h2>
<p>Typically, an opaque token can be verified via an <a href="https://tools.ietf.org/html/rfc7662">OAuth 2.0 Introspection Endpoint</a>, hosted by the authorization server. This can be handy when revocation is a requirement. When using <a href="https://spring.io/projects/spring-boot">Spring Boot</a>, configuring an application as a resource server that uses introspection consists of two basic steps. First, include the needed dependencies and second, indicate the introspection endpoint details.</p>
<h3 id="specifying-the-authorization-server-1">Specifying the Authorization Server</h3>
<p>To specify where the introspection endpoint is, simply do:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">resourceserver</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">opaque-token</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">introspection-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.com/introspect<span class="w">
</span><span class="w"> </span><span class="k">client-id</span><span class="p">:</span><span class="w"> </span>client<span class="w">
</span><span class="w"> </span><span class="k">client-secret</span><span class="p">:</span><span class="w"> </span>secret<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Where <a href="https://idp.example.com/introspect"><code>https://idp.example.com/introspect</code></a> is the introspection endpoint hosted by your authorization server and <code>client-id</code> and <code>client-secret</code> are the credentials needed to hit that endpoint. Resource Server will use these properties to further self-configure and subsequently validate incoming JWTs.</p>
<blockquote>
<p>When using introspection, the authorization server’s word is the law. If the authorization server responses that the token is valid, then it is.</p>
</blockquote>
<p>And that’s it!</p>
<h3 id="startup-expectations-1">Startup Expectations</h3>
<p>When this property and these dependencies are used, Resource Server will automatically configure itself to validate Opaque Bearer Tokens. This startup process is quite a bit simpler than for JWTs since no endpoints need to be discovered and no additional validation rules get added.</p>
<h3 id="runtime-expectations-1">Runtime Expectations</h3>
<p>Once the application is started up, Resource Server will attempt to process any request containing an <code>Authorization: Bearer</code> header:</p>
<pre><code>GET / HTTP/1.1
Authorization: Bearer some-token-value # Resource Server will process this
</code></pre><p>So long as this scheme is indicated, Resource Server will attempt to process the request according to the Bearer Token specification. Given an Opaque Token, Resource Server will</p>
<ol>
<li>Query the provided introspection endpoint using the provided credentials and the token</li>
<li>Inspect the response for an <code>{ 'active' : true }</code> attribute</li>
<li>Map each scope to an authority with the prefix <code>SCOPE_</code></li>
</ol>
<p>The resulting <code>Authentication#getPrincipal</code>, by default, is a Spring Security <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/oauth2/core/OAuth2AuthenticatedPrincipal.html"><code>OAuth2AuthenticatedPrincipal</code></a> object, and <code>Authentication#getName</code> maps to the token’s <code>sub</code> property, if one is present. From here, you may want to jump to:</p>
<ul>
<li><a href="#oauth2resourceserver-opaque-attributes" title="12.3.13 Looking Up Attributes Post-Authentication">Looking Up Attributes Post-Authentication</a></li>
<li><a href="#oauth2resourceserver-opaque-authorization-extraction" title="Extracting Authorities Manually">Extracting Authorities Manually</a></li>
<li><a href="#oauth2resourceserver-opaque-jwt-introspector" title="12.3.17 Using Introspection with JWTs">Using Introspection with JWTs</a></li>
</ul>
<h2 id="13looking-up-attributes-post-authentication">13 Looking Up Attributes Post-Authentication</h2>
<p>Once a token is authenticated, an instance of <code>BearerTokenAuthentication</code> is set in the <code>SecurityContext</code>. This means that it’s available in <code>@Controller</code> methods when using <code>@EnableWebMvc</code> in your configuration:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/foo&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">foo</span><span class="o">(</span><span class="n">BearerTokenAuthentication</span> <span class="n">authentication</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getTokenAttributes</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;sub&#34;</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34; is the subject&#34;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Since <code>BearerTokenAuthentication</code> holds an <code>OAuth2AuthenticatedPrincipal</code>, that also means that it’s available to controller methods, too:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/foo&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">foo</span><span class="o">(</span><span class="nd">@AuthenticationPrincipal</span> <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">principal</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">principal</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;sub&#34;</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34; is the subject&#34;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="looking-up-attributes-via-spel">Looking Up Attributes Via SpEL</h3>
<p>Of course, this also means that attributes can be accessed via SpEL. For example, if using <code>@EnableGlobalMethodSecurity</code> so that you can use <code>@PreAuthorize</code> annotations, you can do:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&#34;principal?.attributes[&#39;sub&#39;] == &#39;foo&#39;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">forFoosEyesOnly</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;foo&#34;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="14overriding-or-replacing-boot-auto-configuration">14 Overriding or Replacing Boot Auto Configuration</h2>
<p>There are two <code>@Bean</code> s that Spring Boot generates on Resource Server’s behalf. The first is a <code>WebSecurityConfigurerAdapter</code> that configures the app as a resource server. When use Opaque Token, this <code>WebSecurityConfigurerAdapter</code> looks like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">http</span>
        <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
            <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
            <span class="o">.</span><span class="na">and</span><span class="o">()</span>
        <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">(</span><span class="n">OAuth2ResourceServerConfigurer</span><span class="o">::</span><span class="n">opaqueToken</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If the application doesn’t expose a <code>WebSecurityConfigurerAdapter</code> bean, then Spring Boot will expose the above default one. Replacing this is as simple as exposing the bean within the application:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCustomSecurityConfiguration</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/messages/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_message:read&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">opaqueToken</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">introspector</span><span class="o">(</span><span class="n">myIntrospector</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above requires the scope of <code>message:read</code> for any URL that starts with <code>/messages/</code>. Methods on the <code>oauth2ResourceServer</code> DSL will also override or replace auto configuration. For example, the second <code>@Bean</code> Spring Boot creates is an <code>OpaqueTokenIntrospector</code>, which decodes <code>String</code> tokens into validated instances of <code>OAuth2AuthenticatedPrincipal</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="n">introspectionUri</span><span class="o">,</span> <span class="n">clientId</span><span class="o">,</span> <span class="n">clientSecret</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If the application doesn’t expose a <code>OpaqueTokenIntrospector</code> bean, then Spring Boot will expose the above default one. And its configuration can be overridden using <code>introspectionUri()</code> and <code>introspectionClientCredentials()</code> or replaced using <code>introspector()</code>.</p>
<h3 id="using-introspectionuri">Using <code>introspectionUri()</code></h3>
<p>An authorization server’s Introspection Uri can be configured <a href="#">as a configuration property</a> or it can be supplied in the DSL:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredIntrospectionUri</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">opaqueToken</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">introspectionUri</span><span class="o">(</span><span class="s">&#34;https://idp.example.com/introspect&#34;</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">introspectionClientCredentials</span><span class="o">(</span><span class="s">&#34;client&#34;</span><span class="o">,</span> <span class="s">&#34;secret&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Using <code>introspectionUri()</code> takes precedence over any configuration property.</p>
<h3 id="using-introspector">Using <code>introspector()</code></h3>
<p>More powerful than <code>introspectionUri()</code> is <code>introspector()</code>, which will completely replace any Boot auto configuration of <code>OpaqueTokenIntrospector</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectlyConfiguredIntrospector</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
                <span class="o">.</span><span class="na">opaqueToken</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">introspector</span><span class="o">(</span><span class="n">myCustomIntrospector</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This is handy when deeper configuration, like <a href="#oauth2resourceserver-opaque-authorization-extraction" title="Extracting Authorities Manually">authority mapping</a>, <a href="#oauth2resourceserver-opaque-jwt-introspector" title="12.3.17 Using Introspection with JWTs">JWT revocation</a>, or <a href="#oauth2resourceserver-opaque-timeouts" title="12.3.16 Configuring Timeouts">request timeouts</a>, is necessary.</p>
<h3 id="exposing-a-opaquetokenintrospector-bean">Exposing a <code>OpaqueTokenIntrospector</code> <code>@Bean</code></h3>
<p>Or, exposing a <code>OpaqueTokenIntrospector</code> <code>@Bean</code> has the same effect as <code>introspector()</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="n">introspectionUri</span><span class="o">,</span> <span class="n">clientId</span><span class="o">,</span> <span class="n">clientSecret</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="15configuring-authorization">15 Configuring Authorization</h2>
<p>An OAuth 2.0 Introspection endpoint will typically return a <code>scope</code> attribute, indicating the scopes (or authorities) it’s been granted, for example: <code>{ …​, &quot;scope&quot; : &quot;messages contacts&quot;}</code> When this is the case, Resource Server will attempt to coerce these scopes into a list of granted authorities, prefixing each scope with the string &quot;SCOPE_&quot;. This means that to protect an endpoint or method with a scope derived from an Opaque Token, the corresponding expressions should include this prefix:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MappedAuthorities</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">(</span><span class="n">authorizeRequests</span> <span class="o">-&gt;</span> <span class="n">authorizeRequests</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/contacts/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_contacts&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">mvcMatchers</span><span class="o">(</span><span class="s">&#34;/messages/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">&#34;SCOPE_messages&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
            <span class="o">)</span>
            <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">(</span><span class="n">OAuth2ResourceServerConfigurer</span><span class="o">::</span><span class="n">opaqueToken</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Or similarly with method security:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&#34;hasAuthority(&#39;SCOPE_messages&#39;)&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="nf">getMessages</span><span class="o">(...)</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="extracting-authorities-manually-1">Extracting Authorities Manually</h3>
<p>By default, Opaque Token support will extract the scope claim from an introspection response and parse it into individual <code>GrantedAuthority</code> instances. For example, if the introspection response were:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;active&#34;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&#34;scope&#34;</span> <span class="p">:</span> <span class="s2">&#34;message:read message:write&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then Resource Server would generate an <code>Authentication</code> with two authorities, one for <code>message:read</code> and the other for <code>message:write</code>. This can, of course, be customized using a custom <code>OpaqueTokenIntrospector</code> that takes a look at the attribute set and converts in its own way:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomAuthoritiesOpaqueTokenIntrospector</span> <span class="kd">implements</span> <span class="n">OpaqueTokenIntrospector</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">OpaqueTokenIntrospector</span> <span class="n">delegate</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="s">&#34;https://idp.example.org/introspect&#34;</span><span class="o">,</span> <span class="s">&#34;client&#34;</span><span class="o">,</span> <span class="s">&#34;secret&#34;</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="nf">introspect</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">principal</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">delegate</span><span class="o">.</span><span class="na">introspect</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">DefaultOAuth2AuthenticatedPrincipal</span><span class="o">(</span>
                <span class="n">principal</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">principal</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">(),</span> <span class="n">extractAuthorities</span><span class="o">(</span><span class="n">principal</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">extractAuthorities</span><span class="o">(</span><span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">principal</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">scopes</span> <span class="o">=</span> <span class="n">principal</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">OAuth2IntrospectionClaimNames</span><span class="o">.</span><span class="na">SCOPE</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">scopes</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">SimpleGrantedAuthority</span><span class="o">::</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Thereafter, this custom introspector can be configured simply by exposing it as a <code>@Bean</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">CustomAuthoritiesOpaqueTokenIntrospector</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="16configuring-timeouts">16 Configuring Timeouts</h2>
<p>By default, Resource Server uses connection and socket timeouts of 30 seconds each for coordinating with the authorization server. This may be too short in some scenarios. Further, it doesn’t take into account more sophisticated patterns like back-off and discovery. To adjust the way in which Resource Server connects to the authorization server, <code>NimbusOpaqueTokenIntrospector</code> accepts an instance of <code>RestOperations</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">(</span><span class="n">RestTemplateBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">RestOperations</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">builder</span>
            <span class="o">.</span><span class="na">basicAuthentication</span><span class="o">(</span><span class="n">clientId</span><span class="o">,</span> <span class="n">clientSecret</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setConnectionTimeout</span><span class="o">(</span><span class="n">60000</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setReadTimeout</span><span class="o">(</span><span class="n">60000</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="n">introspectionUri</span><span class="o">,</span> <span class="n">rest</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="17using-introspection-with-jwts">17 Using Introspection with JWTs</h2>
<p>A common question is whether or not introspection is compatible with JWTs. Spring Security’s Opaque Token support has been designed to not care about the format of the token — it will gladly pass any token to the introspection endpoint provided. So, let’s say that you’ve got a requirement that requires you to check with the authorization server on each request, in case the JWT has been revoked. Even though you are using the JWT format for the token, your validation method is introspection, meaning you’d want to do:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">security</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">oauth2</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">resourceserver</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">opaque-token</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">introspection-uri</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//idp.example.org/introspection<span class="w">
</span><span class="w"> </span><span class="k">client-id</span><span class="p">:</span><span class="w"> </span>client<span class="w">
</span><span class="w"> </span><span class="k">client-secret</span><span class="p">:</span><span class="w"> </span>secret<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>In this case, the resulting <code>Authentication</code> would be <code>BearerTokenAuthentication</code>. Any attributes in the corresponding <code>OAuth2AuthenticatedPrincipal</code> would be whatever was returned by the introspection endpoint. But, let’s say that, oddly enough, the introspection endpoint only returns whether or not the token is active. Now what? In this case, you can create a custom <code>OpaqueTokenIntrospector</code> that still hits the endpoint, but then updates the returned principal to have the JWTs claims as the attributes:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtOpaqueTokenIntrospector</span> <span class="kd">implements</span> <span class="n">OpaqueTokenIntrospector</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">OpaqueTokenIntrospector</span> <span class="n">delegate</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="s">&#34;https://idp.example.org/introspect&#34;</span><span class="o">,</span> <span class="s">&#34;client&#34;</span><span class="o">,</span> <span class="s">&#34;secret&#34;</span><span class="o">);</span>
    <span class="kd">private</span> <span class="n">JwtDecoder</span> <span class="n">jwtDecoder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NimbusJwtDecoder</span><span class="o">(</span><span class="k">new</span> <span class="n">ParseOnlyJWTProcessor</span><span class="o">());</span>

    <span class="kd">public</span> <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="nf">introspect</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">principal</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">delegate</span><span class="o">.</span><span class="na">introspect</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Jwt</span> <span class="n">jwt</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">jwtDecoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">DefaultOAuth2AuthenticatedPrincipal</span><span class="o">(</span><span class="n">jwt</span><span class="o">.</span><span class="na">getClaims</span><span class="o">(),</span> <span class="n">NO_AUTHORITIES</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JwtException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">OAuth2IntrospectionException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ParseOnlyJWTProcessor</span> <span class="kd">extends</span> <span class="n">DefaultJWTProcessor</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="n">JWTClaimsSet</span> <span class="nf">process</span><span class="o">(</span><span class="n">SignedJWT</span> <span class="n">jwt</span><span class="o">,</span> <span class="n">SecurityContext</span> <span class="n">context</span><span class="o">)</span>
                <span class="kd">throws</span> <span class="n">JOSEException</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="na">getJWTClaimSet</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Thereafter, this custom introspector can be configured simply by exposing it as a <code>@Bean</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JwtOpaqueTokenIntropsector</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="18calling-a-userinfo-endpoint">18 Calling a <code>/userinfo</code> Endpoint</h2>
<p>Generally speaking, a Resource Server doesn’t care about the underlying user, but instead about the authorities that have been granted. That said, at times it can be valuable to tie the authorization statement back to a user. If an application is also using <code>spring-security-oauth2-client</code>, having set up the appropriate <code>ClientRegistrationRepository</code>, then this is quite simple with a custom <code>OpaqueTokenIntrospector</code>. This implementation below does three things:</p>
<ul>
<li>Delegates to the introspection endpoint, to affirm the token’s validity</li>
<li>Looks up the appropriate client registration associated with the <code>/userinfo</code> endpoint</li>
<li>Invokes and returns the response from the <code>/userinfo</code> endpoint</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserInfoOpaqueTokenIntrospector</span> <span class="kd">implements</span> <span class="n">OpaqueTokenIntrospector</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">OpaqueTokenIntrospector</span> <span class="n">delegate</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="s">&#34;https://idp.example.org/introspect&#34;</span><span class="o">,</span> <span class="s">&#34;client&#34;</span><span class="o">,</span> <span class="s">&#34;secret&#34;</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">OAuth2UserService</span> <span class="n">oauth2UserService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultOAuth2UserService</span><span class="o">();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ClientRegistrationRepository</span> <span class="n">repository</span><span class="o">;</span>

    <span class="c1">// ... constructor
</span><span class="c1"></span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="nf">introspect</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">authorized</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">delegate</span><span class="o">.</span><span class="na">introspect</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
        <span class="n">Instant</span> <span class="n">issuedAt</span> <span class="o">=</span> <span class="n">authorized</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">ISSUED_AT</span><span class="o">);</span>
        <span class="n">Instant</span> <span class="n">expiresAt</span> <span class="o">=</span> <span class="n">authorized</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">EXPIRES_AT</span><span class="o">);</span>
        <span class="n">ClientRegistration</span> <span class="n">clientRegistration</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">repository</span><span class="o">.</span><span class="na">findByRegistrationId</span><span class="o">(</span><span class="s">&#34;registration-id&#34;</span><span class="o">);</span>
        <span class="n">OAuth2AccessToken</span> <span class="n">token</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OAuth2AccessToken</span><span class="o">(</span><span class="n">BEARER</span><span class="o">,</span> <span class="n">token</span><span class="o">,</span> <span class="n">issuedAt</span><span class="o">,</span> <span class="n">expiresAt</span><span class="o">);</span>
        <span class="n">OAuth2UserRequest</span> <span class="n">oauth2UserRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OAuth2UserRequest</span><span class="o">(</span><span class="n">clientRegistration</span><span class="o">,</span> <span class="n">token</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">oauth2UserService</span><span class="o">.</span><span class="na">loadUser</span><span class="o">(</span><span class="n">oauth2UserRequest</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you aren’t using <code>spring-security-oauth2-client</code>, it’s still quite simple. You will simply need to invoke the <code>/userinfo</code> with your own instance of <code>WebClient</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserInfoOpaqueTokenIntrospector</span> <span class="kd">implements</span> <span class="n">OpaqueTokenIntrospector</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">OpaqueTokenIntrospector</span> <span class="n">delegate</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">NimbusOpaqueTokenIntrospector</span><span class="o">(</span><span class="s">&#34;https://idp.example.org/introspect&#34;</span><span class="o">,</span> <span class="s">&#34;client&#34;</span><span class="o">,</span> <span class="s">&#34;secret&#34;</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">WebClient</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="nf">introspect</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OAuth2AuthenticatedPrincipal</span> <span class="n">authorized</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">delegate</span><span class="o">.</span><span class="na">introspect</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">makeUserInfoRequest</span><span class="o">(</span><span class="n">authorized</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Either way, having created your <code>OpaqueTokenIntrospector</code>, you should publish it as a <code>@Bean</code> to override the defaults:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">OpaqueTokenIntrospector</span> <span class="nf">introspector</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">UserInfoOpaqueTokenIntrospector</span><span class="o">(...);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="19supporting-both-jwt-and-opaque-token">19 Supporting both JWT and Opaque Token</h2>
<p>In some cases, you may have a need to access both kinds of tokens. For example, you may support more than one tenant where one tenant issues JWTs and the other issues opaque tokens. If this decision must be made at request-time, then you can use an <code>AuthenticationManagerResolver</code> to achieve it, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">AuthenticationManagerResolver</span><span class="o">&lt;</span><span class="n">HttpServletRequest</span><span class="o">&gt;</span> <span class="nf">tokenAuthenticationManagerResolver</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">BearerTokenResolver</span> <span class="n">bearerToken</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultBearerTokenResolver</span><span class="o">();</span>
    <span class="n">JwtAuthenticationProvider</span> <span class="n">jwt</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">();</span>
    <span class="n">OpaqueTokenAuthenticationProvider</span> <span class="n">opaqueToken</span> <span class="o">=</span> <span class="n">opaqueToken</span><span class="o">();</span>

    <span class="k">return</span> <span class="n">request</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">bearerToken</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isAJwt</span><span class="o">(</span><span class="n">token</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">jwt</span><span class="o">::</span><span class="n">authenticate</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">opaqueToken</span><span class="o">::</span><span class="n">authenticate</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>And then specify this <code>AuthenticationManagerResolver</code> in the DSL:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">http</span>
    <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
        <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
        <span class="o">.</span><span class="na">and</span><span class="o">()</span>
    <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
        <span class="o">.</span><span class="na">authenticationManagerResolver</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tokenAuthenticationManagerResolver</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="20multi-tenancy">20 Multi-tenancy</h2>
<p>A resource server is considered multi-tenant when there are multiple strategies for verifying a bearer token, keyed by some tenant identifier. For example, your resource server may accept bearer tokens from two different authorization servers. Or, your authorization server may represent a multiplicity of issuers. In each case, there are two things that need to be done and trade-offs associated with how you choose to do them:</p>
<ol>
<li>Resolve the tenant</li>
<li>Propagate the tenant</li>
</ol>
<h3 id="resolving-the-tenant-by-request-material">Resolving the Tenant By Request Material</h3>
<p>Resolving the tenant by request material can be done my implementing an <code>AuthenticationManagerResolver</code>, which determines the <code>AuthenticationManager</code> at runtime, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TenantAuthenticationManagerResolver</span>
        <span class="kd">implements</span> <span class="n">AuthenticationManagerResolver</span><span class="o">&lt;</span><span class="n">HttpServletRequest</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">BearerTokenResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultBearerTokenResolver</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">;</span> <span class="c1">// 1
</span><span class="c1"></span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AuthenticationManager</span><span class="o">&gt;</span> <span class="n">authenticationManagers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span> <span class="c1">// 2
</span><span class="c1"></span>
    <span class="kd">public</span> <span class="nf">TenantAuthenticationManagerResolver</span><span class="o">(</span><span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tenants</span> <span class="o">=</span> <span class="n">tenants</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">AuthenticationManager</span> <span class="nf">resolve</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">authenticationManagers</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">toTenant</span><span class="o">(</span><span class="n">request</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">fromTenant</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">toTenant</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">pathParts</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">pathParts</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">pathParts</span><span class="o">[</span><span class="n">1</span><span class="o">]</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">AuthenticationManager</span> <span class="nf">fromTenant</span><span class="o">(</span><span class="n">String</span> <span class="n">tenant</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenants</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">tenant</span><span class="o">))</span> <span class="c1">// 3
</span><span class="c1"></span>                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">JwtDecoders</span><span class="o">::</span><span class="n">fromIssuerLocation</span><span class="o">)</span> <span class="c1">// 4
</span><span class="c1"></span>                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">JwtAuthenticationProvider</span><span class="o">::</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;unknown tenant&#34;</span><span class="o">))::</span><span class="n">authenticate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>A hypothetical source for tenant information</li>
<li>A cache for <code>AuthenticationManager</code>s, keyed by tenant identifier</li>
<li>Looking up the tenant is more secure than simply computing the issuer location on the fly - the lookup acts as a tenant whitelist</li>
<li>Create a JwtDecoder via the discovery endpoint - the lazy lookup here means that you don’t need to configure all tenants at startup</li>
</ol>
<p>And then specify this <code>AuthenticationManagerResolver</code> in the DSL:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">http</span>
    <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
        <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
        <span class="o">.</span><span class="na">and</span><span class="o">()</span>
    <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
        <span class="o">.</span><span class="na">authenticationManagerResolver</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenantAuthenticationManagerResolver</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="resolving-the-tenant-by-claim">Resolving the Tenant By Claim</h3>
<p>Resolving the tenant by claim is similar to doing so by request material. The only real difference is the <code>toTenant</code> method implementation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TenantAuthenticationManagerResolver</span> <span class="kd">implements</span> <span class="n">AuthenticationManagerResolver</span><span class="o">&lt;</span><span class="n">HttpServletRequest</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">BearerTokenResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultBearerTokenResolver</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">;</span> <span class="c1">// 1
</span><span class="c1"></span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AuthenticationManager</span><span class="o">&gt;</span> <span class="n">authenticationManagers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span> <span class="c1">// 2
</span><span class="c1"></span>
    <span class="kd">public</span> <span class="nf">TenantAuthenticationManagerResolver</span><span class="o">(</span><span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tenants</span> <span class="o">=</span> <span class="n">tenants</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">AuthenticationManager</span> <span class="nf">resolve</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">authenticationManagers</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">toTenant</span><span class="o">(</span><span class="n">request</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">fromTenant</span><span class="o">);</span> <span class="c1">// 3
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">toTenant</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">resolver</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">JWTParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">token</span><span class="o">).</span><span class="na">getJWTClaimsSet</span><span class="o">().</span><span class="na">getIssuer</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">AuthenticationManager</span> <span class="nf">fromTenant</span><span class="o">(</span><span class="n">String</span> <span class="n">tenant</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenants</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">tenant</span><span class="o">))</span> <span class="c1">// 4
</span><span class="c1"></span>                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">JwtDecoders</span><span class="o">::</span><span class="n">fromIssuerLocation</span><span class="o">)</span> <span class="c1">// 5
</span><span class="c1"></span>                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">JwtAuthenticationProvider</span><span class="o">::</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;unknown tenant&#34;</span><span class="o">))::</span><span class="n">authenticate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#CO14-1"><img src="images/1.png" alt="1"></a></td>
<td></td>
<td>A hypothetical source for tenant information</td>
</tr>
<tr>
<td><a href="#CO14-2"><img src="images/2.png" alt="1"></a></td>
<td></td>
<td>A cache for <code>AuthenticationManager</code>s, keyed by tenant identifier</td>
</tr>
<tr>
<td><a href="#CO14-3"><img src="images/3.png" alt="1"></a></td>
<td><a href="#CO14-4"><img src="images/4.png" alt="1"></a></td>
<td>Looking up the tenant is more secure than simply computing the issuer location on the fly - the lookup acts as a tenant whitelist</td>
</tr>
<tr>
<td><a href="#CO14-5"><img src="images/5.png" alt="1"></a></td>
<td></td>
<td>Create a <code>JwtDecoder</code> via the discovery endpoint - the lazy lookup here means that you don’t need to configure all tenants at startup</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">http</span>
    <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
        <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
        <span class="o">.</span><span class="na">and</span><span class="o">()</span>
    <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
        <span class="o">.</span><span class="na">authenticationManagerResolver</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenantAuthenticationManagerResolver</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="parsing-the-claim-only-once">Parsing the Claim Only Once</h3>
<p>You may have observed that this strategy, while simple, comes with the trade-off that the JWT is parsed once by the <code>AuthenticationManagerResolver</code> and then again by the <code>JwtDecoder</code>. This extra parsing can be alleviated by configuring the <code>JwtDecoder</code> directly with a <code>JWTClaimSetAwareJWSKeySelector</code> from Nimbus:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TenantJWSKeySelector</span>
    <span class="kd">implements</span> <span class="n">JWTClaimSetAwareJWSKeySelector</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">;</span> <span class="n">1</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">JWSKeySelector</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;&gt;</span> <span class="n">selectors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span> <span class="n">2</span>

    <span class="kd">public</span> <span class="nf">TenantJWSKeySelector</span><span class="o">(</span><span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tenants</span> <span class="o">=</span> <span class="n">tenants</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Key</span><span class="o">&gt;</span> <span class="nf">selectKeys</span><span class="o">(</span><span class="n">JWSHeader</span> <span class="n">jwsHeader</span><span class="o">,</span> <span class="n">JWTClaimsSet</span> <span class="n">jwtClaimsSet</span><span class="o">,</span> <span class="n">SecurityContext</span> <span class="n">securityContext</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">KeySourceException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">selectors</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">toTenant</span><span class="o">(</span><span class="n">jwtClaimsSet</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">fromTenant</span><span class="o">)</span>
                <span class="o">.</span><span class="na">selectJWSKeys</span><span class="o">(</span><span class="n">jwsHeader</span><span class="o">,</span> <span class="n">securityContext</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">toTenant</span><span class="o">(</span><span class="n">JWTClaimsSet</span> <span class="n">claimSet</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">claimSet</span><span class="o">.</span><span class="na">getClaim</span><span class="o">(</span><span class="s">&#34;iss&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">JWSKeySelector</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="nf">fromTenant</span><span class="o">(</span><span class="n">String</span> <span class="n">tenant</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenantRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">tenant</span><span class="o">))</span> <span class="n">3</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">getAttrbute</span><span class="o">(</span><span class="s">&#34;jwks_uri&#34;</span><span class="o">))</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">fromUri</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;unknown tenant&#34;</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">JWSKeySelector</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="nf">fromUri</span><span class="o">(</span><span class="n">String</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">JWSAlgorithmFamilyJWSKeySelector</span><span class="o">.</span><span class="na">fromJWKSetURL</span><span class="o">(</span><span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">uri</span><span class="o">));</span> <span class="n">4</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#CO14-1"><img src="images/1.png" alt="1"></a></td>
<td>A hypothetical source for tenant information</td>
<td></td>
</tr>
<tr>
<td><a href="#CO14-2"><img src="images/2.png" alt="1"></a></td>
<td>A cache for <code>JWKKeySelector</code>s, keyed by tenant identifier</td>
<td></td>
</tr>
<tr>
<td><a href="#CO14-3"><img src="images/3.png" alt="1"></a></td>
<td>Looking up the tenant is more secure than simply calculating the JWK Set endpoint on the fly - the lookup acts as a tenant whitelist</td>
<td></td>
</tr>
<tr>
<td><a href="#CO14-4"><img src="images/4.png" alt="1"></a></td>
<td>Create a <code>JWSKeySelector</code> via the types of keys that come back from the JWK Set endpoint - the lazy lookup here means that you don’t need to configure all tenants at startupp</td>
<td></td>
</tr>
</tbody>
</table>
<p>The above key selector is a composition of many key selectors. It chooses which key selector to use based on the <code>iss</code> claim in the JWT.</p>
<blockquote>
<p>To use this approach, make sure that the authorization server is configured to include the claim set as part of the token’s signature. Without this, you have no guarantee that the issuer hasn’t been altered by a bad actor.</p>
</blockquote>
<p>Next, we can construct a <code>JWTProcessor</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JWTProcessor</span> <span class="nf">jwtProcessor</span><span class="o">(</span><span class="n">JWTClaimSetJWSKeySelector</span> <span class="n">keySelector</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ConfigurableJWTProcessor</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="n">jwtProcessor</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">DefaultJWTProcessor</span><span class="o">();</span>
    <span class="n">jwtProcessor</span><span class="o">.</span><span class="na">setJWTClaimSetJWSKeySelector</span><span class="o">(</span><span class="n">keySelector</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">jwtProcessor</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As you are already seeing, the trade-off for moving tenant-awareness down to this level is more configuration. We have just a bit more. Next, we still want to make sure you are validating the issuer. But, since the issuer may be different per JWT, then you’ll need a tenant-aware validator, too:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TenantJwtIssuerValidator</span> <span class="kd">implements</span> <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">JwtIssuerValidator</span><span class="o">&gt;</span> <span class="n">validators</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">TenantJwtIssuerValidator</span><span class="o">(</span><span class="n">TenantRepository</span> <span class="n">tenants</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tenants</span> <span class="o">=</span> <span class="n">tenants</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">OAuth2TokenValidatorResult</span> <span class="nf">validate</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">validators</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">toTenant</span><span class="o">(</span><span class="n">token</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">fromTenant</span><span class="o">)</span>
                <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">toTenant</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">jwt</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="na">getIssuer</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">JwtIssuerValidator</span> <span class="nf">fromTenant</span><span class="o">(</span><span class="n">String</span> <span class="n">tenant</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tenants</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">tenant</span><span class="o">))</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;issuer&#34;</span><span class="o">))</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">JwtIssuerValidator</span><span class="o">::</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;unknown tenant&#34;</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Now that we have a tenant-aware processor and a tenant-aware validator, we can proceed with creating our <code>JwtDecoder</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">(</span><span class="n">JWTProcessor</span> <span class="n">jwtProcessor</span><span class="o">,</span> <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">jwtValidator</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">NimbusJwtDecoder</span> <span class="n">decoder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NimbusJwtDecoder</span><span class="o">(</span><span class="n">processor</span><span class="o">);</span>
    <span class="n">OAuth2TokenValidator</span><span class="o">&lt;</span><span class="n">Jwt</span><span class="o">&gt;</span> <span class="n">validator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DelegatingOAuth2TokenValidator</span><span class="o">&lt;&gt;</span>
            <span class="o">(</span><span class="n">JwtValidators</span><span class="o">.</span><span class="na">createDefault</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">jwtValidator</span><span class="o">);</span>
    <span class="n">decoder</span><span class="o">.</span><span class="na">setJwtValidator</span><span class="o">(</span><span class="n">validator</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">decoder</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We’ve finished talking about resolving the tenant. If you’ve chosen to resolve the tenant by request material, then you’ll need to make sure you address your downstream resource servers in the same way. For example, if you are resolving it by subdomain, you’ll need to address the downstream resource server using the same subdomain. However, if you resolve it by a claim in the bearer token, read on to learn about <a href="#oauth2resourceserver-bearertoken-resolver" title="12.3.21 Bearer Token Resolution">Spring Security’s support for bearer token propagation</a>.</p>
<h2 id="21bearer-token-resolution">21 Bearer Token Resolution</h2>
<p>By default, Resource Server looks for a bearer token in the <code>Authorization</code> header. This, however, can be customized in a couple of ways.</p>
<h3 id="reading-the-bearer-token-from-a-custom-header">Reading the Bearer Token from a Custom Header</h3>
<p>For example, you may have a need to read the bearer token from a custom header. To achieve this, you can wire a <code>HeaderBearerTokenResolver</code> instance into the DSL, as you can see in the following example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">http</span>
    <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
        <span class="o">.</span><span class="na">bearerTokenResolver</span><span class="o">(</span><span class="k">new</span> <span class="n">HeaderBearerTokenResolver</span><span class="o">(</span><span class="s">&#34;x-goog-iap-jwt-assertion&#34;</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="reading-the-bearer-token-from-a-form-parameter">Reading the Bearer Token from a Form Parameter</h3>
<p>Or, you may wish to read the token from a form parameter, which you can do by configuring the <code>DefaultBearerTokenResolver</code>, as you can see below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">DefaultBearerTokenResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultBearerTokenResolver</span><span class="o">();</span>
<span class="n">resolver</span><span class="o">.</span><span class="na">setAllowFormEncodedBodyParameter</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">http</span>
    <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
        <span class="o">.</span><span class="na">bearerTokenResolver</span><span class="o">(</span><span class="n">resolver</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="22bearer-token-propagation">22 Bearer Token Propagation</h2>
<p>Now that you’re in possession of a bearer token, it might be handy to pass that to downstream services. This is quite simple with <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/oauth2/server/resource/web/reactive/function/client/ServletBearerExchangeFilterFunction.html"><code>ServletBearerExchangeFilterFunction</code></a>, which you can see in the following example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">WebClient</span> <span class="nf">rest</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="k">new</span> <span class="n">ServletBearerExchangeFilterFunction</span><span class="o">())</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>When the above <code>WebClient</code> is used to perform requests, Spring Security will look up the current <code>Authentication</code> and extract any <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/oauth2/core/AbstractOAuth2Token.html"><code>AbstractOAuth2Token</code></a> credential. Then, it will propagate that token in the <code>Authorization</code> header. For example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="k">this</span><span class="o">.</span><span class="na">rest</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
        <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;https://other-service.example.com/endpoint&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
        <span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">.</span><span class="na">block</span><span class="o">()</span>
</code></pre></td></tr></table>
</div>
</div><p>Will invoke the <a href="https://other-service.example.com/endpoint"><code>https://other-service.example.com/endpoint</code></a>, adding the bearer token <code>Authorization</code> header for you. In places where you need to override this behavior, it’s a simple matter of supplying the header yourself, like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="k">this</span><span class="o">.</span><span class="na">rest</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
        <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;https://other-service.example.com/endpoint&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">headers</span><span class="o">(</span><span class="n">headers</span> <span class="o">-&gt;</span> <span class="n">headers</span><span class="o">.</span><span class="na">setBearerAuth</span><span class="o">(</span><span class="n">overridingToken</span><span class="o">))</span>
        <span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
        <span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">.</span><span class="na">block</span><span class="o">()</span>
</code></pre></td></tr></table>
</div>
</div><p>In this case, the filter will fall back and simply forward the request onto the rest of the web filter chain.</p>
<blockquote>
<p>Unlike the <a href="https://docs.spring.io/spring-security/site/docs/current-SNAPSHOT/api/org/springframework/security/oauth2/client/web/reactive/function/client/ServletOAuth2AuthorizedClientExchangeFilterFunction.html">OAuth 2.0 Client filter function</a>, this filter function makes no attempt to renew the token, should it be expired. To obtain this level of support, please use the OAuth 2.0 Client filter.</p>
</blockquote>
<h3 id="resttemplate-support"><code>RestTemplate</code> support</h3>
<p>There is no dedicated support for <code>RestTemplate</code> at the moment, but you can achieve propagation quite simply with your own interceptor:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="n">RestTemplate</span> <span class="nf">rest</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">RestTemplate</span> <span class="n">rest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RestTemplate</span><span class="o">();</span>
    <span class="n">rest</span><span class="o">.</span><span class="na">getInterceptors</span><span class="o">().</span><span class="na">add</span><span class="o">((</span><span class="n">request</span><span class="o">,</span> <span class="n">body</span><span class="o">,</span> <span class="n">execution</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">authentication</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">execution</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(!(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getCredentials</span><span class="o">()</span> <span class="k">instanceof</span> <span class="n">AbstractOAuth2Token</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">execution</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">AbstractOAuth2Token</span> <span class="n">token</span> <span class="o">=</span> <span class="o">(</span><span class="n">AbstractOAuth2Token</span><span class="o">)</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getCredentials</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">setBearerAuth</span><span class="o">(</span><span class="n">token</span><span class="o">.</span><span class="na">getTokenValue</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">execution</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span>
    <span class="o">});</span>
    <span class="k">return</span> <span class="n">rest</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/" term="后端" label="后端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/spring/" term="spring" label="spring" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Spring推荐使用构造器注入</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/spring%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5.html" />
            <id>https://wss.cool/spring%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2020-01-18T18:30:02+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[Spring团队通常提倡构造函数注入，因为它可以使应用程序组件实现不可变对象并确保所……]]></summary>
            
                <content type="html"><![CDATA[<p>Spring团队通常提倡构造函数注入，因为它可以使应用程序组件实现不可变对象并确保所需的依赖项不为null。此外，构造函数注入的组件始终以完全初始化的状态返回到客户端（调用）代码。附带说明一下，大量的构造函数自变量是一种不好的代码味道，这意味着该类可能承担了太多的职责，应该对其进行重构以更好地解决关注点分离问题。</p>
<p>我们通常建议人们对所有必需的协作者使用构造函数注入，对所有其他属性使用setter注入。同样，构造函数注入可确保满足所有必需属性，并且根本不可能以无效状态（未通过其协作者）实例化对象。换句话说，在使用构造函数注入时，您不必使用专用机制来确保设置了必需的属性（普通Java机制除外）。</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/knowledge/" term="knowledge" label="knowledge" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/" term="后端" label="后端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/spring/" term="spring" label="spring" />
                            
                        
                    
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5/" term="构造器注入" label="构造器注入" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/" term="依赖注入" label="依赖注入" />
                            
                        
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Spring Boot中读取配置文件中的变量</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/spring-boot%E4%B8%AD%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F.html" />
            <id>https://wss.cool/spring-boot%E4%B8%AD%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2020-01-18T17:57:27+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[在application.yml配置文件中加入自定义变量，然后在程序中读取他们。]]></summary>
            
                <content type="html"><![CDATA[<p>在application.yml中配置的变量，可以在代码中引用到。</p>
<h2 id="添加依赖">添加依赖</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-configuration-processor<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.2.0.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="定义变量">定义变量</h2>
<p>application.yml文件中加入自定义的变量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">my</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>wanngshushuo<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="对应的实体类">对应的实体类</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span> <span class="c1">// 文档中没有这个注释，但是不写会报错
</span><span class="c1"></span><span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&#34;my&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfig</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="c1">// getter setter
</span><span class="c1"></span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="在代码中使用">在代码中使用</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MyConfig</span> <span class="n">myConfig</span><span class="o">;</span>

    <span class="n">MainService</span><span class="o">(</span><span class="n">MyConfig</span> <span class="n">myConfig</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">myConfig</span> <span class="o">=</span> <span class="n">myConfig</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/update&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">updateBlog</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">myConfig</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/" term="后端" label="后端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/spring-boot/" term="spring-boot" label="spring-boot" />
                            
                        
                    
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/%E8%AF%BB%E5%8F%96spring-boot%E9%85%8D%E7%BD%AE/" term="读取spring-boot配置" label="读取spring-boot配置" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/%E8%AF%BB%E5%8F%96spring-boot%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" term="读取spring-boot环境变量" label="读取spring-boot环境变量" />
                            
                        
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Java执行shell命令</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/java%E6%89%A7%E8%A1%8Cshell%E5%91%BD%E4%BB%A4.html" />
            <id>https://wss.cool/java%E6%89%A7%E8%A1%8Cshell%E5%91%BD%E4%BB%A4.html</id>
            <updated>2020-01-18T17:53:17+08:00</updated>
            <published>2020-01-18T17:53:17+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[添加依赖 首先使用Spring Boot开启一个RESTful项目，额外的加上Apach……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="添加依赖">添加依赖</h2>
<p>首先使用<code>Spring Boot</code>开启一个<code>RESTful</code>项目，额外的加上<code>Apache Commons Exec</code>的依赖。</p>
<blockquote>
<p>Exec官网<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>，<a href="https://commons.apache.org/proper/commons-exec/apidocs/index.html">API文档</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>commons-exec<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="代码实现">代码实现</h2>
<p>这里分两种情况。一个是最简的只关心执行是否成功，也就是code大于0为失败；另一个是需要拿到执行的标准输出和错误的信息。</p>
<h3 id="只关心是否成功">只关心是否成功</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">updateBlogFromGit</span><span class="o">(){</span>
        <span class="c1">// 1
</span><span class="c1"></span>        <span class="n">CommandLine</span> <span class="n">pull</span> <span class="o">=</span> <span class="n">CommandLine</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&#34;git pull&#34;</span><span class="o">);</span>

        <span class="c1">// 2
</span><span class="c1"></span>        <span class="n">DefaultExecutor</span> <span class="n">executor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultExecutor</span><span class="o">();</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">setWorkingDirectory</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;/home/ubuntu/blog&#34;</span><span class="o">));</span>

        <span class="c1">// 3，省略try_catch
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">exitValue</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">pull</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">exitValue</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">exitValue</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">hugo</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">exitValue</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>准备要运行的shell命令</li>
<li>创建执行器，并设置工作目录</li>
<li>最后执行命令，返回code</li>
</ol>
<h3 id="要拿到标准输出和错误的信息">要拿到标准输出和错误的信息</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">updateBlogFromGit</span><span class="o">(){</span>
        <span class="c1">// 1
</span><span class="c1"></span>        <span class="n">CommandLine</span> <span class="n">pull</span> <span class="o">=</span> <span class="n">CommandLine</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&#34;git pull&#34;</span><span class="o">);</span>
        <span class="n">CommandLine</span> <span class="n">hugo</span> <span class="o">=</span> <span class="n">CommandLine</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&#34;hugo&#34;</span><span class="o">);</span>

        <span class="c1">// 2
</span><span class="c1"></span>        <span class="n">ByteArrayOutputStream</span> <span class="n">outputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="n">ByteArrayOutputStream</span> <span class="n">errorStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="n">PumpStreamHandler</span> <span class="n">streamHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PumpStreamHandler</span><span class="o">(</span><span class="n">outputStream</span><span class="o">,</span> <span class="n">errorStream</span><span class="o">);</span>

        <span class="c1">// 3
</span><span class="c1"></span>        <span class="n">DefaultExecutor</span> <span class="n">executor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultExecutor</span><span class="o">();</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">setWorkingDirectory</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;/home/ubuntu/blog&#34;</span><span class="o">));</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">setStreamHandler</span><span class="o">(</span><span class="n">streamHandler</span><span class="o">);</span>

        <span class="c1">// 4
</span><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">exitValue</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">pull</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">exitValue</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">exitValue</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">hugo</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">String</span> <span class="n">result</span><span class="o">;</span>
            <span class="k">if</span><span class="o">(</span><span class="n">exitValue</span><span class="o">==</span><span class="n">0</span><span class="o">){</span>
                <span class="n">result</span><span class="o">=</span> <span class="n">outputStream</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">errorStream</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecuteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">errorStream</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>准备要运行的shell命令</li>
<li>准备接收标准输出和错误的Stream</li>
<li>创建执行器，并设置工作目录，设置StreamHandler</li>
<li>最后执行命令（如果执行时出错会返回大于0的整数），返回标准输出或错误信息或报错堆栈信息</li>
</ol>
<h2 id="收获">收获</h2>
<p>技能树：</p>
<pre><code>后端 --&gt; Java --&gt; 工具库 --&gt; Exec --&gt; 使用
后端 --&gt; Java --&gt; 语言基础 --&gt; ByteArrayOutputStream --&gt; 使用
</code></pre><h2 id="其他相关内容">其他相关内容</h2>
<ul>
<li><a href="https://wowfriday.cn/posts/linux-base/#%E4%BD%BF%E7%94%A8systemd%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%ADjava%E7%A8%8B%E5%BA%8F">使用systemd启动关闭Java程序</a></li>
<li><a href="https://wowfriday.cn/nginx.html#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE">配置Nginx</a></li>
</ul>
<hr>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Exec官网 <a href="https://commons.apache.org/proper/commons-exec/">https://commons.apache.org/proper/commons-exec/</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%8A%98%E8%85%BE/" term="折腾" label="折腾" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Spring探索与扫盲</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/spring%E6%8E%A2%E7%B4%A2%E4%B8%8E%E6%89%AB%E7%9B%B2.html" />
            <id>https://wss.cool/spring%E6%8E%A2%E7%B4%A2%E4%B8%8E%E6%89%AB%E7%9B%B2.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2020-01-16T23:55:23+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[刚刚接触Spring，感觉它是一个庞大的体系，内容很多。现在想要对它有一个总体的、感……]]></summary>
            
                <content type="html"><![CDATA[<p>刚刚接触Spring，感觉它是一个庞大的体系，内容很多。现在想要对它有一个总体的、感性的认识和了解。首先从官网入手。</p>
<p>spring.io官网下的第一个目录——projects，里面列举了Spring的项目。打开一个项目可以看到它的介绍，学习资料，文档，示例。</p>
<p>第二个目录是guides，里面包含很多的、各个方面的入门引导，这些入门引导都是很简单的。下面还有两个模块——Topical Guides和Tutorials，这两部分稍微长一点，比第一部分要详细一些、内容多一些。</p>
<p>第三个目录是一些付费的培训和认证。</p>
<h2 id="projects">Projects</h2>
<h3 id="spring-framework必学">Spring Framework，必学</h3>
<p>这个应该是通常说到Spring时代表的Spring本人。</p>
<blockquote>
<p>Spring框架可在任何类型的部署平台上为基于Java的现代企业应用程序提供全面的编程和配置模型。</p>
</blockquote>
<blockquote>
<p>Spring的一个关键元素是在应用程序级别的基础架构支持：Spring专注于企业应用程序的“管道”，以便团队可以专注于应用程序级别的业务逻辑，而不必与特定的部署环境建立不必要的联系。</p>
</blockquote>
<h3 id="spring-data要学">Spring Data，要学</h3>
<p><a href="https://spring.io/projects/spring-data">网址</a></p>
<p>它包含了所有数据存储的子项目，JDBC、JPA、MongoDB、Redis、REST，他们都被这个项目封装了，可以用一致的API使用。</p>
<blockquote>
<p>Spring Data的任务是为数据访问提供一个熟悉且一致的，基于Spring的编程模型，同时仍保留基础数据存储的特​​殊特征。</p>
</blockquote>
<blockquote>
<p>它使使用数据访问技术，关系和非关系数据库，map-reduce框架以及基于云的数据服务变得容易。这是一个总括项目，其中包含许多特定于给定数据库的子项目。这些项目是通过与这些令人兴奋的技术背后的许多公司和开发人员共同开发的。</p>
</blockquote>
<h3 id="spring-security要学">Spring Security，要学</h3>
<p>这个应该是用来做登录、权限管理的。下面是机翻介绍和特性。</p>
<blockquote>
<p>Spring Security是一个功能强大且高度可定制的身份验证和访问控制框架。它是用于保护基于Spring的应用程序的实际标准。</p>
</blockquote>
<blockquote>
<p>Spring Security是一个框架，致力于为Java应用程序提供身份验证和授权。与所有Spring项目一样，Spring Security的真正强大之处在于可以轻松扩展以满足自定义要求</p>
</blockquote>
<h4 id="特性">特性</h4>
<ul>
<li>对身份验证和授权的全面且可扩展的支持</li>
<li>防御会话固定，点击劫持，跨站点请求伪造等攻击</li>
<li>Servlet API集成</li>
<li>与Spring Web MVC的可选集成</li>
</ul>
<h3 id="spring-rest-docs可能要学">Spring REST Docs，可能要学</h3>
<p>貌似是用来生成RESTful服务的文档的。</p>
<blockquote>
<p>Spring REST Docs可帮助您记录RESTful服务。</p>
</blockquote>
<blockquote>
<p>它结合了用Asciidoctor编写的手写文档和Spring MVC Test生成的自动生成的代码片段。这种方法使您摆脱了Swagger之类的工具所产生的文档限制。</p>
</blockquote>
<blockquote>
<p>它可以帮助您生成准确，简洁且结构合理的文档。然后，该文档可让您的用户以最少的麻烦获得他们所需的信息。</p>
</blockquote>
<h3 id="spring-cloud要学">Spring Cloud，要学</h3>
<p>官方介绍的机翻如下，可以用来搭建微服务系统。</p>
<blockquote>
<p>Spring Cloud为开发人员提供了工具，以快速构建分布式系统中的某些常见模式（例如，配置管理，服务发现，断路器，智能路由，微代理，控制总线，一次性令牌，全局锁，领导选举，分布式会话，群集状态）。分布式系统的协调导致样板式样，并且使用Spring Cloud开发人员可以快速站起来实现这些样板的服务和应用程序。它们可以在任何分布式环境中正常工作，包括开发人员自己的笔记本电脑，裸机数据中心以及Cloud Foundry等托管平台。</p>
</blockquote>
<h3 id="spring-amqp可能要学">Spring AMQP，可能要学</h3>
<p>消息队列服务</p>
<p><strong>AMQP维基百科</strong></p>
<blockquote>
<p>高级消息队列协议即Advanced Message Queuing Protocol（AMQP）。高级消息队列协议是一种二进制应用层协议，用于应对广泛的面向消息应用程序的支持。协议提供了消息流控制，保证的一个消息对象的传递过程，如至多一次、保证多次、仅有一次等，和基于SASL和TLS的身份验证和消息加密.</p>
</blockquote>
<blockquote>
<p>是面向消息中间件提供的开放的应用层协议，其设计目标是对于消息的排序、路由（包括点对点和订阅-发布）、保持可靠性、保证安全性[1]。AMQP规范了消息传递方和接收方的行为，以使消息在不同的提供商之间实现互操作性，就像SMTP，HTTP，FTP等协议可以创建交互系统一样。与先前的中间件标准（如Java消息服务）不同的是，JMS在特定的API接口层面和实现行为上进行了统一，而高级消息队列协议则关注于各种消息如何以字节流的形式进行传递。因此，使用了符合协议实现的任意应用程序之间可以保持对消息的创建、传递。</p>
</blockquote>
<p><strong>Spring AMQP项目官方介绍的机翻</strong></p>
<blockquote>
<p>Spring AMQP项目将Spring的核心概念应用于基于AMQP的消息传递解决方案的开发。它提供了一个“模板”作为用于发送和接收消息的高级抽象。它还通过“侦听器容器”为消息驱动的POJO提供支持。这些库有助于AMQP资源的管理，同时促进对依赖项注入和声明性配置的使用。在所有这些情况下，您将看到与Spring Framework中的JMS支持相似的地方。</p>
</blockquote>
<blockquote>
<p>该项目包括两个部分；spring-amqp是基础抽象，spring-rabbit是RabbitMQ实现。</p>
</blockquote>
<h3 id="spring-batch可能要学">Spring Batch，可能要学</h3>
<p>批处理框架，公司的什么业务需要批处理呢？日志？统计？比如搞一个服务分析nginx的access.log，看一下访问日志，哪些资源被访问的多？</p>
<blockquote>
<p>一个轻量级，全面的批处理框架，旨在支持开发对企业系统的日常运行至关重要的强大的批处理应用程序。</p>
</blockquote>
<blockquote>
<p>Spring Batch提供了可重用的功能，这些功能对于处理大量记录至关重要，包括日志记录/跟踪，事务管理，作业处理统计信息，作业重新启动，跳过和资源管理。它还提供了更高级的技术服务和功能，这些功能和功能将通过优化和分区技术来实现极高容量和高性能的批处理作业。无论简单还是复杂，大批量处理作业，都可以以高度可扩展的方式利用框架来处理大量信息。</p>
</blockquote>
<h3 id="spring-web-flow可能要学">Spring Web Flow，可能要学</h3>
<blockquote>
<p>Spring Web Flow建立在Spring MVC之上，并允许实现Web应用程序的“流”。流程封装了一系列步骤，这些步骤指导用户完成某些业务任务。它跨越多个HTTP请求，具有状态，处理事务数据，可重用，并且本质上可以是动态的并且可以长期运行。</p>
</blockquote>
<blockquote>
<p>Spring Web Flow的最佳选择是具有导航功能的状态Web应用程序，例如，登机，申请贷款，购物车结帐，甚至向表单添加确认步骤。这些方案的共同点是以下一个或多个特征：</p>
</blockquote>
<ul>
<li>有一个明确的起点和终点。</li>
<li>用户必须按特定顺序浏览一组屏幕。</li>
<li>直到最后一步，更改才能最终确定。</li>
<li>完成后，就不可能意外重复交易</li>
</ul>
<h3 id="spring-for-apache-kafka可能要学">Spring for Apache Kafka，可能要学</h3>
<p>好像也是消息队列，或者数据处理引擎。</p>
<blockquote>
<p>用于Apache Kafka的Spring（spring-kafka）项目将核心Spring概念应用于基于Kafka的消息传递解决方案的开发。它提供了一个“模板”作为发送消息的高级抽象。它还支持带有@KafkaListener注释和“侦听器容器”的消息驱动的POJO 。这些库促进了依赖注入和声明式的使用。在所有这些情况下，您将看到与Spring框架中的JMS支持和Spring AMQP中的RabbitMQ支持相似。</p>
</blockquote>
<h3 id="spring-flo可能有用">Spring Flo，可能有用</h3>
<p>貌似可以做类似流程图的前端页面。</p>
<blockquote>
<p>Spring Flo是一个JavaScript库，为管道和简单图形提供了一个基本的可嵌入HTML5可视生成器。该库用作Spring Cloud Data Flow中流构建器的基础。</p>
</blockquote>
<blockquote>
<p>Flo包括集成流设计器的所有基本元素，例如连接器，控制节点，调色板，状态转换和图形拓扑-重要的是，它具有文本外壳，DSL支持和设计用于创建和查看全面工作流程的图形画布。</p>
</blockquote>
<h3 id="spring-shell可能有用">Spring Shell，可能有用</h3>
<p>gitee上传了代码，触发webhook，接口需要执行一个shell命令来打包博客。在java程序中执行shell命令是用这个项目？</p>
<blockquote>
<p>Spring Shell项目提供了一个交互式Shell，使您可以使用基于Spring的编程模型来插入自己的自定义命令。</p>
</blockquote>
<h3 id="spring-ldap暂时不学">Spring LDAP，暂时不学</h3>
<p>不知道应用场景。</p>
<p><strong>百度百科</strong></p>
<blockquote>
<p>轻型目录访问协议（英文：Lightweight Directory Access Protocol，缩写：LDAP，/ˈɛldæp/）是一个开放的，中立的，工业标准的应用协议，通过IP协议提供访问控制和维护分布式信息的目录信息。</p>
</blockquote>
<p><strong>官方介绍机翻</strong></p>
<blockquote>
<p>Spring LDAP是一个用于简化Java中LDAP编程的库，其建立原理与Spring Jdbc相同。</p>
</blockquote>
<blockquote>
<p>LdapTemplate类封装了传统LDAP编程中涉及的所有管道工作，例如创建，遍历NamingEnumerations，处理Exception和清理资源。这使程序员可以处理重要的事情-在何处查找数据（DN和筛选器）以及如何处理数据（与域对象进行映射，绑定，修改，取消绑定等），方法与JdbcTemplate缓解的方法相同除了实际的SQL之外的所有程序员，以及数据如何映射到域模型。</p>
</blockquote>
<h3 id="spring-hateoas暂时不学">Spring HATEOAS，暂时不学</h3>
<p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-SpringHATEOAS/index.html">介绍文章</a></p>
<blockquote>
<p>HATEOAS（Hypermedia as the engine of application state）是 REST 架构风格中最复杂的约束，也是构建成熟 REST 服务的核心。</p>
</blockquote>
<p>RESTful架构的最高（最牛叉）层次就要使用HATEOAS。</p>
<blockquote>
<p>第四个层次（Level 3）的 Web 服务使用 HATEOAS。在资源的表达中包含了链接信息。客户端可以根据链接来发现可以执行的动作。</p>
</blockquote>
<p>Spring HATEOAS的介绍</p>
<blockquote>
<p>当使用Spring特别是Spring MVC时，Spring HATEOAS提供了一些API来简化创建遵循HATEOAS原理的REST表示形式的API。它试图解决的核心问题是链接创建和表示组装。</p>
</blockquote>
<p>HATEOAS跟“链接”很有关系，一般的RESTful返回结果都只是JSON数据，HATEOAS原理返回的数据还要包含“链接”，客户端可以使用链接做各种事。我还想象不到应用场景。</p>
<hr>
<p>（下面都是不知道干嘛的，暂时不学）</p>
<h3 id="spring-web-services暂时不学">Spring Web Services，暂时不学</h3>
<p>不知道是干嘛的，什么叫“文档驱动的Web服务(document-driven Web services)”，“SOAP服务”好像是“简单数据交换服务”</p>
<blockquote>
<p>Spring Web Services（Spring-WS）是Spring社区的产品，致力于创建文档驱动的Web服务。Spring Web Services旨在促进合同优先SOAP服务的开发，从而允许使用多种操作XML负载的方式之一来创建灵活的Web服务。该产品基于Spring本身，这意味着您可以将诸如依赖项注入之类的Spring概念用作Web服务的组成部分。</p>
</blockquote>
<blockquote>
<p>人们使用Spring-WS的原因有很多，但是大多数人在遵循Web服务最佳实践时发现缺乏替代的SOAP堆栈后才被吸引使用。Spring-WS使最佳实践变得容易。这包括诸如WS-I基本概要文件，合同优先开发之类的实践，以及合同与实施之间的松散耦合。</p>
</blockquote>
<h3 id="spring-integration暂时不学">Spring Integration，暂时不学</h3>
<p>Integration是整合的意思，Spring Cloud Stream项目基于Spring Integration，其中Spring Integration用作消息驱动的微服务的引擎。貌似是用来整合各种服务的。</p>
<p>这里还有一个用它实现分布式锁的<a href="https://www.cnblogs.com/xuwenjin/p/10681187.html#commentform">例子</a></p>
<h3 id="spring-cloud-data-flow暂时不学">Spring Cloud Data Flow，暂时不学</h3>
<p>官方介绍的机翻，现在还不理解。</p>
<blockquote>
<p>用于Cloud Foundry和Kubernetes的基于微服务的流式处理和批处理数据处理。</p>
<p>Spring Cloud Data Flow提供了用于为流和批处理数据管道创建复杂拓扑的工具。数据管道包含使用Spring Cloud Stream或Spring Cloud Task微服务框架构建的Spring Boot应用程序。</p>
<p>Spring Cloud Data Flow支持从ETL到导入/导出，事件流和预测分析的一系列数据处理用例。</p>
</blockquote>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%90%8E%E7%AB%AF/" term="后端" label="后端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/spring/" term="spring" label="spring" />
                            
                        
                    
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/%E5%85%A5%E9%97%A8/" term="入门" label="入门" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/java/" term="Java" label="Java" />
                            
                        
                    
                
            
        </entry>
    
        <entry>
            <title type="text">使用Gitlab的Ci</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/gitlab-ci.html" />
            <id>https://wss.cool/gitlab-ci.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-11-29T16:42:18+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[使用gitlab的ci/cd打包部署前端项目到oss对象存储]]></summary>
            
                <content type="html"><![CDATA[<h1 id="需求">需求</h1>
<p>一个前端项目需要分别发布到线上的测试环境和生产环境。在打包步骤，利用CI的环境变量功能，分别配置不同的API地址、项目地址等。完成打包后，将其上传到阿里oss中，完成发布。</p>
<h1 id="使用gitlab-cicd的准备工作">使用Gitlab CI/CD的准备工作</h1>
<p>需要准备三个东西：<code>.gitlab-ci.yml</code> 文件定义CI的工作流程、Runner执行流程、阿里云OSS的SDK及上传程序用于部署。</p>
<h2 id="gitlab-ciyml文件">.gitlab-ci.yml文件</h2>
<p>项目根目录下需要有一个 <code>.gitlab-ci.yml</code> 文件。</p>
<p><strong>声明流程</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">stages</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- install<span class="w">
</span><span class="w">  </span>- build<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><code>stages</code> 声明流程，这里就是包括 <code>install</code> 和 <code>build</code> 两个流程。这两个流程都做哪些工作呢？这里的声明相当于一个类型或者接口，需要在后面去实现它。</p>
<p><strong>实现流程</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">job_name</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">stage</span><span class="p">:</span><span class="w"> </span>install<span class="w">
</span><span class="w">  </span><span class="k">script</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- npm<span class="w"> </span>install<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>这个 <code>job</code> 就是实现 <code>stages</code> 中声明的 <code>install</code> 流程的，其中 <code>job_name</code> 随便写就是个名字，<code>stage</code> 字段是说这个 <code>job</code> 是实现的哪个接口。一个接口也可以被实现多次，但是要有条件区分开。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">build_develop</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">stage</span><span class="p">:</span><span class="w"> </span>build<span class="w">
</span><span class="w">  </span><span class="k">variables</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">REACT_APP_BASE_UR</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//develop.edinnovaedu.com<span class="p">:</span><span class="m">35040</span>/<span class="w">
</span><span class="w">    </span><span class="k">REACT_APP_LEARNBOT_URL</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//ng-api--dev.edinnovaedu.com/<span class="w">
</span><span class="w">  </span><span class="k">only</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- develop<span class="w">
</span><span class="w">  </span><span class="k">script</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- npm<span class="w"> </span>run<span class="w"> </span>build<span class="p">:</span>dev<span class="w">
</span><span class="w">    </span>- npm<span class="w"> </span>run<span class="w"> </span>deploy<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">build_production</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">stage</span><span class="p">:</span><span class="w"> </span>build<span class="w">
</span><span class="w">  </span><span class="k">variables</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">REACT_APP_BASE_URL</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//api-gray.v.edinnovaedu.com/<span class="w">
</span><span class="w">    </span><span class="k">REACT_APP_LEARNBOT_URL</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//api-gray.v.edinnovaedu.com<span class="w">
</span><span class="w">  </span><span class="k">only</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- master<span class="w">
</span><span class="w">  </span><span class="k">script</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- npm<span class="w"> </span>run<span class="w"> </span>build<span class="p">:</span>gray<span class="w">
</span><span class="w">    </span>- npm<span class="w"> </span>run<span class="w"> </span>deploy<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>上面的两个 <code>job</code>，都是 <code>build</code> 的实现，它们根据 <code>only</code> 字段定义的条件（分支名）做不同的工作。</p>
<p><strong>总结</strong></p>
<p><code>总结一下，stages</code> 声明流程，总的流程是第一步执行 <code>install</code> ，第二步执行 <code>build</code>
<img src="/images/gitlab-ci-1.jpg" alt="install-build"></p>
<p><code>job</code> 实现流程，多个 <code>job</code> 可以实现同一步流程。第一步执行 <code>install</code>；第二步执行 <code>build</code>，但是会根据条件去执行对应的那个实现。
<img src="/images/gitlab-ci-2.jpg" alt="install-mutl-build"></p>
<p><strong>变量</strong></p>
<p>在 job build_develop 中看到有一个 variables 字段，它定义了两个环境变量， npm run build 中会用到他们。</p>
<p>在 job 中声明的变量是局部变量，只在当前 job 中有效。还可以声明全局变量，写法一样，只是写的位置是与 stages 平级。</p>
<p><strong>缓存</strong></p>
<p>在执行不同的流程时，会清除掉.gitignore中的文件，比如 node_modules 就会每次都被删除。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">cache</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$CI_COMMIT_REF_SLUG&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">paths</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- node_modules/<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>上面这段是分支不同时才清除 node_modules ，同个分支的不同 job 间会保留/共享它。</p>
<h2 id="runner">Runner</h2>
<p>在<code>.gitlab-ci.yml</code>文件中定义好流程后，需要配置一个Runner来执行这些操作。它是一个软件，需要单独安装，可以安装在运行gitlab的机器上，也可以安装在另一台机器上。</p>
<p><strong>安装</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># For Debian/Ubuntu</span>
$ curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.deb.sh <span class="p">|</span> sudo bash
$ sudo apt-get install gitlab-ci-multi-runner
</code></pre></td></tr></table>
</div>
</div><p><strong>注册</strong></p>
<p>注册是为了把gitlab和runner连接。gitlab的项目的设置中会提供一个url和一个token</p>
<p><img src="/images/gitlab-ci-runner.png" alt="runner"></p>
<p>拿到了这两个东西，回到刚才安装了runner的电脑，开始注册runner。</p>
<pre><code>sudo gitlab-ci-multi-runner register
</code></pre><p>然后依次输入URL、Token、名字、不用输入、shell，就完成了。</p>
<p>可以用 <code>sudo gitlab-ci-multi-runner list</code> 命令来查看各个 Runner 的状态。</p>
<p>有了<code>.gitlab-ci.yml</code>和 <code>runner</code> gitlab的<code>CI/CD</code>就可以工作了，默认的情况，每次上传<code>commit</code>都会触发<code>CI/CD</code>执行。</p>
<h2 id="部署">部署</h2>
<p>我使用了阿里云的oss部署前端项目，所以只需要把打包后的文件上传到对应的目录即可。这里使用<code>oss</code>的<code>python sdk</code>来上传。</p>
<p><code>python</code>程序放在了项目目录中，<code>runner</code>服务器也安装好了python和sdk。所以只需要运行<code>npm run deploy</code>执行<code>python</code>程序即可。</p>
<h1 id="遇到的问题">遇到的问题</h1>
<p>由于gitlab项目配置错误，clone项目的url与实际url不同。在CI执行时，使用的是错误的URL导致无法clone项目而报错。</p>
<p>解决方法是Runner的配置文件。文档链接是<strong>参考3</strong></p>
<p><code>root</code>用户的配置文件在<code>/etc/gitlab-runner/config.toml</code>，可以为一个<code>runner</code>设置一个<code>clone_url</code>即可解决问题。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-toml" data-lang="toml"><span class="p">[[</span><span class="nx">runners</span><span class="p">]]</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;ruby-2.1-docker&#34;</span>
  <span class="nx">url</span> <span class="p">=</span> <span class="s2">&#34;https://CI/&#34;</span>
  <span class="nx">token</span> <span class="p">=</span> <span class="s2">&#34;TOKEN&#34;</span>
  <span class="nx">limit</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="nx">executor</span> <span class="p">=</span> <span class="s2">&#34;docker&#34;</span>
  <span class="nx">builds_dir</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
  <span class="nx">shell</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
  <span class="nx">environment</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;ENV=value&#34;</span><span class="p">,</span> <span class="s2">&#34;LC_ALL=en_US.UTF-8&#34;</span><span class="p">]</span>
  <span class="nx">clone_url</span> <span class="p">=</span> <span class="s2">&#34;http://gitlab.example.local&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><a href="https://scarletsky.github.io/2016/07/29/use-gitlab-ci-for-continuous-integration/#cache-job-cache">参考1</a>
<a href="https://docs.gitlab.com/ce/ci/variables/README.html#masked-variables">参考2</a>
<a href="https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-global-section">参考3</a></p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/" term="工具" label="工具" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">ARTS打卡</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/arts%E6%89%93%E5%8D%A1.html" />
            <id>https://wss.cool/arts%E6%89%93%E5%8D%A1.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-10-22T16:35:08+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[Algorithm 每周至少做一个LeetCode的算法题。为了编程训练和学习，只看书不训练是没用的。……]]></summary>
            
                <content type="html"><![CDATA[<h1 id="algorithm">Algorithm</h1>
<p>每周至少做一个LeetCode的算法题。为了编程训练和学习，只看书不训练是没用的。</p>
<h1 id="review">Review</h1>
<p>阅读并点评至少一篇英文技术文章。为了学习英文。</p>
<h1 id="tip">Tip</h1>
<p>学习至少一个技术技巧，为了总结和归纳在日常工作中遇到的知识点。</p>
<h1 id="share">Share</h1>
<p>分享一篇有观点和思考的技术文章，为了建立影响力，输出价值观。</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%8A%98%E8%85%BE/" term="折腾" label="折腾" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">[机翻]如何解决问题</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98.html" />
            <id>https://wss.cool/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-10-21T16:54:43+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[此为机翻文章，原文在此。 解决问题方法 当遇到新问题时，你该怎么做？ 1.理解、明白 确切的……]]></summary>
            
                <content type="html"><![CDATA[<p>此为机翻文章，<a href="https://medium.com/free-code-camp/how-to-think-like-a-programmer-lessons-in-problem-solving-d1d8bf1de7d2">原文在此</a>。</p>
<h1 id="解决问题方法">解决问题方法</h1>
<p>当遇到新问题时，你该怎么做？</p>
<h1 id="1理解明白">1.理解、明白</h1>
<p>确切的知道要问什么。大多数难题之所以难是因为你不理解它。</p>
<p>怎么知道你理解一个问题呢？当你可以简单的术语解释它的时候。</p>
<p>你还记得吗，当你被一个问题卡住，你开始解释它，你会立即发现以前从未见过的逻辑漏洞？</p>
<p>多数程序员知道这种感觉。</p>
<blockquote>
<p>“If you can’t explain something in simple terms, you don’t understand it.” — Richard Feynman</p>
</blockquote>
<h1 id="2计划">2.计划</h1>
<p>不要没有计划就直接解决问题（以某种方式希望您能摸索到底）。规划您的解决方案！</p>
<p>如果你不能写下具体的步骤，将无济于事。在编程中，这意味着不要马上开始写代码。要给你的大脑时间，处理问题、分析信息。</p>
<p>为这个为题给出一个计划：</p>
<p>“当输入X时，有哪些必要的步骤才能输出Y？”</p>
<p>旁注：程序员有一个很棒的工具来帮助他们。</p>
<h1 id="3划分">3.划分</h1>
<p>请注意。这是最重要的一步。</p>
<p>不要试图解决一个大问题。你会哭。而是将其分解为多个子问题。这些子问题更容易解决。</p>
<p>然后，一个一个地解决每个子问题。从最简单的开始。最简单意味着您知道答案（或更接近答案）。</p>
<p>此后，最简单的方法意味着要解决的子问题不依赖于要解决的其他问题。</p>
<p>解决了每个子问题后，将点连接起来。连接所有“子解决方案”将为您解决原始问题。恭喜你！</p>
<p>该技术是解决问题的基石。记住这一点（如果需要，请再次阅读此步骤）。</p>
<h1 id="4卡住了吗">4.卡住了吗？</h1>
<p>到现在为止，您可能坐在那里想：“嗨，理查德……太酷了，但是，如果我被卡住甚至不能解决子问题怎么办？”</p>
<p>首先，深呼吸。第二，这很公平。</p>
<p>朋友，请不要担心。这发生在每个人身上！不同之处在于，最好的程序员/问题解决者对bugs/errors的好奇大于对错误的恼怒。</p>
<p>实际上，面对混乱时，可以尝试以下三件事：</p>
<ol>
<li>调试：逐步解决您的解决方案，尝试找出问题所在。程序员将其称为调试（实际上，这是调试器的全部工作）。</li>
<li>重新评估： 退后一步。从另一个角度看问题。有什么可以抽象为更通用的方法的吗？</li>
<li>研究： 啊，Google不错。您没看错。无论您遇到什么问题，都可能有人解决了。找到那个人/解决方案。实际上，即使您解决了问题，也要这样做！（您可以从其他人的解决方案中学到很多东西）。</li>
</ol>
<p>警告：不要为大问题寻找解决方案。只寻找子问题的解决方案。为什么？因为除非您奋斗（一点点），否则您将不会学到任何东西。如果您什么都不学，那您就浪费了时间。</p>
<h1 id="实践">实践</h1>
<p>仅仅一周之后，别指望自己变得很棒。如果您想成为一个好的问题解决者，请解决很多问题！</p>
<p>实践。实践。实践。认识到“使用“在此处插入概念”可以轻松解决此问题”只是时间问题。</p>
<p>怎么练习？wazoo有多种选择！</p>
<p>国际象棋难题，数学问题，数独，围棋，专卖，视频游戏，加密小猫，等等……等等……等等……。</p>
<p>实际上，在成功人士中，常见的习惯是练习“解决微观问题”的习惯。例如，彼得·泰尔（Peter Thiel）下棋，伊隆·马斯克（Elon Musk）玩电子游戏。</p>
<p>例如，我喜欢编码方面的挑战。每天，我都会尝试解决至少一个难题（通常在Coderbyte上）。</p>
<p>就像我说的，所有问题都有相似的模式。</p>
<h1 id="结论">结论</h1>
<p>那是所有人！
现在，您更好地了解了“像程序员一样思考”的含义。
您还知道解决问题是一种不可思议的技能（超能力）。
如果这还不够，请注意您还知道如何去练习解决问题的技能！
ew……挺酷的吧？
最后，祝您遇到许多问题。
您没看错。至少现在您知道如何解决它们了！（此外，您将了解到每种解决方案都可以改进）。</p>
<blockquote>
<p>“只要您认为自己已经成功克服了一个障碍，就会出现另一个障碍。但这就是让生活变得有趣的原因。
生活是突破这些障碍的过程，这是我们必须突破的一系列防御性路线。
每次，您都会学到一些东西。
每次，您都会发展力量，智慧和远见。
每次，更多的竞争都会消失。直到剩下的只有你：你最好的版本。” —瑞安·霍里</p>
</blockquote>
<p>现在，去解决一些问题！</p>
<p>祝你好运🙂</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/" term="心得与经验" label="心得与经验" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%9C%BA%E7%BF%BB/" term="机翻" label="机翻" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Hugo</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/hugo.html" />
            <id>https://wss.cool/hugo.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-10-10T14:15:23+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[改造hugo主题，修改hugo主题，显示、控制hugo分类和hugo摘要]]></summary>
            
                <content type="html"><![CDATA[<p>这个博客是使用hugo搭建的，选择来一个大体喜欢的主题。但是有一些细节还是不够满意，所以如何改造hugo主题，加上自己想要的内容，就成了一个值得研究的问题。</p>
<h1 id="分类法taxonomies">分类法（Taxonomies）</h1>
<p>我想解决的第一个问题就是文章的分类，因为一个单纯的列表看上去可能有点散乱。观察创建文章的可选参数，以及其他博客。可以确定hugo是支持分类的。在官网文档中的Content Management下有Taxonomies，阅读内容后可以确定，这就是我想找的东西。</p>
<p>在hugo中，用“Taxonomies”这个术语表示“文章的分类”。相关的有三个概念：</p>
<ul>
<li>Taxonomy -&gt; 一个分类</li>
<li>Term -&gt; 一个分类的项目</li>
<li>Value -&gt; 一个项目的值</li>
</ul>
<p>比如：</p>
<pre><code>Year                &lt;- Taxonomy
    2018              &lt;- Term
        前端入门          &lt;- Value
        Vue入门          &lt;- Value
        React入门        &lt;- Value
    2019              &lt;- Term
        前端进阶          &lt;- Value
        vue进阶           &lt;- Value
        react进阶         &lt;- Value
categories         &lt;- Taxonomy
    css              &lt;- Term
        flex布局          &lt;- Value
        css module       &lt;- Value
        background渐变色  &lt;- Value
    框架              &lt;- Term
        Vue入门           &lt;- Value
        React入门         &lt;- Value
        vue进阶           &lt;- Value
        react进阶         &lt;- Value
</code></pre><p>这里的“value”对应的都是文章的题目，“term”对应一个分类中具体有哪些项，“taxonomy”则是我们预先定义好的分类的名字。</p>
<p>这些需要通过站点配置和文章首部信息才可以实现。</p>
<p>在“站点配置”中设置有哪些Taxonomy，在“文章首部”标记该文章是哪个Taxonomy中的哪种Term</p>
<h2 id="站点配置">站点配置</h2>
<p>站点配置文件一般位于博客根目录中，叫做“config.toml”，在其中加上下面这段代码</p>
<pre><code>[taxonomies]
  category = &quot;categories&quot;
  year = &quot;year&quot;
</code></pre><h2 id="文章首部">文章首部</h2>
<p>创建每个文章时，都会有一些首部信息配置，现在这篇文章的首部信息如下：</p>
<pre><code>---
title: &quot;Hugo&quot;
url: &quot;/Hugo&quot;
toc: true
date: 2019-10-10T14:15:23+08:00
author: 王书硕
description: 了解hugo，将它改造成你想要的样子。
categories:
  - 工具
year:
  - 2019
---
</code></pre><p>其中最下面的两项——“categories”和“year”——就是上面提到的“Taxonomy”，“工具”和“2019”则是“Term”，而这篇文章就是“value”了。</p>
<p>准备好了这些配置以后，</p>
<p>……两种方式展示分类，一种是在一个特定的页面，一种是在其他地方。两种方式引用题目的方法不同。</p>
<h2 id="展示分类">展示分类</h2>
<p>第一种展示方式是在<code>layouts/_default/terms.html</code>中，如下面的代码即可展示一种terms。通过访问地址<code>localhost:1313/categories/</code>或<code>localhost:1313/year/</code>即可查看到该页面。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{{ define &#34;main&#34; }}
<span class="p">&lt;</span><span class="nt">main</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;main&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ .Title }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {{ range .Data.Terms.ByCount  }}
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ .Page.RelPermalink }}&#34;</span><span class="p">&gt;</span>{{ printf &#34;%s&#34; .Page.Title }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ printf &#34;(%d)&#34; .Count }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {{ end }}
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
{{ end }}
</code></pre></td></tr></table>
</div>
</div><p>第二种展示方式是任意一个页面，比如主页<code>layouts/index.html</code>模板中，通过<code>Site</code>变量引用分类数据。同样的其中的<code>categories</code>也可以替换成定义好的其他terms。</p>
<pre><code>&lt;ul&gt;
  {{ range .Site.Taxonomies.categories }}
  &lt;li&gt;&lt;a href=&quot;{{ .Page.Permalink }}&quot;&gt;{{ .Page.Title }}&lt;/a&gt; {{ .Count }}&lt;/li&gt;
  {{ end }}
&lt;/ul&gt;
</code></pre><p>排序</p>
<p>按字母排序</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {{ range .Data.Terms.Alphabetical }}
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ .Page.Permalink }}&#34;</span><span class="p">&gt;</span>{{ .Page.Title }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> {{ .Count }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {{ end }}
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>按数量排序</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {{ range .Data.Terms.ByCount }}
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ .Page.Permalink }}&#34;</span><span class="p">&gt;</span>{{ .Page.Title }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> {{ .Count }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {{ end }}
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>……有了这些还不够还需要term页面</p>
<p>……综上……实现了分类……</p>
<h1 id="seo">SEO</h1>
<p>robots.txt</p>
<p>setmap.xml</p>
<p>google search console</p>
<p>head模版</p>
<h1 id="摘要summary">摘要（summary）</h1>
<p>摘要最重要的一个用处是生成head中的description标签（这个是主题的head.html部分定义的，可以修改成其他内容），搜索引擎会将其中的内容展示在搜索结果中。（搜索结果中也可能不显示摘要，而现实搜索引擎自己生成的内容）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;description&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;测试一哈&#34;</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>另一个用处是用来在文章列表中展示，比如在网站首页展示10篇最近的文章，并显示其摘要。</p>
<p>两种方式可以定义一篇文章的摘要：在首部定义summary变量、在文章中使用摘要分隔符<code>&lt;!--more--&gt;</code>。后者权重更高。</p>
<p>当文章开头的几行可以准确的概括文章包含内容时，摘要分隔符<code>&lt;!--more--&gt;</code>比较适用。不然的话，就自己编辑一段摘要放在首部的summary变量中。</p>
<p>另外可以在网站配置中使用<code>summaryLength</code>控制摘要的字符长度，但是对中文貌似不起作用。</p>
<h1 id="函数">函数</h1>
<p><a href="https://gohugo.io/functions/">文档</a></p>
<p>遍历集合用<code>range</code></p>
<pre><code>&lt;ul&gt;
  {{ range .Site.Taxonomies.categories }}
    &lt;li style=&quot;text-align:left;&quot;&gt;&lt;a href=&quot;{{ .Page.Permalink }}&quot;&gt;{{ .Page.Title }}&lt;/a&gt; {{ .Count }}&lt;/li&gt;
  {{ end }}
&lt;/ul&gt;
</code></pre><p>对集合进行排序用<code>sort</code>，相较上面的代码，其中<code>count</code>是用哪个字段进行排序，<code>desc</code>表示降序</p>
<pre><code>&lt;ul&gt;
  {{ range sort .Site.Taxonomies.categories &quot;Count&quot; &quot;desc&quot; }}
    &lt;li style=&quot;text-align:left;&quot;&gt;&lt;a href=&quot;{{ .Page.Permalink }}&quot;&gt;{{ .Page.Title }}&lt;/a&gt; {{ .Count }}&lt;/li&gt;
  {{ end }}
&lt;/ul&gt;
</code></pre><h1 id="多语言模式">多语言模式</h1>
<p>hugo可以管理多种语言，但是要自己翻译内容</p>
<p><a href="https://gohugo.io/content-management/multilingual/">配置多种语言</a>
<a href="https://regisphilibert.com/blog/2018/08/hugo-multilingual-part-1-managing-content-translation/">翻译内容</a></p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/" term="工具" label="工具" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">职业发展</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/posts/experience/%E8%81%8C%E4%B8%9A%E5%8F%91%E5%B1%95/" />
            <id>https://wss.cool/posts/experience/%E8%81%8C%E4%B8%9A%E5%8F%91%E5%B1%95/</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-10-07T18:05:05+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[七个对我最重要的职业建议（阮一峰翻译） ruanyifeng 一、不要别人点什么就做什么 “不要做一个别人点……]]></summary>
            
                <content type="html"><![CDATA[<h1 id="七个对我最重要的职业建议阮一峰翻译">七个对我最重要的职业建议（阮一峰翻译）</h1>
<p><a href="http://www.ruanyifeng.com/blog/2015/09/career-advice.html">ruanyifeng</a></p>
<h2 id="一不要别人点什么就做什么">一、不要别人点什么就做什么</h2>
<p>“不要做一个别人点了什么才就烧什么的厨师，也不要这样的地方工作，你要去一个地方，那里的人能肯定你对产品的想法，相信你的能力，放手让你去做。”</p>
<p>单单实现一个产品是不够的，你还必须参与决定怎么实现。好的工程师并不仅仅服从命令，而且还会给出反馈，帮助产品的拥有者改进它。</p>
<p>🤔从技术角度改进产品？或者技术角度的feature吗？比如实现更好的交互，新的技术可以做更好的事情？</p>
<p>🤔不能只是让别人给你一个技术方案你只负责实现它，而是要自己能设计一个方案，甚至可以根据自己的技术给出一个让不同feature变成高级的feature。比如更节省成本，时间少人力少、效率高机器成本低、交互好、更美观、用户体验更好等等。总之就是，因为你的一些想法，原来那个别人提出来的东西别的更好了。</p>
<p>🤔对自己有什么好处呢？输出一些想法，肯定是要付出精力的，那么这些精力能不能有所回报呢？首先，它能体现分析、解决问题的能力，体现积极、负责，其次，进一步端粒自己分析、解决问题的能力，锻炼表达能力，这些经验多了起来，就相对其他人来说是一种优势，能创造出一些价值，可以写在简历中，对某某功能提出哪些想法，使成本降低了多少，收益增加了多少。</p>
<h2 id="二推销自己">二、推销自己</h2>
<p>“为了让其他人相信你，你必须首先让别人知道你做了什么。你需要推销自己，引起别人的注意。”</p>
<p>公司的其他人需要明白你的价值，最好的办法就是告诉别人你做了什么。</p>
<p>🤔写邮件告诉别人真的好吗？可能还是写博客好一点吧，但是博客很难找到读者，可以通过掘金、csdn之类的引流一下。</p>
<h2 id="三学会带领团队">三、学会带领团队</h2>
<p>&quot;当你的技术能力过关以后，就要考验你与他人相处的能力了。&quot;</p>
<p>如何带领一个团队，有效地与其他人协同工作，取到更大的成果。</p>
<p>🤔先看一下左耳朵的文章学习一下沟通技术。</p>
<p>🤔目前我只需要考虑一二三这几个问题。</p>
<h2 id="四生活才是最重要的">四、生活才是最重要的</h2>
<h2 id="五自己找到道路">五、自己找到道路</h2>
<p>&quot;以前都是我们告诉你做什么，从现在开始，你必须自己回答这个问题了，我期待你来告诉我，什么事情需要做。&quot;</p>
<p>很多工程师都没有完成这个转变，如果能够做到，可能就说明你成熟了，学会了取舍。你不可能把时间花在所有事情上面，必须找到一个重点。</p>
<h2 id="六把自己当成主人">六、把自己当成主人</h2>
<p>&quot;不要再去开这样的会了。你参加一个会，那是因为你参与了某件事。如果不确定自己为什么要在场，就停下来问。如果这件事不需要你，就离开。不要从头到尾都静静地参加一个会，要把自己当成负责人，大家会相信你的。&quot;</p>
<p>从那时起，我从没有一声不发地参加会议。我确保只参加那些需要我参加的会议。</p>
<h2 id="七找到水平更高的人">七、找到水平更高的人</h2>
<p>&quot;找到那些比你水平更高、更聪明的人，尽量和他们在一起，吃饭或者喝咖啡，向他们讨教，了解他们拥有的知识。你的职业，甚至你的生活，都会因此变得更好。&quot;</p>
<h1 id="面试时如何向公司提问">面试时，如何向公司提问？</h1>
<p><a href="http://www.ruanyifeng.com/blog/2012/08/questions_you_need_to_ask_in_an_interview.html">ruanyifeng</a></p>
<p>有一些注意点，你需要知道：</p>
<ol>
<li>面试之前，一定要做准备，多了解公司的情况。</li>
<li>你提出的问题，应该围绕&quot;这份工作是否合适我&quot;这个中心点，其他与应聘关系不大的问题，不宜多问。</li>
<li>提问的时候，要自然放松，不要害羞，就把它当作普通的聊天。你要表现出对公司的真诚兴趣。</li>
<li>提问要直接了当，不要绕圈子。提出问题之后，你要保持安静，让面试官多说话。</li>
<li>面试官回答的时候，你可以做笔记，或者事先询问能不能做。笔记必须简短，你的大部分时间，要用来全神贯注倾听面试官的回答，并与其有眼神的交流。</li>
<li>面试结束后一周内，最好打一个电话或发一封邮件，了解公司对你的反馈意见。即使面试失败，你不妨也问一下原因，这会有助于你以后的面试。</li>
</ol>
<p>6个问题</p>
<ol>
<li>为什么招人，之前的人离职了还是公司增长扩张。</li>
<li>为什么大家想留在你们公司。公司的文化、价值观、环境对员工的影响。</li>
<li>如果被录用了，在上班的头两三个月，公司希望我做到的三件事是什么？</li>
<li>一个人像成功地做好这份工作，需要哪些东西？</li>
<li>我刚才说过的话里，是否有哪些内容让你华裔我不适合这份工作。</li>
<li>你们什么时候会做最后的决定？</li>
</ol>
<p><strong>围绕“这份工作是否合适我”提问</strong></p>
<p>下面是一些你可以问的典型问题。</p>
<p><strong>问题一：你们为什么要招聘这个职位？</strong></p>
<p>这个问题会使得面试官开始谈论当前的项目，或者谈论前一位离职人员。无论哪种情况，都会让你了解，一些与你最密切相关的公司情况。</p>
<p><strong>问题二：你们的新员工多吗？</strong></p>
<p>这个问题起一个过渡作用，使得谈话导向公司内部的情况。但是，它本身也能说明一些问题。如果公司成立已经超过四年，又没有新项目，但是新员工却很多，这往往说明公司文化不是很健康。</p>
<p><strong>问题三：你们公司（团队）目前面临的最大挑战是什么？</strong></p>
<p>如果面试官开始谈论一些具体的技术问题，这很好；如果他的回答是项目时间紧迫，或者需要更多的资金，那你就要小心一点了，公司管理上面可能有问题。</p>
<p><strong>问题四：什么新技术（编程语言）是你们未来希望采用的？</strong></p>
<p>如果你申请的是技术职位，面试官恰巧又是技术负责人，那么这个问题将会非常合适。你会对公司的技术路线有所了解和准备，一旦入职，就能更好地适应公司的需要。</p>
<p><strong>问题五：在业务方面，有没有什么地方是你们不满意的，未来想要改进的？</strong></p>
<p>很少有公司，会百分之百满意自身的现状，即使那些状况很良好的公司也是如此。这个问题可以让你对公司管理层的关注重点和担忧之处，有所了解。</p>
<p><strong>问题六：我申请的这个职位，对公司的业务有何影响？</strong></p>
<p>这个问题会让你了解自己在公司的角色，以及你的岗位对公司是否重要。</p>
<h1 id="如何提高求职时的谈判能力">如何提高求职时的谈判能力？</h1>
<p>（1）记住你不是在求职，不是在展示编程技巧，而是在推销某种商业问题（增加收入或降低成本）的解决方案。</p>
<p>（2）面试时，要有自信，要平等的对话。你要的是一个互利的录用合同，不要每次对方提出要求，你都说Yes。</p>
<p>（3）雇主可能会问&quot;你的上一份工资是多少&quot;，他们其实在说&quot;给我一个理由，压低你的报酬&quot;。你要想好如何适当地回答这个问题。</p>
<p>（4）要还价。这里不仅仅指钱，还指其它你关心的方面。如果你无法要求更高的薪水，那就试着要求更多的假期。</p>
<p>（5）在对方决定录用你以后，才开始讨论薪水。因为那时，他们已经在你身上，投入了大量的时间和金钱，产生了一定的成本，此时他们可能觉得一些小问题已经不值得再纠缠了，比如每年的工资增加几千元。</p>
<h1 id="产品五问">产品五问</h1>
<ol>
<li>给谁用？</li>
<li>他们用这个产品来解决什么问题？</li>
<li>这个问题对他们而言有多重要？</li>
<li>我们的方法是否足够简单方便？</li>
<li>他们要付出的代价与所得是否匹配？</li>
</ol>
<h1 id="创业公式">创业公式</h1>
<p>Paul Graham的创业公式就是：搭建原型、上线运营（别管bug）、收集反馈、调整产品、成长壮大。</p>
<h1 id="程序员的能力">程序员的能力</h1>
<p><strong>基础：掌握语言。</strong></p>
<p>比如熟悉js——看《忍者秘籍》《语言精髓》《es6》等，而掌握语言的基础</p>
<p><strong>进阶：掌握框架、语言细节、重要的工具。babel等的插件，开发一个通用sdk。</strong></p>
<p>比如掌握react和vue的原理，状态数据管理redux和vuex等等。</p>
<p>比如git的各种常用用法。</p>
<p><strong>高级：通用解决方案。</strong></p>
<p>比如：算法、并发、分布式、沟通技巧、表达能力、领导能力</p>
<p><strong>亮点：</strong></p>
<p>技能和能力有多种，不可能也不需要掌握太多，有一两种能够给别人留下深刻印象即可。</p>
<p>比如java方向的可以是这些：</p>
<ul>
<li>你特别熟悉Spring，跟它有关的啥问题啥需求你都能搞定</li>
<li>你特别会建数据库索引，分析慢SQL原因</li>
<li>你特别会写脚本进行自动化</li>
<li>你特别会看源代码，会debug</li>
<li>你对多线程特别熟悉</li>
<li>你特别会对JVM调优</li>
<li>你特别会进行性能调优</li>
</ul>
<p>前端方向可以有哪些呢？</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/" term="心得与经验" label="心得与经验" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">内容分发网络</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/cdn.html" />
            <id>https://wss.cool/cdn.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-09-27T13:16:55+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[用CDN(内容分发网络)加快博客的访问速度。]]></summary>
            
                <content type="html"><![CDATA[<blockquote>
<p>以下将内容分发网络简称为CDN</p>
</blockquote>
<h2 id="cdn是什么">CDN是什么</h2>
<p>如果没有CDN，www.baidu.com <code>-&gt;</code> DNS解析 <code>-&gt;</code> 123.123.123.123</p>
<p>加入了CDN以后，www.baidu.com <code>-&gt;</code> DNS解析为CNAME域名 <code>-&gt;</code> CDN地址image.baidu.cnd258.com <code>-&gt;</code> 在CDN服务器中未发现请求的资源 <code>-&gt;</code> 到源服务器请求资源</p>
<p>当再次请求相同的资源时，CDN服务器会直接返回资源，而不会访问源服务器。</p>
<ol>
<li>由于有了cdn缓存资源，源服务器的压力大大减小。避免了由于访问量过多而无法响应请求。</li>
<li>cdn服务商有大量的服务器分布于广阔的地理范围内，可以就近响应请求，从而提高响应请求的速度。</li>
<li>可以通过cdn的api提前将cdn没有缓存的资源添加到缓存中，这样用户第一次访问资源就可以享受到cdn的缓存加速。</li>
</ol>
<h2 id="配置">配置</h2>
<p>我们需要提供给CDN服务商需要加速的网址和源服务器的ip或域名。服务商会给我们一个cdn网址，需要我们在网址的dns解析服务商处，加一条cname解析，将原来的网址解析为cdn网址。</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E7%9F%A5%E8%AF%86%E7%82%B9/" term="知识点" label="知识点" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" term="服务器" label="服务器" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Nginx的简单使用</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/nginx.html" />
            <id>https://wss.cool/nginx.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-09-27T13:08:38+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[nginx的配置文件目录，默认静态网站目录，ubuntu安装nginx，websocket代理。]]></summary>
            
                <content type="html"><![CDATA[<p><a href="https://www.linode.com/docs/web-servers/nginx/how-to-configure-nginx/">攻略1</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-18-04">攻略2</a></p>
<h2 id="安装">安装</h2>
<pre><code>sudo apt-get install nginx
</code></pre><h2 id="配置文件">配置文件</h2>
<p>ubuntu</p>
<pre><code>/etc/nginx/conf.d/*.conf
</code></pre><p>centos</p>
<pre><code>/usr/local/nginx/conf/
</code></pre><h2 id="常用命令">常用命令</h2>
<pre><code>sudo nginx -s reload
</code></pre><h2 id="日志">日志</h2>
<pre><code>cat /var/log/nginx/access.log
</code></pre><h2 id="https配置">https配置</h2>
<pre><code>server {
    listen 443 ssl http2;
    server_name  blog.wowfriday.cn;

    ssl                      on;
    ssl_certificate          /etc/nginx/1_blog.wowfriday.cn_bundle.crt;
    ssl_certificate_key      /etc/nginx/2_blog.wowfriday.cn.key;

    ssl_session_timeout  5m;

    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers   on;

    location / {
        proxy_pass https://wowfriday.cn;
    }
}
</code></pre><h2 id="静态网站配置">静态网站配置</h2>
<pre><code>server {
  listen 80 http;
  server_name  wowfriday.cn;

  location / {
      root   /usr/share/nginx/html;
      index  index.html index.htm;
  }
}
</code></pre><h1 id="反向代理配置">反向代理配置</h1>
<pre><code>server {
  listen 80 http;
  server_name  wowfriday.cn;

  location / {
      proxy_pass http://blog.wowfriday.cn;
  }
}
</code></pre><h1 id="websocket代理">websocket代理</h1>
<pre><code>location /wss {
  proxy_pass http://127.0.0.1:8765;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection &quot;Upgrade&quot;;
  proxy_set_header X-Real-IP $remote_addr;
}
</code></pre>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" term="服务器" label="服务器" />
                            
                        
                    
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/nginx/" term="nginx" label="nginx" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/%E5%85%A5%E9%97%A8/" term="入门" label="入门" />
                            
                        
                    
                
            
        </entry>
    
        <entry>
            <title type="text">CSS知识点汇总</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/css%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB.html" />
            <id>https://wss.cool/css%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-09-15T21:53:21+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[MDN 选择器 优先级 伪类 伪元素 盒子模型 内容、内边距、边框、外边距、box-sizing 背景……]]></summary>
            
                <content type="html"><![CDATA[<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS">MDN</a></p>
<h2 id="选择器">选择器</h2>
<h2 id="优先级">优先级</h2>
<h2 id="伪类">伪类</h2>
<h2 id="伪元素">伪元素</h2>
<h2 id="盒子模型">盒子模型</h2>
<ul>
<li>内容、内边距、边框、外边距、box-sizing</li>
<li>背景颜色、背景图片、背景渐变色</li>
<li>outline、box-shadow</li>
</ul>
<h2 id="外边距合并">外边距合并</h2>
<p>块级元素的上外边距和下外边距有时会合并（或折叠）为一个外边距，其大小取其中的最大者</p>
<h2 id="布局">布局</h2>
<ul>
<li>浮动和定位在内的传统布局方法</li>
<li>弹性盒（flexbox）布局</li>
</ul>
<h2 id="书写规范">书写规范</h2>
<h2 id="less">less</h2>
<p><a href="http://lesscss.org">官网</a></p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/css/" term="css" label="css" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">React With Gesture</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/react-with-gesture.html" />
            <id>https://wss.cool/react-with-gesture.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-08-28T13:21:48+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[react的手势拖拽的库，支持鼠标和触屏]]></summary>
            
                <content type="html"><![CDATA[<p><a href="https://www.npmjs.com/package/react-with-gesture">文档</a></p>
<p>yarn add react-with-gesture</p>
<p>import { useGesture, withGesture, Gesture } from 'react-with-gesture'</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/react/" term="react" label="react" />
                            
                        
                    
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/%E6%89%8B%E5%8A%BF/" term="手势" label="手势" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/%E6%8B%96%E6%8B%BD/" term="拖拽" label="拖拽" />
                            
                        
                    
                
            
        </entry>
    
        <entry>
            <title type="text">workbox</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/workbox/" />
            <id>https://wss.cool/workbox/</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-08-28T09:53:21+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[利用workbox实现资源的预下载]]></summary>
            
                <content type="html"><![CDATA[<p><a href="https://developers.google.com/web/tools/workbox/guides/get-started">官网</a></p>
<h2 id="需求">需求</h2>
<ol>
<li>资源本地化：上课时课件的所有资源预先下载。</li>
<li>绘本插件图片资源多，需要预先下载。</li>
</ol>
<h2 id="实现方案">实现方案</h2>
<p>workbox</p>
<h2 id="使用">使用</h2>
<ol>
<li>安装 workbox
<pre><code>npm install workbox-cli --global
</code></pre></li>
<li>在项目目录下运行命令，进行 workbox 的配置，会生成一个配置文件 workbox-config.js
<pre><code>cd ./a/b/project_path
workbox wizard
</code></pre></li>
<li>默认生成的 workbox 的依赖是 google 的 cdn ，国内无法访问，可通过配置改为使用本地依赖。在配置文件（workbox-config.js）中添加或修改为
<pre><code>&quot;importWorkboxFrom&quot;: &quot;local&quot;,
</code></pre></li>
<li>根据配置文件让 workbox 工作，会生成一些 service worker 相关的文件，入口是 sw.js 文件
<pre><code>workbox generateSW workbox-config.js
</code></pre></li>
<li>在项目入口的html文件（index.html）中引入 workbox 。
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span> <span class="k">in</span> <span class="nx">navigator</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;/sw.js&#39;</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>workbox 会遍历它的工作目录下的所有html文件，将html文件及其中依赖的图片、css和js文件全部加入一个列表中。当第一个页面载入后 workbox 开始工作，利用 service worker 的 api 预下载列表中的文件（缓存）。当访问其他网页或者没有网络/弱网时，就可以使用缓存工作。</p>
<p>通过 workbox 的配置，也可以通过 workbox 的 api 实现一个高级功能。</p>
<p>比如缓存的优先级的设置。资源可能会更新，当网络可用时，workbox 是使用缓存的资源还是请求网络上的资源，可以通过设置缓存的优先级策略来根据需要配置。</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                    
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/service-worker/" term="service worker" label="service worker" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/workbox/" term="workbox" label="workbox" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/%E9%A2%84%E4%B8%8B%E8%BD%BD/" term="预下载" label="预下载" />
                            
                        
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Git</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/git/" />
            <id>https://wss.cool/git/</id>
            <updated>2020-03-27T20:53:36+08:00</updated>
            <published>2019-07-18T10:53:36+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[Git 常用操作，暂存，刷新远程分支列表，取消追踪，代理设置等。]]></summary>
            
                <content type="html"><![CDATA[<h2 id="删除本地的所有分支除了master">删除本地的所有分支，除了master</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git branch <span class="p">|</span> grep -v <span class="s2">&#34;master&#34;</span> <span class="p">|</span> xargs git branch -d
</code></pre></td></tr></table>
</div>
</div><h2 id="暂存改动">暂存改动</h2>
<table>
<thead>
<tr>
<th align="center">操作</th>
<th align="center">代码</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">暂存</td>
<td align="center">git stash</td>
</tr>
<tr>
<td align="center">列表</td>
<td align="center">git stash list</td>
</tr>
<tr>
<td align="center">取出</td>
<td align="center">git stash pop 1</td>
</tr>
</tbody>
</table>
<h2 id="刷新本地的远程分支列表">刷新本地的远程分支列表</h2>
<p>远程已经被删除的分支，在本地使用<code>git branch -a</code>命令是依然可以看到。所以需要刷新一下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git remote prune origin
</code></pre></td></tr></table>
</div>
</div><p>这条命令是删除与<name>关联的陈旧引用</p>
<p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git fetch -p
</code></pre></td></tr></table>
</div>
</div><p>这条命令是在获取之前，删除远程不再存在的任何远程跟踪引用。</p>
<h2 id="不相干分支强制pull或push等操作">不相干分支强制pull或push等操作</h2>
<p>在命令后面加<code>--allow-unrelated-histories</code></p>
<h2 id="推送当前分支到远端">推送当前分支到远端</h2>
<p>如果你还没有推到原点，那么<code>git push -u origin HEAD</code>可以在本地分支中设置上游跟踪信息。</p>
<h2 id="使用一次新的commit替代上一次提交">使用一次新的commit，替代上一次提交</h2>
<p>如果代码没有任何新变化，则用来改写上一次commit的提交信息</p>
<pre><code>git commit --amend -m &quot;666&quot;
</code></pre><p>代码有变动，要制定文件</p>
<pre><code>git commit --amend src\plugins\icElement_vote\components\config.vue src\plugins\icElement_chose\components\config.vue
  -m &quot;fix(编辑器-选择题/投票题):删除不是当前选中的选项&quot;
</code></pre><h2 id="获取当前分支名">获取当前分支名</h2>
<pre><code>git symbolic-ref --short -q HEAD 
</code></pre><h2 id="推送当前分支到远端会在远端新建当前分支名的新分支">推送当前分支到远端，会在远端新建当前分支名的新分支</h2>
<pre><code>git push -u origin HEAD  
</code></pre><h2 id="获取上一次commit的message">获取上一次commit的message</h2>
<pre><code>git log -1 --pretty=%B  
</code></pre><h2 id="如果有文件没有被add则git-status时有提示">如果有文件没有被add，则git status时有提示</h2>
<p>Changes not staged for commit:
有文件被add了：
Changes to be committed
上面两种可以同时存在。</p>
<h2 id="分支间摘-commit">分支间摘 commit</h2>
<p>分支A有5次提交，想把其中的第二三次提交拿到B分支，先拿到 commit 的 id 可通过 <code>git log -1 --pretty=%B</code> 取到。然后使用摘樱桃命令：</p>
<pre><code>git cherry-pick 5cf6d24
</code></pre><p>分支B就把这次commit摘过来了。</p>
<h2 id="代理">代理</h2>
<p>全局设置</p>
<pre><code>git config --global http.proxy 'socks5://127.0.0.1:1080'
git config --global https.proxy 'socks5://127.0.0.1:1080'
</code></pre><p>全局取消</p>
<pre><code>git config --global --unset http.proxy
git config --global --unset https.proxy
</code></pre><p>#只对github.com</p>
<pre><code>git config --global http.https://github.com.proxy socks5://127.0.0.1:1080
</code></pre><p>#取消代理</p>
<pre><code>git config --global --unset http.https://github.com.proxy
</code></pre><h2 id="取消追踪">取消追踪</h2>
<pre><code>git rm -r --cached 文件或目录
</code></pre><h2 id="切换分支branch">切换分支(branch)</h2>
<p>想看React的代码，因为v16有些新特性，所以想看v15的代码。clone代码以后，使用 <code>git branch</code> 查看分支，发现只有 <code>master</code> ，但是看 github 上是有 15-stable 分支的。<br>
解决办法：使用 <code>git branch -a</code> 可以看到所有分支，包括远端的分支，其中有 <code>remotes/origin/15-stable</code> 分支，用这个名字切换分支即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 远程分支列表</span>
git branch -r
<span class="c1"># 所有分支列表（包括远程）</span>
git branch -a 
<span class="c1"># 分支列表</span>
git branch
<span class="c1"># 创建并切换到dev分支,</span>
git checkout -b dev
<span class="c1"># 上面的命令，等于下面的两条命令</span>
<span class="c1"># 创建分支</span>
git branch dev 
<span class="c1"># 切换分支</span>
git checkout dev
</code></pre></td></tr></table>
</div>
</div><h2 id="分支合并">分支合并</h2>
<p>建议合并时保留目标分支的commit信息。即使用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git merge --no-ff <span class="o">[</span>branch name<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>当合并错了以后怎么撤销合并呢，使用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git reset --hard <span class="o">[</span>merge的版本号<span class="o">]</span> <span class="c1">#版本号使用 git log 查，这种方法只针对合并以后对当前分支没有过其他操作，有的话比较复杂</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>合并远程分支：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 如果本地没有远程分支：</span>
git checkout -b develop origin/develop <span class="c1"># 本地新建develop分支并拉取</span>
<span class="c1"># 如果本地已有远程分支：</span>
git checkout develop 
git pull origin develop <span class="c1">#拉取远程代码</span>

<span class="c1"># 方法二：</span>
git fetch origin dev:temp <span class="c1">#拉取远程dev分支，创建本地temp分支</span>
git diff temp
git merge temp <span class="c1"># 合并</span>
git branch -d temp <span class="c1">#删除</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="删除远程分支">删除远程分支</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git push origin -d <span class="o">[</span>远程分支名<span class="o">]</span>
git push origin :<span class="o">[</span>远程分支名<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>git push origin :experimental<br>
Find a ref that matches experimental in the origin repository (e.g.  refs/heads/experimental), and delete it.</p>
</blockquote>
<h2 id="查看记录log">查看记录log</h2>
<p><code>git log</code> 这样会打印出超级多的信息，包括SHA-1、作者、时间、message,很啰嗦，还是不要这么用得好。<br>
<code>git log --pretty=format:&quot;%h - %an, %ar : %s&quot;</code> 按格式打印信息，具体选项如下 <br>
git log --graph
git log --graph --oneline --decorate</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>%H</td>
<td>提交对象（commit）的完整哈希字串</td>
</tr>
<tr>
<td>%h</td>
<td>提交对象的简短哈希字串</td>
</tr>
<tr>
<td>%T</td>
<td>树对象（tree）的完整哈希字串</td>
</tr>
<tr>
<td>%t</td>
<td>树对象的简短哈希字串</td>
</tr>
<tr>
<td>%P</td>
<td>父对象（parent）的完整哈希字串</td>
</tr>
<tr>
<td>%p</td>
<td>父对象的简短哈希字串</td>
</tr>
<tr>
<td>%an</td>
<td>作者（author）的名字</td>
</tr>
<tr>
<td>%ae</td>
<td>作者的电子邮件地址</td>
</tr>
<tr>
<td>%ad</td>
<td>作者修订日期（可以用 -date= 选项定制格式）</td>
</tr>
<tr>
<td>%ar</td>
<td>作者修订日期，按多久以前的方式显示</td>
</tr>
<tr>
<td>%cn</td>
<td>提交者(committer)的名字</td>
</tr>
<tr>
<td>%ce</td>
<td>提交者的电子邮件地址</td>
</tr>
<tr>
<td>%cd</td>
<td>提交日期</td>
</tr>
<tr>
<td>%cr</td>
<td>提交日期，按多久以前的方式显示</td>
</tr>
<tr>
<td>%s</td>
<td>提交说明</td>
</tr>
</tbody>
</table>
<p><code>git log -2 --oneline</code> 打印最近两次的简化后的记录，其中<code>--oneline</code>为	<code>--pretty=oneline --abbrev-commit</code> 命令的简化用法。<code>-n</code>为最近n次的提交。<br>
<code>git log --since=2.weeks</code> 打印2周内的记录，具体选项如下</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-(n)</td>
<td>仅显示最近的 n 条提交</td>
</tr>
<tr>
<td>--since, --after</td>
<td>仅显示指定时间之后的提交。</td>
</tr>
<tr>
<td>--until, --before</td>
<td>仅显示指定时间之前的提交。</td>
</tr>
<tr>
<td>--author</td>
<td>仅显示指定作者相关的提交。</td>
</tr>
<tr>
<td>--committer</td>
<td>仅显示指定提交者相关的提交。</td>
</tr>
</tbody>
</table>
<p><code>git log --pretty=&quot;%h - %s&quot; --author=wss --since=&quot;2008-10-01&quot; --before=&quot;2008-11-01&quot;</code> 各种条件可以一起用<br>
<code>git log -p -2</code> 查看最近两次提交，并显示提交内容（具体改动了什么）</p>
<h2 id="标签">标签</h2>
<p>将某次commit打上标签
<code>git tag &lt;name </code> 默认给最新提交打标签。<br>
<code>git tag</code> 查看所有标签
<code>git tag v0.9 f52c633</code> 根据commit id给某次提交打标签</p>
<h2 id="在缓存中移除某个目录">在缓存中移除某个目录</h2>
<p><code>git rm -r --cached some-directory</code></p>
<h2 id="攻略">攻略</h2>
<p>Git 原理入门 <a href="http://www.ruanyifeng.com/blog/2018/10/git-internals.html">http://www.ruanyifeng.com/blog/2018/10/git-internals.html</a></p>
<p>Git 分支管理策略 <a href="http://www.ruanyifeng.com/blog/2012/07/git.html">http://www.ruanyifeng.com/blog/2012/07/git.html</a></p>
<p>Git 工作流程 <a href="http://www.ruanyifeng.com/blog/2015/12/git-workflow.html">http://www.ruanyifeng.com/blog/2015/12/git-workflow.html</a></p>
<p>Git 使用规范流程 <a href="http://www.ruanyifeng.com/blog/2015/08/git-use-process.html">http://www.ruanyifeng.com/blog/2015/08/git-use-process.html</a></p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/" term="工具" label="工具" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">web前端对密码加密的意义</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/posts/experience/web%E5%89%8D%E7%AB%AF%E5%AF%B9%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86%E7%9A%84%E6%84%8F%E4%B9%89/" />
            <id>https://wss.cool/posts/experience/web%E5%89%8D%E7%AB%AF%E5%AF%B9%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86%E7%9A%84%E6%84%8F%E4%B9%89/</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-07-06T10:04:07+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[web前端对密码加密的意义 有的运维或者后台会记录包含请求体的 access log，如果不加密，l……]]></summary>
            
                <content type="html"><![CDATA[<h1 id="web前端对密码加密的意义httpswwwv2excomt522221"><a href="https://www.v2ex.com/t/522221">web前端对密码加密的意义</a></h1>
<blockquote>
<p>有的运维或者后台会记录包含请求体的 access log，如果不加密，log 里面就是明文密码。这种在架构上垂直扩展&amp;多层的公司很容易发生。GitHub 就翻车过一次，在请求日志里发现了明文密码，然后就群发邮件通知用户改密码。 @lincanbin</p>
</blockquote>
<blockquote>
<p>用单向函数“加密”等同于明文 @hanru</p>
</blockquote>
<blockquote>
<p>能增加攻击的难度。安全领域并不是非黑即白的，如果小量成本能挡住小学 3 年级的傻子攻击，那就有意义 @otakustay</p>
</blockquote>
<blockquote>
<p>任何提高攻击门槛的做法都是有意义的 @newmlp</p>
</blockquote>
<blockquote>
<p>感觉一般加密意义不大，中间人重放就可以了，但聊胜于无。顺便一说 B 站采用的是前端非对称加密 @lzvezr</p>
</blockquote>
<blockquote>
<p>非对称加密。用公钥加密，知道 JS 源码也没用。但是我觉得在 HTTPS 下面没必要。另外，如果进日志，肯定不要存密码啊。如果原封进日志，那所有加密都没有意义。因为这个加密过的密码本来就可以从前端登录进去。我只是不知道明文而已。CDN 商是可以拦截保存，所以不要啥的都经过 CDN。基于上面的分析，还有一种比较稳妥的方式是前端密码提交的时候，附上 timestamp，用 RSA 公钥加密，服务器私钥解密后验证时间，然后登录一次 timestamp 作废。这样日志泄露或者被拦截，也无法用原密文重放 @lhx2008</p>
</blockquote>
<blockquote>
<p>看了下苹果、微软、谷歌、fb 这几个登录页面都是明文传输密码的，百度、淘宝、qq 都是先前端加密，总结一下就是在国外没意义，国内有意义 @iiji86</p>
</blockquote>
<h1 id="用户密码安全性设计httpsblogcoderzhcom20160103security-design"><a href="https://blog.coderzh.com/2016/01/03/security-design/">用户密码安全性设计</a></h1>
<h1 id="即使被拖库也可以保证密码不泄露httpsblogcoderzhcom20160110a-password-security-design-example"><a href="https://blog.coderzh.com/2016/01/10/a-password-security-design-example/">即使被拖库，也可以保证密码不泄露</a></h1>
<h1 id="前端rsa私钥加密httpsgithubcomtravistjsencrypt"><a href="https://github.com/travist/jsencrypt">前端rsa私钥加密</a></h1>
<h1 id="web前端密码加密是否有意义---w2014的回答httpswwwzhihucomquestion25539382answer539557939"><a href="https://www.zhihu.com/question/25539382/answer/539557939">Web前端密码加密是否有意义？ - w2014的回答</a></h1>
<p>事实上现代密码学已经可以做到很多让人难以想象的事情了下面是一些有一点“反常识”的结论<br>
1.A可以向B证明自己拥有一个密码，但是如果B是假冒的验证者，A不会透露关于密码的任何信息给B。——“零知识证明”<br>
2.A可以和B比较自己持有的一个值的大小关系，而不泄露这个值给对方。——“百万富翁问题”<br>
3.A可以给B发来的一段信息进行电子签名，而不知道信息的内容。——“盲签名”<br>
4.A和B可以，在没有公正第三人的情况下，进行等概率胜负的博弈。——“电子博弈”<br>
5.邮件服务，如果不考虑法律风险的话，是可以做到让服务器看不到你的邮件内容的。——PGP<br>
6.破解4096位RSA是困难的。——即使用超算也如此。破解256位AES是困难的。——即使用量子计算也如此。破解OTP系统是困难（划掉）不可能的。——即使天顶星人来了也如此。<br>
7.一个好的加密算法真的应该是公开的——它可以接受更多人的检验。    一个好的密码系统不一定是公开的——但是它应该按照可以公开除了密码之外的一切而依旧安全来设计。<br>
8.可以实现这样的算法，使得班干部中的任何一个均可以以班委会的名义下达通知，且其他人，除了班长之外，都不知道具体下达者。<br>
9.密码系统的安全性取决于最弱的一环……当年是谁说的“只用https保护登录界面就够了”的来着…你的token也会被盗<br>
10.大多数密码系统都不是被正面攻破的…而是实现过程中出了差错…<br>
11.以上内容，真的，真的，在大多数的密码学教材上都能找到——甚至还有用到的一些算法安全性的数学证明…</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/" term="心得与经验" label="心得与经验" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">为博客打造在线编辑器</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/online-editor-for-markdown-blog/" />
            <id>https://wss.cool/online-editor-for-markdown-blog/</id>
            <updated>2019-10-18T08:47:32+08:00</updated>
            <published>2019-06-23T21:12:32+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[使用vscode开源的编辑器，制作一个在线的博客编辑器。]]></summary>
            
                <content type="html"><![CDATA[<h2 id="初衷">初衷</h2>
<p>博客的内容时使用git管理的。在公司的电脑和家里的两台电脑上都有写博客的需求，那么在3个端的每次的pull和push就显得有一点麻烦。如果有一个基于浏览器访问的编辑器就舒服多了。</p>
<h2 id="构思">构思</h2>
<p>我的博客使用了hugo，它的内容是基于markdown或html的，所以如果把博客源文件放在服务器上，同时搭建一个可以编辑这些源文件的后台，就可以实现基于浏览器编辑博客了。</p>
<p>vscode开源了他们的编辑器monaco-editor，可以使用它作为浏览器中的编辑器。</p>
<p>在搭建一个后台程序来读取博客文章内容，配合若干接口实现保存、创建、删除、登录等功能即可。</p>
<h2 id="editor项目">editor项目</h2>
<p>此项目作为后台服务，需要提供的接口有：</p>
<ol>
<li>创建文章</li>
<li>保存文章</li>
<li>提交到git并push到仓库，并打包发布。</li>
</ol>
<p>准备使用golang实现。需要用到的golang的api有：
……</p>
<h3 id="制作image">制作image</h3>
<pre><code>sudo docker image build -t myeditor .
</code></pre><h3 id="启动容器">启动容器</h3>
<pre><code>sudo docker container run -d  --rm -p 3000:3000 -v &quot;/home/wang/code/hugo/content/posts&quot;:/app/blog myeditor
</code></pre><h2 id="hugo项目中的docker">hugo项目中的docker</h2>
<h3 id="生成image">生成image</h3>
<pre><code>sudo docker image build -t site .
</code></pre><h3 id="启动nginx容器">启动nginx容器</h3>
<pre><code>sudo docker container run --rm --name myblog \
-p 80:80 -p 443:443 -d \
--volume &quot;$PWD/public&quot;:/usr/share/nginx/html site
</code></pre><h3 id="打包hugo">打包hugo</h3>
<pre><code>hugo --baseURL https://wowfriday.cn/
</code></pre><pre><code>hugo serve --renderToDisk --baseURL https://wowfriday.cn/ --appendPort=false
hugo serve --renderToDisk --appendPort=false
</code></pre>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%8A%98%E8%85%BE/" term="折腾" label="折腾" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Favicon Emoji</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/favicon-emoji.html" />
            <id>https://wss.cool/favicon-emoji.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-06-12T17:58:07+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[使用emoji表情作为网站的favicon]]></summary>
            
                <content type="html"><![CDATA[<p>先加一个这个</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;icon&#34;</span> <span class="na">data-emoji</span><span class="o">=</span><span class="s">&#34;🛰&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;image/png&#34;</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>在来一段js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">favicon</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;link[rel=icon]&#34;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">favicon</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">emoji</span> <span class="o">=</span> <span class="nx">favicon</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&#34;data-emoji&#34;</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">emoji</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;canvas&#34;</span><span class="p">);</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>

    <span class="kr">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&#34;2d&#34;</span><span class="p">);</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s2">&#34;64px serif&#34;</span><span class="p">;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">emoji</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>

    <span class="nx">favicon</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Linux的简单使用</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/linux.html" />
            <id>https://wss.cool/linux.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-06-11T23:02:30+08:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[安装二进制软件 下载tar.gz压缩包 use the command tar vxzf hugo.tar.gz move lib to /usr/local/bin, command:mv ~/download/hugo /usr/local/bin/hugo set path vim ~/.zshrc add export PATH=/usr/local/bin/hugo:$PATH source ~/.zshrc 复制……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="安装二进制软件">安装二进制软件</h2>
<ol>
<li>下载tar.gz压缩包</li>
<li>use the command <code>tar vxzf hugo.tar.gz </code></li>
<li>move lib to <code>/usr/local/bin</code>, command:<code>mv ~/download/hugo /usr/local/bin/hugo</code></li>
<li>set path <code>vim ~/.zshrc</code></li>
<li>add <code>export PATH=/usr/local/bin/hugo:$PATH</code></li>
<li><code>source ~/.zshrc</code></li>
</ol>
<h2 id="复制">复制</h2>
<p>sudo cp -r public /usr/share/nginx/html/blog</p>
<h2 id="端口被占用">端口被占用</h2>
<p>lsof -i :80</p>
<h2 id="解析域名">解析域名</h2>
<p>apt install dig</p>
<p>dig wss.cool</p>
<h2 id="设置梯子-客户端">设置梯子-客户端</h2>
<p>使用shadowsocks-libev，</p>
<p>安装 <code>sudo apt-get install shadowsocks-libev</code></p>
<p>配置文件在 <code>/etc/shadowsocks-libev/config.json</code></p>
<p>修改后启动服务 <code>systemctl start shadowsocks-livev-local@config</code></p>
<p>开机自启动 <code>systemctl enable shadowsocks-livev-local@config</code></p>
<p>可以查看日志 <code>journalctl -u shadowsocks-livev-local@config</code></p>
<h2 id="使用systemd启动关闭java程序">使用systemd启动关闭Java程序</h2>
<p><a href="https://stackoverflow.com/a/28704296/6021280">参考1</a></p>
<p>使用spring boot创建的项目，使用maven打包出来成jar包。上传到服务器，这里使用linux的systemd来开启和关闭java程序。</p>
<p>首先找到用户定义的service目录，ubuntu是在<code>/etc/systemd/system</code>，其他发行版可能在<code>/usr/lib/systemd/system/</code></p>
<p>第二步，在其中创建文件<code>名字.service</code>，我的是叫<code>blog.service</code>，编辑文件。</p>
<pre><code>[Unit]
Description=webserver Daemon

[Service]
ExecStart=/usr/bin/java -jar /web/server.jar
User=ubuntu

[Install]
WantedBy=multi-user.target
</code></pre><p>第三步，启动/关闭/查看状态。</p>
<p>命令可以这样用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo systemctl start blog.service <span class="c1"># starts the service</span>
sudo systemctl stop blog.service <span class="c1"># stops the service</span>

sudo systemctl status blog.service
sudo systemctl restart blog.service <span class="c1"># restarts the service</span>

sudo systemctl <span class="nb">enable</span> blog.service <span class="c1"># auto starts the service</span>
sudo systemctl disable blog.service <span class="c1"># stops autostart</span>
</code></pre></td></tr></table>
</div>
</div><p>还可以这样用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo service blog start/stop/status/restart
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" term="服务器" label="服务器" />
                            
                        
                    
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/linux/" term="linux" label="linux" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/%E5%85%A5%E9%97%A8/" term="入门" label="入门" />
                            
                        
                    
                
            
        </entry>
    
        <entry>
            <title type="text">docker</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/docker.html" />
            <id>https://wss.cool/docker.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-06-06T01:47:46+00:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[ubuntu安装docker 使用清华源安装，地址，按照文档操作即可。 设置docker……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="ubuntu安装docker">ubuntu安装docker</h2>
<p>使用清华源安装，<a href="https://mirror.tuna.tsinghua.edu.cn/help/docker-ce/">地址</a>，按照文档操作即可。</p>
<h2 id="设置docker源为阿里镜像">设置docker源为阿里镜像</h2>
<pre><code>sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  &quot;registry-mirrors&quot;: [&quot;https://2sjdzxnu.mirror.aliyuncs.com&quot;]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre><h2 id="tensorflow">tensorflow</h2>
<p>系统ubuntu 18.04，显卡Gtx950，驱动390。</p>
<ol>
<li>安装<code>nvidia-docker</code>和<code>nvidia-container-runtime</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey <span class="p">|</span> <span class="se">\
</span><span class="se"></span>  sudo apt-key add -
<span class="nv">distribution</span><span class="o">=</span><span class="k">$(</span>. /etc/os-release<span class="p">;</span><span class="nb">echo</span> <span class="nv">$ID$VERSION_ID</span><span class="k">)</span>
curl -s -L https://nvidia.github.io/nvidia-docker/<span class="nv">$distribution</span>/nvidia-docker.list <span class="p">|</span> <span class="se">\
</span><span class="se"></span>  sudo tee /etc/apt/sources.list.d/nvidia-docker.list
sudo apt-get update
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt-get install -y nvidia-docker2<span class="o">=</span>2.0.3+docker18.09.1-1 nvidia-container-runtime<span class="o">=</span>2.0.0+docker18.08.1-1
sudo pkill -SIGHUP dockerd
</code></pre></td></tr></table>
</div>
</div><p>测试一下</p>
<p><code>docker run --runtime=nvidia --rm nvidia/cuda:9.0-base nvidia-smi</code></p>
<p><a href="https://github.com/NVIDIA/nvidia-docker/issues/578">如果报错<code>docker: Error response from daemon: Unknown runtime specified nvidia.</code></a></p>
<p>解决方法：</p>
<blockquote>
<p>Systemd drop-in file
sudo mkdir -p /etc/systemd/system/docker.service.d
sudo tee /etc/systemd/system/docker.service.d/override.conf &lt;&lt;EOF
[Service]
ExecStart=
ExecStart=/usr/bin/dockerd --host=fd:// --add-runtime=nvidia=/usr/bin/nvidia-container-runtime
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
Daemon configuration file
sudo tee /etc/docker/daemon.json &lt;&lt;EOF
{
&quot;runtimes&quot;: {
&quot;nvidia&quot;: {
&quot;path&quot;: &quot;/usr/bin/nvidia-container-runtime&quot;,
&quot;runtimeArgs&quot;: []
}
}
}
EOF
sudo pkill -SIGHUP dockerd
再次测试。</p>
</blockquote>
<ol start="2">
<li>安装tensorflow的docker，<a href="https://github.com/NVIDIA/nvidia-docker/issues/931">由于驱动旧，不能使用最新的tensorflow版本</a>，就先用1.11.0版本。还要用python3，所以安装的docker image是这个<code>sudo docker pull tensorflow/tensorflow:1.11.0-gpu-py3</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo docker run -p 8888:8888 --volume <span class="s2">&#34;</span><span class="nv">$PWD</span><span class="s2">&#34;</span>:/notebooks --runtime<span class="o">=</span>nvidia -it tensorflow/tensorflow:1.11.0-gpu-py3
</code></pre></td></tr></table>
</div>
</div><p>启动后会直接打开一个jupyter，可以先做一下gpu的测试。
这样就算是搭号GPU环境了。</p>
<p>但是这个环境中没有安装opencv-python或者opencv-contrib-python，也没有～/.keras/modelsinception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5文件。</p>
<p>这里可能需要自己再打包一个image，可以参考这个<a href="https://blog.csdn.net/chenming_hnu/article/details/70184543">链接</a><br>
还可以试一下用映射解决</p>
<p><code>--volume</code>为“映射”，当前目录（$PWD）中的文件，会反映容器中个的<code>/notebooks</code>目录下。<br>
tensorflow这个image会启动一个jupyter，其中就可以访问到<code>$PWD</code>目录。</p>
<h2 id="腾讯云的docker仓库">腾讯云的docker仓库</h2>
<p>账号w..........<br>
密码w...1......</p>
<p><code>docker image build -t site . </code></p>
<p>方案1：使用<code>hugo</code>命令手动将也构建到public目录，然后启动docker是映射目录<br>
<code>sudo docker container run --rm --name myblog -p 80:80 -p 443:443 --volume &quot;$PWD/public&quot;:/usr/share/nginx/html site</code></p>
<p>方案2：使用<code>hugo server -D</code>命令运行测试服务器，修改nginx的default.conf文件，加入反向代理配置。</p>
<p>登录腾讯云 docker registry</p>
<p><code>sudo docker login --username=wangshushuo hub.tencentyun.com</code><br>
登录 registry 的用户名是您 Tencent Hub 的用户名，密码是您开通   Tencent Hub 用户时设置的密码。</p>
<p>从 registry 拉取镜像</p>
<p><code>sudo docker pull hub.tencentyun.com/wangshushuo/site:[tag]</code></p>
<p>其中 [tag] 请根据您的镜像版本信息进行填写。</p>
<p>将镜像推送到 registry</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo docker tag <span class="o">[</span>ImageId<span class="o">]</span> hub.tencentyun.com/wangshushuo/site:<span class="o">[</span>tag<span class="o">]</span>

sudo docker login --username<span class="o">=</span>wangshushuo hub.tencentyun.com
sudo docker tag site hub.tencentyun.com/wangshushuo/site
sudo docker push hub.tencentyun.com/wangshushuo/site
</code></pre></td></tr></table>
</div>
</div><h2 id="加速image文件上传到云服务器">加速image文件上传到云服务器。</h2>
<p>云服务器的快带只有1m，我猜测上传速度会很慢，一个image文件有七八十兆，可能要上传很久。</p>
<p>腾讯云有免费的docker仓库，可以上传image文件。</p>
<p>再从腾讯云服务器pull image文件，就很快。</p>
<h2 id="将wordpress的nginx配置改掉了">将wordpress的nginx配置改掉了</h2>
<p>docker开启在8080端口，修改了原来wp的配置为：</p>
<pre><code class="language-conf" data-lang="conf">server {
  listen 80;
  listen 443 ssl http2;
  ssl_certificate /usr/local/nginx/conf/ssl/1_wowfriday.cn_bundle.crt;
  ssl_certificate_key /usr/local/nginx/conf/ssl/2_wowfriday.cn.key;
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
  ssl_prefer_server_ciphers on;
  ssl_session_timeout 10m;
  ssl_session_cache builtin:1000 shared:SSL:10m;
  ssl_buffer_size 1400;
  add_header Strict-Transport-Security max-age=15768000;
  ssl_stapling on;
  ssl_stapling_verify on;
  server_name wowfrday.cn;
  access_log /data/wwwlogs/wowfrday.cn_nginx.log combined;
  index index.html index.htm index.php;
  root /data/wwwroot/wowfrday.cn/;

  if ($ssl_protocol = &quot;&quot;) { return 301 https://$host$request_uri; }
  

  location /{
    proxy_pass https://localhost:8080;
  }
}
</code></pre><h2 id="phpmyadmin">phpmyadmin</h2>
<pre><code>docker run --name myphpadmin -d -e PMA_ARBITRARY=1 -p 8080:80 phpmyadmin/phpmyadmin
</code></pre>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%B7%A5%E5%85%B7/" term="工具" label="工具" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">如何拥有技术领导力？</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/lead.html" />
            <id>https://wss.cool/lead.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-05-06T02:38:58+00:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[左耳听风专栏 第一，吃透基础技术，基础技术是各种上层技术的共同的基础。 计算机技术太多，……]]></summary>
            
                <content type="html"><![CDATA[<p><a href="">左耳听风专栏</a></p>
<h2 id="第一吃透基础技术基础技术是各种上层技术的共同的基础">第一，吃透基础技术，基础技术是各种上层技术的共同的基础。</h2>
<p>计算机技术太多，但仔细分析你会发现，知识表现形式多，而基础技术并不多。学好基础技术，能让你一通百通，更快地使用各种新技术，从而可以更轻松地与时代同步。</p>
<p>基础技术主要是两部分：编程和系统。</p>
<h3 id="编程部分">编程部分：</h3>
<p>**C语言：**更接近底层，能更好地理解程序的运行。</p>
<p>**编程范式：**培养抽象思维，提高编程效率，提高程序的结构合理性、可读性和可维护性，降低冗余度。学习编程范式：多了解各种程序设计语言的功能特性。</p>
<p>**算法和数据结构：**任何有技术含量的软件中一定有高级的算法和数据结构。比如epoll中使用红黑树，数据库索引使用B+树。业务中的各种排序、过滤、查找也用到算法。</p>
<h3 id="系统部分">系统部分：</h3>
<p><strong>网络基础：</strong>《TCP/IP详解》，学习基础的网络协议，可以为我们的高纬度分布式架构中的一些技术问题提供很多的技术方案。比如TCP的滑动窗口限流，完全可以用于分布式服务中的限流方案。</p>
<p>**数据库原理：**文件系统适合存放连续的信息，比如图片，文章。如果保存很短的信息也保存文件的画，会浪费大量的磁盘空间，而且无法方便地查询。数据库更适合存放短的数据。且能方便的查询。流行的两类数据库管理系统：SQL和NoSQL。前者B+数，强一致性，后者弱一致性，高存取效率，基于哈希表和其他技术。</p>
<p>学习数据库原理，能了解数据库访问性调优的要点。以及保证并发情况下的数据操作的原子性。</p>
<p>**分布式技术架构：**数据库和应用程序服务器需要横向扩展，才能提供做够高的性能。为了做到这一点，要学习分布式技术架构，包括负载均衡、DNS解析、多子域名、无状态应用层、缓存层、数据库分片、容错和恢复机制、Paxos、Map/Reduce操作、分布式SQL数据库一致性等知识点。</p>
<p>学习分布式技术架构的有效途径是参与到分布式项目的开发中去，并阅读相关论文。</p>
<h2 id="第二提高学习能力就是能够很快地学习新技术又能在关键技术上深入的能力">第二，提高学习能力。就是能够很快地学习新技术，又能在关键技术上深入的能力。</h2>
<p>只有掌握了上述基础原理之上，才能拥有好的学习能力。</p>
<h2 id="第三坚持做正确的事">第三，坚持做正确的事。</h2>
<p>做正确的事，比用正确的方法做事更重要。因为这样才始终会向目的地靠拢。</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/" term="心得与经验" label="心得与经验" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">CSS命名</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/css-module.html" />
            <id>https://wss.cool/css-module.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-03-27T05:08:59+00:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[使用less和css module。在A和B两个less文件中分别写如下的样式。 .textfillsContainer{ background-color:red; .textfills{……]]></summary>
            
                <content type="html"><![CDATA[<p>使用less和css module。在A和B两个less文件中分别写如下的样式。</p>
<pre><code>.textfillsContainer{
  background-color:red;
  .textfills{
      background-color:red;
  }
}
</code></pre><p>A文件：
<img src="/images/css_class_name/image-9.png" alt="A文件" title="A文件">
B文件：
<img src="/images/css_class_name/image-8.png" alt="B文件" title="B文件"></p>
<p>在编译打包后的文件中观察：</p>
<p>A文件打包出来的css代码：
<img src="/images/css_class_name/image-6.png" alt="B文件" title="A文件的实际css代码"></p>
<p>B文件打包出来的css代码：
<img src="/images/css_class_name/image-7.png" alt="B文件" title="B文件的实际css代码"></p>
<p>可以看到，即使是相同的class名，由于less或者css module的作用，会视文件为一个模块，在打包时，根据模块对class名做混淆哈希。</p>
<p>所以只要不在一个文件（模块）中使用相同class名就能避免命名冲突。</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/css/" term="css" label="css" />
                            
                        
                    
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/classname/" term="classname" label="classname" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/css/" term="css" label="css" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/tags/module/" term="module" label="module" />
                            
                        
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Typescript & React</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/typescript-react.html" />
            <id>https://wss.cool/typescript-react.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-01-20T14:15:47+00:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[0. 类型 input的onChange事件，ChangeEvent是event.targ……]]></summary>
            
                <content type="html"><![CDATA[<h2 id="0-类型">0. 类型</h2>
<p>input的onChange事件，ChangeEvent是event.target，FormEvent是event.currentTarget</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts">    <span class="kr">const</span> <span class="nx">handleSearch</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span>: <span class="kt">React.ChangeEvent</span><span class="o">&lt;</span><span class="nx">HTMLInputElement</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">setKeywords</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
            <span class="nx">props</span><span class="p">.</span><span class="nx">onUpdateKeyword</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="1-创建项目">1. 创建项目</h2>
<p><a href="https://github.com/Microsoft/TypeScript-React-Starter#typescript-react-starter">creact-react-app</a>可以直接创建typescript项目。</p>
<pre class="wp-block-code"><code>create-react-app my-app --scripts-version=react-scripts-ts</code></pre>
<h2 id="2-修改配置">2. 修改配置</h2>
<p>2.1. -把tslint.json修改为这样，能舒服一点：</p>
<pre class="wp-block-code"><code>{
  "extends": ["tslint:recommended", "tslint-react", "tslint-config-prettier"],
  "defaultSeverity": "warning",
  "linterOptions": {
    "exclude": [
      "config/**/*.js",
      "node_modules/**/*.ts",
      "coverage/lcov-report/*.js"
    ]
  },
  "rules": {
    "object-literal-sort-keys": false,
    "no-console": false
  }
}</code></pre>
<p>2.2. 在package.json的script中加入这条，可以让tslint自动修复问题：</p>
<pre class="wp-block-code"><code>"lint": "tslint --fix -c ./tslint.json 'src/**/*{.ts,.tsx}'"</code></pre>
<p>千万要注意，你的代码将被修改，所以要<a href="https://stackoverflow.com/a/44850320/6021280">注意以下事项</a>⚠️：</p>
<ul>
<li>Commit the changes you have made to your code</li>
<li>Run TSLint with the <code>--fix</code> flag like above</li>
<li>Quickly review the changes TSLint has made</li>
<li>Make a new commit with these changes, or simply amend them to your previous commit</li>
</ul>
<h2 id="3-各种类型怎么定义">3. 各种类型怎么定义</h2>
<p>class组件需要定义props和state的类型：</p>
<pre class="wp-block-code"><code>interface IProps {
  addTodo: (input: string) => void;
}
interface IState {
  input: string;
}
class AddTodo extends React.Component&lt;IProps, IState>{}</code></pre>
<p>input事件需要定义事件类型：</p>
<pre class="wp-block-code"><code>  public handleInput(event:React.ChangeEvent&lt;HTMLInputElement>) {
    this.updateInput(event.target.value);
  }</code></pre>
<p>HTMLInputElement还可能是HTMLSelectElement等。</p>
<p>.d.ts文件是使用js编写的api才用的。</p>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/api/" term="api" label="api" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%89%8D%E7%AB%AF/" term="前端" label="前端" />
                            
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/react/" term="react" label="react" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">命令行发送email</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/mac-ubuntu-send-email.html" />
            <id>https://wss.cool/mac-ubuntu-send-email.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2019-01-04T04:49:13+00:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html"><![CDATA[python发送邮件]]></summary>
            
                <content type="html"><![CDATA[<p><a href="http://www.ruanyifeng.com/blog/2017/06/smtp-protocol.html">如何验证 Email 地址：SMTP 协议入门教程</a>
<a href="http://fred.itxfd.com/2017/08/08/ubuntu-mail-%E7%94%A8-qq-%E9%82%AE%E7%AE%B1%E5%8F%91%E9%82%AE%E4%BB%B6/">ubuntu mail 用 qq 邮箱发邮件</a></p>
<p>我先尝试在我的mac上发送，先是找到了sendmail相关的介绍，然后找到了mac自带的postfix类似于sendmail，于是研究postfix，将近一天的时间我经历了各种配置与失败。</p>
<p>晚上下班的路上，看了阮一峰的smtp介绍，了解到smtp服务器的身份验证是为了防止垃圾邮件，为了控制垃圾邮件，许多邮件服务器会用自己的方法验证邮件地址，下面就是其中的一些方法。</p>
<ul>
<li>example.com 是否有 MX 记录</li>
<li>example.com 是否可以 Ping 通</li>
<li>是否存在 <a href="mailto:postmaster@example.com">postmaster@example.com</a> 这个邮箱</li>
<li>发起连接的 IP 地址是否在黑名单之中</li>
<li>IP 地址的反向 DNS 解析，是否指向一个邮件服务器</li>
</ul>
<p>qq邮箱也许用了其中某些方法，使用mac链接smtp的话，135应该都是不能通过的，所以导致了在mac上mail失败。具体什么原因导致的不能成功就不深究了。</p>
<p>由于得知了上面的信息，于是尝试用我的云服务器来实验一下，因为云服务器可以ping，有MX记录。正好还发现了一个ubuntu发邮件的文章。步骤如下：（以下主要是某网友的博文）</p>
<p>先用 <code>which mail</code> 看看有没有 <code>mail</code>。</p>
<p>如果没有的话，可以安装如下软件：</p>
<pre><code>sudo apt-get install -y heirloom-mailx
</code></pre><p>有了 <code>mail</code> 后，直接用命令行测试</p>
<pre><code>echo &quot;mail body&quot; | \
mail -v \
-r 6666666@qq.com \
-s &quot;subject&quot; \
-S form=6666666@qq.com \
-S smtp-auth-password=密码或授权码 \
-S smtp-auth-user=6666666@qq.com \
-S smtp-auth=login \
-S smtp-use-starttls \
-S smtp=smtps://smtp.qq.com:465 \
-S ssl-verify=ignore \
6666666@qq.com
</code></pre><p>在配置文件里面配置账号，首先找到相应的配置文件：</p>
<pre><code>strings `which mail` | grep '\.rc'
sudo vim /etc/s-nail.rc﻿
</code></pre><p>在文件尾部添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">set</span> <span class="nx">from</span><span class="o">=</span><span class="mi">6666666</span><span class="err">@</span><span class="nx">qq</span><span class="p">.</span><span class="nx">com</span>
<span class="nx">set</span> <span class="nx">smtp</span><span class="o">-</span><span class="nx">auth</span><span class="o">-</span><span class="nx">password</span><span class="o">=</span><span class="nx">密码或授权码</span>
<span class="nx">set</span> <span class="nx">smtp</span><span class="o">-</span><span class="nx">auth</span><span class="o">-</span><span class="nx">user</span><span class="o">=</span><span class="mi">6666666</span><span class="err">@</span><span class="nx">qq</span><span class="p">.</span><span class="nx">com</span>
<span class="nx">set</span> <span class="nx">smtp</span><span class="o">-</span><span class="nx">auth</span><span class="o">=</span><span class="nx">login</span>
<span class="nx">set</span> <span class="nx">smtp</span><span class="o">=</span><span class="nx">smtps</span><span class="o">:</span><span class="c1">//smtp.qq.com:465
</span><span class="c1"></span><span class="nx">set</span> <span class="nx">ssl</span><span class="o">-</span><span class="nx">verify</span><span class="o">=</span><span class="nx">ignore</span>
</code></pre></td></tr></table>
</div>
</div><p>然后测试：</p>
<pre><code>echo &quot;mail body&quot; | mail -s &quot;subject1&quot; 6666666@qq.com
</code></pre><p>至此，我的qq邮箱可以成功接收到邮件。这件事总算有了结果。</p>
<p>发送邮件虽然能成功，但是我的命令行会打印一个警告</p>
<pre><code>mail: /usr/local/openssl/lib/libssl.so.1.0.0: no version information available (required by mail)
</code></pre><p>经查，及尝试。将警告的2个文件移除即可，也可以改名字：</p>
<pre><code>mv /usr/local/openssl/lib/libssl.so.1.0.0 /usr/local/openssl/lib/libssl.so.1.0.0_bk
</code></pre><p>之后再发邮件就一切顺利了。</p>
<hr>
<p>事情有了新的进展：2019年1月7日。</p>
<p>我又想，为什么mac的邮件app可以发送而命令行却不行吗？应该都是用的SMTP方式来发送邮件的。那么可能还是我配置SMTP参数的问题。</p>
<p>经过搜索了解到，mac的命令行mail是一个旧版的，新版的叫heirloom-mailx或者s-nail。</p>
<p>我通过Homebrew安装了s-nail，将上面测试代码的mail换成s-nail是可以发送邮件的，但是同样的写s-nail.rc后，却不能发送邮件。而且看了man s-nail以后还是不会写抄送参数的配置。</p>
<p>上面的这个过程又消耗了我一天的时间，直接使用s-nail的人似乎很少，没有查到一个能运行的例子，这一天就在各种搜索、配置、测试中度过了。后来又想到安装mail的新本的二进制文件来更新mail似乎也是个办法。但是想到还要重新配置还是很麻烦。就放弃了。</p>
<p>今天早晨坐地铁时想到，shell不行，那就试试python吧。到公司后，在stackoverflow上找到了一个例子，修改smtp地址，账号密码，加上抄送字段。整个过程差不多半个多小时，顺利的发出了邮件🥳🤙🕺💃🎉🎊</p>
<p>幸甚至哉，歌以咏志。</p>
<p>真的惊喜，我真是太蠢了，傻了吧唧地折腾了4天的，最后用python半小时就解决了。</p>
<p>最后奉上python发送邮件的代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#! /usr/local/bin/python</span>

<span class="n">SMTPserver</span> <span class="o">=</span> <span class="s1">&#39;smtp.qq.com:465&#39;</span>
<span class="n">sender</span> <span class="o">=</span>     <span class="s1">&#39;666666@qq.com&#39;</span>
<span class="n">cc</span> <span class="o">=</span> <span class="s2">&#34;888888@163.com&#34;</span>
<span class="n">to</span> <span class="o">=</span> <span class="s2">&#34;666666@qq.com&#34;</span>

<span class="n">USERNAME</span> <span class="o">=</span> <span class="s2">&#34;666666@qq.com&#34;</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&#34;PASSWORD&#34;</span>

<span class="c1"># typical values for text_subtype are plain, html, xml</span>
<span class="n">text_subtype</span> <span class="o">=</span> <span class="s1">&#39;plain&#39;</span>


<span class="n">content</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;</span><span class="se">\
</span><span class="se"></span><span class="s2">Test message
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="n">subject</span><span class="o">=</span><span class="s2">&#34;Sent from Python&#34;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">smtplib</span> <span class="kn">import</span> <span class="n">SMTP_SSL</span> <span class="k">as</span> <span class="n">SMTP</span> <span class="c1"># this invokes the secure SMTP protocol (port 465, uses SSL)</span>
<span class="c1"># from smtplib import SMTP # use this for standard SMTP protocol   (port 25, no encryption)</span>

<span class="c1"># old version</span>
<span class="c1"># from email.MIMEText import MIMEText</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">rcpt</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">to</span><span class="p">]</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">text_subtype</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span><span class="o">=</span>       <span class="n">subject</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">sender</span> <span class="c1"># some SMTP servers will do this automatically, not all</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Cc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cc</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">SMTP</span><span class="p">(</span><span class="n">SMTPserver</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">set_debuglevel</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">USERNAME</span><span class="p">,</span> <span class="n">PASSWORD</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">rcpt</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

<span class="k">except</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="s2">&#34;mail failed; </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="s2">&#34;CUSTOM_ERROR&#34;</span> <span class="p">)</span> <span class="c1"># give an error message</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E6%8A%98%E8%85%BE/" term="折腾" label="折腾" />
                            
                        
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">如何处理大量bug</title>
            <link rel="alternate" type="text/html" href="https://wss.cool/%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%A4%A7%E9%87%8Fbug.html" />
            <id>https://wss.cool/%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%A4%A7%E9%87%8Fbug.html</id>
            <updated>2020-04-13T13:35:15+00:00</updated>
            <published>2018-12-21T16:21:39+00:00</published>
            <author>
                    <name>WangShuShuo</name>
                    <uri>https://wss.cool/</uri>
                    <email>wss.six@foxmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights>
    
    <summary type="html"><![CDATA[处理bug分三步：确认位置及原因，解决方案，实现代码。 bug数量很多时，领导的心里会……]]></summary>
            
                <content type="html"><![CDATA[<p>处理bug分三步：确认位置及原因，解决方案，实现代码。</p>
<p>bug数量很多时，领导的心里会有压力，所以先解决容易改的，让数量降下来，领导的压力小了就可以不加班了。如果你改的数量多还可能认为你比别人有些。</p>
<h2 id="处理问题的1-2-3升级策略">处理问题的“1-2-3”升级策略</h2>
<p>遇到问题的时候，</p>
<ol>
<li>自己一个人处理1小时内没有思路，请找他人小范围讨论</li>
<li>如果与他人2小时内没有结果，请上升到团队范围</li>
<li>如果在团队范围3小时内没有思路</li>
<li>我们就需要借助外部力量了。比如：找产品改需求，找公司外的技术高手做咨询，外包</li>
</ol>
]]></content>
            
            
            
            
            
                
                    
                        
                            
                            
                            
                                <category scheme="https://wss.cool/categories/%E5%BF%83%E5%BE%97%E4%B8%8E%E7%BB%8F%E9%AA%8C/" term="心得与经验" label="心得与经验" />
                            
                        
                    
                
                    
                
            
        </entry>
    
</feed>
